      
!THE MODULE OF THE SOLUTION OF SYSTEM OF THE DIFFERENTIAL EQUATIONS VER 2.0 01.2020
! VER 2.0  01,2020 √Œƒ

!! MODULE FOR SOLVING THE SYSTEM OF DIFFERENTIAL EQUATIONS VERSION 2.0


	
module msde
 implicit none
    
	
 contains

!! SUBPROGRAMME OF THE SOLUTION OF THE SYSTEM OF DIFFERENTIAL EQUATIONS (PROGON + NUMEROV METHOD)
†!! OBTAINING THE WAVE FUNCTION OF A MOLECULAR SHELL
†!! IndexExit-PARAMETER INDICATING EMERGENCY STOPPING OF THE PROGRAM
†!! IndexExit = 0-PROGRAM WORKS WITHOUT FAILURES
†!! IndexExit = 1-HAS FAILED THROUGH READING INFORMATION FROM EMERGENCY FILES
†!! NNEL-MAIN QUANTUM NUMBER OF MOLECULAR ORBITALS
†!! Niteration-Iteration Number
†!! NMO-NUMBER OF MOLECULAR SHELL IN CONFIGURATION
†!! NumeroMin-FIRST HARMONY NUMBER
†!! NumeroMax-NUMBER OF LAST HARMONIC
†!! NLST-KEY INDICATED ON THE PROCESS OF MIXING THE PREVIOUS CONFIGURATION TO THE DATA
†!! IreshimSO-PARAMETER INDICATING THE TYPE OF HARMONIZATION OF MOLECULAR ORBITALS
†!! IreshimSO = 0-STANDARD MODE OF CODE
†!! IreshimSO = 1- "STRENGTHENING" HARMONIZATION MODE THE BINDING COEFFICIENTS ARE EXPRESSED
†!! Npoint-NUMBER OF POINTS
†!! H-STEP
†!! EPS-ACCURACY DETERMINATION OF SINGLE-ELECTRON ENERGY
†!! TETMAX-MAXIMUM DEVIATION OF PREVIOUS ITERATION FROM THIS DATA
†!! TETA (NMO) -MASSIVE DEVIATIONS OF EACH FUNCTION
†!! MAXCNV-NUMBER OF THE POINT APPROPRIATE TO MAXIMUM REJECTION
†!! E3 (NMO) -MASSIVE OF SINGLE-ELECTRON ENERGIES RECEIVED ON NITERATION-1 ITERATION
†!! E4 (NMO) -MASSIVE OF SINGLE-ELECTRONIC ENERGIES OBTAINED ON NITERATION-2 ITERATIONS
†!! E5 (NMO) -MASSIVE OF SINGLE-ELECTRON ENERGIES RECEIVED ON NITERATION-3 ITERATIONS
†!! DeltaEnegry (NMO, 2) -MASSIVE INDICATORY DEVIATION OF SINGLE-ELECTRON ENERGY RECEIVED BY SOLUTION OF A HOMOGENEOUS AND INHOMOGENEOUS EQUATION
†!! RnormMOXFII-NORMAL FACTOR FOR THIS MOLECULAR ORBITAL FOR THIS ITERATION
†!! RnormMOXF (NMO) -MASSIVE NORMALITY COEFFICIENTS FOR EACH MOLECULAR ORBITAL OBTAINED AT THE FIRST STEP OF CRITERIA
†!! DETERMINING RECEIPT OF RIGHT FUNCTIONS AT EACH STAGE OF HARMONIZATION
†!! Pz (NumbreGarmMO (NMO), NumbreGarmMO (NMO), Npoint) - VALUE MAP of the P (ro) -particle of the log function P entering the equation Y '' = P * Y + Q-LOCAL POTENTIAL
†!! Qz (NumbreGarmMO (NMO), Npoint + 2) -MASSIVE of VALUES of the Q (ro) -function into the equation in the equation Y '' = P * Y + Q-NONLOCAL PART OF POTENTIAL
†!! RFunMO (NMO, NumbreGarmMO (NumbreMO), Npoint + 2) is the array of values ??of the radial parts of the harmonics of the molecular orbitals of the configuration
†!! FunMOOld (NMO, NumbreGarmMO (NumbreMO), Npoint + 2) is the array of values ??of the radial parts of the harmonics of the molecular orbitals of the configuration for writing the forward iteration
†!! FunMONew (NMO, NumbreGarmMO (NumbreMO), Npoint + 2) is the array of values ??of the radial parts of harmonics of the molecular configuration orbitals for writing this iteration not mixed with the previous one
†!! RO1X (Npoint) - MASSIVE VALUES OF THE FIRST DERIVATIVE ON THE NEW VARIABLE
†!! ENN0-LOWER ENERGY BORDER
†!! NumreISzam (NumbreMO) -MASSIVE NUMBER OF SHELLS OF EQUIVALENT DATA
†!! ISCalculZZ (NumbreMO, NumbreMO) -MASIVE OF EQUIVALENT DATA SHEET NUMBERS
†!! IKLExchange-KEY TO THE TYPE OF CALCULATION
†!! IKLExchange = 0- CALCULATION WITHOUT EXCHANGE
†!! IKLExchange = 1- CALCULATION WITH EXCHANGE
†!! IRETURN-KEY APPROPRIATE TO THE RESULT OF THE WORK OF THE PROGRAM
†!! IRETURN = 0-REMOVAL SOLVED AND ROOF FOUND
†!! IRETURN = 1-EQUATION NOT SOLVED ROOTS NOT AVAILABLE
†!! RparamterCalcul () - MASSIVE OF INTERMEDIATE PARAMETERS OF CALCULATION
†!! NumeroMaxLimid-MAXIMUM NUMBER HARMONIC FOR THIS MOLECULAR ORBITAL
†!! NumbreLigand (NumbreMO) -MASSIVE NUMBER OF LIGANDES WHICH FUNCTIONS DESCRIBE HIGHER HARMONICS OF THIS MOLECULAR ORBITAL
†!! NLigands (NumbreMO, NumbreLigand (NumbreMO)) - MASSIVE OF LIGAND NUMBERS FUNCTIONS WHICH DESCRIBE HIGHER HARMONICS OF THIS MOLECULAR ORBITAL
†!! NFunLigands (NumbreMO, NumbreLigand (NumbreMO)) - A MASSIVE OF THE NUMBER OF FUNCTIONS OF EACH LIGAND DESCRIBING HIGHER HARMONICS OF THIS MOLECULAR ORBITAL
†!! NumbreFunctionLig (NumbreMO, NumbreLigand (NumbreMO), NFunLigands (NumbreMO, NumbreLigand (NumbreMO)))) - MASSIVE OF NUMBERS OF LIGAND FUNCTIONS THAT COMPLY WITH THIS MOLECULAR ORBITAL
†!! RfunLigands (Nnuclei, NumbreFunctionLig, NumbreGarmLigand, Npoint + 2) -MASSIVE OF VALUES OF LIGAND FUNCTIONS
†!! AlfaCoffMO (NumbreMO, NumbreLigand, NumbreFunLigand) -MASSIVE OF COEFFICIENTS WITH WHICH LIGANDA FUNCTIONS COME INTO THE STRUCTURE OF MOLECULAR ORBITAL
†!! NumbreRegion (NumbreMO) -MASSIVE NUMBER OF REGIONS IN WHICH A ROOT REDUCTION IS CARRIED OUT
†!! EnergyZeroZ (NumbreMO, NNEL + 1,2) -MASSIVE OF THE ROOTS OF A HOMOGENEOUS EQUATION
†!! EnergyRegion (NumbreMO, NNEL + 1,2) -MASSIVE OF AREAS IN WHICH STEP DECREASES
†!! IndexRegionHMIN (NumbreMO, NNEL + 1) -MASSIVE INDEX OF INDICATORS INDEXING STEP FOR DETERMINING BORDERS FOR THIS MINIMUM
†!! EnergyRegionHMIN (NumbreMO, NNEL + 1,2) -MASSIVE OF INITIAL STEPS FOR DETERMINATION OF THE BOUNDARIES OF MINIMUMS
 subroutine SolutionSystemDifferentialEquations(IndexExit,NNEL,Niteration,NMO,NumeroMin,NumeroMax,NLST,IreshimSO,Npoint,H,EPS,TETMAX,TETA,MAXCNV,E3,E4,E5,DeltaEnegry,RnormMOXFII,RnormMOXF,Pz,Qz,RFunMO,FunMOOld,FunMONew,RO1X,ENN0,NumreISzam,ISCalculZZ,IKLExchange,IRETURN,RparamterCalcul,NumeroMaxLimid,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,RfunLigands,AlfaCoffMO,NumbreRegion,EnergyZeroZ,EnergyRegion,IndexRegionHMIN,EnergyRegionHMIN)
   implicit none
   integer::IndexExit,NNEL,Niteration,NMO,NumeroMin,NumeroMax,NLST,Npoint,MAXCNV,IKLExchange,IRETURN,NumeroMaxLimid,IreshimSO
   real(8)::H,EPS,TETMAX,ENN0,RnormMOXFII
   integer,dimension(:)::NumreISzam,NumbreLigand,NumbreRegion
   integer,dimension(:,:)::ISCalculZZ,NLigands,NFunLigands,IndexRegionHMIN
   integer,dimension(:,:,:)::NumbreFunctionLig
   real(8),dimension(:)::TETA,E3,E4,E5,RnormMOXF,RO1X,RparamterCalcul
   real(8),dimension(:,:)::Qz,DeltaEnegry
   real(8),dimension(:,:,:)::Pz,RFunMO,FunMOOld,FunMONew,AlfaCoffMO,EnergyZeroZ,EnergyRegion,EnergyRegionHMIN 
   real(8),dimension(:,:,:,:)::RfunLigands
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   integer::IndexM,IndexML,IIX,ierr,Kpoint,NEpsIter,IYXDS,IIK,IIO,IparametrDeterEnergy,INEXDSEXF,IZNAK,IndexVilky,INDEXDF,IIKK,IndexCorrect,IndexSolutions,IndexSUMZK
   integer::IIXXYYT,IICFHK,IcorenZZ,INlevo,INspravo,IIIOPL,IntParXX,IntParXXZ,IKLSDCalcul,IndexCorrectSET,IndexSolutionsSET,INDEXGRNYT,IndexExitRerern
   integer::IISSXDDZS,IparDeterEnergy,IparDeter,Indexfr,IIISDD,INDEXZZSFA,INDEXEXITRF,IndexIIUMN,IndexMinDifini
   real(8)::RcofXZSD,Rcof,Exf,Henergy,T,RnormMO,C,EZR,BBL,RRnormcoff,ExfZero,ErrorRP,ExfLevo,ExfSpravo,Rkriter,EXXX1,Emin,RHS,RX0,RX1,RX2,RnormX0,RnormX1,RnormX2
   real(8)::Rfun0XZ,Xfun0XZ,Rfun1XZ,Xfun1XZ,Rfun2XZ,Xfun2XZ,RfunMIN,RgarMIN,REmin,E1X,E2X,E3X,E4X,D1X,D2X,D3X,D4X,E1XX,E2XX,E3XX,E4XX,D1XX,D2XX,D3XX,D4XX,ExfTemp,RGHK
   real(8)::HenergySET,ExfSETT,EZZmax,EZZmin,EZZ0cert,EESXZ0,REleft,REright,EEDP,EminGranL,EminGranR
   real(8),dimension(3)::ExfSolutions 
   real(8),dimension(10)::DetM,ExfM,DetMA,ExfMA,Egran,RdeltaZnak,ExfSET,DetSET
   integer,allocatable,dimension(:)::IndexMin  
   integer,allocatable,dimension(:,:)::IXM,IndexGranyMin  
   real(8),allocatable,dimension(:)::AX,BX,CX,DX,UNout,UNin,BXL,EEMmin,DDMmin
   real(8),allocatable,dimension(:,:)::E,AZ,BZ,FZ,DZ,FX,Uout,Uin,VNout,VNin,FunMO,EEGranymin
   real(8),allocatable,dimension(:,:,:)::A,B,AA,BB,Vout,Vin
   
   ! «¿Õ”Àﬂ≈Ã œ≈–≈ƒ –¿—◊≈“ŒÃ 
   ExfLevo=0.D0
   ExfSpravo=0.D0 
   

   ! Œœ–≈ƒ≈Àﬂ≈Ã –¿«Ã≈– Ã¿——»¬¿
   IndexM=NumeroMax-NumeroMin+1
   IndexML=NumeroMaxLimid-NumeroMin+1
   
   !¬€ƒ≈Àﬂ≈Ã œ¿Ãﬂ“‹ ƒÀﬂ Ã¿——»¬Œ¬ 
   allocate(EEMmin(NNEL),stat=ierr)
   if(ierr/=0) then
      write(*,*)'SolutionSystemDifferentialEquations'
      write(*,*)'MEMORY ON THE FILE "EEMmin" IS NOT SELECTED'
      read(*,*)
	  stop 
   endif
   allocate(EEGranymin(NNEL,2),stat=ierr)
   if(ierr/=0) then
      write(*,*)'SolutionSystemDifferentialEquations'
      write(*,*)'MEMORY ON THE FILE "EEGranymin" IS NOT SELECTED'
      read(*,*)
	  stop 
   endif
   allocate(IndexGranyMin(NNEL,2),stat=ierr)
   if(ierr/=0) then
      write(*,*)'SolutionSystemDifferentialEquations'
      write(*,*)'MEMORY ON THE FILE "IndexGranyMin" IS NOT SELECTED'
      read(*,*)
	  stop 
   endif
   allocate(DDMmin(NNEL),stat=ierr)
   if(ierr/=0) then
      write(*,*)'SolutionSystemDifferentialEquations'
      write(*,*)'MEMORY ON THE FILE "DDMmin" IS NOT SELECTED'
      read(*,*)
	  stop 
   endif
   allocate(IndexMin(NNEL-1),stat=ierr)
   if(ierr/=0) then
      write(*,*)'SolutionSystemDifferentialEquations'
      write(*,*)'MEMORY ON THE FILE "IndexMin" IS NOT SELECTED'
      read(*,*)
	  stop 
   endif
   allocate(FunMO(size(RFunMO,dim=2),size(RFunMO,dim=3)),stat=ierr)
   if(ierr/=0) then
      write(*,*)'SolutionSystemDifferentialEquations'
      write(*,*)'MEMORY ON THE FILE "FunMO" IS NOT SELECTED'
      read(*,*)
	  stop 
   endif
   allocate(AX(IndexM),stat=ierr)
   if(ierr/=0) then
      write(*,*)'SolutionSystemDifferentialEquations'
      write(*,*)'MEMORY ON THE FILE "AX" IS NOT SELECTED'
      read(*,*)
	  stop 
   endif
   allocate(BX(IndexM),stat=ierr)
   if(ierr/=0) then
      write(*,*)'SolutionSystemDifferentialEquations'
      write(*,*)'MEMORY ON THE FILE "BX" IS NOT SELECTED'
      read(*,*)
	  stop 
   endif
   allocate(BXL(IndexML),stat=ierr)
   if(ierr/=0) then
      write(*,*)'SolutionSystemDifferentialEquations'
      write(*,*)'MEMORY ON THE FILE "BXL" IS NOT SELECTED'
      read(*,*)
	  stop 
   endif
   allocate(CX(IndexM),stat=ierr)
   if(ierr/=0) then
      write(*,*)'SolutionSystemDifferentialEquations'
      write(*,*)'MEMORY ON THE FILE "CX" IS NOT SELECTED'
      read(*,*)
	  stop 
   endif
   allocate(DX(IndexM),stat=ierr)
   if(ierr/=0) then
      write(*,*)'SolutionSystemDifferentialEquations'
      write(*,*)'MEMORY ON THE FILE "DX" IS NOT SELECTED'
      read(*,*)
	  stop 
   endif
   allocate(E(IndexM,IndexM),stat=ierr)
   if(ierr/=0) then
      write(*,*)'SolutionSystemDifferentialEquations'
      write(*,*)'MEMORY ON THE FILE "E" IS NOT SELECTED'
      read(*,*)
	  stop 
   endif
   allocate(FZ(IndexM,IndexM),stat=ierr)
   if(ierr/=0) then
      write(*,*)'SolutionSystemDifferentialEquations'
      write(*,*)'MEMORY ON THE FILE "FZ" IS NOT SELECTED'
      read(*,*)
	  stop 
   endif
   allocate(AZ(IndexM,IndexM),stat=ierr)
   if(ierr/=0) then
      write(*,*)'SolutionSystemDifferentialEquations'
      write(*,*)'MEMORY ON THE FILE "AZ" IS NOT SELECTED'
      read(*,*)
	  stop 
   endif
   allocate(BZ(IndexM,IndexM),stat=ierr)
   if(ierr/=0) then
      write(*,*)'SolutionSystemDifferentialEquations'
      write(*,*)'MEMORY ON THE FILE "BZ" IS NOT SELECTED'
      read(*,*)
	  stop 
   endif
   allocate(DZ(IndexM,IndexM),stat=ierr)
   if(ierr/=0) then
      write(*,*)'SolutionSystemDifferentialEquations'
      write(*,*)'MEMORY ON THE FILE "DZ" IS NOT SELECTED'
      read(*,*)
	  stop 
   endif     
   allocate(IXM(IndexM,2),stat=ierr)
   if(ierr/=0) then
      write(*,*)'SolutionSystemDifferentialEquations'
      write(*,*)'MEMORY ON THE FILE "IXM" IS NOT SELECTED'
      read(*,*)
	  stop 
   endif
   !!!!!!!!!!! Ã¿——»¬€ ƒÀﬂ –¿—◊≈“¿ !!!!!!!!!!!!!!!
   allocate(A(IndexM,IndexM,Npoint),stat=ierr)
   if(ierr/=0) then
      write(*,*)'SolutionSystemDifferentialEquations'
      write(*,*)'MEMORY ON THE FILE "A" IS NOT SELECTED'
      read(*,*)
	  stop 
   endif
   allocate(B(IndexM,IndexM,Npoint),stat=ierr)
   if(ierr/=0) then
      write(*,*)'SolutionSystemDifferentialEquations'
      write(*,*)'MEMORY ON THE FILE "B" IS NOT SELECTED'
      read(*,*)
	  stop 
   endif
   allocate(FX(IndexM,Npoint),stat=ierr)
   if(ierr/=0) then
      write(*,*)'SolutionSystemDifferentialEquations'
      write(*,*)'MEMORY ON THE FILE "FX" IS NOT SELECTED'
      read(*,*)
	  stop 
   endif
   allocate(AA(IndexM,IndexM,Npoint),stat=ierr)
   if(ierr/=0) then
      write(*,*)'SolutionSystemDifferentialEquations'
      write(*,*)'MEMORY ON THE FILE "AA" IS NOT SELECTED'
      read(*,*)
	  stop 
   endif
   allocate(BB(IndexM,IndexM,Npoint),stat=ierr)
   if(ierr/=0) then
      write(*,*)'SolutionSystemDifferentialEquations'
      write(*,*)'MEMORY ON THE FILE "BB" IS NOT SELECTED'
      read(*,*)
	  stop 
   endif
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! 
   allocate(Vout(IndexM,IndexM,Npoint),stat=ierr)
   if(ierr/=0) then
      write(*,*)'SolutionSystemDifferentialEquations'
      write(*,*)'MEMORY ON THE FILE "Vout" IS NOT SELECTED'
      read(*,*)
	  stop 
   endif
   allocate(Vin(IndexM,IndexM,Npoint),stat=ierr)
   if(ierr/=0) then
      write(*,*)'SolutionSystemDifferentialEquations'
      write(*,*)'MEMORY ON THE FILE "Vin" IS NOT SELECTED'
      read(*,*)
	  stop 
   endif
   allocate(VNout(IndexM,IndexM),stat=ierr)
   if(ierr/=0) then
      write(*,*)'SolutionSystemDifferentialEquations'
      write(*,*)'MEMORY ON THE FILE "VNout" IS NOT SELECTED'
      read(*,*)
	  stop 
   endif
   allocate(VNin(IndexM,IndexM),stat=ierr)
   if(ierr/=0) then
      write(*,*)'SolutionSystemDifferentialEquations'
      write(*,*)'MEMORY ON THE FILE "VNin" IS NOT SELECTED'
      read(*,*)
	  stop 
   endif
   allocate(Uout(IndexM,Npoint),stat=ierr)
   if(ierr/=0) then
      write(*,*)'SolutionSystemDifferentialEquations'
      write(*,*)'MEMORY ON THE FILE "Uout" IS NOT SELECTED'
      read(*,*)
	  stop 
   endif
   allocate(Uin(IndexM,Npoint),stat=ierr)
   if(ierr/=0) then
      write(*,*)'SolutionSystemDifferentialEquations'
      write(*,*)'MEMORY ON THE FILE "Uin" IS NOT SELECTED'
      read(*,*)
	  stop 
   endif
   allocate(UNout(IndexM),stat=ierr)
   if(ierr/=0) then
      write(*,*)'SolutionSystemDifferentialEquations'
      write(*,*)'MEMORY ON THE FILE "UNout" IS NOT SELECTED'
      read(*,*)
	  stop 
   endif
   allocate(UNin(IndexM),stat=ierr)
   if(ierr/=0) then
      write(*,*)'SolutionSystemDifferentialEquations'
      write(*,*)'MEMORY ON THE FILE "UNin" IS NOT SELECTED'
      read(*,*)
	  stop 
   endif

   !write(6,*)
   !write(6,*) 'local criteriy',Niteration,NMO
 
   34678 FORMAT(2X,100(F15.10,1X))
   35678 FORMAT(2X,100(1X,F20.16))
   89787 FORMAT(5X,I3,5X,I2,1X,F10.5,1X,F10.5,1X,1X,F10.5,1X,F10.5,2X,F7.5)

   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   !! ›“¿œ 0. œŒƒ√Œ“Œ¬»“≈À‹Õ€… !!!!!!!!!!!!!!!!
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   ! ‘Œ–Ã»–”≈Ã ≈ƒ»Õ»◊Õ”ﬁ Ã¿“–»÷”
   
   Rcof=H*H/12.D0
   E=0.D0
   !DO IIX=1,IndexM
   !   E(IIX,IIX)=1.D0 
   !ENDDO 
   FORALL (IIX=1:IndexM) E(IIX,IIX)=1.D0 
     
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   !! ›“¿œ 1. ‘Œ–Ã»–”≈Ã Ã¿——»¬€ ”◊¿¬—“¬”ﬁŸ»≈ ¬ –¿—◊≈“≈!! 
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ ÀŒ ¿À‹Õ€’ —À¿√¿≈Ã€’
   DO IIX=1,Npoint
      call ReadWriteMassiv2X(IIX,NumeroMin,NumeroMax,Pz,FZ) 
      
	  AZ=E-Rcof*FZ
	  BZ=2.D0*E+10.D0*Rcof*FZ
      	       
	  call ReadWriteMassiv2(1,IIX,IndexM,A,AZ) 
	  call ReadWriteMassiv2(1,IIX,IndexM,B,BZ)  
   ENDDO
      
   ! œ–Œ¬≈–ﬂ≈Ã  Àﬁ◊ ƒÀﬂ ”—“¿ÕŒ¬À≈Õ≈ Õ≈Œ¡’Œƒ»ÃŒ—“» ¬ –¿—◊≈“≈ Õ≈ŒƒÕŒ–ŒƒÕŒ√Œ —À¿√¿≈ÃŒ√Œ (Œ¡Ã≈ÕÕŒ√Œ —À¿√¿≈ÃŒ√Œ)
   IF(IKLExchange.EQ.1) THEN
      IntParXX=1
   ENDIF
   IF(IKLExchange.EQ.0) THEN
      IntParXX=0
   ENDIF

   IF(IntParXX.EQ.1) THEN
      DO IIX=2,Npoint-1
         call ReadWriteMassiv1X(2,IIX-1,NumeroMin,NumeroMax,Qz,AX)
		 call ReadWriteMassiv1X(2,IIX,NumeroMin,NumeroMax,Qz,BX) 
         call ReadWriteMassiv1X(2,IIX+1,NumeroMin,NumeroMax,Qz,CX) 
         DX=Rcof*(AX+10.D0*BX+CX)
         call ReadWriteMassiv1(1,IIX,IndexM,FX,DX) 
      ENDDO 
   ENDIF

   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! 
   ! ›“¿œ 2. Õ¿’Œƒ»Ã ŒƒÕŒ›À≈ “–ŒÕÕ”ﬁ ›Õ≈–√»ﬁ!!!!!!!!!!!!!!!!!!!!
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! 

   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! 
   ! ›“¿œ 2.1  Õ¿’Œƒ»Ã ŒƒÕŒ›À≈ “–ŒÕÕ”ﬁ ›Õ≈–√»ﬁ –≈ÿ≈Õ»≈Ã ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€ ”–¿¬Õ≈Õ»… !!!!!
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   
   ! ”—“¿Õ¿¬À»¬¿≈Ã “»œ –¿—◊≈“¿ 
   IF(IKLExchange.EQ.1) THEN
      IntParXX=1
   ENDIF
   IF(IKLExchange.EQ.0) THEN
      IntParXX=0
   ENDIF
   !  Àﬁ◊ ” ¿«€¬¿ﬁŸ»… Õ¿ –¿—◊≈“ ÕŒ–Ã€
   IISSXDDZS=0
   
   ! œ–Œ¬≈–ﬂ≈Ã “»œ –¿—◊≈“¿
   IF(Niteration.EQ.1.AND.IntParXX.EQ.0) THEN

        ! ƒÀﬂ —À”◊¿ﬂ œ≈–¬Œ… »“≈–¿÷»» » ¡≈« Œ¡Ã≈Õ¿ ƒÀﬂ ¬—≈’ –≈ÿ≈Õ»… ŒƒÕŒ–ŒƒÕŒ√Œ ”–¿¬Õ≈Õ»… »—œŒÀ‹«”≈“—ﬂ —“¿Õƒ¿–“Õ€… Ã≈“Œƒ
	    ! —“¿Õƒ¿–“Õ€… Ã≈“Œƒ –¿—◊≈“¿
	    WRITE(17,*) 'Energy zero',Niteration,NMO
		call SearchEnergySolutionHomogeneousSystemStandard(IndexExit,Niteration,NMO,NNEL,Npoint,NumeroMin,Kpoint,IndexM,Rcof,EPS,Pz,RO1X,A,B,AA,BB,E,AZ,FZ,BZ,FX,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,DZ,AX,BX,ENN0,ExfZero,NumbreRegion,EnergyZeroZ,EnergyRegion) 
	
	    ! –≈ÿ≈Õ»≈ ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€ ”–¿¬Õ≈Õ»… 
	    Exf=ExfZero
	 ELSE
            
        ! ‘» —»–”≈Ã Ã≈“Œƒ –¿—◊≈“¿
        IF(NNEL.LT.4) THEN
		  
           ! —“¿Õƒ¿–“Õ€… Ã≈“Œƒ –¿—◊≈“¿
		   WRITE(17,*) 'Energy zero',Niteration,NMO
           call SearchEnergySolutionHomogeneousSystemStandard(IndexExit,Niteration,NMO,NNEL,Npoint,NumeroMin,Kpoint,IndexM,Rcof,EPS,Pz,RO1X,A,B,AA,BB,E,AZ,FZ,BZ,FX,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,DZ,AX,BX,ENN0,ExfZero,NumbreRegion,EnergyZeroZ,EnergyRegion) 
            
		   ! –≈ÿ≈Õ»≈ ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€ ”–¿¬Õ≈Õ»… 
		   Exf=ExfZero 
        ENDIF

        IF(NNEL.GT.3) THEN
		   ! ”— Œ–≈ÕÕ€… Ã≈“Œƒ –¿—◊≈“¿
		   WRITE(17,*) 'Energy zero',Niteration,NMO
           ! ƒÀﬂ œ≈–¬€’ “–≈’ »“≈–¿÷»… —Œ’–¿Õﬂ≈Ã ¬—≈ Ã≈“Œƒ€ 
		   IF(Niteration.LT.4) THEN
              
			   call SearchEnergySolutionHomogeneousSystemAccelerated(IndexExit,Niteration,NMO,NNEL,Npoint,NumeroMin,Kpoint,IndexM,Rcof,EPS,Pz,RO1X,A,B,AA,BB,E,AZ,FZ,BZ,FX,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,DZ,AX,BX,ENN0,ExfSolutions,IndexCorrectSET,IndexSolutionsSET,HenergySET,ExfSETT,ExfSET,DetSET,NumbreRegion,EnergyZeroZ,EnergyRegion) 
            
		       ! –≈ÿ≈Õ»≈ ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€ ”–¿¬Õ≈Õ»… 
               ExfZero=ExfSolutions(2)
               Exf=ExfSolutions(2) 
		      
			  ELSE
			   ! œ–Œ¬≈–ﬂ≈Ã Œ—”Ÿ≈—“¬Àﬂ≈“—ﬂ –≈ÿ≈Õ»≈ ”–¿¬Õ≈Õ»ﬂ ’¿–“–» »À» ’¿–»–»-‘Œ ¿
		       ! –≈ÿ≈Õ»≈ ”–¿¬Õ≈Õ»ﬂ ’¿–“–»
		       IF(IntParXX.EQ.0) THEN
                  call SearchEnergySolutionHomogeneousSystemAccelerated(IndexExit,Niteration,NMO,NNEL,Npoint,NumeroMin,Kpoint,IndexM,Rcof,EPS,Pz,RO1X,A,B,AA,BB,E,AZ,FZ,BZ,FX,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,DZ,AX,BX,ENN0,ExfSolutions,IndexCorrectSET,IndexSolutionsSET,HenergySET,ExfSETT,ExfSET,DetSET,NumbreRegion,EnergyZeroZ,EnergyRegion) 
            
		          ! –≈ÿ≈Õ»≈ ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€ ”–¿¬Õ≈Õ»… 
                  ExfZero=ExfSolutions(2)
                  Exf=ExfSolutions(2) 
               ENDIF
		       ! –≈ÿ≈Õ»≈ ”–¿¬Õ≈Õ»ﬂ ’¿–“–»-‘Œ ¿
		       ! ÕŒ¬€… Ã≈“Œƒ –≈ÿ≈Õ»ﬂ ”–¿¬Õ≈Õ»ﬂ ’¿–“–»-‘Œ ¿ Œ—ÕŒ¬¿Õ Õ¿ Œœ–≈ƒ≈À≈Õ»ﬂ Ã»Õ»Ã”ÃŒ¬ Ã≈∆ƒ”  Œ“Œ–€Ã» Õ¿’Œƒ»“—ﬂ  Œ–≈Õ‹
		       ! ƒÀﬂ «¿œ”— ¿ œ–Œ÷≈ƒ”–€ Õ≈Œ¡’Œƒ»ÃŒ Œœ–≈ƒ≈À»“‹ œ≈–¬€…  Œ–≈Õ‹
               IF(IntParXX.EQ.1) THEN
		          ! ” ¿«€¬¿≈Ã “Œ ◊“Œ ¬ ƒ¿ÕÕŒÃ —À”◊¿≈ ÕŒ–Ã¿ Õ≈ –¿—◊»“€¬¿≈“—ﬂ
				  IISSXDDZS=1
                  
				  call SearchEnergySolutionHomogeneousSystemAccelerated2(IndexExit,Niteration,NMO,1,Npoint,NumeroMin,Kpoint,IndexM,Rcof,EPS,Pz,RO1X,A,B,AA,BB,E,AZ,FZ,BZ,FX,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,DZ,AX,BX,ENN0,ExfSolutions,IndexCorrectSET,IndexSolutionsSET,HenergySET,ExfSETT,ExfSET,DetSET,NumbreRegion,EnergyZeroZ,EnergyRegion) 
            
		          ! –≈ÿ≈Õ»≈ ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€ ”–¿¬Õ≈Õ»… 
                  ExfZero=ExfSolutions(1)
                  Exf=ExfSolutions(1)  
		       ENDIF
           ENDIF
        ENDIF
   ENDIF


   ! ”—“¿Õ¿¬À»¬¿≈Ã “»œ –¿—◊≈“¿
   IF(IKLExchange.EQ.1) THEN
      IntParXX=1
   ENDIF
   IF(IKLExchange.EQ.0) THEN
      IntParXX=0
   ENDIF

   ! Œœ–≈ƒ≈Àﬂ≈Ã ÕŒ–Ã»–Œ¬Œ◊Õ”ﬁ  ŒÕ—“¿Õ“”  –»“≈–»… Œ“¡Œ–¿ –≈ÿ≈Õ»…
   ! œ–Œ¬≈–ﬂ≈Ã “»œ ¬€’Œƒ¿
   IF(IndexExit.EQ.0) THEN
      IF(Niteration.EQ.1.AND.IntParXX.EQ.1) THEN 
         ! Œœ–≈ƒ≈Àﬂ≈Ã ÕŒÃ≈– “Œ◊ » —ÿ»¬ » –≈ÿ≈Õ»… OUT AND IN
         call PointIntersection(Npoint,NumeroMin,Exf,Pz,RO1X,Kpoint)
    
	     ! œŒƒœ–Œ√–¿ÃÃ¿ ‘Œ–Ã»–”≈“ Ã¿——»¬€ ƒÀﬂ –¿—◊≈“¬¿ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ »
         call FormMassivAABB(Npoint,IndexM,Rcof,Exf,A,B,AA,BB,RO1X,E,AZ,FZ,BZ)
       
         ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » ƒÀﬂ ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€
         call CalculationParameterProgonky(1,IndexM,Kpoint,Npoint,AA,BB,FX,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,AZ,BZ,FZ,DZ,E,AX,BX)
 
         ! Õ¿’Œƒ»Ã «Õ¿◊≈Õ»ﬂ √¿–ÃŒÕ»  ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» ¬ “Œ◊ ≈ —ÿ»¬ »
         call CalculationValuesGarmonikMO(Kpoint,IndexM,NumeroMin,NumeroMax,Vout,Vin,FunMO,AZ,BZ,E,AX,BX)
    
         ! Œ—”Ÿ≈—“¬Àﬂ≈Ã ¬Œ——“¿ÕŒ¬À≈Õ»≈ «Õ¿◊≈Õ»… ‘”Õ ÷»» ¬ ¬—≈’ “Œ◊ ¿’ Œ“ “Œ◊ » —ÿ»¬ » » ÕŒ–Ã»–”≈Ã œŒÀ”◊≈ÕÕ”ﬁ ‘”Õ ÷»ﬁ ƒÀﬂ —À”◊¿ﬂ ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€
         call FunctionRecovery(1,Kpoint,IndexM,Npoint,NumeroMin,NumeroMax,H,Vout,Uout,Vin,Uin,FunMO,AX,BX,BXL,CX,VNout,UNout,VNin,UNin,RO1X,NMO,NumeroMaxLimid,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,RfunLigands,AlfaCoffMO) 
   
         ! «¿œ»—€¬¿≈Ã ÕŒ–Ã»–Œ¬Œ◊Õ€…  Œ›‘‘»÷»≈Õ“ ( –»“≈–»… Œœ–≈ƒ≈À≈Õ»ﬂ œ–¿¬»À‹ÕŒ… ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»»)
         RnormMOXF(NMO)=FunMO(NumeroMin,2)
      ENDIF
   ENDIF
     



   ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ ÕŒ–Ã»–Œ¬Œ◊ÕŒ…  ŒÕ—“¿Õ“€ ƒÀﬂ ƒ¿ÕÕŒ… ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» ƒÀﬂ ƒ¿ÕÕŒ… »“≈–¿÷»»
   RnormMOXFII=0.D0
   IF(IISSXDDZS.EQ.0) THEN
      ! Œœ–≈ƒ≈Àﬂ≈Ã ÕŒÃ≈– “Œ◊ » —ÿ»¬ » –≈ÿ≈Õ»… OUT AND IN
      call PointIntersection(Npoint,NumeroMin,Exf,Pz,RO1X,Kpoint)
    
      ! œŒƒœ–Œ√–¿ÃÃ¿ ‘Œ–Ã»–”≈“ Ã¿——»¬€ ƒÀﬂ –¿—◊≈“¬¿ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ »
      call FormMassivAABB(Npoint,IndexM,Rcof,Exf,A,B,AA,BB,RO1X,E,AZ,FZ,BZ)
      
      ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » ƒÀﬂ ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€
      call CalculationParameterProgonky(1,IndexM,Kpoint,Npoint,AA,BB,FX,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,AZ,BZ,FZ,DZ,E,AX,BX)
 
      ! Õ¿’Œƒ»Ã «Õ¿◊≈Õ»ﬂ √¿–ÃŒÕ»  ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» ¬ “Œ◊ ≈ —ÿ»¬ »
      call CalculationValuesGarmonikMO(Kpoint,IndexM,NumeroMin,NumeroMax,Vout,Vin,FunMO,AZ,BZ,E,AX,BX)
    
      ! Œ—”Ÿ≈—“¬Àﬂ≈Ã ¬Œ——“¿ÕŒ¬À≈Õ»≈ «Õ¿◊≈Õ»… ‘”Õ ÷»» ¬ ¬—≈’ “Œ◊ ¿’ Œ“ “Œ◊ » —ÿ»¬ » » ÕŒ–Ã»–”≈Ã œŒÀ”◊≈ÕÕ”ﬁ ‘”Õ ÷»ﬁ ƒÀﬂ —À”◊¿ﬂ ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€
      call FunctionRecovery(1,Kpoint,IndexM,Npoint,NumeroMin,NumeroMax,H,Vout,Uout,Vin,Uin,FunMO,AX,BX,BXL,CX,VNout,UNout,VNin,UNin,RO1X,NMO,NumeroMaxLimid,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,RfunLigands,AlfaCoffMO) 
   
      ! «¿œ»—€¬¿≈Ã ÕŒ–Ã»–Œ¬Œ◊Õ€…  Œ›‘‘»÷»≈Õ“ ( –»“≈–»… Œœ–≈ƒ≈À≈Õ»ﬂ œ–¿¬»À‹ÕŒ… ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»»)
      RnormMOXFII=FunMO(NumeroMin,2)
   ENDIF
    
    
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! 
   ! ›“¿œ 2.2  Õ¿’Œƒ»Ã ŒƒÕŒ›À≈ “–ŒÕÕ”ﬁ ›Õ≈–√»ﬁ –≈ÿ≈Õ»≈Ã Õ≈ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€ ”–¿¬Õ≈Õ»… !!!
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

   ! ”—“¿Õ¿¬À»¬¿≈Ã “»œ –¿—◊≈“¿
   IF(IKLExchange.EQ.1) THEN
      IntParXX=1
   ENDIF
   IF(IKLExchange.EQ.0) THEN
      IntParXX=0
   ENDIF


   ! Õ¿’Œƒ»Ã ŒƒÕŒ›À≈ “–ŒÕÕ”ﬁ ›Õ≈–√»ﬁ ¬ —À”◊¿≈ –≈ÿ≈Õ»ﬂ Õ≈ŒƒÕŒ–ŒƒÕŒ√Œ ”–¿¬Õ≈Õ»ﬂ
   IF(IntParXX.EQ.1) THEN 

       IISSXDDZS=0
	   ! Œ—”Ÿ≈—“¬Àﬂ≈Ã ¬€¡Œ– Ã≈∆ƒ” Ã≈“Œƒ¿Ã» Œœ–≈ƒ≈À≈Õ»ﬂ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»
	   IF(NNEL.GT.3) THEN
	 	  IF(Niteration.LT.4) THEN
              ! ƒÀﬂ œ≈–¬€’ “–≈’ »“≈–¿÷»… —Œ’–¿Õﬂ≈Ã ¬—≈ Ã≈“Œƒ€ 
		 	  IISSXDDZS=1  
	         ELSE
              ! œ–»Ã≈Õﬂ≈Ã ÕŒ¬€… Ã≈“Œƒ ƒÀﬂ œŒ»— ¿ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»
			  IISSXDDZS=2 
	      ENDIF
	   ENDIF

       ! ÕŒ¬€… Ã≈“Œƒ Œ—ÕŒ¬¿ÕÕ€… Õ¿ œŒ»— ≈ Ã»Õ»Ã”ÃŒ¬ Ã≈∆ƒ”  Œ“Œ–€Ã» Õ¿’Œƒﬂ“—ﬂ  Œ–Õ» 
       IF(IISSXDDZS.EQ.2) THEN
          
		  ! ›“¿œ 1. Œœ–≈ƒ≈Àﬂ≈Ã œ≈–¬€… Ã»Õ»Ã”Ã ƒÀﬂ ”—“¿ÕŒ¬À≈Õ»ﬂ »Õ“≈–¬¿À¿ ›Õ≈–√»… ¬  Œ“Œ–ŒÃ ¡”ƒ”“ Œœ–≈ƒ≈À≈Õ€  Œ–Õ»
		 
		  ! Õ¿◊¿À‹Õ€… ÿ¿√ œŒ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»
          Henergy=0.1D0
          ! Œœ–≈ƒ≈Àﬂ≈Ã ÿ¿√ ƒÀﬂ ƒ¿ÕÕŒ… ŒƒÕŒ›À≈ “–ŒÕÕŒ… ‘”Õ ÷»» 
          !DO IICFHK=1,NNEL
          !   ! »«Ã≈Õ≈Õ»≈ ÿ¿√¿ 
	      !   Henergy=Henergy/FLOAT(IICFHK+1)  
          !ENDDO
      
	      ! Œœ–≈ƒ≈Àﬂ≈Ã Ã»Õ»Ã”Ã —À≈¬¿  
		  E1X=ExfZero*(1.D0-Henergy) 
          E2X=ExfZero*(1.D0-2.D0*Henergy)
		  E3X=ExfZero*(1.D0-3.D0*Henergy) 
		  ! œ–¿¬¿ﬂ √–¿Õ»÷¿
		  EEDP=E3X 
	      ! Œœ–≈ƒ≈Àﬂ≈Ã —À≈¬¿ » —œ–¿¬¿ Œ“ «Õ¿◊≈Õ»ﬂ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»» œŒÀ”◊≈ÕÕŒ… œ–» –≈ÿ≈Õ»» ŒƒÕŒ–ŒƒÕŒ√Œ ”–¿¬Õ≈Õ»ﬂ
          WRITE(17,*) 'MIN',Niteration,NMO 
          ! 1. Œœ–≈ƒ≈Àﬂ≈Ã œ≈–¬Œ≈ Ã»Õ»Ã¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ ÕŒ–Ã€  
		  call MinValueNormEnergyFunctionDD(NMO,Npoint,IndexM,NumeroMin,NumeroMax,Kpoint,NumeroMaxLimid,Rcof,H,Uout,Uin,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,AlfaCoffMO,RfunLigands,RO1X,FunMO,Pz,IXM,UNout,UNin,Vout,Vin,AX,BX,CX,E,AZ,FZ,BZ,FX,VNout,VNin,DZ,A,B,AA,BB,E3X,E2X,E1X,REmin,RfunMIN,REleft,IndexRegionHMIN(NMO,1),EnergyRegionHMIN(NMO,1,1))
		  
		  ! ›“¿œ 2. Œœ–≈ƒ≈Àﬂ≈Ã œ–»¡À»∆≈ÕÕ€≈ «Õ¿◊≈Õ»ﬂ ¬ »Õ“≈–¬¿À≈ (0,REmin)
          ! œ≈–¬€… Ã»Õ»Ã”Ã
		  EEMmin(1)=REmin
		  DDMmin(1)=RfunMIN
		  
          ! «¿Õ”Àﬂ≈Ã œ≈–≈ƒ –¿—◊≈“ŒÃ 
		  IndexGranyMin=0
		  EEGranymin=0.D0 
          
		  ! ‘» —»–”≈Ã À≈¬”ﬁ » œ–¿¬”ﬁ √–¿Õ»÷€ œ≈–¬Œ√Œ Ã»Õ»Ã”Ã¿
          ! À≈¬¿ﬂ √–¿Õ»÷¿
		  IndexGranyMin(1,1)=1
          EEGranymin(1,1)=REleft
		  ! œ–¿¬¿ﬂ √–¿Õ»÷¿
          IndexGranyMin(1,2)=1
          EEGranymin(1,2)=EEDP


		  ! Õ¿◊¿À‹Õ€… ÿ¿√ œŒ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»
          Henergy=0.001D0
          ! Œœ–≈ƒ≈Àﬂ≈Ã ÿ¿√ ƒÀﬂ ƒ¿ÕÕŒ… ŒƒÕŒ›À≈ “–ŒÕÕŒ… ‘”Õ ÷»» 
          DO IICFHK=1,NNEL
             ! »«Ã≈Õ≈Õ»≈ ÿ¿√¿ 
	         Henergy=Henergy/FLOAT(IICFHK+1)  
          ENDDO
          	 	
          
          ! ”—“¿Õ¿¬À»¬¿≈Ã Õ¿◊¿À‹Õ€≈ «Õ¿◊≈Õ»ﬂ ƒÀﬂ œŒÀŒ∆≈Õ»… Ã»Õ»Ã”ÃŒ¬
		  DO IICFHK=2,NNEL
		     ! Õ¿◊¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ ƒÀﬂ Œœ–≈ƒ≈À≈Õ»≈ —À≈ƒ”ﬁŸ≈√Œ Ã»Õ»Ã”Ã¿
			 REmin=EEMmin(IICFHK-1)           
		     
			 ! œ¿–¿Ã≈“– ¬€’Œƒ¿ »« ÷» À¿ 
             IparDeterEnergy=1 
             DO WHILE(IparDeterEnergy.EQ.1)
		        ! Œœ–≈ƒ≈Àﬂ≈Ã Õ¿◊¿À‹ÕŒ≈ œ–»¡À»∆≈Õ»ﬂ ƒÀﬂ œŒÀŒ∆≈Õ»ﬂ Ã»Õ»Ã”Ã¿
				REmin=REmin*DBLE(NNEL-1)/DBLE(NNEL)  
				WRITE(17,*) 'PremierShagMIN',Niteration,IICFHK
				! Œœ–≈ƒ≈Àﬂ≈Ã Ã»Õ»Ã¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈
   		        call MinValueNormEnergyFunctionD2(NMO,Npoint,IndexM,NumeroMin,NumeroMax,Kpoint,NumeroMaxLimid,Rcof,H,Uout,Uin,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,AlfaCoffMO,RfunLigands,RO1X,FunMO,Pz,IXM,UNout,UNin,Vout,Vin,AX,BX,CX,E,AZ,FZ,BZ,FX,VNout,VNin,DZ,A,B,AA,BB,Henergy,REmin,Rkriter,RfunMIN,IndexGranyMin(IICFHK-1,1),EEGranymin(IICFHK-1,1),EEMmin(IICFHK-1),DDMmin(IICFHK-1),REleft,REright,IndexMinDifini,IndexRegionHMIN(NMO,IICFHK),EnergyRegionHMIN(NMO,IICFHK,1),EnergyRegionHMIN(NMO,IICFHK,2))
		        
				! ”—“¿Õ¿¬À»¬¿≈Ã œŒÀ”◊≈Õ ÕŒ¬€… Ã»Õ»Ã”Ã »À» Õ≈“
				IF(IndexMinDifini.EQ.0) THEN
                     ! “–≈¡Œ¬¿Õ»ﬂ ¬€œŒÀÕ≈Õ€
				     EEMmin(IICFHK)=Rkriter
				     DDMmin(IICFHK)=RfunMIN
				     ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ Œ—”Ÿ≈—“¬À≈ÕŒ
				     IparDeterEnergy=2   
					 
					 ! «¿œ»—€¬¿≈Ã œ–¿¬”ﬁ √–¿Õ»÷” Ã»Õ»Ã”Ã¿
                     IndexGranyMin(IICFHK,2)=1 
					 EEGranymin(IICFHK,2)=REright
					                    
					 ! «¿œ»—€¬¿≈Ã À≈¬”ﬁ √–¿Õ»÷” Ã»Õ»Ã”Ã¿
                     IndexGranyMin(IICFHK,1)=1
					 EEGranymin(IICFHK,1)=REleft

				   ELSE
				     ! ”—ÀŒ¬»≈ Õ≈ ¬€œŒÀÕ≈ÕŒ «Õ¿◊»“‹ ›Õ≈–√»ﬂ Œ“ÕŒ—»“—ﬂ   œ–≈ƒ≈ƒ”Ÿ≈Ã” Ã»Õ»Ã”Ã»
					 IF(REmin.LT.EEMmin(IICFHK-1)) THEN
					    ! œ–Œ¬≈–ﬂ≈Ã «¿œ»—€¬¿À¿—‹ À» ”∆≈ À≈¬¿ﬂ √–¿Õ»÷¿
						IF(IndexGranyMin(IICFHK-1,1).EQ.0) THEN
                            ! «¿œ»—€¬¿≈Ã √–¿Õ»÷” ¬ œ≈–¬€… –¿«
                            IndexGranyMin(IICFHK-1,1)=1 
							EEGranymin(IICFHK-1,1)=REmin
						   ELSE
						    ! œ–Œ¬≈–ﬂ≈Ã ƒ¿ÕÕ¿ﬂ ›Õ≈–√»ﬂ À≈∆»“ Õ»∆≈ »À» Õ≈“
							IF(REmin.LT.EEGranymin(IICFHK-1,1)) THEN
							   EEGranymin(IICFHK-1,1)=REmin
							ENDIF	   
						ENDIF
					 ENDIF 
					 
				ENDIF
			 ENDDO           
		  ENDDO 
		  
		  WRITE(17,*)
		  WRITE(17,*) 'Min Value Energy Zero approximation',Niteration,NMO
          DO IICFHK=1,NNEL
             WRITE(17,*) EEMmin(IICFHK),DDMmin(IICFHK)
		  ENDDO
          WRITE(17,*)
		   

		  ! Œœ–≈ƒ≈Àﬂ≈Ã œŒÀŒ∆≈Õ»≈ Ã»Õ»Ã”ÃŒ¬
          IndexMin=0
          ! œ¿–¿Ã≈“– ¬€’Œƒ¿ »« ÷» À¿ 
          IparDeter=1 
          DO WHILE(IparDeter.EQ.1)
		     
             ! ÷» À œŒ »Õ“≈–¬¿À¿Ã Ã≈∆ƒ” Ã»Õ»Ã”Ã¿Ã»
			 DO IICFHK=1,NNEL-1
			    ! œ–Œ¬≈–ﬂ≈Ã ƒ¿ÕÕ€… »Õ“≈–¬¿À Õ≈ —Œƒ≈–∆»“ Ã»Õ»Ã”ÃŒ¬ »À» Õ≈“
				Indexfr=0
				IF(IndexMin(IICFHK).EQ.0) THEN
                   ! –¿——Ã¿“–»¬¿≈Ã Œ¡À¿—“‹ Ã≈∆ƒ” Ã»Õ»Ã”Ã¿Ã»
				   IF(IndexGranyMin(IICFHK,1).EQ.1) THEN
                        EZZmax=EEGranymin(IICFHK,1)
					  ELSE
                        EZZmax=EEMmin(IICFHK)  
				   ENDIF
                   IF(IndexGranyMin(IICFHK+1,2).EQ.1) THEN
                        EZZmin=EEGranymin(IICFHK+1,2)
					  ELSE
                        EZZmin=EEMmin(IICFHK+1)  
				   ENDIF

				   EZZ0cert=0.25D0*EZZmax+0.75D0*EZZmin 
				   EESXZ0=0.5D0*(EZZmax+EZZmin) 
                   ! Œœ–≈ƒ≈Àﬂ≈Ã »Ã≈≈“—ﬂ ¬ ƒ¿ÕÕŒ… Œ¡À¿—“» ƒŒœŒÀÕ»“≈À‹Õ€≈ Ã»Õ»Ã”Ã€ »À» Õ≈“
                   IparDeterEnergy=1
				   DO WHILE(IparDeterEnergy.EQ.1)
				      ! Œœ–≈ƒ≈Àﬂ≈Ã  ¿ ŒÃ” Ã»Õ»Ã”Ã” —ŒŒ“¬≈“—“¬”≈“ ƒ¿ÕÕ¿ﬂ “Œ◊ ¿
					  WRITE(17,*) 'DefiniMIN',Niteration,IICFHK
					  WRITE(17,*) 'EnergyGranyIntervala'
					  WRITE(17,*) EZZmax,EZZmin,EZZ0cert
                      call MinValueNormEnergyFunctionD3(NMO,Npoint,IndexM,NumeroMin,NumeroMax,Kpoint,NumeroMaxLimid,Rcof,H,Uout,Uin,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,AlfaCoffMO,RfunLigands,RO1X,FunMO,Pz,IXM,UNout,UNin,Vout,Vin,AX,BX,CX,E,AZ,FZ,BZ,FX,VNout,VNin,DZ,A,B,AA,BB,Henergy,EZZ0cert,Rkriter,RfunMIN,IndexGranyMin(IICFHK+1,2),EEMmin(IICFHK+1),EEGranymin(IICFHK+1,2),DDMmin(IICFHK+1),IndexGranyMin(IICFHK,1),EEGranymin(IICFHK,1),EEMmin(IICFHK),DDMmin(IICFHK),IndexMinDifini,EminGranL,EminGranR,IndexRegionHMIN(NMO,IICFHK+1),EnergyRegionHMIN(NMO,IICFHK+1,1),EnergyRegionHMIN(NMO,IICFHK+1,2))
                      Indexfr=0
					  ! œ–Œ¬≈–ﬂ≈Ã ƒ¿ÕÕ¿ﬂ “Œ◊ ¿ œŒœ¿À¿ ¬ Œ¡À¿—“‹ À≈¬Œ√Œ »À» œ–¿¬Œ√Œ Ã»Õ»Ã”Ã¿
					  ! Œœ–≈ƒ≈Àﬂ≈Ã —ŒŒ“¬≈“—“¬»≈ MAX  
				      IF(IndexMinDifini.EQ.2) THEN
                         ! ƒ¿ÕÕ¿ﬂ “Œ◊ ¿ —ŒŒ“¬≈“—“¬”≈“ Ã»Õ»Ã”Ã” ¬ “Œ◊ ≈ EZZmax
                         Indexfr=1
                         EZZmax=EZZ0cert
						 !  Œ––≈ “»–”≈Ã √–¿Õ»÷” Œ¡À¿—“» ƒ¿ÕÕŒ√Œ Ã»Õ»Ã”Ã¿
						 IF(IndexGranyMin(IICFHK,1).EQ.1) THEN
						     ! √–¿Õ»÷¿ —”Ÿ≈—“¬”≈“ Œ—”Ÿ≈—“¬Àﬂ≈Ã ≈≈  Œ––≈ “»–Œ¬ ” 
                             IF(EZZ0cert.LT.EEGranymin(IICFHK,1)) THEN
							    EEGranymin(IICFHK,1)=EZZ0cert
							 ENDIF                                    
							ELSE
                             ! √–¿Õ»÷¿ Õ≈Œœ–≈ƒ≈À≈Õ¿ ‘» —»–”≈Ã √–¿Õ»÷”
							 IndexGranyMin(IICFHK,1)=1
							 EEGranymin(IICFHK,1)=EZZ0cert 
						 ENDIF 
				      ENDIF
					  ! Œœ–≈ƒ≈Àﬂ≈Ã —ŒŒ“¬≈“—“¬»≈ MIN 
                      IF(IndexMinDifini.EQ.1) THEN
                         ! ƒ¿ÕÕ¿ﬂ “Œ◊ ¿ —ŒŒ“¬≈“—“¬”≈“ Ã»Õ»Ã”Ã” ¬ “Œ◊ ≈ EZZmin
                         Indexfr=2
                         EZZmin=EZZ0cert
                         
						 !  Œ––≈ “»–”≈Ã √–¿Õ»÷” Œ¡À¿—“» ƒ¿ÕÕŒ√Œ Ã»Õ»Ã”Ã¿
						 IF(IndexGranyMin(IICFHK+1,2).EQ.1) THEN
						     ! √–¿Õ»÷¿ —”Ÿ≈—“¬”≈“ Œ—”Ÿ≈—“¬Àﬂ≈Ã ≈≈  Œ––≈ “»–Œ¬ ” 
                             IF(EZZ0cert.GT.EEGranymin(IICFHK+1,2)) THEN
							    EEGranymin(IICFHK+1,2)=EZZ0cert
							 ENDIF                                    
							ELSE
                             ! √–¿Õ»÷¿ Õ≈Œœ–≈ƒ≈À≈Õ¿ ‘» —»–”≈Ã √–¿Õ»÷”
							 IndexGranyMin(IICFHK+1,2)=1
							 EEGranymin(IICFHK+1,2)=EZZ0cert 
						 ENDIF  
				      
					  ENDIF
					  WRITE(17,*) 'Value Interval'
                      WRITE(17,*) Indexfr,DABS(EZZmax-EZZmin),DABS(EESXZ0*Henergy)
                      ! ÕŒ¬¿ﬂ —–≈ƒÕﬂﬂ “Œ◊ ¿
					  EZZ0cert=0.25D0*EZZmax+0.75D0*EZZmin 
				      ! œ–Œ¬≈–ﬂ≈Ã Õ¿…ƒ≈Õ ÕŒ¬€… Ã»Õ»Ã”Ã »À» Õ≈“
                      IF(IndexMinDifini.EQ.0) THEN
				         ! Õ¿…ƒ≈Õ ÕŒ¬€… Ã»Õ»Ã”Ã
					     ! œ≈–≈—“–¿»¬¿≈Ã œŒ–ﬂƒŒ¬ Ã»Õ»Ã”ÃŒ¬
                         IF((IICFHK+1).NE.NNEL) THEN
						    DO IIISDD=NNEL,IICFHK+2,-1
                               EEMmin(IIISDD)=EEMmin(IIISDD-1)
						       DDMmin(IIISDD)=DDMmin(IIISDD-1) 
							   IndexGranyMin(IIISDD,1)=IndexGranyMin(IIISDD-1,1) 
							   IndexGranyMin(IIISDD,2)=IndexGranyMin(IIISDD-1,2)   
					        ENDDO
					     ENDIF
						 ! «¿œ»—€¬¿≈Ã ÕŒ¬€… Ã»Õ»Ã”Ã
                         EEMmin(IICFHK+1)=Rkriter
                         DDMmin(IICFHK+1)=RfunMIN
						 ! ‘» —»–”≈Ã √–¿Õ»÷€ ƒÀﬂ ƒ¿ÕŒ√Œ Ã»Õ»Ã”Ã¿
                         IndexGranyMin(IICFHK+1,1)=1 
						 IndexGranyMin(IICFHK+1,2)=1
						 EEGranymin(IICFHK+1,1)=EminGranL
						 EEGranymin(IICFHK+1,2)=EminGranR  
                         ! œŒ—À≈ œ≈–≈—“–Œ» » œŒ»—  Ã»Õ»Ã”ÃŒ¬ Õ≈Œ¡’Œƒ»ÃŒ «¿œ”—»“‹ «¿ÕŒ¬Œ
                         Indexfr=4
						 EXIT
				      ENDIF 
					  ! œ–Œ¬≈–ﬂ≈Ã –¿«Õ»÷¿ Ã≈∆ƒ” √–¿Õ»÷¿Ã» Ã≈Õ‹ÿ≈ Ã»Õ»Ã¿À‹ÕŒ√Œ «Õ¿◊≈Õ»ﬂ
					  IF(DABS(EZZmax-EZZmin).LT.4.D0*DABS(EESXZ0*Henergy)) THEN
					     ! ¬ ƒ¿ÕÕŒÃ »Õ“≈–¬¿À≈ Œ“—”“—“¬”ﬁ“ ƒ–”√»≈ Ã»Õ»Ã”Ã€
						 IndexMin(IICFHK)=1
						 EXIT  
					  ENDIF 
				   ENDDO
                ENDIF

				! œ–Œ¬≈–ﬂ≈Ã Œ—”Ÿ≈—“¬À≈Õ œ≈–≈—ÃŒ“– œŒ—À≈ƒŒ¬¿“≈À‹ÕŒ—“» Ã»Õ»Ã”ÃŒ¬
				IF(Indexfr.EQ.4) THEN
                   EXIT
				ENDIF
			 ENDDO

			 ! œ–Œ¬≈–ﬂ≈Ã Õ¿…ƒ≈Õ€ ¬—≈ »Õ“≈–¬¿À€ ¬Õ”“–»  Œ“Œ–€’ Õ≈“ Ã»Õ»Ã”ÃŒ¬
             Indexfr=0
			 DO IICFHK=1,NNEL-1
                IF(IndexMin(IICFHK).EQ.1) THEN
                   Indexfr=Indexfr+1 
				ENDIF
             ENDDO
			 ! œ–Œ¬≈–ﬂ≈Ã Œœ–≈ƒ≈À≈Õ€ ¬—≈ »Õ“≈–¬¿À€ »À» Õ≈“
			 IF(Indexfr.EQ.(NNEL-1)) THEN
                IparDeter=2 
			 ENDIF
		  ENDDO

		  ! ‘» —»–”≈Ã Õ¿◊¿À‹Õ€… ÿ¿√ ƒÀﬂ ƒ¿À‹Õ≈…ÿ≈√Œ –¿—◊≈“¿ 
		  ! ”◊»“€¬¿ﬂ “Œ“ ‘¿ “, ◊“Œ Œœ–≈ƒ≈À≈Õ€ ¬—≈ √–¿Õ»÷€ ƒÀﬂ ¬—≈’ Ã»Õ»Ã”ÃŒ¬ “Œ Õ¿’Œƒ»Ã –¿«Õ»÷” Ã≈∆ƒ” Ã»Ã»Ã”ÃŒÃ » √–¿Õ»÷≈…
          DO IICFHK=1,NNEL
		     ! ‘» —»–”≈Ã, ◊“Œ ÿ¿√ ƒÀﬂ ƒ¿ÕÕŒ√Œ Ã»Õ»Ã”Ã¿ Œœ–≈ƒ≈À≈Õ 
             IndexRegionHMIN(NMO,IICFHK)=1
			 EnergyRegionHMIN(NMO,IICFHK,1)=DABS(1.D0-EEGranymin(IICFHK,1)/EEMmin(IICFHK)) 
             EnergyRegionHMIN(NMO,IICFHK,2)=DABS(1.D0-EEMmin(IICFHK)/EEGranymin(IICFHK,2)) 
          ENDDO 

		  WRITE(17,*)
		  WRITE(17,*) 'Min Value Energy',Niteration,NMO
          DO IICFHK=1,NNEL
             WRITE(17,*) EEMmin(IICFHK),DDMmin(IICFHK)
		  ENDDO
          WRITE(17,*)

		  ! ›“¿œ 3. Œœ–≈ƒ≈Àﬂ≈Ã  Œ–Õ» 
          ! œ–Œ¬≈–ﬂ≈Ã »Ã≈≈“—ﬂ  Œ–Õ» »À» Õ≈“
		  ! œ–Œ¬≈–ﬂ≈Ã ÕŒ–Ã” —œ–¿¬¿
		  IF(RnormMOXF(NMO).GT.DDMmin(NNEL-1)) THEN
		       WRITE(17,*) 'Defini grani Energy right',Niteration,NMO
		       ! Œ—”Ÿ≈—“¬Àﬂ≈Ã ¿Õ¿À»« Œ¡À¿—“» Ã≈∆ƒ” Ã»Õ»Ã”Ã¿Ã» » ”—“¿Õ¿¬À»¬¿≈Ã Ã≈—“Œ œ≈–≈Ã≈Õ€ «Õ¿ ¿ œ–Œ»«¬ŒƒÕŒ…
			   ! «¿Õ”Àﬂ≈Ã œ≈–≈ƒ –¿—◊≈“ŒÃ
			   DetM=0.D0
			   DetMA=0.D0
			   ExfM=0.D0
			   ! «¿œ»—€¬¿≈Ã œ≈–¬Œ≈ «Õ¿◊≈Õ»≈
			   ExfM(7)=EEMmin(NNEL-1)
               DetM(7)=DDMmin(NNEL-1)
               ! Œœ–≈ƒ≈Àﬂ≈Ã Õ¿◊¿À‹Õ€… ÿ¿√
               Henergy=0.02D0*DABS(EEMmin(NNEL)-EEMmin(NNEL-1))
               ! Œœ–≈ƒ≈Àﬂ≈Ã Õ¿◊¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ ƒÀﬂ ›Õ≈–√»» 
			   E1X=EEMmin(NNEL-1)*(1-Henergy) 
			   IndexSUMZK=0	
			   ! »Õƒ≈ — ” ¿«€¬¿≈“ — ŒÀ‹ Œ –¿« Œ—”Ÿ≈—“¬ÀﬂÀŒ—‹ ”Ã≈Õ‹ÿ≈Õ»≈ ¬ 10 –¿« ÿ¿√¿
			   IndexIIUMN=0	         			  
			   ! œ¿–¿Ã≈“– ¬€’Œƒ¿ »« ÷» À¿ 
               IparametrDeterEnergy=1 
			   ! œ¿–¿Ã≈“– ¬€’Œƒ¿ »« ÷» À¿
			   INDEXEXITRF=0
			   INDEXZZSFA=0
			   RcofXZSD=1.D0
               DO WHILE(IparametrDeterEnergy.EQ.1) 
			      ! »Õƒ≈ — ÷» À¿
				  IndexSUMZK=IndexSUMZK+1
		          ! Õ¿’Œƒ»Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ ƒÀﬂ «Õ¿◊≈Õ»ﬂ ›Õ≈–√»» E1X
				  call CalculationNormFunctionEnergyXF(E1X,D1X,NMO,NumeroMaxLimid,Npoint,IndexM,Kpoint,NumeroMin,NumeroMax,Rcof,H,NumbreLigand,IXM,NLigands,NFunLigands,NumbreFunctionLig,RO1X,UNout,UNin,AX,BX,CX,FX,Uout,Uin,VNout,VNin,AZ,BZ,FZ,DZ,E,FunMO,Pz,A,B,AA,BB,Vout,Vin,AlfaCoffMO,RfunLigands)
			      WRITE(17,*) E1X,D1X,Henergy
				  ! «¿œ»—€¬¿≈Ã –≈«”À‹“¿“€ –¿—◊≈“¿
				  ExfM(1)=ExfM(2)
                  DetM(1)=DetM(2)
				  ExfM(2)=ExfM(3)
                  DetM(2)=DetM(3)
				  ExfM(3)=ExfM(4)
                  DetM(3)=DetM(4)
				  ExfM(4)=ExfM(5)
                  DetM(4)=DetM(5)
                  ExfM(5)=ExfM(6)
                  DetM(5)=DetM(6)
                  ExfM(6)=ExfM(7)
                  DetM(6)=DetM(7)
				  ExfM(7)=E1X
                  DetM(7)=D1X
							 
				  IF(IndexSUMZK.EQ.1) THEN
                     ! –¿—◊»“€¬¿≈Ã œ–Œ»«¬ŒƒÕ”ﬁ
                     DetMA(7)=DetM(7)*(1.D0-DetM(6)/DetM(7))/(ExfM(7)*(1.D0-ExfM(6)/ExfM(7)))
				  ENDIF
                  IF(IndexSUMZK.GT.1) THEN
                     ! –¿—◊»“€¬¿≈Ã œ–Œ»«¬ŒƒÕ”ﬁ
					 DetMA(1)=DetMA(2)
					 DetMA(2)=DetMA(3)
                     DetMA(3)=DetMA(4)
					 DetMA(4)=DetMA(5)
					 DetMA(5)=DetMA(6)
                     DetMA(6)=DetMA(7)
				     DetMA(7)=DetM(7)*(1.D0-DetM(6)/DetM(7))/(ExfM(7)*(1.D0-ExfM(6)/ExfM(7)))

                     ! œ–Œ¬Œƒ»Ã ¿Õ¿À»« »  Œ––≈ “»–Œ¬ ” ÿ¿√¿
				     call CorrectHRightD(IndexSUMZK,INDEXZZSFA,IndexIIUMN,Henergy,RcofXZSD,DetMA)
		
					 
					 ! œ–Œ¬≈–ﬂ≈Ã Õ≈Œ¡’Œƒ»ÃŒ ¬≈–Õ”“—ﬂ Õ¿ ƒ¬≈ “Œ◊ » Õ¿«¿ƒ »À» Õ≈“
					 IF(INDEXZZSFA.EQ.1) THEN
                        ! Õ≈Œ¡’Œƒ»ÃŒ ¬≈–Õ”“—ﬂ Õ¿ ƒ¬≈ “Œ◊ » Õ¿«¿ƒ
                        E1X=ExfM(5) 
                        ExfM(7)=ExfM(5) 
                        DetM(7)=DetM(5)
                        ExfM(6)=ExfM(4) 
                        DetM(6)=DetM(4)
						ExfM(5)=ExfM(3) 
                        DetM(5)=DetM(3)
						ExfM(4)=ExfM(2) 
                        DetM(4)=DetM(2)
						ExfM(3)=ExfM(1) 
                        DetM(3)=DetM(1)
                        DetMA(7)=DetMA(5)
                        DetMA(6)=DetMA(4)
						DetMA(5)=DetMA(3)
						DetMA(4)=DetMA(2)
						DetMA(3)=DetMA(1)
						! Œ¡Õ”Àﬂ≈Ã ¬€’Œƒ »« ÷» À¿
						INDEXEXITRF=0
						! œ–Œ¬≈–ﬂ≈Ã ◊»—ÀŒ »“≈–¿÷»…
			            IF(IndexSUMZK.LT.3) THEN
                           ! Œ¡Õ”Àﬂ≈Ã —◊≈“◊»  œŒ— ŒÀ‹ ” œŒ—À≈ ¬Œ«¬–¿Ÿ≈Õ»ﬂ Õ¿ ƒ¬≈ “Œ◊ » Ã€ œŒœ¿ƒ¿≈Ã ¬ Õ¿◊¿À‹Õ”ﬁ “Œ◊ ”
				           IndexSUMZK=0 
			            ENDIF
					 ENDIF
					  
				  ENDIF

				  ! ÕŒ¬Œ≈ œ–»¡À»∆≈Õ»≈ ƒÀﬂ ›Õ≈–√»»                 
                  E1X=E1X*(1-Henergy)
				  ! œ–Œ¬≈–ﬂ≈Ã ¬€œŒÀÕ»ÀŒ—‹ ”—ÀŒ¬»≈ »À» Õ≈“
				  IF(INDEXZZSFA.EQ.0) THEN
                     IF(D1X.GT.RnormMOXF(NMO)) THEN 
                        INDEXEXITRF=INDEXEXITRF+1
					 ENDIF
					 ! œ–Œ¬≈–ﬂ≈Ã ¬€œŒÀÕ≈ÕŒ ”—ÀŒ¬»≈ ¬€’Œƒ¿ »À» Õ≈“
					 IF(INDEXEXITRF.EQ.5) THEN
					    ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈Õ€
                        IparametrDeterEnergy=2
					 ENDIF
				  ENDIF
			   ENDDO

			   ! 4. Œœ–≈ƒ≈Àﬂ≈Ã  Œ–≈Õ‹ 
               ! Œœ–≈ƒ≈Àﬂ≈Ã Õ¿◊¿À‹Õ€≈ «Õ¿◊≈Õ»ﬂ œ–Œ÷≈——¿ œŒ»— ¿
               RnormMO=RnormMOXF(NMO) 
               ! À≈¬¿ﬂ √–¿Õ»÷¿ 
			   E1X=ExfM(7)
               E2X=ExfM(6)
			   E3X=ExfM(5)
               ! œ–¿¬¿ﬂ √–¿Õ»÷¿
			   E4X=EEMmin(NNEL-1)
			   D4X=DDMmin(NNEL-1)
               ! ÷» À œŒ Œœ–≈ƒ≈À≈Õ»ﬁ  Œ–Õﬂ
			   WRITE(17,*) 'Energy right',Niteration,NMO,RnormMO
               ! œ¿–¿Ã≈“– ¬€’Œƒ¿ »« ÷» À¿ 
               IparametrDeterEnergy=1 
               DO WHILE(IparametrDeterEnergy.EQ.1)
			      ! Õ¿’Œƒ»Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ ƒÀﬂ «Õ¿◊≈Õ»ﬂ ›Õ≈–√»» E1X
			  	  call CalculationNormFunctionEnergyXF(E1X,D1X,NMO,NumeroMaxLimid,Npoint,IndexM,Kpoint,NumeroMin,NumeroMax,Rcof,H,NumbreLigand,IXM,NLigands,NFunLigands,NumbreFunctionLig,RO1X,UNout,UNin,AX,BX,CX,FX,Uout,Uin,VNout,VNin,AZ,BZ,FZ,DZ,E,FunMO,Pz,A,B,AA,BB,Vout,Vin,AlfaCoffMO,RfunLigands)
			      ! Õ¿’Œƒ»Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ ƒÀﬂ «Õ¿◊≈Õ»ﬂ ›Õ≈–√»» E2X
			      call CalculationNormFunctionEnergyXF(E2X,D2X,NMO,NumeroMaxLimid,Npoint,IndexM,Kpoint,NumeroMin,NumeroMax,Rcof,H,NumbreLigand,IXM,NLigands,NFunLigands,NumbreFunctionLig,RO1X,UNout,UNin,AX,BX,CX,FX,Uout,Uin,VNout,VNin,AZ,BZ,FZ,DZ,E,FunMO,Pz,A,B,AA,BB,Vout,Vin,AlfaCoffMO,RfunLigands)
				  ! Õ¿’Œƒ»Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ ƒÀﬂ «Õ¿◊≈Õ»ﬂ ›Õ≈–√»» E3X
			      call CalculationNormFunctionEnergyXF(E3X,D3X,NMO,NumeroMaxLimid,Npoint,IndexM,Kpoint,NumeroMin,NumeroMax,Rcof,H,NumbreLigand,IXM,NLigands,NFunLigands,NumbreFunctionLig,RO1X,UNout,UNin,AX,BX,CX,FX,Uout,Uin,VNout,VNin,AZ,BZ,FZ,DZ,E,FunMO,Pz,A,B,AA,BB,Vout,Vin,AlfaCoffMO,RfunLigands)
				  ! Õ¿’Œƒ»Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ ƒÀﬂ «Õ¿◊≈Õ»ﬂ ›Õ≈–√»» E4X
			      call CalculationNormFunctionEnergyXF(E4X,D4X,NMO,NumeroMaxLimid,Npoint,IndexM,Kpoint,NumeroMin,NumeroMax,Rcof,H,NumbreLigand,IXM,NLigands,NFunLigands,NumbreFunctionLig,RO1X,UNout,UNin,AX,BX,CX,FX,Uout,Uin,VNout,VNin,AZ,BZ,FZ,DZ,E,FunMO,Pz,A,B,AA,BB,Vout,Vin,AlfaCoffMO,RfunLigands)
				  ! Œ—”Ÿ≈—“¬Àﬂ≈Ã œ–Œ¬≈– ” ”—“¿ÕŒ¬À≈ÕŒ Õ”À»¬Œ≈ «Õ¿◊≈Õ»≈ »À» Õ≈“
				  ! Õ¿’Œƒ»Ã ÷≈Õ“–¿À‹Õ€…  Œ–≈Õ‹
				  E3XX=((RnormMO-D2X)*E4X-(RnormMO-D4X)*E2X)/(D4X-D2X) 
                  ! Õ¿’Œƒ»Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ ƒÀﬂ «Õ¿◊≈Õ»ﬂ ›Õ≈–√»» E3XX
				  call CalculationNormFunctionEnergyXF(E3XX,D3XX,NMO,NumeroMaxLimid,Npoint,IndexM,Kpoint,NumeroMin,NumeroMax,Rcof,H,NumbreLigand,IXM,NLigands,NFunLigands,NumbreFunctionLig,RO1X,UNout,UNin,AX,BX,CX,FX,Uout,Uin,VNout,VNin,AZ,BZ,FZ,DZ,E,FunMO,Pz,A,B,AA,BB,Vout,Vin,AlfaCoffMO,RfunLigands)
			      ! œ–Œ¬≈–ﬂ≈Ã ¬€œŒÀÕﬂ≈“—ﬂ ”—ÀŒ¬»≈ ¬€’Œƒ¿
                  IF(DABS(D3XX-RnormMO).LT.EPS) THEN
                     ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
				  	 IparametrDeterEnergy=2
					 Exf=E3XX 
				  ENDIF
                    
				  ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ 
				  ! «¿œ»—€¬¿≈Ã ƒ¿ÕÕŒ≈ œ–»¡À»∆≈Õ»≈ 
				  E1XX=E1X
				  D1XX=D1X

				  E2XX=E2X
				  D2XX=D2X
					 
				  E3XX=E3X
				  D3XX=D3X

				  E4XX=E4X
				  D4XX=D4X
					 
				  ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ ÕŒ¬Œ√Œ œ–»¡À»∆≈Õ»ﬂ
                  E2X=E2XX-(D2XX-RnormMO)*(E3XX-E1XX)/(D3XX-D1XX)
                  E3X=E2X*(1.D0+Henergy) 
                  E1X=E2X/(1.D0+Henergy)  
				  E4X=(E2XX*(D4XX-RnormMO)-E4XX*(D2XX-RnormMO))/(D4XX-D2XX)  
				  WRITE(17,*) E2X,E4X,D3XX
			   ENDDO 
					   

               !  Œ–≈Õ‹ Õ≈…ƒ≈Õ
		       INspravo=1
		       ExfSpravo=Exf
		       ! ‘» —»–”≈Ã  Œ–≈Õ‹ —À≈¬¿  ¿  Õ”À»¬Œ… 
               ! ≈—À» Õ¿…ƒ≈Õ Õ»∆≈ À≈∆¿Ÿ»… ¡ŒÀ≈≈ ¬€—Œ Œ À≈∆¿Ÿ»… Õ≈ Õ”∆ÕŒ »— ¿“‹
		       INlevo=0 
		       ExfLevo=0.D0
               ExfZero=0.D0  
			 ELSE 
                             
			  !  Œ–≈Õ‹ Õ≈ —”Ÿ≈—“¬”≈“
              INspravo=0
		      ExfSpravo=0.D0
			  ExfZero=0.D0  
		  ENDIF 
          
		  ! œ–Œ¬≈–ﬂ≈Ã Õ¿…ƒ≈Õ  Œ–≈Õ‹ —œ–¿¬¿ »À» Õ≈“
          IF(INspravo.EQ.0) THEN   
		     ! œ–Œ¬≈–ﬂ≈Ã ÕŒ–Ã” —À≈¬¿
             IF(RnormMOXF(NMO).GT.DDMmin(NNEL)) THEN
                  WRITE(17,*) 'Defini grani Energy left',Niteration,NMO
		          ! Œ—”Ÿ≈—“¬Àﬂ≈Ã ¿Õ¿À»« Œ¡À¿—“» Ã≈∆ƒ” Ã»Õ»Ã”Ã¿Ã» » ”—“¿Õ¿¬À»¬¿≈Ã Ã≈—“Œ œ≈–≈Ã≈Õ€ «Õ¿ ¿ œ–Œ»«¬ŒƒÕŒ…
			      ! «¿Õ”Àﬂ≈Ã œ≈–≈ƒ –¿—◊≈“ŒÃ
			      DetM=0.D0
			      DetMA=0.D0
			      ExfM=0.D0
			      ! «¿œ»—€¬¿≈Ã œ≈–¬Œ≈ «Õ¿◊≈Õ»≈
			      ExfM(7)=EEMmin(NNEL)
                  DetM(7)=DDMmin(NNEL)
                  ! Œœ–≈ƒ≈Àﬂ≈Ã Õ¿◊¿À‹Õ€… ÿ¿√
                  Henergy=0.02D0*DABS(EEMmin(NNEL)-EEMmin(NNEL-1))
                  ! Œœ–≈ƒ≈Àﬂ≈Ã Õ¿◊¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ ƒÀﬂ ›Õ≈–√»» 
			      E1X=EEMmin(NNEL)*(1+Henergy) 
			      IndexSUMZK=0	
			      ! »Õƒ≈ — ” ¿«€¬¿≈“ — ŒÀ‹ Œ –¿« Œ—”Ÿ≈—“¬ÀﬂÀŒ—‹ ”Ã≈Õ‹ÿ≈Õ»≈ ¬ 10 –¿« ÿ¿√¿
			      IndexIIUMN=0	         			  
			      ! œ¿–¿Ã≈“– ¬€’Œƒ¿ »« ÷» À¿ 
                  IparametrDeterEnergy=1 
			      ! œ¿–¿Ã≈“– ¬€’Œƒ¿ »« ÷» À¿
			      INDEXEXITRF=0
			      INDEXZZSFA=0
			      RcofXZSD=1.D0
                  DO WHILE(IparametrDeterEnergy.EQ.1) 
			         ! »Õƒ≈ — ÷» À¿
				     IndexSUMZK=IndexSUMZK+1
		             ! Õ¿’Œƒ»Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ ƒÀﬂ «Õ¿◊≈Õ»ﬂ ›Õ≈–√»» E1X
				     call CalculationNormFunctionEnergyXF(E1X,D1X,NMO,NumeroMaxLimid,Npoint,IndexM,Kpoint,NumeroMin,NumeroMax,Rcof,H,NumbreLigand,IXM,NLigands,NFunLigands,NumbreFunctionLig,RO1X,UNout,UNin,AX,BX,CX,FX,Uout,Uin,VNout,VNin,AZ,BZ,FZ,DZ,E,FunMO,Pz,A,B,AA,BB,Vout,Vin,AlfaCoffMO,RfunLigands)
			         WRITE(17,*) E1X,D1X,Henergy
				     ! «¿œ»—€¬¿≈Ã –≈«”À‹“¿“€ –¿—◊≈“¿
				     ExfM(1)=ExfM(2)
                     DetM(1)=DetM(2)
				     ExfM(2)=ExfM(3)
                     DetM(2)=DetM(3)
				     ExfM(3)=ExfM(4)
                     DetM(3)=DetM(4)
				     ExfM(4)=ExfM(5)
                     DetM(4)=DetM(5)
                     ExfM(5)=ExfM(6)
                     DetM(5)=DetM(6)
                     ExfM(6)=ExfM(7)
                     DetM(6)=DetM(7)
				     ExfM(7)=E1X
                     DetM(7)=D1X
							 
				     IF(IndexSUMZK.EQ.1) THEN
                        ! –¿—◊»“€¬¿≈Ã œ–Œ»«¬ŒƒÕ”ﬁ
                        DetMA(7)=DetM(7)*(1.D0-DetM(6)/DetM(7))/(ExfM(7)*(1.D0-ExfM(6)/ExfM(7)))
				     ENDIF
                     IF(IndexSUMZK.GT.1) THEN
                        ! –¿—◊»“€¬¿≈Ã œ–Œ»«¬ŒƒÕ”ﬁ
					    DetMA(1)=DetMA(2)
					    DetMA(2)=DetMA(3)
                        DetMA(3)=DetMA(4)
					    DetMA(4)=DetMA(5)
					    DetMA(5)=DetMA(6)
                        DetMA(6)=DetMA(7)
				        DetMA(7)=DetM(7)*(1.D0-DetM(6)/DetM(7))/(ExfM(7)*(1.D0-ExfM(6)/ExfM(7)))

                        ! œ–Œ¬Œƒ»Ã ¿Õ¿À»« »  Œ––≈ “»–Œ¬ ” ÿ¿√¿
			            call CorrectHLeftD(IndexSUMZK,INDEXZZSFA,IndexIIUMN,Henergy,RcofXZSD,DetMA)
			   
					 
					    ! œ–Œ¬≈–ﬂ≈Ã Õ≈Œ¡’Œƒ»ÃŒ ¬≈–Õ”“—ﬂ Õ¿ ƒ¬≈ “Œ◊ » Õ¿«¿ƒ »À» Õ≈“
					    IF(INDEXZZSFA.EQ.1) THEN
                           ! Õ≈Œ¡’Œƒ»ÃŒ ¬≈–Õ”“—ﬂ Õ¿ ƒ¬≈ “Œ◊ » Õ¿«¿ƒ
                           E1X=ExfM(5) 
                           ExfM(7)=ExfM(5) 
                           DetM(7)=DetM(5)
                           ExfM(6)=ExfM(4) 
                           DetM(6)=DetM(4)
						   ExfM(5)=ExfM(3) 
                           DetM(5)=DetM(3)
						   ExfM(4)=ExfM(2) 
                           DetM(4)=DetM(2)
						   ExfM(3)=ExfM(1) 
                           DetM(3)=DetM(1)
                           DetMA(7)=DetMA(5)
                           DetMA(6)=DetMA(4)
						   DetMA(5)=DetMA(3)
						   DetMA(4)=DetMA(2)
						   DetMA(3)=DetMA(1)
						   ! Œ¡Õ”Àﬂ≈Ã ¬€’Œƒ »« ÷» À¿
						   INDEXEXITRF=0
						   ! œ–Œ¬≈–ﬂ≈Ã ◊»—ÀŒ »“≈–¿÷»…
			               IF(IndexSUMZK.LT.3) THEN
                              ! Œ¡Õ”Àﬂ≈Ã —◊≈“◊»  œŒ— ŒÀ‹ ” œŒ—À≈ ¬Œ«¬–¿Ÿ≈Õ»ﬂ Õ¿ ƒ¬≈ “Œ◊ » Ã€ œŒœ¿ƒ¿≈Ã ¬ Õ¿◊¿À‹Õ”ﬁ “Œ◊ ”
				              IndexSUMZK=0 
			               ENDIF
					    ENDIF
					  
				     ENDIF

				     ! ÕŒ¬Œ≈ œ–»¡À»∆≈Õ»≈ ƒÀﬂ ›Õ≈–√»»                 
                     E1X=E1X*(1+Henergy)
				     ! œ–Œ¬≈–ﬂ≈Ã ¬€œŒÀÕ»ÀŒ—‹ ”—ÀŒ¬»≈ »À» Õ≈“
				     IF(INDEXZZSFA.EQ.0) THEN
                        IF(D1X.GT.RnormMOXF(NMO)) THEN 
                           INDEXEXITRF=INDEXEXITRF+1
					    ENDIF
					    ! œ–Œ¬≈–ﬂ≈Ã ¬€œŒÀÕ≈ÕŒ ”—ÀŒ¬»≈ ¬€’Œƒ¿ »À» Õ≈“
					    IF(INDEXEXITRF.EQ.5) THEN
					       ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈Õ€
                           IparametrDeterEnergy=2
					    ENDIF
				     ENDIF
			      ENDDO

                  !4. Œœ–≈ƒ≈Àﬂ≈Ã  Œ–≈Õ‹
				  ! Œœ–≈ƒ≈Àﬂ≈Ã Õ¿◊¿À‹Õ€≈ «Õ¿◊≈Õ»ﬂ œ–Œ÷≈——¿ œŒ»— ¿
                  RnormMO=RnormMOXF(NMO) 
                  ! œ–¿¬¿ﬂ √–¿Õ»÷¿ 
				  E1X=ExfM(7)
                  E2X=ExfM(6)
				  E3X=ExfM(5)
                  ! À≈¬¿ﬂ √–¿Õ»÷¿
				  E4X=EEMmin(NNEL)
				  D4X=DDMmin(NNEL)
                  ! ÷» À œŒ Œœ–≈ƒ≈À≈Õ»ﬁ  Œ–Õﬂ
				  WRITE(17,*) 'Energy left',Niteration,NMO,RnormMO
                  ! œ¿–¿Ã≈“– ¬€’Œƒ¿ »« ÷» À¿ 
                  IparametrDeterEnergy=1 
                  DO WHILE(IparametrDeterEnergy.EQ.1)
			         ! Õ¿’Œƒ»Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ ƒÀﬂ «Õ¿◊≈Õ»ﬂ ›Õ≈–√»» E1X
					 call CalculationNormFunctionEnergyXF(E1X,D1X,NMO,NumeroMaxLimid,Npoint,IndexM,Kpoint,NumeroMin,NumeroMax,Rcof,H,NumbreLigand,IXM,NLigands,NFunLigands,NumbreFunctionLig,RO1X,UNout,UNin,AX,BX,CX,FX,Uout,Uin,VNout,VNin,AZ,BZ,FZ,DZ,E,FunMO,Pz,A,B,AA,BB,Vout,Vin,AlfaCoffMO,RfunLigands)
			         ! Õ¿’Œƒ»Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ ƒÀﬂ «Õ¿◊≈Õ»ﬂ ›Õ≈–√»» E2X
			         call CalculationNormFunctionEnergyXF(E2X,D2X,NMO,NumeroMaxLimid,Npoint,IndexM,Kpoint,NumeroMin,NumeroMax,Rcof,H,NumbreLigand,IXM,NLigands,NFunLigands,NumbreFunctionLig,RO1X,UNout,UNin,AX,BX,CX,FX,Uout,Uin,VNout,VNin,AZ,BZ,FZ,DZ,E,FunMO,Pz,A,B,AA,BB,Vout,Vin,AlfaCoffMO,RfunLigands)
					 ! Õ¿’Œƒ»Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ ƒÀﬂ «Õ¿◊≈Õ»ﬂ ›Õ≈–√»» E3X
			         call CalculationNormFunctionEnergyXF(E3X,D3X,NMO,NumeroMaxLimid,Npoint,IndexM,Kpoint,NumeroMin,NumeroMax,Rcof,H,NumbreLigand,IXM,NLigands,NFunLigands,NumbreFunctionLig,RO1X,UNout,UNin,AX,BX,CX,FX,Uout,Uin,VNout,VNin,AZ,BZ,FZ,DZ,E,FunMO,Pz,A,B,AA,BB,Vout,Vin,AlfaCoffMO,RfunLigands)
					 ! Õ¿’Œƒ»Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ ƒÀﬂ «Õ¿◊≈Õ»ﬂ ›Õ≈–√»» E4X
			         call CalculationNormFunctionEnergyXF(E4X,D4X,NMO,NumeroMaxLimid,Npoint,IndexM,Kpoint,NumeroMin,NumeroMax,Rcof,H,NumbreLigand,IXM,NLigands,NFunLigands,NumbreFunctionLig,RO1X,UNout,UNin,AX,BX,CX,FX,Uout,Uin,VNout,VNin,AZ,BZ,FZ,DZ,E,FunMO,Pz,A,B,AA,BB,Vout,Vin,AlfaCoffMO,RfunLigands)
				     ! Œ—”Ÿ≈—“¬Àﬂ≈Ã œ–Œ¬≈– ” ”—“¿ÕŒ¬À≈ÕŒ Õ”À»¬Œ≈ «Õ¿◊≈Õ»≈ »À» Õ≈“
					 ! Õ¿’Œƒ»Ã ÷≈Õ“–¿À‹Õ€…  Œ–≈Õ‹
					 E3XX=((RnormMO-D2X)*E4X-(RnormMO-D4X)*E2X)/(D4X-D2X) 
                     ! Õ¿’Œƒ»Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ ƒÀﬂ «Õ¿◊≈Õ»ﬂ ›Õ≈–√»» E3XX
					 call CalculationNormFunctionEnergyXF(E3XX,D3XX,NMO,NumeroMaxLimid,Npoint,IndexM,Kpoint,NumeroMin,NumeroMax,Rcof,H,NumbreLigand,IXM,NLigands,NFunLigands,NumbreFunctionLig,RO1X,UNout,UNin,AX,BX,CX,FX,Uout,Uin,VNout,VNin,AZ,BZ,FZ,DZ,E,FunMO,Pz,A,B,AA,BB,Vout,Vin,AlfaCoffMO,RfunLigands)
			         ! œ–Œ¬≈–ﬂ≈Ã ¬€œŒÀÕﬂ≈“—ﬂ ”—ÀŒ¬»≈ ¬€’Œƒ¿
                     IF(DABS(D3XX-RnormMO).LT.EPS) THEN
                        ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
					    IparametrDeterEnergy=2
						Exf=E3XX 
					 ENDIF


				     ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ 
				     ! «¿œ»—€¬¿≈Ã ƒ¿ÕÕŒ≈ œ–»¡À»∆≈Õ»≈ 
				     E1XX=E1X
					 D1XX=D1X

					 E2XX=E2X
					 D2XX=D2X
					  
					 E3XX=E3X
					 D3XX=D3X

					 E4XX=E4X
					 D4XX=D4X
					 
					 ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ ÕŒ¬Œ√Œ œ–»¡À»∆≈Õ»ﬂ
                     E2X=E2XX-(D2XX-RnormMO)*(E3XX-E1XX)/(D3XX-D1XX)
                     E3X=E2X*(1.D0-Henergy) 
                     E1X=E2X/(1.D0-Henergy)  
					 E4X=(E2XX*(D4XX-RnormMO)-E4XX*(D2XX-RnormMO))/(D4XX-D2XX) 
					 WRITE(17,*) E2X,E4X,D3XX 
				  ENDDO 


                  !  Œ–≈Õ‹ Õ¿…ƒ≈Õ
		          INlevo=1
		          ExfLevo=Exf
				  ExfZero=0.D0
		        ELSE
                 !  ŒÕ≈Õ‹ Õ≈ Õ¿…ƒ≈Õ
		         INlevo=0 
		         ExfLevo=0.D0
				 ExfZero=0.D0
             ENDIF 
          ENDIF

	   ENDIF
      

	   ! ”— Œ–≈ÕÕ€… Ã≈“Œƒ –¿—◊≈“¿
       IF(IISSXDDZS.EQ.1) THEN
		   
		    ! Õ”À»¬Œ≈ œ–»¡À»∆≈Õ»≈
			ExfZero=Exf			 
           
			! Õ¿’Œƒ»Ã ŒƒÕŒ›À≈ “–ŒÕÕ€≈ ›Õ≈–√»» —ŒŒ“¬≈“—“¬”ﬁŸ»≈ ƒ¿ÕÕŒÃ” «Õ¿◊≈Õ»ﬁ ÕŒ–Ã»–Œ¬Œ◊ÕŒ…  ŒÕ—“¿Õ“€
	        ! —À≈¬¿ » —œ–¿¬¿ Œ“ «Õ¿◊≈Õ»ﬂ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»» œŒÀ”◊≈ÕÕŒ… œ–» –≈ÿ≈Õ»» ŒƒÕŒ–ŒƒÕŒ√Œ ”–¿¬Õ≈Õ»ﬂ
            WRITE(17,*) 'MIN',Niteration,NMO 
            ! Œœ–≈ƒ≈Àﬂ≈Ã «Õ¿◊≈Õ»≈ —œ–¿¬¿ 
			! 1. Œœ–≈ƒ≈Àﬂ≈Ã Ã»Õ»Ã¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ ÕŒ–Ã€  ¬ »Õ“≈–¬¿À≈  (NNEL-1, NNEL)
			call MinValueNormEnergyFunction(NMO,Npoint,IndexM,NumeroMin,NumeroMax,Kpoint,NumeroMaxLimid,Rcof,H,Uout,Uin,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,AlfaCoffMO,RfunLigands,RO1X,FunMO,Pz,IXM,UNout,UNin,Vout,Vin,AX,BX,CX,E,AZ,FZ,BZ,FX,VNout,VNin,DZ,A,B,AA,BB,ExfSolutions(2),ExfSolutions(1),REmin,RfunMIN)
			
					
			! 2. —–¿¬Õ»¬¿≈Ã œŒÀ”◊≈ÕÕŒ≈ Ã»Õ»Ã¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ ÕŒ–Ã€ — ÕŒ–ÃŒ… –≈ÿ≈Õ»ﬂ ƒÀﬂ ”—“¿ÕŒ¬À≈Õ»ﬂ Õ¿À»◊»ﬂ  Œ–Õﬂ
			! Œœ–≈ƒ≈Àﬂ≈Ã ŒƒÕŒ›À≈ “–ŒÕÕŒ≈ «Õ¿◊≈Õ»≈ ›Õ≈–√»» ¬ —ŒŒ“¬≈“—¬»» — »Õ“≈√–¿À‹Õ€Ã  –»“≈–»≈Ã 
			IF(RnormMOXF(NMO).GT.RfunMIN) THEN
                
				!  Œ–≈Õ‹ —”Ÿ≈—“¬”≈“
				! Œ—”Ÿ≈—“¬Àﬂ≈Ã œŒ»—   Œ–Õﬂ   
               
			      ! Õ¿◊¿À‹Õ€… ÿ¿√ œŒ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»
                  Henergy=0.1D0
                  ! Œœ–≈ƒ≈Àﬂ≈Ã ÿ¿√ ƒÀﬂ ƒ¿ÕÕŒ… ŒƒÕŒ›À≈ “–ŒÕÕŒ… ‘”Õ ÷»» 
                  DO IICFHK=1,NNEL
                     ! »«Ã≈Õ≈Õ»≈ ÿ¿√¿ 
	                 Henergy=Henergy/FLOAT(IICFHK+2)  
                  ENDDO

                  ! Œœ–≈ƒ≈Àﬂ≈Ã Õ≈Œ¡’Œƒ»Ã –¿—◊≈“ »À» Õ≈“
                  IntParXXZ=2
	              IF(Niteration.EQ.1) THEN  
                     ! –¿—◊≈“ ¡≈« Œ¡Ã≈Õ¿
		             IF(IKLExchange.EQ.0) THEN
                        IntParXXZ=2
                     ENDIF
                     ! –¿—◊≈“ — Œ¡Ã≈ÕŒÃ
                     IF(IKLExchange.EQ.1) THEN
                        IntParXXZ=1
                     ENDIF
                  ENDIF

      
	              ! œ–Œ¬≈–ﬂ≈Ã ¬€œŒÀÕ≈Õ»ﬂ  –»“≈–»ﬂ ƒÀﬂ ƒ¿ÕÕŒ√Œ ÿ¿√¿
	              ! ÿ¿√ ƒŒÀ∆≈Õ ¡€“‹ Ã≈Õ‹ÿ≈ Œ“ÕŒÿ≈Õ»ﬂ Œ“ ÀŒÕ≈Õ»ﬂ   Õ”À»¬ŒÃ” œ–»¡À»∆≈Õ»ﬁ ›Õ≈–√»» œ–» ›“ŒÃ ¡€“‹ “¿ Œ¬€Ã, 
	              ! ◊“Œ¡€ ÃŒ∆ÕŒ ¡€ÀŒ —ƒ≈À¿“‹ “–» ÿ¿√¿
	              IF(Niteration.NE.IntParXXZ) THEN 
	                 Rkriter=DeltaEnegry(NMO,2)/(3.D0*ExfZero)
	                 DO WHILE(Henergy.GT.Rkriter)
		                Henergy=Henergy*0.97D0   
                     ENDDO
	              ENDIF
                  
                  ! Œœ–≈ƒ≈Àﬂ≈Ã Õ¿◊¿À‹Õ€≈ «Õ¿◊≈Õ»ﬂ œ–Œ÷≈——¿ œŒ»— ¿
                  RnormMO=RnormMOXF(NMO) 
                  ! À≈¬¿ﬂ √–¿Õ»÷¿ 
				  E1X=ExfZero*(1.D0+Henergy) 
                  E2X=ExfZero*(1.D0+2.D0*Henergy)
				  E3X=ExfZero*(1.D0+3.D0*Henergy) 
                  ! œ–¿¬¿ﬂ √–¿Õ»÷¿
				  E4X=REmin 
				  D4X=RfunMIN   
                  ! ÷» À œŒ Œœ–≈ƒ≈À≈Õ»ﬁ  Œ–Õﬂ
				  WRITE(17,*) 'Energy right',Niteration,NMO,RnormMO
                  ! œ¿–¿Ã≈“– ¬€’Œƒ¿ »« ÷» À¿ 
                  IparametrDeterEnergy=1 
                  DO WHILE(IparametrDeterEnergy.EQ.1)
			         ! Õ¿’Œƒ»Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ ƒÀﬂ «Õ¿◊≈Õ»ﬂ ›Õ≈–√»» E1X
					 call CalculationNormFunctionEnergyXF(E1X,D1X,NMO,NumeroMaxLimid,Npoint,IndexM,Kpoint,NumeroMin,NumeroMax,Rcof,H,NumbreLigand,IXM,NLigands,NFunLigands,NumbreFunctionLig,RO1X,UNout,UNin,AX,BX,CX,FX,Uout,Uin,VNout,VNin,AZ,BZ,FZ,DZ,E,FunMO,Pz,A,B,AA,BB,Vout,Vin,AlfaCoffMO,RfunLigands)
			         ! Õ¿’Œƒ»Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ ƒÀﬂ «Õ¿◊≈Õ»ﬂ ›Õ≈–√»» E2X
			         call CalculationNormFunctionEnergyXF(E2X,D2X,NMO,NumeroMaxLimid,Npoint,IndexM,Kpoint,NumeroMin,NumeroMax,Rcof,H,NumbreLigand,IXM,NLigands,NFunLigands,NumbreFunctionLig,RO1X,UNout,UNin,AX,BX,CX,FX,Uout,Uin,VNout,VNin,AZ,BZ,FZ,DZ,E,FunMO,Pz,A,B,AA,BB,Vout,Vin,AlfaCoffMO,RfunLigands)
					 ! Õ¿’Œƒ»Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ ƒÀﬂ «Õ¿◊≈Õ»ﬂ ›Õ≈–√»» E3X
			         call CalculationNormFunctionEnergyXF(E3X,D3X,NMO,NumeroMaxLimid,Npoint,IndexM,Kpoint,NumeroMin,NumeroMax,Rcof,H,NumbreLigand,IXM,NLigands,NFunLigands,NumbreFunctionLig,RO1X,UNout,UNin,AX,BX,CX,FX,Uout,Uin,VNout,VNin,AZ,BZ,FZ,DZ,E,FunMO,Pz,A,B,AA,BB,Vout,Vin,AlfaCoffMO,RfunLigands)
					 ! Õ¿’Œƒ»Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ ƒÀﬂ «Õ¿◊≈Õ»ﬂ ›Õ≈–√»» E4X
			         call CalculationNormFunctionEnergyXF(E4X,D4X,NMO,NumeroMaxLimid,Npoint,IndexM,Kpoint,NumeroMin,NumeroMax,Rcof,H,NumbreLigand,IXM,NLigands,NFunLigands,NumbreFunctionLig,RO1X,UNout,UNin,AX,BX,CX,FX,Uout,Uin,VNout,VNin,AZ,BZ,FZ,DZ,E,FunMO,Pz,A,B,AA,BB,Vout,Vin,AlfaCoffMO,RfunLigands)
				     ! Œ—”Ÿ≈—“¬Àﬂ≈Ã œ–Œ¬≈– ” ”—“¿ÕŒ¬À≈ÕŒ Õ”À»¬Œ≈ «Õ¿◊≈Õ»≈ »À» Õ≈“
					 ! Õ¿’Œƒ»Ã ÷≈Õ“–¿À‹Õ€…  Œ–≈Õ‹
					 E3XX=((RnormMO-D2X)*E4X-(RnormMO-D4X)*E2X)/(D4X-D2X) 
                 	 ! Õ¿’Œƒ»Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ ƒÀﬂ «Õ¿◊≈Õ»ﬂ ›Õ≈–√»» E3XX
					 call CalculationNormFunctionEnergyXF(E3XX,D3XX,NMO,NumeroMaxLimid,Npoint,IndexM,Kpoint,NumeroMin,NumeroMax,Rcof,H,NumbreLigand,IXM,NLigands,NFunLigands,NumbreFunctionLig,RO1X,UNout,UNin,AX,BX,CX,FX,Uout,Uin,VNout,VNin,AZ,BZ,FZ,DZ,E,FunMO,Pz,A,B,AA,BB,Vout,Vin,AlfaCoffMO,RfunLigands)
			         ! œ–Œ¬≈–ﬂ≈Ã ¬€œŒÀÕﬂ≈“—ﬂ ”—ÀŒ¬»≈ ¬€’Œƒ¿
                     IF(DABS(D3XX-RnormMO).LT.EPS) THEN
                        ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
						IparametrDeterEnergy=2
						Exf=E3XX 
					 ENDIF
                    
				     ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ 
				     ! «¿œ»—€¬¿≈Ã ƒ¿ÕÕŒ≈ œ–»¡À»∆≈Õ»≈ 
				     E1XX=E1X
					 D1XX=D1X

					 E2XX=E2X
					 D2XX=D2X
					 
					 E3XX=E3X
					 D3XX=D3X

					 E4XX=E4X
					 D4XX=D4X
					 
					 ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ ÕŒ¬Œ√Œ œ–»¡À»∆≈Õ»ﬂ
                     E2X=E2XX-(D2XX-RnormMO)*(E3XX-E1XX)/(D3XX-D1XX)
                     E3X=E2X*(1.D0+Henergy) 
                     E1X=E2X/(1.D0+Henergy)  
					 E4X=(E2XX*(D4XX-RnormMO)-E4XX*(D2XX-RnormMO))/(D4XX-D2XX)  
					 WRITE(17,*) E2X,E4X,D3XX
				  ENDDO 
					   

                   !  Œ–≈Õ‹ Õ≈…ƒ≈Õ
		           INspravo=1
		           ExfSpravo=Exf
		           ! ‘» —»–”≈Ã  Œ–≈Õ‹ —À≈¬¿  ¿  Õ”À»¬Œ… 
                   ! ≈—À» Õ¿…ƒ≈Õ Õ»∆≈ À≈∆¿Ÿ»… ¡ŒÀ≈≈ ¬€—Œ Œ À≈∆¿Ÿ»… Õ≈ Õ”∆ÕŒ »— ¿“‹
		           INlevo=0 
		           ExfLevo=0.D0
               ELSE 
                             
			    !  Œ–≈Õ‹ Õ≈ —”Ÿ≈—“¬”≈“
                INspravo=0
		        ExfSpravo=0.D0  
			ENDIF


			! 3. œ–Œ¬≈–ﬂ≈Ã Õ¿…ƒ≈Õ  Œ–≈Õ‹ —œ–¿¬¿ »À» Õ≈“
            IF(INspravo.EQ.0) THEN
			   !  Œ–≈Õ‹ —œ–¿¬¿ Õ≈ Õ¿…ƒ≈Õ Œ—”Ÿ≈—“¬Àﬂ≈Ã œŒ»—   Œ–Õﬂ —À≈¬¿
			   ! Œ—”Ÿ≈—“¬Àﬂ≈Ã œŒ»—  œŒ—À≈ƒÕ≈… ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»» ƒÀﬂ NNEL+1
			   WRITE(17,*) 'Energy zero Left',Niteration,NMO
			   call SearchEnergySolutionHomogeneousSystemAcceleratedLeft2(NNEL,Npoint,NumeroMin,Kpoint,IndexM,Rcof,EPS,Pz,RO1X,A,B,AA,BB,E,AZ,FZ,BZ,FX,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,DZ,AX,BX,ENN0,ExfSolutions,IndexCorrectSET,IndexSolutionsSET,HenergySET,ExfSETT,ExfSET,DetSET,INDEXGRNYT) 
              
			   ! 1. Œœ–≈ƒ≈Àﬂ≈Ã Ã»Õ»Ã¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ ÕŒ–Ã€  ¬ »Õ“≈–¬¿À≈  (NNEL, NNEL+1)
			   WRITE(17,*) 
			   IF(INDEXGRNYT.EQ.0) THEN
			      ! »Õ“≈–¬¿À œŒÀÕŒ—“‹ﬁ Œœ–≈ƒ≈À≈Õ (Œœ–≈ƒ≈À≈Õ¿ √–¿Õ»÷¿) 
			      call MinValueNormEnergyFunction(NMO,Npoint,IndexM,NumeroMin,NumeroMax,Kpoint,NumeroMaxLimid,Rcof,H,Uout,Uin,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,AlfaCoffMO,RfunLigands,RO1X,FunMO,Pz,IXM,UNout,UNin,Vout,Vin,AX,BX,CX,E,AZ,FZ,BZ,FX,VNout,VNin,DZ,A,B,AA,BB,ExfSolutions(3),ExfSolutions(2),REmin,RfunMIN)
			   ENDIF
		       IF(INDEXGRNYT.EQ.1) THEN
			      ! Œœ–≈ƒ≈À≈Õ¿ “Œ◊ ¿ ¬ »Õ“≈–¬¿À≈ Œ“ÕŒ—»“≈À‹ÕŒ  Œ“Œ–Œ… Õ¿’Œƒ»“—ﬂ Ã»Õ»Ã”Ã 
                  call MinValueNormEnergyFunctionD(NMO,Npoint,IndexM,NumeroMin,NumeroMax,Kpoint,NumeroMaxLimid,Rcof,H,Uout,Uin,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,AlfaCoffMO,RfunLigands,RO1X,FunMO,Pz,IXM,UNout,UNin,Vout,Vin,AX,BX,CX,E,AZ,FZ,BZ,FX,VNout,VNin,DZ,A,B,AA,BB,ExfSolutions(3),ExfSolutions(2),REmin,RfunMIN)
			   ENDIF

               ! 2. —–¿¬Õ»¬¿≈Ã œŒÀ”◊≈ÕÕŒ≈ Ã»Õ»Ã¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ ÕŒ–Ã€ — ÕŒ–ÃŒ… –≈ÿ≈Õ»ﬂ ƒÀﬂ ”—“¿ÕŒ¬À≈Õ»ﬂ Õ¿À»◊»ﬂ  Œ–Õﬂ
			   IF(RnormMOXF(NMO).GT.RfunMIN) THEN
                    !  Œ–≈Õ‹ —”Ÿ≈—“¬”≈“
				    ! Œ—”Ÿ≈—“¬Àﬂ≈Ã œŒ»—   Œ–Õﬂ   		
			        ! Õ¿◊¿À‹Õ€… ÿ¿√ œŒ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»
                    Henergy=0.1D0
                    ! Œœ–≈ƒ≈Àﬂ≈Ã ÿ¿√ ƒÀﬂ ƒ¿ÕÕŒ… ŒƒÕŒ›À≈ “–ŒÕÕŒ… ‘”Õ ÷»» 
                    DO IICFHK=1,NNEL
                       ! »«Ã≈Õ≈Õ»≈ ÿ¿√¿ 
	                   Henergy=Henergy/FLOAT(IICFHK+1)  
                    ENDDO
      
	                ! Œœ–≈ƒ≈Àﬂ≈Ã Õ≈Œ¡’Œƒ»Ã –¿—◊≈“ »À» Õ≈“
                    IntParXXZ=2
	                IF(Niteration.EQ.1) THEN  
                       ! –¿—◊≈“ ¡≈« Œ¡Ã≈Õ¿
		               IF(IKLExchange.EQ.0) THEN
                          IntParXXZ=2
                       ENDIF
                       ! –¿—◊≈“ — Œ¡Ã≈ÕŒÃ
                       IF(IKLExchange.EQ.1) THEN
                          IntParXXZ=1
                       ENDIF
                    ENDIF



	                ! œ–Œ¬≈–ﬂ≈Ã ¬€œŒÀÕ≈Õ»ﬂ  –»“≈–»ﬂ ƒÀﬂ ƒ¿ÕÕŒ√Œ ÿ¿√¿
	                ! ÿ¿√ ƒŒÀ∆≈Õ ¡€“‹ Ã≈Õ‹ÿ≈ Œ“ÕŒÿ≈Õ»ﬂ Œ“ ÀŒÕ≈Õ»ﬂ   Õ”À»¬ŒÃ” œ–»¡À»∆≈Õ»ﬁ ›Õ≈–√»» œ–» ›“ŒÃ ¡€“‹ “¿ Œ¬€Ã, 
	                ! ◊“Œ¡€ ÃŒ∆ÕŒ ¡€ÀŒ —ƒ≈À¿“‹ “–» ÿ¿√¿
                    IF(Niteration.NE.IntParXXZ) THEN 
	                   Rkriter=DeltaEnegry(NMO,1)/(3.D0*ExfZero)
	                   DO WHILE(Henergy.GT.Rkriter)
		                  Henergy=Henergy*0.97D0   
                       ENDDO
	                ENDIF

	                ! Õ¿’Œƒ»Ã ŒƒÕŒ›À≈ “–ŒÕÕ”ﬁ ›Õ≈–√»ﬁ —À≈¬¿  
	                !  Œ›‘‘»÷»≈Õ“ ÕŒ–Ã»–Œ¬ » ƒÀﬂ ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»  –»“≈–»… œŒÀ”◊≈Õ»ﬂ œ–¿¬»À‹ÕŒ… ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»  
                   
				    ! Œœ–≈ƒ≈Àﬂ≈Ã Õ¿◊¿À‹Õ€≈ «Õ¿◊≈Õ»ﬂ œ–Œ÷≈——¿ œŒ»— ¿
                    RnormMO=RnormMOXF(NMO) 
                    ! œ–¿¬¿ﬂ √–¿Õ»÷¿ 
				    E1X=ExfZero*(1.D0-Henergy) 
                    E2X=ExfZero*(1.D0-2.D0*Henergy)
				    E3X=ExfZero*(1.D0-3.D0*Henergy) 
                    ! À≈¬¿ﬂ √–¿Õ»÷¿
				    E4X=REmin 
				    D4X=RfunMIN   
                    ! ÷» À œŒ Œœ–≈ƒ≈À≈Õ»ﬁ  Œ–Õﬂ
                    ! œ¿–¿Ã≈“– ¬€’Œƒ¿ »« ÷» À¿ 
                    IparametrDeterEnergy=1 
                    DO WHILE(IparametrDeterEnergy.EQ.1)
			           ! Õ¿’Œƒ»Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ ƒÀﬂ «Õ¿◊≈Õ»ﬂ ›Õ≈–√»» E1X
					   call CalculationNormFunctionEnergyXF(E1X,D1X,NMO,NumeroMaxLimid,Npoint,IndexM,Kpoint,NumeroMin,NumeroMax,Rcof,H,NumbreLigand,IXM,NLigands,NFunLigands,NumbreFunctionLig,RO1X,UNout,UNin,AX,BX,CX,FX,Uout,Uin,VNout,VNin,AZ,BZ,FZ,DZ,E,FunMO,Pz,A,B,AA,BB,Vout,Vin,AlfaCoffMO,RfunLigands)
			           ! Õ¿’Œƒ»Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ ƒÀﬂ «Õ¿◊≈Õ»ﬂ ›Õ≈–√»» E2X
			           call CalculationNormFunctionEnergyXF(E2X,D2X,NMO,NumeroMaxLimid,Npoint,IndexM,Kpoint,NumeroMin,NumeroMax,Rcof,H,NumbreLigand,IXM,NLigands,NFunLigands,NumbreFunctionLig,RO1X,UNout,UNin,AX,BX,CX,FX,Uout,Uin,VNout,VNin,AZ,BZ,FZ,DZ,E,FunMO,Pz,A,B,AA,BB,Vout,Vin,AlfaCoffMO,RfunLigands)
					   ! Õ¿’Œƒ»Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ ƒÀﬂ «Õ¿◊≈Õ»ﬂ ›Õ≈–√»» E3X
			           call CalculationNormFunctionEnergyXF(E3X,D3X,NMO,NumeroMaxLimid,Npoint,IndexM,Kpoint,NumeroMin,NumeroMax,Rcof,H,NumbreLigand,IXM,NLigands,NFunLigands,NumbreFunctionLig,RO1X,UNout,UNin,AX,BX,CX,FX,Uout,Uin,VNout,VNin,AZ,BZ,FZ,DZ,E,FunMO,Pz,A,B,AA,BB,Vout,Vin,AlfaCoffMO,RfunLigands)
					   ! Õ¿’Œƒ»Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ ƒÀﬂ «Õ¿◊≈Õ»ﬂ ›Õ≈–√»» E4X
			           call CalculationNormFunctionEnergyXF(E4X,D4X,NMO,NumeroMaxLimid,Npoint,IndexM,Kpoint,NumeroMin,NumeroMax,Rcof,H,NumbreLigand,IXM,NLigands,NFunLigands,NumbreFunctionLig,RO1X,UNout,UNin,AX,BX,CX,FX,Uout,Uin,VNout,VNin,AZ,BZ,FZ,DZ,E,FunMO,Pz,A,B,AA,BB,Vout,Vin,AlfaCoffMO,RfunLigands)
				       ! Œ—”Ÿ≈—“¬Àﬂ≈Ã œ–Œ¬≈– ” ”—“¿ÕŒ¬À≈ÕŒ Õ”À»¬Œ≈ «Õ¿◊≈Õ»≈ »À» Õ≈“
					   ! Õ¿’Œƒ»Ã ÷≈Õ“–¿À‹Õ€…  Œ–≈Õ‹
					   E3XX=((RnormMO-D2X)*E4X-(RnormMO-D4X)*E2X)/(D4X-D2X) 
                       ! Õ¿’Œƒ»Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ ƒÀﬂ «Õ¿◊≈Õ»ﬂ ›Õ≈–√»» E3XX
					   call CalculationNormFunctionEnergyXF(E3XX,D3XX,NMO,NumeroMaxLimid,Npoint,IndexM,Kpoint,NumeroMin,NumeroMax,Rcof,H,NumbreLigand,IXM,NLigands,NFunLigands,NumbreFunctionLig,RO1X,UNout,UNin,AX,BX,CX,FX,Uout,Uin,VNout,VNin,AZ,BZ,FZ,DZ,E,FunMO,Pz,A,B,AA,BB,Vout,Vin,AlfaCoffMO,RfunLigands)
			           ! œ–Œ¬≈–ﬂ≈Ã ¬€œŒÀÕﬂ≈“—ﬂ ”—ÀŒ¬»≈ ¬€’Œƒ¿
                       IF(DABS(D3XX-RnormMO).LT.EPS) THEN
                          ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
						  IparametrDeterEnergy=2
						  Exf=E3XX 
					   ENDIF


				       ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ 
				       ! «¿œ»—€¬¿≈Ã ƒ¿ÕÕŒ≈ œ–»¡À»∆≈Õ»≈ 
				       E1XX=E1X
					   D1XX=D1X

					   E2XX=E2X
					   D2XX=D2X
					  
					   E3XX=E3X
					   D3XX=D3X

					   E4XX=E4X
					   D4XX=D4X
					 
					   ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ ÕŒ¬Œ√Œ œ–»¡À»∆≈Õ»ﬂ
                       E2X=E2XX-(D2XX-RnormMO)*(E3XX-E1XX)/(D3XX-D1XX)
                       E3X=E2X*(1.D0-Henergy) 
                       E1X=E2X/(1.D0-Henergy)  
					   E4X=(E2XX*(D4XX-RnormMO)-E4XX*(D2XX-RnormMO))/(D4XX-D2XX)  
				    ENDDO 


                    !  Œ–≈Õ‹ Õ¿…ƒ≈Õ
		            INlevo=1
		            ExfLevo=Exf
				  
				  ELSE
                    !  ŒÕ≈Õ‹ Õ≈ Õ¿…ƒ≈Õ
		            INlevo=0 
		            ExfLevo=0.D0
               ENDIF

			ENDIF

	   ENDIF
      


	   ! —“¿Õƒ¿–“Õ€… Ã≈“Œƒ –¿—◊≈“¿
	   IF(NNEL.LT.4) THEN 
	    
		 ! Õ¿’Œƒ»Ã ŒƒÕŒ›À≈ “–ŒÕÕ€≈ ›Õ≈–√»» —ŒŒ“¬≈“—“¬”ﬁŸ»≈ ƒ¿ÕÕŒÃ” «Õ¿◊≈Õ»ﬁ ÕŒ–Ã»–Œ¬Œ◊ÕŒ…  ŒÕ—“¿Õ“€
	     ! —À≈¬¿ » —œ–¿¬¿ Œ“ «Õ¿◊≈Õ»ﬂ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»» œŒÀ”◊≈ÕÕŒ… œ–» –≈ÿ≈Õ»» ŒƒÕŒ–ŒƒÕŒ√Œ ”–¿¬Õ≈Õ»ﬂ
	     ExfZero=Exf
      

         !WRITE(6,*) 'Energy One-Electron NE ODNORODNOE LEVOE',Niteration,NMO,Exf,Kpoint
         !WRITE(*,*) 'EEEX NE ODNORODNOE LEVOE',ExfLevo
         !READ(*,*) 
      
         ! Õ¿◊¿À‹Õ€… ÿ¿√ œŒ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»
         Henergy=0.1D0
         ! Œœ–≈ƒ≈Àﬂ≈Ã ÿ¿√ ƒÀﬂ ƒ¿ÕÕŒ… ŒƒÕŒ›À≈ “–ŒÕÕŒ… ‘”Õ ÷»» 
         DO IICFHK=1,NNEL
            ! »«Ã≈Õ≈Õ»≈ ÿ¿√¿ 
	        Henergy=Henergy/FLOAT(IICFHK+2)  
         ENDDO

         ! Œœ–≈ƒ≈Àﬂ≈Ã Õ≈Œ¡’Œƒ»Ã –¿—◊≈“ »À» Õ≈“
         IntParXXZ=2
	     IF(Niteration.EQ.1) THEN  
            ! –¿—◊≈“ ¡≈« Œ¡Ã≈Õ¿
		    IF(IKLExchange.EQ.0) THEN
               IntParXXZ=2
            ENDIF
            ! –¿—◊≈“ — Œ¡Ã≈ÕŒÃ
            IF(IKLExchange.EQ.1) THEN
               IntParXXZ=1
            ENDIF
         ENDIF

      
	     ! œ–Œ¬≈–ﬂ≈Ã ¬€œŒÀÕ≈Õ»ﬂ  –»“≈–»ﬂ ƒÀﬂ ƒ¿ÕÕŒ√Œ ÿ¿√¿
	     ! ÿ¿√ ƒŒÀ∆≈Õ ¡€“‹ Ã≈Õ‹ÿ≈ Œ“ÕŒÿ≈Õ»ﬂ Œ“ ÀŒÕ≈Õ»ﬂ   Õ”À»¬ŒÃ” œ–»¡À»∆≈Õ»ﬁ ›Õ≈–√»» œ–» ›“ŒÃ ¡€“‹ “¿ Œ¬€Ã, 
	     ! ◊“Œ¡€ ÃŒ∆ÕŒ ¡€ÀŒ —ƒ≈À¿“‹ “–» ÿ¿√¿
	     IF(Niteration.NE.IntParXXZ) THEN 
	        Rkriter=DeltaEnegry(NMO,2)/(3.D0*ExfZero)
	        DO WHILE(Henergy.GT.Rkriter)
		       Henergy=Henergy*0.97D0   
            ENDDO
	     ENDIF

         ! Õ¿’Œƒ»Ã ŒƒÕŒ›À≈ “–ŒÕÕ”ﬁ ›Õ≈–√»ﬁ —œ–¿¬¿  
	     !  Œ›‘‘»÷»≈Õ“ ÕŒ–Ã»–Œ¬ » ƒÀﬂ ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»  –»“≈–»… œŒÀ”◊≈Õ»ﬂ œ–¿¬»À‹ÕŒ… ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»  
         RnormMO=RnormMOXF(NMO) 
         DetM=0.D0
         ExfM=0.D0
         ExfM(2)=ExfZero*(1.D0+Henergy) 
	     Exf=ExfZero*(1.D0+Henergy)   
      
         ! œ¿–¿Ã≈“– ¬€’Œƒ¿ »« ÷» À¿ œŒ –¿—◊≈“” ›Õ≈–√»»
         IparametrDeterEnergy=1
         NEpsIter=0
         INEXDSEXF=0
	     IcorenZZ=0
         ! œ¿–¿Ã≈“– ” ¿«€¬¿ﬁŸ»… Õ¿  Œ–≈Õ‹  Œ“Œ–€… »Ÿ≈“—ﬂ —œ–¿¬¿
         IZNAK=2
         ! œ¿–¿Ã≈“– ” ¿«€¬¿ﬁŸ»… Õ¿ “Œ ◊“Œ »Õ“≈–¬¿À √ƒ≈ Õ¿’Œƒ»“—ﬂ  Œ–≈Õ‹ Œœ–≈ƒ≈À≈Õ
         IndexVilky=0
         INDEXDF=0
         IIKK=0
         IndexCorrect=0
		 IndexExitRerern=0
         WRITE(17,*) 'Energy right',Niteration,NMO
	     !WRITE(*,*) 'EEEX NOW PRAVOE',Exf 
         !READ(*,*) 
         !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
         !÷» À Œœ–≈ƒ≈À≈Õ»≈ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»» ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» —œ–¿¬¿!
         !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
         DO WHILE(IparametrDeterEnergy.EQ.1)
            NEpsIter=NEpsIter+1
	        ! Œœ–≈ƒ≈Àﬂ≈Ã ÕŒÃ≈– “Œ◊ » —ÿ»¬ » –≈ÿ≈Õ»… OUT AND IN
	        call PointIntersection(Npoint,NumeroMin,Exf,Pz,RO1X,Kpoint)
	        !WRITE(*,*) 'Kpoint',Kpoint
	        !WRITE(*,*) '4 Exf',Exf

	        ! œŒƒœ–Œ√–¿ÃÃ¿ ‘Œ–Ã»–”≈“ Ã¿——»¬€ ƒÀﬂ –¿—◊≈“¬¿ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ »
	        call FormMassivAABB(Npoint,IndexM,Rcof,Exf,A,B,AA,BB,RO1X,E,AZ,FZ,BZ)
	 
            !WRITE(*,*) '5 Exf',Exf
            ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » ƒÀﬂ Õ≈ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€
            call CalculationParameterProgonky(2,IndexM,Kpoint,Npoint,AA,BB,FX,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,AZ,BZ,FZ,DZ,E,AX,BX)
            !WRITE(*,*) '6 Exf',Exf  
            !  Œ––≈ “»–”≈Ã «Õ¿◊≈Õ»≈ ›Õ≈–√»» Exf
	        !write(*,*) 'eeee',Exf 
    	    call CorrectionEnergy(IZNAK,NEpsIter,Kpoint,Npoint,IndexM,NumeroMin,NumeroMax,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,DetM,ExfM,Exf,AZ,BZ,E,AX,BX,CX,IXM,FunMO,RO1X,H,Henergy,RnormMO,IparametrDeterEnergy,EPS,RdeltaZnak,IndexVilky,INDEXDF,IIKK,IndexCorrect,IcorenZZ,NMO,NumeroMaxLimid,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,RfunLigands,AlfaCoffMO,IndexExitRerern)  
			!write(*,*) '3 exf',Exf 
         ENDDO

	
      
	     ! ”—“¿Õ¿¬À»¬¿≈Ã Õ¿…ƒ≈Õ À» —œ–¿¬¿  Œ–≈Õ‹
	     IF(IcorenZZ.EQ.1) THEN
             !  Œ–≈Õ‹ Õ¿…ƒ≈Õ
		     INspravo=1
		     ExfSpravo=Exf
		     ! ‘» —»–”≈Ã  Œ–≈Õ‹ —À≈¬¿  ¿  Õ”À»¬Œ… 
             ! ≈—À» Õ¿…ƒ≈Õ Õ»∆≈ À≈∆¿Ÿ»… ¡ŒÀ≈≈ ¬€—Œ Œ À≈∆¿Ÿ»… Õ≈ Õ”∆ÕŒ »— ¿“‹
		     INlevo=0 
		     ExfLevo=0.D0
            ELSE
		     !  ŒÕ≈Õ‹ Õ≈ Õ¿…ƒ≈Õ
		     INspravo=0
		     ExfSpravo=0.D0 
	     ENDIF 
         
		 IF(Niteration.EQ.11.AND.NMO.EQ.3) THEN
            WRITE(6,*) 'Energy right',Niteration,NMO 
			WRITE(6,*) 'ExfSpravo',INspravo,ExfSpravo

		 ENDIF


	     ! œŒ»—   Œ–Õﬂ —À≈¬¿ Œ—”Ÿ≈—“¬Àﬂ≈Ã ¬ —À”◊¿≈ Œ“—”“—“¬»ﬂ  Œ–Õﬂ —œ–¿¬¿
	     IF(INspravo.EQ.0) THEN
         
	        ! Õ¿◊¿À‹Õ€… ÿ¿√ œŒ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»
            Henergy=0.1D0
            ! Œœ–≈ƒ≈Àﬂ≈Ã ÿ¿√ ƒÀﬂ ƒ¿ÕÕŒ… ŒƒÕŒ›À≈ “–ŒÕÕŒ… ‘”Õ ÷»» 
            DO IICFHK=1,NNEL
               ! »«Ã≈Õ≈Õ»≈ ÿ¿√¿ 
	           Henergy=Henergy/FLOAT(IICFHK+1)  
            ENDDO
      
	        ! Œœ–≈ƒ≈Àﬂ≈Ã Õ≈Œ¡’Œƒ»Ã –¿—◊≈“ »À» Õ≈“
            IntParXXZ=2
	        IF(Niteration.EQ.1) THEN  
               ! –¿—◊≈“ ¡≈« Œ¡Ã≈Õ¿
		       IF(IKLExchange.EQ.0) THEN
                  IntParXXZ=2
               ENDIF
               ! –¿—◊≈“ — Œ¡Ã≈ÕŒÃ
               IF(IKLExchange.EQ.1) THEN
                  IntParXXZ=1
               ENDIF
            ENDIF



	        ! œ–Œ¬≈–ﬂ≈Ã ¬€œŒÀÕ≈Õ»ﬂ  –»“≈–»ﬂ ƒÀﬂ ƒ¿ÕÕŒ√Œ ÿ¿√¿
	        ! ÿ¿√ ƒŒÀ∆≈Õ ¡€“‹ Ã≈Õ‹ÿ≈ Œ“ÕŒÿ≈Õ»ﬂ Œ“ ÀŒÕ≈Õ»ﬂ   Õ”À»¬ŒÃ” œ–»¡À»∆≈Õ»ﬁ ›Õ≈–√»» œ–» ›“ŒÃ ¡€“‹ “¿ Œ¬€Ã, 
	        ! ◊“Œ¡€ ÃŒ∆ÕŒ ¡€ÀŒ —ƒ≈À¿“‹ “–» ÿ¿√¿
            IF(Niteration.NE.IntParXXZ) THEN 
	           Rkriter=DeltaEnegry(NMO,1)/(3.D0*ExfZero)
	           DO WHILE(Henergy.GT.Rkriter)
		          Henergy=Henergy*0.97D0   
               ENDDO
	        ENDIF

	        ! Õ¿’Œƒ»Ã ŒƒÕŒ›À≈ “–ŒÕÕ”ﬁ ›Õ≈–√»ﬁ —À≈¬¿  
	        !  Œ›‘‘»÷»≈Õ“ ÕŒ–Ã»–Œ¬ » ƒÀﬂ ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»  –»“≈–»… œŒÀ”◊≈Õ»ﬂ œ–¿¬»À‹ÕŒ… ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»  
            RnormMO=RnormMOXF(NMO) 
            DetM=0.D0
            ExfM=0.D0
            ExfM(2)=ExfZero*(1.D0-Henergy) 
	        Exf=ExfZero*(1.D0-Henergy)   
      
            ! œ¿–¿Ã≈“– ¬€’Œƒ¿ »« ÷» À¿ œŒ –¿—◊≈“” ›Õ≈–√»»
            IparametrDeterEnergy=1
            NEpsIter=0
            INEXDSEXF=0
	        IcorenZZ=0
            ! œ¿–¿Ã≈“– ” ¿«€¬¿ﬁŸ»… Õ¿  Œ–≈Õ‹  Œ“Œ–€… »Ÿ≈“—ﬂ —À≈¬¿
            IZNAK=1
            ! œ¿–¿Ã≈“– ” ¿«€¬¿ﬁŸ»… Õ¿ “Œ ◊“Œ »Õ“≈–¬¿À √ƒ≈ Õ¿’Œƒ»“—ﬂ  Œ–≈Õ‹ Œœ–≈ƒ≈À≈Õ
            IndexVilky=0
            INDEXDF=0
            IIKK=0
            IndexCorrect=0
			IndexExitRerern=0
            WRITE(17,*) 'Energy left',Niteration,NMO
            !WRITE(*,*) 'EEEX NOW LEVOE',Exf 
            !READ(*,*) 
            !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
            ! ÷» À Œœ–≈ƒ≈À≈Õ»≈ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»» ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» —À≈¬¿!
            !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
            DO WHILE(IparametrDeterEnergy.EQ.1)
               NEpsIter=NEpsIter+1
	           ! Œœ–≈ƒ≈Àﬂ≈Ã ÕŒÃ≈– “Œ◊ » —ÿ»¬ » –≈ÿ≈Õ»… OUT AND IN
	           call PointIntersection(Npoint,NumeroMin,Exf,Pz,RO1X,Kpoint)
	           !WRITE(*,*) 'Kpoint',Kpoint
	           !WRITE(*,*) '4 Exf',Exf

	           ! œŒƒœ–Œ√–¿ÃÃ¿ ‘Œ–Ã»–”≈“ Ã¿——»¬€ ƒÀﬂ –¿—◊≈“¬¿ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ »
	           call FormMassivAABB(Npoint,IndexM,Rcof,Exf,A,B,AA,BB,RO1X,E,AZ,FZ,BZ)
	 
               !WRITE(*,*) '5 Exf',Exf
               ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » ƒÀﬂ Õ≈ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€
               call CalculationParameterProgonky(2,IndexM,Kpoint,Npoint,AA,BB,FX,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,AZ,BZ,FZ,DZ,E,AX,BX)
               !WRITE(*,*) '6 Exf',Exf  
               !  Œ––≈ “»–”≈Ã «Õ¿◊≈Õ»≈ ›Õ≈–√»» Exf
               !write(*,*) 'eeee',Exf 
    	       call CorrectionEnergy(IZNAK,NEpsIter,Kpoint,Npoint,IndexM,NumeroMin,NumeroMax,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,DetM,ExfM,Exf,AZ,BZ,E,AX,BX,CX,IXM,FunMO,RO1X,H,Henergy,RnormMO,IparametrDeterEnergy,EPS,RdeltaZnak,IndexVilky,INDEXDF,IIKK,IndexCorrect,IcorenZZ,NMO,NumeroMaxLimid,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,RfunLigands,AlfaCoffMO,IndexExitRerern)  
               !write(*,*) '3 exf',Exf 
            ENDDO
      
	        ! ”—“¿Õ¿¬À»¬¿≈Ã Õ¿…ƒ≈Õ À» —À≈¬¿  Œ–≈Õ‹
	        IF(IcorenZZ.EQ.1) THEN
                 !  Œ–≈Õ‹ Õ≈…ƒ≈Õ
		         INlevo=1
		         ExfLevo=Exf
               ELSE
		         !  ŒÕ≈Õ‹ Õ≈ Õ¿…ƒ≈Õ
		         INlevo=0 
		         ExfLevo=0.D0
	        ENDIF 
         ENDIF
         
		
      ENDIF



      !WRITE(6,*) 'Energy One-Electron NE ODNORODNOE PRAVOE',Niteration,NMO,Exf,Kpoint
      !WRITE(*,*) 'EEEX NE ODNORODNOE PRAVOE',ExfSpravo
      !READ(*,*) 
              
	  ! œ–Œ¬≈–ﬂ≈Ã Õ¿À»◊»≈  Œ–Õ≈…
      IF(INlevo.EQ.0.AND.INspravo.EQ.0) THEN
         !  Œ–Õ» Œ“—”“—“¬”ﬁ“
		 WRITE(7,*) ' ERROR. Solution not  Niteration=',Niteration,' NMO=',NMO 
	     WRITE(17,*) ' ERROR. Solution ont  Niteration=',Niteration,' NMO=',NMO  
	     
		 WRITE(*,*) ' ERROR. Solution not  Niteration=',Niteration,' NMO=',NMO  
		 !WRITE(*,*) 'Writing spectrum all solutions? (yes=1/no=2/exit=3):' 
		 !READ(*,*) IKLSDCalcul
		 ! ‘» —»–”≈Ã  Àﬁ◊
		 IKLSDCalcul=2 
		  
		 IF(IKLSDCalcul.EQ.3) THEN
            ! Œ—“¿ÕŒ¬ ¿ œ–Œ√–¿ÃÃ€
			STOP 
		 ENDIF
		 ! œ–Œ¬≈–ﬂ≈Ã —ƒ≈À¿ÕÕ€… ¬€¡Œ–
         IF(IKLSDCalcul.EQ.1) THEN
		    WRITE(*,*) 'Writing Emin in Ry:'
			READ(*,*)  Emin  
		    ! œ–»¬Œƒ»Ã «¿¬»—»ÃŒ—“‹ »Õ“≈√–¿À¿ Œ–“Œ√ŒÕ¿À‹ÕŒ—“» 
			! ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» Œ“ «Õ¿◊≈Õ»… ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»» 
		    
			! œ¿–¿Ã≈“– ¬€’Œƒ¿ »« ÷» À¿ œŒ ›Õ≈–√»»
            IparametrDeterEnergy=1
            ! Õ¿◊¿À‹ÕŒ≈ œ–»¡À»∆≈Õ»≈ ƒÀﬂ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»
            Exf=ENN0  
			WRITE(18,*) 'Integral Ort(Energy)',Niteration,NMO
	        !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
            !÷» À Œœ–≈ƒ≈À≈Õ»≈ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»» ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»!
            !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
            DO WHILE(IparametrDeterEnergy.EQ.1)
               ! Œœ–≈ƒ≈Àﬂ≈Ã ÕŒÃ≈– “Œ◊ » —ÿ»¬ » –≈ÿ≈Õ»… OUT AND IN
	           call PointIntersection(Npoint,NumeroMin,Exf,Pz,RO1X,Kpoint)
	 		   ! œŒƒœ–Œ√–¿ÃÃ¿ ‘Œ–Ã»–”≈“ Ã¿——»¬€ ƒÀﬂ –¿—◊≈“¬¿ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ »
	           call FormMassivAABB(Npoint,IndexM,Rcof,Exf,A,B,AA,BB,RO1X,E,AZ,FZ,BZ)
	           ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » ƒÀﬂ Õ≈ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€
               call CalculationParameterProgonky(2,IndexM,Kpoint,Npoint,AA,BB,FX,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,AZ,BZ,FZ,DZ,E,AX,BX)
               ! œŒƒœ–Œ√–¿ÃÃ¿ «¿œ»—» «¿¬»—»ÃŒ—“» »Õ“≈√–¿À¿ Œ–“Œ√ŒÕ¿À‹ÕŒ—“» Œ“ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»
			   call SpectrumEnergy(Kpoint,Npoint,IndexM,NumeroMin,NumeroMax,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,Exf,Emin,AZ,BZ,E,AX,BX,CX,IXM,FunMO,RO1X,H,Henergy,RnormMO,IparametrDeterEnergy,NMO,NumeroMaxLimid,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,RfunLigands,AlfaCoffMO)  
			ENDDO 
    	 ENDIF

		 ! ‘» —»–”≈Ã Œ“—”“—“¬»≈  Œ–Õﬂ
		 IRETURN=1
		 ! »«Ã≈Õﬂ≈Ã ÕŒÃ≈– »Õ“≈–¿÷»»
		 ! “¿   ¿  œ≈–≈’Œƒ»Ã   —Œ√À¿—Œ¬¿Õ»ﬁ ¬ ƒ–”√ŒÃ –≈∆»Ã≈ ƒÀﬂ “Œ… ∆≈ »“≈–¿÷»» 
         Niteration=Niteration-1
         return
	  ENDIF


	  IF(Niteration.EQ.15.AND.NMO.EQ.106) THEN 
         !  Œ–Õ» Œ“—”“—“¬”ﬁ“
		 !WRITE(7,*) ' ERROR. Solution not  Niteration=',Niteration,' NMO=',NMO 
	     !WRITE(17,*) ' ERROR. Solution ont  Niteration=',Niteration,' NMO=',NMO  
	     
		 !WRITE(*,*) ' ERROR. Solution not  Niteration=',Niteration,' NMO=',NMO  
		 !WRITE(*,*) 'Writing spectrum all solutions? (yes=1/no=2/exit=3):' 
		 !READ(*,*) IKLSDCalcul
		 ! Õ¿◊¿À‹Õ€… ÿ¿√ œŒ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»
         Henergy=0.05D0
         ! Œœ–≈ƒ≈Àﬂ≈Ã ÿ¿√ ƒÀﬂ ƒ¿ÕÕŒ… ŒƒÕŒ›À≈ “–ŒÕÕŒ… ‘”Õ ÷»» 
         DO IICFHK=1,NNEL
            ! »«Ã≈Õ≈Õ»≈ ÿ¿√¿ 
	        Henergy=Henergy/FLOAT(IICFHK+1)  
         ENDDO
		 ! ‘» —»–”≈Ã  Àﬁ◊
		 IKLSDCalcul=1 
		  
		 IF(IKLSDCalcul.EQ.3) THEN
            ! Œ—“¿ÕŒ¬ ¿ œ–Œ√–¿ÃÃ€
			STOP 
		 ENDIF
		 ! œ–Œ¬≈–ﬂ≈Ã —ƒ≈À¿ÕÕ€… ¬€¡Œ–
         IF(IKLSDCalcul.EQ.1) THEN
		    Emin=0.01d0 
		    !WRITE(*,*) 'Writing Emin in Ry:'
			!READ(*,*)  Emin  
		    ! œ–»¬Œƒ»Ã «¿¬»—»ÃŒ—“‹ »Õ“≈√–¿À¿ Œ–“Œ√ŒÕ¿À‹ÕŒ—“» 
			! ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» Œ“ «Õ¿◊≈Õ»… ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»» 
		    
			! œ¿–¿Ã≈“– ¬€’Œƒ¿ »« ÷» À¿ œŒ ›Õ≈–√»»
            IparametrDeterEnergy=1
            ! Õ¿◊¿À‹ÕŒ≈ œ–»¡À»∆≈Õ»≈ ƒÀﬂ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»
            Exf=ENN0  
			WRITE(18,*) 'Integral Ort(Energy)',Niteration,NMO
	        !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
            !÷» À Œœ–≈ƒ≈À≈Õ»≈ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»» ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»!
            !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
            DO WHILE(IparametrDeterEnergy.EQ.1)
               ! Œœ–≈ƒ≈Àﬂ≈Ã ÕŒÃ≈– “Œ◊ » —ÿ»¬ » –≈ÿ≈Õ»… OUT AND IN
	           call PointIntersection(Npoint,NumeroMin,Exf,Pz,RO1X,Kpoint)
	 		   ! œŒƒœ–Œ√–¿ÃÃ¿ ‘Œ–Ã»–”≈“ Ã¿——»¬€ ƒÀﬂ –¿—◊≈“¬¿ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ »
	           call FormMassivAABB(Npoint,IndexM,Rcof,Exf,A,B,AA,BB,RO1X,E,AZ,FZ,BZ)
	           ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » ƒÀﬂ Õ≈ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€
               call CalculationParameterProgonky(2,IndexM,Kpoint,Npoint,AA,BB,FX,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,AZ,BZ,FZ,DZ,E,AX,BX)
               ! œŒƒœ–Œ√–¿ÃÃ¿ «¿œ»—» «¿¬»—»ÃŒ—“» »Õ“≈√–¿À¿ Œ–“Œ√ŒÕ¿À‹ÕŒ—“» Œ“ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»
			   call SpectrumEnergy(Kpoint,Npoint,IndexM,NumeroMin,NumeroMax,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,Exf,Emin,AZ,BZ,E,AX,BX,CX,IXM,FunMO,RO1X,H,Henergy,RnormMO,IparametrDeterEnergy,NMO,NumeroMaxLimid,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,RfunLigands,AlfaCoffMO)  
			ENDDO 
    	 ENDIF

		 !! ‘» —»–”≈Ã Œ“—”“—“¬»≈  Œ–Õﬂ
		 !IRETURN=1
		 !! »«Ã≈Õﬂ≈Ã ÕŒÃ≈– »Õ“≈–¿÷»»
		 !! “¿   ¿  œ≈–≈’Œƒ»Ã   —Œ√À¿—Œ¬¿Õ»ﬁ ¬ ƒ–”√ŒÃ –≈∆»Ã≈ ƒÀﬂ “Œ… ∆≈ »“≈–¿÷»» 
         !Niteration=Niteration-1
         !return
	  ENDIF

      ! «¿œ»—€¬¿≈Ã Œ“ ÀŒÕ≈Õ»≈ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»» œŒÀ”◊≈ÕÕŒ… –≈ÿ≈Õ»≈Ã ŒƒÕŒ–ŒƒÕŒ√Œ » Õ≈ŒƒÕŒ–ŒƒÕŒ√Œ ”–¿¬Õ≈Õ»ﬂ
      IF(INlevo.EQ.0) THEN
         ! À≈¬€…  Œ–≈Õ‹ Œ“—”“—“¬”≈“ 
         DeltaEnegry(NMO,1)=DABS(ExfSpravo-ExfZero)
	     DeltaEnegry(NMO,2)=DABS(ExfSpravo-ExfZero) 
      ENDIF
	  IF(INspravo.EQ.0) THEN
         ! œ–¿¬€…  Œ–≈Õ‹ Œ“—”“—“¬”≈“ 
         DeltaEnegry(NMO,1)=DABS(ExfLevo-ExfZero)
	     DeltaEnegry(NMO,2)=DABS(ExfLevo-ExfZero) 
      ENDIF
      IF(INlevo.NE.0.AND.INspravo.NE.0) THEN
         DeltaEnegry(NMO,1)=DABS(ExfLevo-ExfZero)
	     DeltaEnegry(NMO,2)=DABS(ExfSpravo-ExfZero)    
      ENDIF

	  !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
	  ! œ–Œ¬Œƒ» ¿Õ¿À»« œŒÀ”◊≈ÕÕ€’ ŒƒÕŒ›À≈ “–ŒÕÕ€’ ›Õ≈–√»… !!!!!!!!!!
	  !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
      IF(INlevo.EQ.0) THEN
         ! À≈¬€…  Œ–≈Õ‹ Œ“—”“—“¬”≈“ 
         Exf=ExfSpravo 
      ENDIF
	  IF(INspravo.EQ.0) THEN
         ! œ–¿¬€…  Œ–≈Õ‹ Œ“—”“—“¬”≈“ 
         Exf=ExfLevo
      ENDIF
	  IF(INlevo.NE.0.AND.INspravo.NE.0) THEN
         Exf=ExfSpravo 
      ENDIF
   ENDIF


   ! –¿—◊≈“ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»» «¿¬≈–ÿ≈Õ
   EXXX1=Exf
   !WRITE(6,*) 'Energy One-Electron NE ODNORODNOE PRAVOE',Niteration,NMO,Exf,Kpoint
   !WRITE(*,*) 'EEEX FINAL',Exf 
   !READ(*,*) 

     
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   ! ›“¿œ 3. Õ¿’Œƒ»Ã ÃŒÀ≈ ”Àﬂ–Õ”ﬁ Œ–¡»“¿À‹ ƒÀﬂ Õ¿…ƒ≈ÕŒ… ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»» ’¿–“–»-‘Œ ¿ (œ¿–÷»¿À‹Õ€≈ √¿–ÃŒÕ» »)! 
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   
   ! Œœ–≈ƒ≈Àﬂ≈Ã “»œ –¿—◊≈“¿
   IntParXXZ=2
   IF(Niteration.EQ.1) THEN  
        IF(IKLExchange.EQ.0) THEN
           IntParXXZ=1
        ENDIF
      ELSE
	    IF(IKLExchange.EQ.0) THEN
           IntParXXZ=1
        ENDIF 
   ENDIF 
     
   
   ! Œœ–≈ƒ≈Àﬂ≈Ã ÕŒÃ≈– “Œ◊ » —ÿ»¬ » –≈ÿ≈Õ»… OUT AND IN
   call PointIntersection(Npoint,NumeroMin,Exf,Pz,RO1X,Kpoint)
   !WRITE(6,*) 'Kpoint=',Kpoint,'IndexM=',IndexM

   ! œŒƒœ–Œ√–¿ÃÃ¿ ‘Œ–Ã»–”≈“ Ã¿——»¬€ ƒÀﬂ –¿—◊≈“¬¿ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ »
   call FormMassivAABB(Npoint,IndexM,Rcof,Exf,A,B,AA,BB,RO1X,E,AZ,FZ,BZ)
       
   ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ »
   call CalculationParameterProgonky(IntParXXZ,IndexM,Kpoint,Npoint,AA,BB,FX,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,AZ,BZ,FZ,DZ,E,AX,BX)
 
   ! Õ¿’Œƒ»Ã «Õ¿◊≈Õ»ﬂ √¿–ÃŒÕ»  ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» ¬ “Œ◊ ≈ —ÿ»¬ »
   IF(IntParXXZ.EQ.1) THEN   
       call CalculationValuesGarmonikMO(Kpoint,IndexM,NumeroMin,NumeroMax,Vout,Vin,FunMO,AZ,BZ,E,AX,BX)
      ELSE
       call CalculationValuesGarmonikMOFull(Kpoint,IndexM,NumeroMin,NumeroMax,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,FunMO,E,AX,BX,IXM) 
   ENDIF 
   
   ! Œ—”Ÿ≈—“¬Àﬂ≈Ã ¬Œ——“¿ÕŒ¬À≈Õ»≈ «Õ¿◊≈Õ»… ‘”Õ ÷»» ¬ ¬—≈’ “Œ◊ ¿’ Œ“ “Œ◊ » —ÿ»¬ » » ÕŒ–Ã»–”≈Ã œŒÀ”◊≈ÕÕ”ﬁ ‘”Õ ÷»ﬁ
   call FunctionRecovery(IntParXXZ,Kpoint,IndexM,Npoint,NumeroMin,NumeroMax,H,Vout,Uout,Vin,Uin,FunMO,AX,BX,BXL,CX,VNout,UNout,VNin,UNin,RO1X,NMO,NumeroMaxLimid,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,RfunLigands,AlfaCoffMO) 
   ! «¿œ»—€¬¿≈Ã ÕŒ–Ã»–Œ¬Œ◊Õ€…  Œ›‘‘»÷»≈Õ“ ( –»“≈–»… Œœ–≈ƒ≈À≈Õ»ﬂ œ–¿¬»À‹ÕŒ… ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»»)
   ! œ–Œ¬≈–ﬂ≈Ã “»œ ¬€’Œƒ¿
   IF(IndexExit.EQ.0) THEN
      IF(Niteration.EQ.1.AND.IntParXXZ.EQ.1) THEN
         !WRITE(6,*) 'WRITING NORM MO=',NMO
	     RnormMOXF(NMO)=FunMO(NumeroMin,2)
      ENDIF
      IF(Niteration.EQ.3.AND.IntParXXZ.EQ.1) THEN
         !WRITE(6,*) 'WRITING NORM MO=',NMO
	     RnormMOXF(NMO)=FunMO(NumeroMin,2)
      ENDIF
   ENDIF
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! 
   ! ›“¿œ 4. «¿œ»—‹ œŒÀ”◊≈ÕÕŒ… ‘”Õ ÷»» ƒ¿ÕÕŒ… »“≈–¿÷»» (œ–Œ÷≈ƒ”–¿ œ–Œ¬≈– » —Œ√À¿—Œ¬¿ÕÕŒ—“»)!!!!
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   
   IF(Niteration.EQ.1) THEN
        ! œ¿–¿Ã≈“– –¿——Œ√À¿—Œ¬¿ÕÕŒ—“»
		T=1.D0-RFunMO(NMO,NumeroMin,1)/Exf  
		TETA(NMO)=T
		TETMAX=TETMAX+DABS(T)
        ! «¿œ»—€¬¿≈Ã ŒƒÕŒ›À≈ “–ŒÕÕ€≈ ›Õ≈–√»» œŒÀ”◊≈ÕÕ€≈ ƒÀﬂ ƒ¿À‹Õ≈…ÿ≈√Œ ”◊≈“¿  
        E3(NMO)=RFunMO(NMO,NumeroMin,1)  
        E5(NMO)=Exf
		E4(NMO)=Exf

		! «¿œ»—€¬¿≈Ã ¬ Ã¿——»¬ «Õ¿◊≈Õ»≈ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»
		! ¿ “¿ ∆≈ ÕŒ–Ã»–Œ¬Œ◊Õ€…  Œ›‘‘»÷»≈Õ“
        DO IIX=1,NumeroMaxLimid  !NumeroMax
		   RFunMO(NMO,IIX,1)=Exf
		   RFunMO(NMO,IIX,2)=FunMO(NumeroMin,2)
           FunMOOld(NMO,IIX,1)=Exf
           FunMOOld(NMO,IIX,2)=FunMO(NumeroMin,2)
        ENDDO
		! «¿Õ”Àﬂ≈Ã œ–≈∆ƒ≈ √¿–ÃŒÕ» » Õ¿’ŒƒﬂŸ»≈—ﬂ Õ»∆≈ NumeroMin
		DO IIO=1,Npoint 
		   DO IIX=1,NumeroMin
              RFunMO(NMO,IIX,IIO+2)=0.D0
		   ENDDO
        ENDDO
       
        ! «¿œ»—€¬¿≈Ã œŒÀ”◊≈ÕÕ”ﬁ ÃŒÀ≈ ”Àﬂ–Õ”ﬁ Œ–¡»“¿À‹ 
		DO IIO=1,Npoint 
		   DO IIX=NumeroMin,NumeroMaxLimid   !NumeroMax
		      RFunMO(NMO,IIX,IIO+2)=FunMO(IIX,IIO+2)
			  FunMOOld(NMO,IIX,IIO+2)=FunMO(IIX,IIO+2)
		   ENDDO
        ENDDO

		! «¿œ»—€¬¿≈Ã ÃŒÀ≈ ”Àﬂ–Õ€≈ Œ–¡»“¿À» › ¬¿¬ŒÀ≈Õ“Õ€≈ ƒ¿ÕÕŒ…
        DO IIXXYYT=1,NumreISzam(NMO)
           ! œ¿–¿Ã≈“– –¿——Œ√À¿—Œ¬¿ÕÕŒ—“»
		   TETA(ISCalculZZ(NMO,IIXXYYT+1))=T
		   TETMAX=TETMAX+DABS(T)
           ! «¿œ»—€¬¿≈Ã ŒƒÕŒ›À≈ “–ŒÕÕ€≈ ›Õ≈–√»» œŒÀ”◊≈ÕÕ€≈ ƒÀﬂ ƒ¿À‹Õ≈…ÿ≈√Œ ”◊≈“¿  
           E3(ISCalculZZ(NMO,IIXXYYT+1))=RFunMO(ISCalculZZ(NMO,IIXXYYT+1),NumeroMin,1)  
           E4(ISCalculZZ(NMO,IIXXYYT+1))=Exf
           ! «¿œ»—€¬¿≈Ã ¬ Ã¿——»¬ «Õ¿◊≈Õ»≈ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»
		   ! ¿ “¿ ∆≈ ÕŒ–Ã»–Œ¬Œ◊Õ€…  Œ›‘‘»÷»≈Õ“
           DO IIX=1,NumeroMaxLimid  !NumeroMax
		      RFunMO(ISCalculZZ(NMO,IIXXYYT+1),IIX,1)=Exf
		      RFunMO(ISCalculZZ(NMO,IIXXYYT+1),IIX,2)=FunMO(NumeroMin,2)
			  FunMOOld(ISCalculZZ(NMO,IIXXYYT+1),IIX,1)=Exf
              FunMOOld(ISCalculZZ(NMO,IIXXYYT+1),IIX,2)=FunMO(NumeroMin,2)
           ENDDO
           ! «¿Õ”Àﬂ≈Ã œ–≈∆ƒ≈ √¿–ÃŒÕ» » Õ¿’ŒƒﬂŸ»≈—ﬂ Õ»∆≈ NumeroMin
		   DO IIO=1,Npoint 
		      DO IIX=1,NumeroMin
                 RFunMO(ISCalculZZ(NMO,IIXXYYT+1),IIX,IIO+2)=0.D0
		      ENDDO
           ENDDO
           ! «¿œ»—€¬¿≈Ã œŒÀ”◊≈ÕÕ”ﬁ ÃŒÀ≈ ”Àﬂ–Õ”ﬁ Œ–¡»“¿À‹ 
		   DO IIO=1,Npoint 
		      DO IIX=NumeroMin,NumeroMaxLimid  !NumeroMax
		         RFunMO(ISCalculZZ(NMO,IIXXYYT+1),IIX,IIO+2)=FunMO(IIX,IIO+2)
		         FunMOOld(ISCalculZZ(NMO,IIXXYYT+1),IIX,IIO+2)=FunMO(IIX,IIO+2) 
			  ENDDO
           ENDDO
        ENDDO

      ELSE

        ! œ¿–¿Ã≈“– –¿——Œ√À¿—Œ¬¿ÕÕŒ—“»
	    T=1.D0-RFunMO(NMO,NumeroMin,1)/Exf  
	
	    ! œ–Œ¬≈–ﬂ≈Ã —Ã≈ÿ»¬¿Õ»≈ Œ—“—”“—“¬”≈“ »À» Õ≈“
	    IF(NLST.EQ.0) THEN
	       T=0.D0
	    ENDIF 
       	! —“¿Õƒ¿–“Õ€… –≈∆»Ã —Œ√À¿—Œ¬¿Õ»ﬂ
        IF(IreshimSO.EQ.0) THEN
	       ! ”—“¿Õ¿¬À»¬¿≈Ã  Œ›‘‘»÷»≈Õ“ —Ã≈ÿ»¬¿Õ»ﬂ
	       IF((Niteration-2).LT.0) THEN
               C=0.D0
              ELSE
               IF((-1)**Niteration.LE.0) THEN
		          C=AnalysCoffMixing(Niteration,E5(NMO),E4(NMO),Exf)
		         ELSE
			      EZR=Exf-E4(NMO)-RFunMO(NMO,NumeroMin,1)+E3(NMO)
                  IF(DABS(EZR).LT.1.D-8) THEN
			         EZR=1.D0
                  ENDIF
                  C=(Exf-E4(NMO))/EZR
				  IF(C.LT.0.D0.OR.C.GT.1.D0) THEN 
			         C=AnalysCoffMixing(Niteration,E5(NMO),E4(NMO),Exf)
			      ENDIF
		       ENDIF     
           ENDIF
	    ENDIF

        ! –≈∆»Ã —Œ√À¿—Œ¬¿Õ»ﬂ — Œ√–¿Õ»◊≈Õ»≈Ã
        IF(IreshimSO.EQ.1) THEN
	       ! ”—“¿Õ¿¬À»¬¿≈Ã  Œ›‘‘»÷»≈Õ“ —Ã≈ÿ»¬¿Õ»ﬂ
	       IF((Niteration-2).LT.0) THEN
               C=0.D0
              ELSE
               IF((-1)**Niteration.LE.0) THEN
		          C=AnalysCoffMixing(Niteration,E5(NMO),E4(NMO),Exf)
		         ELSE
			      EZR=Exf-E4(NMO)-RFunMO(NMO,NumeroMin,1)+E3(NMO)
                  IF(DABS(EZR).LT.1.D-8) THEN
			         EZR=1.D0
                  ENDIF
                  C=(Exf-E4(NMO))/EZR
				  IF(C.LT.0.D0.OR.C.GT.1.D0) THEN 
			         C=AnalysCoffMixing(Niteration,E5(NMO),E4(NMO),Exf)
			      ENDIF
		       ENDIF 
			   IF(C.LT.0.7D0) THEN
			      C=0.7D0
			   ENDIF    
           ENDIF
	    ENDIF

		
		! ”—»À≈ÕÕ€… –≈∆»Ã —Œ√À¿—Œ¬¿Õ»ﬂ 
        IF(IreshimSO.EQ.2) THEN
	       ! ”—“¿Õ¿¬À»¬¿≈Ã  Œ›‘‘»÷»≈Õ“ —Ã≈ÿ»¬¿Õ»ﬂ
	       IF((Niteration-2).LT.0) THEN
               C=0.D0
              ELSE
               IF((-1)**Niteration.LE.0) THEN
		           C=0.9D0
		          ELSE
				   C=AnalysCoffMixingStrong(Niteration,E5(NMO),E4(NMO),Exf) 
		       ENDIF     
           ENDIF
        ENDIF

		! ”—»À≈ÕÕ€… –≈∆»Ã —Œ√À¿—Œ¬¿Õ»ﬂ 2
        IF(IreshimSO.EQ.3) THEN
	       ! ”—“¿Õ¿¬À»¬¿≈Ã  Œ›‘‘»÷»≈Õ“ —Ã≈ÿ»¬¿Õ»ﬂ
	       IF((Niteration-2).LT.0) THEN
               C=0.D0
              ELSE
               IF((-1)**Niteration.LE.0) THEN
		           C=0.97D0
		          ELSE
				   C=AnalysCoffMixingStrong2(Niteration,E5(NMO),E4(NMO),Exf) 
		       ENDIF     
           ENDIF
        ENDIF
        
		! ”—»À≈ÕÕ€… –≈∆»Ã —Œ√À¿—Œ¬¿Õ»ﬂ 3
		IF(IreshimSO.EQ.4) THEN
	       ! ”—“¿Õ¿¬À»¬¿≈Ã  Œ›‘‘»÷»≈Õ“ —Ã≈ÿ»¬¿Õ»ﬂ
	       IF((Niteration-2).LT.0) THEN
               C=0.D0
              ELSE
               IF((-1)**Niteration.LE.0) THEN
		           C=0.98D0
		          ELSE
				   C=AnalysCoffMixingStrong3(Niteration,E5(NMO),E4(NMO),Exf) 
		       ENDIF     
           ENDIF
        ENDIF
        
	    E3(NMO)=RFunMO(NMO,NumeroMin,1)  
		E5(NMO)=E4(NMO)
        E4(NMO)=Exf
        IF(NLST.EQ.0) THEN
	       ! —Ã≈ÿ»¬¿Õ»ﬂ Õ≈“ 
	       C=0.D0
	    ENDIF  

      
	    ! «¿œ»—‹ ŒƒÕŒ›À≈ “–ŒÕÕŒ√Œ «Õ¿◊≈Õ»ﬂ ›Õ≈–√»» "ÕŒ¬Œ…" ƒ¿ÕÕŒ… »“≈–¿÷»»
        ! «¿œ»—€¬¿≈Ã ¬ Ã¿——»¬ «Õ¿◊≈Õ»≈ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»
	    DO IIX=1,NumeroMaxLimid !NumeroMax
		   ! Á‡ÔËÒ˚‚‡ÂÏ ÔÂ‰˚‰Û˘Û˛ ËÚÂ‡ˆË˛
		   FunMOOld(NMO,IIX,1)=RFunMO(NMO,IIX,1)
		   ! Á‡ÔËÒ˚‚‡ÂÏ ÌÓÏÛ ÔÂ‰Â‰Û˘ÂÈ ËÚÂ‡ˆËË
           FunMOOld(NMO,IIX,2)=RFunMO(NMO,IIX,2)
		   ! Á‡ÔËÒ˚‚‡ÂÏ ‰‡ÌÌÛ˛ ËÚÂ‡ˆË˛
		   FunMONew(NMO,IIX,1)=Exf
		   RFunMO(NMO,IIX,1)=C*RFunMO(NMO,IIX,1)+(1.D0-C)*Exf
        ENDDO
        
	    ! «¿œ»—€¬¿≈Ã œŒÀ”◊≈ÕÕ”ﬁ ÃŒÀ≈ ”Àﬂ–Õ”ﬁ Œ–¡»“¿À‹
	    DO IIO=1,Npoint  
	       DO IIX=NumeroMin,NumeroMaxLimid   !NumeroMax
	          BBL=RFunMO(NMO,IIX,IIO+2)-FunMO(IIX,IIO+2)
              IF(Niteration.EQ.3.AND.IndexExit.EQ.0) THEN
                 BBL=RFunMO(NMO,IIX,IIO+2)*DSQRT(FunMO(IIX,2)/RFunMO(NMO,IIX,2))-FunMO(IIX,IIO+2)
			  ENDIF
	  	      IF(DABS(BBL).GT.DABS(T)) THEN
			     MAXCNV=IIO
              ENDIF
			  IF(DABS(BBL).GT.DABS(T)) THEN
			     T=BBL
              ENDIF 
              ! Á‡ÔËÒ˚‚‡ÂÏ ÔÂ‰˚‰Û˘Û˛ ËÚÂ‡ˆË˛
		      FunMOOld(NMO,IIX,IIO+2)=RFunMO(NMO,IIX,IIO+2)
		      ! Á‡ÔËÒ˚‚‡ÂÏ ‰‡ÌÌÛ˛ ËÚÂ‡ˆË˛
		      FunMONew(NMO,IIX,IIO+2)=FunMO(IIX,IIO+2)
			  IF(Niteration.EQ.3.AND.IndexExit.EQ.0) THEN
			       RFunMO(NMO,IIX,IIO+2)=C*RFunMO(NMO,IIX,IIO+2)*DSQRT(FunMO(IIX,2)/RFunMO(NMO,IIX,2))+(1.D0-C)*FunMO(IIX,IIO+2)
                 ELSE
				   RFunMO(NMO,IIX,IIO+2)=C*RFunMO(NMO,IIX,IIO+2)+(1.D0-C)*FunMO(IIX,IIO+2)  
		      ENDIF
		   ENDDO
        ENDDO

        ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ ÕŒ–Ã€ œŒÀ”◊≈ÕÕŒ… ‘”Õ ÷»»
        RRnormcoff=CalculationNormalizationConstaResult(NMO,NumeroMin,NumeroMaxLimid,Npoint,H,RO1X,RFunMO) 
        
	    ! «¿œ»—€¬¿≈Ã  ÕŒ–Ã»–Œ¬Œ◊Õ€…  Œ›‘‘»÷»≈Õ“
	    DO IIX=1,NumeroMaxLimid !NumeroMax
	       RFunMO(NMO,IIX,2)=RRnormcoff
        ENDDO
		
		! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ ÕŒ–Ã€ ƒÀﬂ ‘”Õ ÷»…
        RRnormcoff=CalculationNormalizationConstaResult(NMO,NumeroMin,NumeroMaxLimid,Npoint,H,RO1X,FunMONew) 
        
        ! «¿œ»—€¬¿≈Ã  ÕŒ–Ã»–Œ¬Œ◊Õ€…  Œ›‘‘»÷»≈Õ“
	    DO IIX=1,NumeroMaxLimid !NumeroMax
	       FunMONew(NMO,IIX,2)=RRnormcoff
        ENDDO
        


	    !WRITE(200,*) 'FUNN',Niteration,NMO,RFunMO(NMO,NumeroMin,1)
	    !DO IIO=1,Npoint
        !   WRITE(100*Niteration+NMO,35678) RR(IIO),(RFunMO(NMO,IIX,IIO+2)/DSQRT(RFunMO(NMO,IIX,2)*RO1X(IIO)),IIX=1,NumeroMax) !NumeroMin,NumeroMax)
        !ENDDO
        
	    TETA(NMO)=T
	    TETMAX=TETMAX+DABS(T)

		! «¿œ»—€¬¿≈Ã ÃŒÀ≈ ”Àﬂ–Õ€≈ Œ–¡»“¿À» › ¬¿¬ŒÀ≈Õ“Õ€≈ ƒ¿ÕÕŒ…
        DO IIXXYYT=1,NumreISzam(NMO)
           ! œ¿–¿Ã≈“– –¿——Œ√À¿—Œ¬¿ÕÕŒ—“»
		   TETA(ISCalculZZ(NMO,IIXXYYT+1))=T
		   TETMAX=TETMAX+DABS(T)
           ! «¿œ»—€¬¿≈Ã ŒƒÕŒ›À≈ “–ŒÕÕ€≈ ›Õ≈–√»» œŒÀ”◊≈ÕÕ€≈ ƒÀﬂ ƒ¿À‹Õ≈…ÿ≈√Œ ”◊≈“¿  
           E3(ISCalculZZ(NMO,IIXXYYT+1))=RFunMO(ISCalculZZ(NMO,IIXXYYT+1),NumeroMin,1)  
           E4(ISCalculZZ(NMO,IIXXYYT+1))=Exf
		   ! «¿œ»—‹ ŒƒÕŒ›À≈ “–ŒÕÕŒ√Œ «Õ¿◊≈Õ»ﬂ ›Õ≈–√»» "ÕŒ¬Œ…" ƒ¿ÕÕŒ… »“≈––¿÷»»
           ! «¿œ»—€¬¿≈Ã ¬ Ã¿——»¬ «Õ¿◊≈Õ»≈ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»
		   DO IIX=1,NumeroMaxLimid !NumeroMax
              ! Á‡ÔËÒ˚‚‡ÂÏ ÔÂ‰˚‰Û˘Û˛ ËÚÂ‡ˆË˛
		      FunMOOld(ISCalculZZ(NMO,IIXXYYT+1),IIX,1)=RFunMO(ISCalculZZ(NMO,IIXXYYT+1),IIX,1)
		      ! Á‡ÔËÒ˚‚‡ÂÏ ÌÓÏÛ ÔÂ‰Â‰Û˘ÂÈ ËÚÂ‡ˆËË
              FunMOOld(ISCalculZZ(NMO,IIXXYYT+1),IIX,2)=RFunMO(ISCalculZZ(NMO,IIXXYYT+1),IIX,2)
		      ! Á‡ÔËÒ˚‚‡ÂÏ ‰‡ÌÌÛ˛ ËÚÂ‡ˆË˛
		      FunMONew(ISCalculZZ(NMO,IIXXYYT+1),IIX,1)=Exf
			  RFunMO(ISCalculZZ(NMO,IIXXYYT+1),IIX,1)=C*RFunMO(ISCalculZZ(NMO,IIXXYYT+1),IIX,1)+(1.D0-C)*Exf
		   ENDDO
           ! «¿œ»—€¬¿≈Ã œŒÀ”◊≈ÕÕ”ﬁ ÃŒÀ≈ ”Àﬂ–Õ”ﬁ Œ–¡»“¿À‹ 
		   DO IIO=1,Npoint 
		      DO IIX=NumeroMin,NumeroMaxLimid !NumeroMax
			     ! Á‡ÔËÒ˚‚‡ÂÏ ÔÂ‰˚‰Û˘Û˛ ËÚÂ‡ˆË˛
		         FunMOOld(ISCalculZZ(NMO,IIXXYYT+1),IIX,IIO+2)=RFunMO(ISCalculZZ(NMO,IIXXYYT+1),IIX,IIO+2)  
		         ! Á‡ÔËÒ˚‚‡ÂÏ ‰‡ÌÌÛ˛ ËÚÂ‡ˆË˛
		         FunMONew(ISCalculZZ(NMO,IIXXYYT+1),IIX,IIO+2)=FunMO(IIX,IIO+2)
				 IF(Niteration.EQ.3.AND.IndexExit.EQ.0) THEN
				      RFunMO(ISCalculZZ(NMO,IIXXYYT+1),IIX,IIO+2)=C*RFunMO(ISCalculZZ(NMO,IIXXYYT+1),IIX,IIO+2)*DSQRT(FunMO(IIX,2)/RFunMO(ISCalculZZ(NMO,IIXXYYT+1),IIX,2))+(1.D0-C)*FunMO(IIX,IIO+2)
		            ELSE
					  RFunMO(ISCalculZZ(NMO,IIXXYYT+1),IIX,IIO+2)=C*RFunMO(ISCalculZZ(NMO,IIXXYYT+1),IIX,IIO+2)+(1.D0-C)*FunMO(IIX,IIO+2)  
                 ENDIF
			  ENDDO
           ENDDO
	       ! «¿œ»—€¬¿≈Ã  ÕŒ–Ã»–Œ¬Œ◊Õ€…  Œ›‘‘»÷»≈Õ“
		   DO IIX=1,NumeroMaxLimid !NumeroMax
              FunMONew(ISCalculZZ(NMO,IIXXYYT+1),IIX,2)=FunMONew(NMO,IIX,2)
		      RFunMO(ISCalculZZ(NMO,IIXXYYT+1),IIX,2)=RFunMO(NMO,IIX,2)
           ENDDO
        ENDDO
        
   ENDIF

   ! ¬€ƒ¿◊¿ œ–ŒÃ≈∆”“Œ◊Õ€’ –≈«”À‹“¿“Œ¬ —Œ√À¿—Œ¬¿Õ»ﬂ
   !WRITE(7,89787) Niteration,NMO,Exf,ExfLevo,ExfZero,ExfSpravo,C 
   ! Õ¿…ƒ≈ÕÕ¿ﬂ ŒƒÕŒ›À≈ “–ŒÕÕ¿ﬂ ›Õ≈–√»ﬂ 
   RparamterCalcul(1)=Exf
   !  Œ–Õ» ”–¿¬Õ≈Õ»ﬂ ŒƒÕŒ–ŒƒÕŒ… » Õ≈ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€
   RparamterCalcul(2)=ExfLevo
   RparamterCalcul(3)=ExfZero
   RparamterCalcul(4)=ExfSpravo
   !  Œ›‘‘»÷»≈Õ“ —Ã≈ÿ»¬¿Õ»ﬂ
   RparamterCalcul(5)=C 
   ! ‘» —»–”≈Ã Õ¿À»◊»≈  Œ–Õﬂ
   IRETURN=0
   
   !WRITE(*,*) 'PARAMETR'
   !WRITE(*,*) Niteration,C,TETA(NMO),TETMAX
   !READ(*,*)

   !WRITE(*,*) 'DD'
   !READ(*,*)
   !STOP


   ! ”ƒ¿Àﬂ≈Ã Ã¿——»¬€ »« œ¿Ãﬂ“» 
   deallocate(IndexGranyMin,stat=ierr)
   if(ierr/=0) then
      write(*,*) 'SolutionSystemDifferentialEquations'
      write(*,*) 'THE MASSIV "IndexGranyMin" IS NOT REMOVED FROM MEMORY'
      read(*,*)
	  stop 
   endif  
   deallocate(EEGranymin,stat=ierr)
   if(ierr/=0) then
      write(*,*) 'SolutionSystemDifferentialEquations'
      write(*,*) 'THE MASSIV "EEGranymin" IS NOT REMOVED FROM MEMORY'
      read(*,*)
	  stop 
   endif  
   deallocate(IndexMin,stat=ierr)
   if(ierr/=0) then
      write(*,*) 'SolutionSystemDifferentialEquations'
      write(*,*) 'THE MASSIV "IndexMin" IS NOT REMOVED FROM MEMORY'
      read(*,*)
	  stop 
   endif 
   deallocate(DDMmin,stat=ierr)
   if(ierr/=0) then
      write(*,*) 'SolutionSystemDifferentialEquations'
      write(*,*) 'THE MASSIV "DDMmin" IS NOT REMOVED FROM MEMORY'
      read(*,*)
	  stop 
   endif 
   deallocate(EEMmin,stat=ierr)
   if(ierr/=0) then
      write(*,*) 'SolutionSystemDifferentialEquations'
      write(*,*) 'THE MASSIV "EEMmin" IS NOT REMOVED FROM MEMORY'
      read(*,*)
	  stop 
   endif 
   deallocate(IXM,stat=ierr)
   if(ierr/=0) then
      write(*,*) 'SolutionSystemDifferentialEquations'
      write(*,*) 'THE MASSIV "IXM" IS NOT REMOVED FROM MEMORY'
      read(*,*)
	  stop 
   endif 
   deallocate(AX,stat=ierr)
   if(ierr/=0) then
      write(*,*) 'SolutionSystemDifferentialEquations'
      write(*,*) 'THE MASSIV "AX" IS NOT REMOVED FROM MEMORY'
      read(*,*)
	  stop 
   endif 
   deallocate(BX,stat=ierr)
   if(ierr/=0) then
      write(*,*) 'SolutionSystemDifferentialEquations'
      write(*,*) 'THE MASSIV "BX" IS NOT REMOVED FROM MEMORY'
      read(*,*)
	  stop 
   endif
   deallocate(BXL,stat=ierr)
   if(ierr/=0) then
      write(*,*) 'SolutionSystemDifferentialEquations'
      write(*,*) 'THE MASSIV "BXL" IS NOT REMOVED FROM MEMORY'
      read(*,*)
	  stop 
   endif  
   deallocate(CX,stat=ierr)
   if(ierr/=0) then
      write(*,*) 'SolutionSystemDifferentialEquations'
      write(*,*) 'THE MASSIV "CX" IS NOT REMOVED FROM MEMORY'
      read(*,*)
	  stop 
   endif 
   deallocate(DX,stat=ierr)
   if(ierr/=0) then
      write(*,*) 'SolutionSystemDifferentialEquations'
      write(*,*) 'THE MASSIV "DX" IS NOT REMOVED FROM MEMORY'
      read(*,*)
	  stop 
   endif 
   deallocate(UNout,stat=ierr)
   if(ierr/=0) then
      write(*,*) 'SolutionSystemDifferentialEquations'
      write(*,*) 'THE MASSIV "UNout" IS NOT REMOVED FROM MEMORY'
      read(*,*)
	  stop 
   endif 
   deallocate(UNin,stat=ierr)
   if(ierr/=0) then
      write(*,*) 'SolutionSystemDifferentialEquations'
      write(*,*) 'THE MASSIV "UNin" IS NOT REMOVED FROM MEMORY'
      read(*,*)
	  stop 
   endif 
   deallocate(E,stat=ierr)
   if(ierr/=0) then
      write(*,*) 'SolutionSystemDifferentialEquations'
      write(*,*) 'THE MASSIV "E" IS NOT REMOVED FROM MEMORY'
      read(*,*)
	  stop 
   endif 
   deallocate(AZ,stat=ierr)
   if(ierr/=0) then
      write(*,*) 'SolutionSystemDifferentialEquations'
      write(*,*) 'THE MASSIV "AZ" IS NOT REMOVED FROM MEMORY'
      read(*,*)
	  stop 
   endif 
   deallocate(BZ,stat=ierr)
   if(ierr/=0) then
      write(*,*) 'SolutionSystemDifferentialEquations'
      write(*,*) 'THE MASSIV "BZ" IS NOT REMOVED FROM MEMORY'
      read(*,*)
	  stop 
   endif 
   deallocate(FZ,stat=ierr)
   if(ierr/=0) then
      write(*,*) 'SolutionSystemDifferentialEquations'
      write(*,*) 'THE MASSIV "FZ" IS NOT REMOVED FROM MEMORY'
      read(*,*)
	  stop 
   endif
   deallocate(DZ,stat=ierr)
   if(ierr/=0) then
      write(*,*) 'SolutionSystemDifferentialEquations'
      write(*,*) 'THE MASSIV "DZ" IS NOT REMOVED FROM MEMORY'
      read(*,*)
	  stop 
   endif 
   deallocate(FX,stat=ierr)
   if(ierr/=0) then
      write(*,*) 'SolutionSystemDifferentialEquations'
      write(*,*) 'THE MASSIV "FX" IS NOT REMOVED FROM MEMORY'
      read(*,*)
	  stop 
   endif 
   deallocate(Uout,stat=ierr)
   if(ierr/=0) then
      write(*,*) 'SolutionSystemDifferentialEquations'
      write(*,*) 'THE MASSIV "Uout" IS NOT REMOVED FROM MEMORY'
      read(*,*)
	  stop 
   endif 
   deallocate(Uin,stat=ierr)
   if(ierr/=0) then
      write(*,*) 'SolutionSystemDifferentialEquations'
      write(*,*) 'THE MASSIV "Uin" IS NOT REMOVED FROM MEMORY'
      read(*,*)
	  stop 
   endif 
   deallocate(VNout,stat=ierr)
   if(ierr/=0) then
      write(*,*) 'SolutionSystemDifferentialEquations'
      write(*,*) 'THE MASSIV "VNout" IS NOT REMOVED FROM MEMORY'
      read(*,*)
	  stop 
   endif 
   deallocate(VNin,stat=ierr)
   if(ierr/=0) then
      write(*,*) 'SolutionSystemDifferentialEquations'
      write(*,*) 'THE MASSIV "VNin" IS NOT REMOVED FROM MEMORY'
      read(*,*)
	  stop 
   endif 
   deallocate(FunMO,stat=ierr)
   if(ierr/=0) then
      write(*,*) 'SolutionSystemDifferentialEquations'
      write(*,*) 'THE MASSIV "FunMO" IS NOT REMOVED FROM MEMORY'
      read(*,*)
	  stop 
   endif 
   deallocate(A,stat=ierr)
   if(ierr/=0) then
      write(*,*) 'SolutionSystemDifferentialEquations'
      write(*,*) 'THE MASSIV "A" IS NOT REMOVED FROM MEMORY'
      read(*,*)
	  stop 
   endif
   deallocate(B,stat=ierr)
   if(ierr/=0) then
      write(*,*) 'SolutionSystemDifferentialEquations'
      write(*,*) 'THE MASSIV "B" IS NOT REMOVED FROM MEMORY'
      read(*,*)
	  stop 
   endif 
   deallocate(AA,stat=ierr)
   if(ierr/=0) then
      write(*,*) 'SolutionSystemDifferentialEquations'
      write(*,*) 'THE MASSIV "AA" IS NOT REMOVED FROM MEMORY'
      read(*,*)
	  stop 
   endif 
   deallocate(BB,stat=ierr)
   if(ierr/=0) then
      write(*,*) 'SolutionSystemDifferentialEquations'
      write(*,*) 'THE MASSIV "BB" IS NOT REMOVED FROM MEMORY'
      read(*,*)
	  stop 
   endif
   deallocate(Vout,stat=ierr)
   if(ierr/=0) then
      write(*,*) 'SolutionSystemDifferentialEquations'
      write(*,*) 'THE MASSIV "Vout" IS NOT REMOVED FROM MEMORY'
      read(*,*)
	  stop 
   endif  
   deallocate(Vin,stat=ierr)
   if(ierr/=0) then
      write(*,*) 'SolutionSystemDifferentialEquations'
      write(*,*) 'THE MASSIV "Vin" IS NOT REMOVED FROM MEMORY'
      read(*,*)
	  stop 
   endif  

   return
 end subroutine SolutionSystemDifferentialEquations

 
 
!! SUBPROGRAMME OF THE CALCULATION OF THE NORM OF A FUNCTION OF THE RELEVANT DATA ON THE ENERGY
†!! NMO-NUMBER OF MOLECULAR ORBITALS
†!! Npoint-NUMBER OF POINTS
†!! Kpoint-NUMBER OF POINT OF SOLVING SOLUTIONS
†!! IndexM-SIZE OF MASSIVE
†!! NumeroMin-MINIMUM HARMONIC NUMBER
†!! NumeroMaxLimid-MAXIMUM NUMBER OF HARMONIC MOLECULAR ORBITALS
†!! Rcof-EQUITY RATIO H * H / 12
†!! H-STEP
†!! Pz (NumbreGarmMO (NMO), NumbreGarmMO (NMO), Npoint) - VALUE MAP of the P (ro) -particle of the log function P entering the equation Y '' = P * Y + Q-LOCAL POTENTIAL
†!! RO1X (Npoint) - MASSIVE VALUES OF THE FIRST DERIVATIVE ON THE NEW VARIABLE
†!! A (Isize, Isize, Npoint) -MASSIVE FOR CALCULATING FUNCTION PARAMETERS
†!! B (Isize, Isize, Npoint) -MASSIVE FOR CALCULATING FUNCTION PARAMETERS
†!! AA (IndexM, IndexM, Npoint) -MASSIVE A
†!! BB (IndexM, IndexM, Npoint) -MASSIVE B
†!! FX (IndexM, Npoint) -MASSIVE F
†!! Vout (IndexM, IndexM, Npoint) -MASSIVE OF FREQUENCY ON THE DIRECTION OF "OUTSIDE"
†!! Uout (IndexM, Npoint) -MASSIVE OF FREQUENCY ON THE DIRECTION OF "OUTSIDE"
†!! Vin (IndexM, IndexM, Npoint) -MASSIVE OF FIRING ON THE DIRECTION "INSIDE"
†!! Uin (IndexM, Npoint) -MASSIVE OF FIRING ON THE DIRECTION "INSIDE"
†!! VNout, UNout, VNin, UNIN, AZ, BZ, FZ, DZ, E, AX, BX, CX, IXM-AUXILIARY MASSIVE FOR CALCULATION
†!! FunMO-IN THIS CASE AUXILIARY MASSIVE
†!! NumbreLigand (NumbreMO) -MASSIVE NUMBER OF LIGANDES WHICH FUNCTIONS DESCRIBE HIGHER HARMONICS OF THIS MOLECULAR ORBITAL
†!! NLigands (NumbreMO, NumbreLigand (NumbreMO)) - MASSIVE OF LIGAND NUMBERS FUNCTIONS WHICH DESCRIBE HIGHER HARMONICS OF THIS MOLECULAR ORBITAL
†!! NFunLigands (NumbreMO, NumbreLigand (NumbreMO)) - A MASSIVE OF THE NUMBER OF FUNCTIONS OF EACH LIGAND DESCRIBING HIGHER HARMONICS OF THIS MOLECULAR ORBITAL
†!! NumbreFunctionLig (NumbreMO, NumbreLigand (NumbreMO), NFunLigands (NumbreMO, NumbreLigand (NumbreMO)))) - MASSIVE OF NUMBERS OF LIGAND FUNCTIONS THAT COMPLY WITH THIS MOLECULAR ORBITAL
†!! RfunLigands (Nnuclei, NumbreFunctionLig, NumbreGarmLigand, Npoint + 2) -MASSIVE OF VALUES OF LIGAND FUNCTIONS
†!! AlfaCoffMO (NumbreMO, NumbreLigand, NumbreFunLigand) -MASSIVE OF COEFFICIENTS WITH WHICH LIGANDA FUNCTIONS COME INTO THE STRUCTURE OF MOLECULAR ORBITAL
†!! Exf-SINGLE-ELECTRONIC ENERGY OF HARTRI-FOCA (MOLECULAR ORBITAL)
†!! RnormFunXF-NORMING CONSTANT OF THE HARTRI-FOCO FUNCTION MO
 subroutine CalculationNormFunctionEnergyXF(Exf,RnormFunXF,NMO,NumeroMaxLimid,Npoint,IndexM,Kpoint,NumeroMin,NumeroMax,Rcof,H,NumbreLigand,IXM,NLigands,NFunLigands,NumbreFunctionLig,RO1X,UNout,UNin,AX,BX,CX,FX,Uout,Uin,VNout,VNin,AZ,BZ,FZ,DZ,E,FunMO,Pz,A,B,AA,BB,Vout,Vin,AlfaCoffMO,RfunLigands)
   implicit none
   integer::NMO,NumeroMaxLimid,Npoint,IndexM,Kpoint,NumeroMin,NumeroMax
   real(8)::Exf,RnormFunXF,Rcof,H
   integer,dimension(:)::NumbreLigand
   integer,dimension(:,:)::IXM,NLigands,NFunLigands
   integer,dimension(:,:,:)::NumbreFunctionLig
   real(8),dimension(:)::RO1X,UNout,UNin,AX,BX,CX
   real(8),dimension(:,:)::FX,Uout,Uin,VNout,VNin,AZ,BZ,FZ,DZ,E,FunMO
   real(8),dimension(:,:,:)::Pz,A,B,AA,BB,Vout,Vin,AlfaCoffMO
   real(8),dimension(:,:,:,:)::RfunLigands
    
   ! Õ¿’Œƒ»Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ ƒÀﬂ «Õ¿◊≈Õ»ﬂ ›Õ≈–√»» E1X
   !  Œœ–≈ƒ≈Àﬂ≈Ã ÕŒÃ≈– “Œ◊ » —ÿ»¬ » –≈ÿ≈Õ»… OUT AND IN
   call PointIntersection(Npoint,NumeroMin,Exf,Pz,RO1X,Kpoint)
	       
   ! œŒƒœ–Œ√–¿ÃÃ¿ ‘Œ–Ã»–”≈“ Ã¿——»¬€ ƒÀﬂ –¿—◊≈“¬¿ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ »
   call FormMassivAABB(Npoint,IndexM,Rcof,Exf,A,B,AA,BB,RO1X,E,AZ,FZ,BZ)
	 
   ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » ƒÀﬂ Õ≈ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€
   call CalculationParameterProgonky(2,IndexM,Kpoint,Npoint,AA,BB,FX,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,AZ,BZ,FZ,DZ,E,AX,BX)
                 
   ! Œœ–≈ƒ≈Àﬂ≈Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ —ŒŒ“¬≈“—“¬”ﬁŸ≈≈ ƒ¿ÕÕŒÃ” «Õ¿◊≈Õ»ﬁ ›Õ≈–√»» RX0
   call CalculationNormFunE(RnormFunXF,Kpoint,Npoint,IndexM,NumeroMin,NumeroMax,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,AZ,BZ,E,AX,BX,CX,IXM,FunMO,RO1X,H,NMO,NumeroMaxLimid,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,RfunLigands,AlfaCoffMO)    
     
   return
 end subroutine CalculationNormFunctionEnergyXF 

 ! œŒƒœ–Œ√–¿ÃÃ¿  Œ––≈ “»–”ﬁŸ¿ﬂ ÿ¿√ 
 subroutine CorrectHRight(INDEXZZSFA,IndexIIUMN,Henergy,RcoffChengH,ProDet)
   implicit none
   integer::INDEXZZSFA,IndexIIUMN
   real(8)::Henergy,RcoffChengH
   real(8),dimension(:)::ProDet
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   real(8)::RcoffChengHOld

   !  Àﬁ◊ ” ¿«€¬¿ﬁŸ»… Õ≈Œ¡’Œƒ»ÃŒ—“‹ ¬Œ«¬–¿Ÿ≈Õ»ﬂ Õ¿ ŒƒÕ” “Œ◊ ” Õ¿«¿ƒ
   INDEXZZSFA=0 

       
   ! ¬Œ«¬–¿Ÿ¿≈Ã ¬ »—’ŒƒÕŒ≈ —Œ—“ŒﬂÕ»≈ ÿ¿√
   Henergy=Henergy*RcoffChengH*(10.D0)**IndexIIUMN 

  
     
   ! œ–Œ¬≈–ﬂ≈Ã ≈—“‹ »«Ã≈Õ≈Õ»≈ «Õ¿ ¿ œ–Œ»«¬ŒƒÕŒ… »À» Õ≈“ 
   IF(ProDet(7).LT.0.D0) THEN
        ! «Õ¿  œ–Œ»«¬ŒƒÕŒ… Õ≈ »«Ã≈Õ»À—ﬂ
      
	    ! –¿—◊»“€¬¿≈Ã ÕŒ¬€…  Œ›‘‘»÷»≈Õ“
        RcoffChengH=DABS(ProDet(7)/ProDet(6))   
     ELSE
	    ! «Õ¿  œ–Œ»«¬ŒƒÕŒ… »«Ã≈Õ»À—ﬂ 
		! ‘» —»–”≈Ã »«Ã≈Õ≈Õ»≈ «Õ¿ ¿ œ–Œ»«¬ŒƒÕŒ…
        INDEXZZSFA=1
		! ”¬≈À»◊»¬¿≈Ã »Õƒ≈ — ”Ã≈Õ‹ÿ≈Õ»ﬂ ÿ¿√¿
        IndexIIUMN=IndexIIUMN+1
		! –¿—◊»“€¬¿≈Ã ÕŒ¬€…  Œ›‘‘»÷»≈Õ“ (— ”◊≈“ŒÃ ¬Œ«¬–¿Ÿ≈Õ»ﬂ Õ¿ ƒ¬≈ “Œ◊ » Õ¿«¿ƒ)
        RcoffChengH=DABS(ProDet(5)/ProDet(4))  		 
   ENDIF

   ! œ–Œ¬≈–ﬂ≈Ã  –»“≈–»…
   IF(RcoffChengH.GT.2.1D0) THEN
       RcoffChengH=RcoffChengH*2.D0
   ENDIF 
   ! Œ√–¿Õ»◊≈Õ»≈ œŒ ¬≈À»◊»Õ≈ ”Ã≈Õ‹ÿ≈Õ»ﬂ ÿ¿√¿
   ! Õ≈“ –≈∆»Ã¿ ”Ã≈Õ‹ÿ≈Õ»ﬂ ÿ¿√¿ ¬ 10*IndexIIUMN –¿«
   IF(RcoffChengH.GT.200.D0.AND.IndexIIUMN.EQ.0) THEN
      RcoffChengH=200.D0
   ENDIF 
   ! ≈—“‹ –≈∆»Ã ”Ã≈Õ‹ÿ≈Õ»ﬂ ÿ¿√¿ ¬ 10*IndexIIUMN –¿« 
   IF(RcoffChengH.GT.400.D0.AND.IndexIIUMN.NE.0) THEN
      RcoffChengH=400.D0
   ENDIF 

   IF(RcoffChengH.LT.1.D0) THEN
      RcoffChengH=1.D0
   ENDIF

   ! »«Ã≈Õﬂ≈Ã ÿ¿√
   Henergy=Henergy/(RcoffChengH*(10.D0)**IndexIIUMN)  
   
  
   return
 end subroutine CorrectHRight


 ! œŒƒœ–Œ√–¿ÃÃ¿  Œ––≈ “»–”ﬁŸ¿ﬂ ÿ¿√ 
 subroutine CorrectHLeft(INDEXZZSFA,IndexIIUMN,Henergy,RcoffChengH,ProDet)
   implicit none
   integer::INDEXZZSFA,IndexIIUMN
   real(8)::Henergy,RcoffChengH
   real(8),dimension(:)::ProDet
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   real(8)::RcoffChengHOld

   !  Àﬁ◊ ” ¿«€¬¿ﬁŸ»… Õ≈Œ¡’Œƒ»ÃŒ—“‹ ¬Œ«¬–¿Ÿ≈Õ»ﬂ Õ¿ ŒƒÕ” “Œ◊ ” Õ¿«¿ƒ
   INDEXZZSFA=0 
   
   ! ¬Œ«¬–¿Ÿ¿≈Ã ¬ »—’ŒƒÕŒ≈ —Œ—“ŒﬂÕ»≈ ÿ¿√
   Henergy=Henergy*RcoffChengH*(10.D0)**IndexIIUMN 
     
   ! œ–Œ¬≈–ﬂ≈Ã ≈—“‹ »«Ã≈Õ≈Õ»≈ «Õ¿ ¿ œ–Œ»«¬ŒƒÕŒ… »À» Õ≈“ 
   IF(ProDet(7).GT.0.D0) THEN
        ! «Õ¿  œ–Œ»«¬ŒƒÕŒ… Õ≈ »«Ã≈Õ»À—ﬂ
	    ! –¿—◊»“€¬¿≈Ã ÕŒ¬€…  Œ›‘‘»÷»≈Õ“
        RcoffChengH=DABS(ProDet(7)/ProDet(6))   
     ELSE
	    ! «Õ¿  œ–Œ»«¬ŒƒÕŒ… »«Ã≈Õ»À—ﬂ 
		! ‘» —»–”≈Ã »«Ã≈Õ≈Õ»≈ «Õ¿ ¿ œ–Œ»«¬ŒƒÕŒ…
        INDEXZZSFA=1
		! ”¬≈À»◊»¬¿≈Ã »Õƒ≈ — ”Ã≈Õ‹ÿ≈Õ»ﬂ ÿ¿√¿
        IndexIIUMN=IndexIIUMN+1
		! –¿—◊»“€¬¿≈Ã ÕŒ¬€…  Œ›‘‘»÷»≈Õ“ (— ”◊≈“ŒÃ ¬Œ«¬–¿Ÿ≈Õ»ﬂ Õ¿ ƒ¬≈ “Œ◊ » Õ¿«¿ƒ)
        RcoffChengH=DABS(ProDet(5)/ProDet(4))  		 
   ENDIF

   ! œ–Œ¬≈–ﬂ≈Ã  –»“≈–»…
   IF(RcoffChengH.GT.2.1D0) THEN
       RcoffChengH=RcoffChengH*2.D0
   ENDIF 
   ! Œ√–¿Õ»◊≈Õ»≈ œŒ ¬≈À»◊»Õ≈ ”Ã≈Õ‹ÿ≈Õ»ﬂ ÿ¿√¿
   ! Õ≈“ –≈∆»Ã¿ ”Ã≈Õ‹ÿ≈Õ»ﬂ ÿ¿√¿ ¬ 10*IndexIIUMN –¿«
   IF(RcoffChengH.GT.200.D0.AND.IndexIIUMN.EQ.0) THEN
      RcoffChengH=200.D0
   ENDIF 
   ! ≈—“‹ –≈∆»Ã ”Ã≈Õ‹ÿ≈Õ»ﬂ ÿ¿√¿ ¬ 10*IndexIIUMN –¿« 
   IF(RcoffChengH.GT.400.D0.AND.IndexIIUMN.NE.0) THEN
      RcoffChengH=400.D0
   ENDIF 

   IF(RcoffChengH.LT.1.D0) THEN
      RcoffChengH=1.D0
   ENDIF

   ! »«Ã≈Õﬂ≈Ã ÿ¿√
   Henergy=Henergy/(RcoffChengH*(10.D0)**IndexIIUMN)  

   return
 end subroutine CorrectHLeft 


  ! œŒƒœ–Œ√–¿ÃÃ¿  Œ––≈ “»–”ﬁŸ¿ﬂ ÿ¿√ 
 subroutine CorrectHRightD(IndexSUMZKX,INDEXZZSFA,IndexIIUMN,Henergy,RcoffChengH,ProDet)
   implicit none
   integer::IndexSUMZKX,INDEXZZSFA,IndexIIUMN
   real(8)::Henergy,RcoffChengH
   real(8),dimension(:)::ProDet
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   real(8)::RcoffChengHOld

   !  Àﬁ◊ ” ¿«€¬¿ﬁŸ»… Õ≈Œ¡’Œƒ»ÃŒ—“‹ ¬Œ«¬–¿Ÿ≈Õ»ﬂ Õ¿ ŒƒÕ” “Œ◊ ” Õ¿«¿ƒ
   INDEXZZSFA=0 

       
   ! ¬Œ«¬–¿Ÿ¿≈Ã ¬ »—’ŒƒÕŒ≈ —Œ—“ŒﬂÕ»≈ ÿ¿√
   Henergy=Henergy*RcoffChengH*(10.D0)**IndexIIUMN 

  
     
   ! œ–Œ¬≈–ﬂ≈Ã ≈—“‹ »«Ã≈Õ≈Õ»≈ «Õ¿ ¿ œ–Œ»«¬ŒƒÕŒ… »À» Õ≈“ 
   IF(ProDet(7).LT.0.D0) THEN
        ! «Õ¿  œ–Œ»«¬ŒƒÕŒ… Õ≈ »«Ã≈Õ»À—ﬂ
	    ! –¿—◊»“€¬¿≈Ã ÕŒ¬€…  Œ›‘‘»÷»≈Õ“
        RcoffChengH=DABS(ProDet(7)/ProDet(6))   
     ELSE
	    ! «Õ¿  œ–Œ»«¬ŒƒÕŒ… »«Ã≈Õ»À—ﬂ 
		! ‘» —»–”≈Ã »«Ã≈Õ≈Õ»≈ «Õ¿ ¿ œ–Œ»«¬ŒƒÕŒ…
        INDEXZZSFA=1
		! ”¬≈À»◊»¬¿≈Ã »Õƒ≈ — ”Ã≈Õ‹ÿ≈Õ»ﬂ ÿ¿√¿
        IndexIIUMN=IndexIIUMN+1
		! œ–Œ¬≈–ﬂ≈Ã ÕŒÃ≈– »“≈–¿÷»» 
		IF(IndexSUMZKX.GT.2) THEN
		    ! –¿—◊»“€¬¿≈Ã ÕŒ¬€…  Œ›‘‘»÷»≈Õ“ (— ”◊≈“ŒÃ ¬Œ«¬–¿Ÿ≈Õ»ﬂ Õ¿ ƒ¬≈ “Œ◊ » Õ¿«¿ƒ)
            RcoffChengH=DABS(ProDet(5)/ProDet(4))  		 
           ELSE
            ! œŒ— ŒÀ‹ ” ◊»—ÀŒ »“≈–¿÷»… Õ≈ ƒŒ—“¿“Œ◊ÕŒ ƒÀﬂ –¿—◊≈“¿  Œ›‘‘»÷»≈Õ“¿ ‘» —»–”≈Ã 
			RcoffChengH=2.D0 
        ENDIF
   ENDIF

   ! œ–Œ¬≈–ﬂ≈Ã  –»“≈–»…
   IF(RcoffChengH.GT.2.1D0) THEN
       RcoffChengH=RcoffChengH*2.D0
   ENDIF 
   ! Œ√–¿Õ»◊≈Õ»≈ œŒ ¬≈À»◊»Õ≈ ”Ã≈Õ‹ÿ≈Õ»ﬂ ÿ¿√¿
   ! Õ≈“ –≈∆»Ã¿ ”Ã≈Õ‹ÿ≈Õ»ﬂ ÿ¿√¿ ¬ 10*IndexIIUMN –¿«
   IF(RcoffChengH.GT.200.D0.AND.IndexIIUMN.EQ.0) THEN
      RcoffChengH=200.D0
   ENDIF 
   ! ≈—“‹ –≈∆»Ã ”Ã≈Õ‹ÿ≈Õ»ﬂ ÿ¿√¿ ¬ 10*IndexIIUMN –¿« 
   IF(RcoffChengH.GT.400.D0.AND.IndexIIUMN.NE.0) THEN
      RcoffChengH=400.D0
   ENDIF 

   IF(RcoffChengH.LT.1.D0) THEN
      RcoffChengH=1.D0
   ENDIF

  
   ! »«Ã≈Õﬂ≈Ã ÿ¿√
   Henergy=Henergy/(RcoffChengH*(10.D0)**IndexIIUMN)  
   
 
   return
 end subroutine CorrectHRightD


 ! œŒƒœ–Œ√–¿ÃÃ¿  Œ––≈ “»–”ﬁŸ¿ﬂ ÿ¿√ 
 subroutine CorrectHLeftD(IndexSUMZKX,INDEXZZSFA,IndexIIUMN,Henergy,RcoffChengH,ProDet)
   implicit none
   integer::IndexSUMZKX,INDEXZZSFA,IndexIIUMN
   real(8)::Henergy,RcoffChengH
   real(8),dimension(:)::ProDet
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   real(8)::RcoffChengHOld

   !  Àﬁ◊ ” ¿«€¬¿ﬁŸ»… Õ≈Œ¡’Œƒ»ÃŒ—“‹ ¬Œ«¬–¿Ÿ≈Õ»ﬂ Õ¿ ŒƒÕ” “Œ◊ ” Õ¿«¿ƒ
   INDEXZZSFA=0 
   
   ! ¬Œ«¬–¿Ÿ¿≈Ã ¬ »—’ŒƒÕŒ≈ —Œ—“ŒﬂÕ»≈ ÿ¿√
   Henergy=Henergy*RcoffChengH*(10.D0)**IndexIIUMN 
     
   ! œ–Œ¬≈–ﬂ≈Ã ≈—“‹ »«Ã≈Õ≈Õ»≈ «Õ¿ ¿ œ–Œ»«¬ŒƒÕŒ… »À» Õ≈“ 
   IF(ProDet(7).GT.0.D0) THEN
        ! «Õ¿  œ–Œ»«¬ŒƒÕŒ… Õ≈ »«Ã≈Õ»À—ﬂ
	    ! –¿—◊»“€¬¿≈Ã ÕŒ¬€…  Œ›‘‘»÷»≈Õ“
        RcoffChengH=DABS(ProDet(7)/ProDet(6))   
     ELSE
	    ! «Õ¿  œ–Œ»«¬ŒƒÕŒ… »«Ã≈Õ»À—ﬂ 
		! ‘» —»–”≈Ã »«Ã≈Õ≈Õ»≈ «Õ¿ ¿ œ–Œ»«¬ŒƒÕŒ…
        INDEXZZSFA=1
		! ”¬≈À»◊»¬¿≈Ã »Õƒ≈ — ”Ã≈Õ‹ÿ≈Õ»ﬂ ÿ¿√¿
        IndexIIUMN=IndexIIUMN+1
		! œ–Œ¬≈–ﬂ≈Ã ÕŒÃ≈– »“≈–¿÷»» 
		IF(IndexSUMZKX.GT.2) THEN
		    ! –¿—◊»“€¬¿≈Ã ÕŒ¬€…  Œ›‘‘»÷»≈Õ“ (— ”◊≈“ŒÃ ¬Œ«¬–¿Ÿ≈Õ»ﬂ Õ¿ ƒ¬≈ “Œ◊ » Õ¿«¿ƒ)
            RcoffChengH=DABS(ProDet(5)/ProDet(4))  		 
           ELSE
            ! œŒ— ŒÀ‹ ” ◊»—ÀŒ »“≈–¿÷»… Õ≈ ƒŒ—“¿“Œ◊ÕŒ ƒÀﬂ –¿—◊≈“¿  Œ›‘‘»÷»≈Õ“¿ ‘» —»–”≈Ã 
			RcoffChengH=2.D0 
        ENDIF	 
   ENDIF

   ! œ–Œ¬≈–ﬂ≈Ã  –»“≈–»…
   IF(RcoffChengH.GT.2.1D0) THEN
       RcoffChengH=RcoffChengH*2.D0
   ENDIF 
   ! Œ√–¿Õ»◊≈Õ»≈ œŒ ¬≈À»◊»Õ≈ ”Ã≈Õ‹ÿ≈Õ»ﬂ ÿ¿√¿
   ! Õ≈“ –≈∆»Ã¿ ”Ã≈Õ‹ÿ≈Õ»ﬂ ÿ¿√¿ ¬ 10*IndexIIUMN –¿«
   IF(RcoffChengH.GT.200.D0.AND.IndexIIUMN.EQ.0) THEN
      RcoffChengH=200.D0
   ENDIF 
   ! ≈—“‹ –≈∆»Ã ”Ã≈Õ‹ÿ≈Õ»ﬂ ÿ¿√¿ ¬ 10*IndexIIUMN –¿« 
   IF(RcoffChengH.GT.400.D0.AND.IndexIIUMN.NE.0) THEN
      RcoffChengH=400.D0
   ENDIF 

   IF(RcoffChengH.LT.1.D0) THEN
      RcoffChengH=1.D0
   ENDIF
  
   ! »«Ã≈Õﬂ≈Ã ÿ¿√
   Henergy=Henergy/(RcoffChengH*(10.D0)**IndexIIUMN)  

 
   return
 end subroutine CorrectHLeftD 
 
 

 !! SUBPROGRAMME SEARCH FOR THE OWN ENERGY OF THE HOMOGENEOUS SYSTEM OF EQUATIONS BY "STANDARD" METHOD
†!! IndexExit-PARAMETER INDICATING EMERGENCY STOPPING OF THE PROGRAM
†!! IndexExit = 0-PROGRAM WORKS WITHOUT FAILURES
†!! IndexExit = 1-HAS FAILED THROUGH READING INFORMATION FROM EMERGENCY FILES
†!! Niteration-NUMBER OF INTERACTION
†!! NMO-NUMBER OF MOLECULAR ORBITALS
†!! NNEL- MAIN QUANTUM NUMBER
†!! Npoint-NUMBER OF POINTS
†!! NumeroMin-MINIMUM HARMONIC NUMBER
†!! Kpoint-NUMBER OF POINT OF SOLVING SOLUTIONS
†!! IndexM-SIZE OF MASSIVE
†!! Rcof-EQUITY RATIO H * H / 12
†!! EPS-ACCURACY
†!! Pz (NumbreGarmMO (NMO), NumbreGarmMO (NMO), Npoint) - VALUE MAP of the P (ro) -particle of the log function P entering the equation Y '' = P * Y + Q-LOCAL POTENTIAL
†!! RO1X (Npoint) - MASSIVE VALUES OF THE FIRST DERIVATIVE ON THE NEW VARIABLE
†!! A (Isize, Isize, Npoint) -MASSIVE FOR CALCULATING FUNCTION PARAMETERS
†!! B (Isize, Isize, Npoint) -MASSIVE FOR CALCULATING FUNCTION PARAMETERS
†!! AA (Isize, Isize, Npoint) -MASSIVE FOR CALCULATING THE PARAMETERS OF THE PROLONG WITH ADDED ESSENTIAL SINGLE-ELECTRONIC ENERGY
†!! BB (Isize, Isize, Npoint) -MASSIVE FOR CALCULATING THE PARAMETERS OF THE PROLONG WITH ADDED ESSENTIAL SINGLE-ELECTRONIC ENERGY
†!! FX (IndexM, Npoint) -MASSIVE F
†!! Vout (IndexM, IndexM, Npoint) -MASSIVE OF FREQUENCY ON THE DIRECTION OF "OUTSIDE"
†!! Uout (IndexM, Npoint) -MASSIVE OF FREQUENCY ON THE DIRECTION OF "OUTSIDE"
†!! Vin (IndexM, IndexM, Npoint) -MASSIVE OF FIRING ON THE DIRECTION "INSIDE"
†!! Uin (IndexM, Npoint) -MASSIVE OF FIRING ON THE DIRECTION "INSIDE"
†!! RO1X (Npoint) -MASSIVE FIRST DERIVATIVE NEW VARIABLE FOR THE OLD VARIABLE
†!! VNout, UNout, VNin, UNin, E, AZ, FZ, DZ, BZ, AX, BX-AUXILIARY MASSIVE
†!! ENN0-LOWER ENERGY BORDER
†!! ExfZero-SOLUTION OF THE HOMOGENEOUS SYSTEM OF EQUATIONS ONE-ELECTRONIC ENERGY
†!! NumbreRegion (NumbreMO) -MASSIVE NUMBER OF REGIONS IN WHICH A ROOT REDUCTION IS CARRIED OUT
†!! EnergyZeroZ (NumbreMO, NNEL + 1,2) -MASSIVE OF THE ROOTS OF A HOMOGENEOUS EQUATION
†!! EnergyRegion (NumbreMO, NNEL + 1,2) -MASSIVE OF AREAS IN WHICH STEP DECREASES
 subroutine SearchEnergySolutionHomogeneousSystemStandard(IndexExit,Niteration,NMO,NNEL,Npoint,NumeroMin,Kpoint,IndexM,Rcof,EPS,Pz,RO1X,A,B,AA,BB,E,AZ,FZ,BZ,FX,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,DZ,AX,BX,ENN0,ExfZero,NumbreRegion,EnergyZeroZ,EnergyRegion) 
   implicit none
   integer::IndexExit,Niteration,NMO,NNEL,Npoint,NumeroMin,Kpoint,IndexM
   real(8)::Rcof,EPS,ENN0,ExfZero
   integer,dimension(:)::NumbreRegion
   real(8),dimension(:)::RO1X,UNout,UNin,AX,BX
   real(8),dimension(:,:)::E,AZ,FZ,BZ,FX,Uout,Uin,VNout,VNin,DZ
   real(8),dimension(:,:,:)::Pz,A,B,AA,BB,Vout,Vin,EnergyZeroZ,EnergyRegion 
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   integer::IparametrDeterEnergy,NEpsIter,IndexVilky,INDEXDF,IIKK,IndexCorrect,IndexRegion,IndexSmena,IIFG,IKLKORX,IOPZ,IDFJK,IKLRXX,INDEXAD,INDEXRShag,IIHD,IIOXDPZ,INDEXPeresc
   real(8)::Henergy,Exf,Delta,RcoffInterval,RcoffChengH,DeltaEnerPers,DeltaFunPers
   real(8),dimension(10)::DetM,ExfM,ProDet 
    
   ! —“¿Õƒ¿–“Õ€… Ã≈“Œƒ –¿—◊≈“¿
   ! «¿Õ”Àﬂ≈Ã œ≈–≈ƒ –¿—◊≈“ŒÃ
   DetM=0.D0
   ExfM=0.D0
   ! Õ¿◊¿À‹ÕŒ≈ œ–»¡À»∆≈Õ»≈ ƒÀﬂ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»
   Exf=ENN0  
   ! Õ¿◊¿À‹Õ€… ÿ¿√ œŒ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»
   Henergy=0.1D0
   ! Õ¿ œ≈–¬€’ ƒ¬”’ »“≈–¿÷»ﬂ’ ”Ã≈Õ‹ÿ¿≈Ã ÿ¿√ ¬ 10 –¿«
   IF(IndexExit.EQ.0) THEN
      IF(Niteration.EQ.1) THEN
         Henergy=Henergy/10.D0
      ENDIF
      IF(Niteration.EQ.2) THEN
         Henergy=Henergy/10.D0
      ENDIF
	  ! ÕŒÃ≈– »“≈–¿÷»»
	  IDFJK=2
   ENDIF
   ! Õ¿ œ≈–¬€’ ƒ¬”’ »“≈–¿÷»ﬂ’ ”Ã≈Õ‹ÿ¿≈Ã ÿ¿√ ¬ 10 –¿«
   IF(IndexExit.EQ.1) THEN
      IF(Niteration.EQ.2) THEN
         Henergy=Henergy/10.D0
      ENDIF
      IF(Niteration.EQ.3) THEN
         Henergy=Henergy/10.D0
      ENDIF
	  ! ÕŒÃ≈– »“≈–¿÷»»
	  IDFJK=3
   ENDIF
   ! œ¿–¿Ã≈“– ¬€’Œƒ¿ »« ÷» À¿  
   IparametrDeterEnergy=1
   ! »Õƒ≈ — ÷» À¿ 
   NEpsIter=0
   ! œ¿–¿Ã≈“– ” ¿«€¬¿ﬁŸ»… Õ¿ “Œ ◊“Œ »Õ“≈–¬¿À √ƒ≈ Õ¿’Œƒ»“—ﬂ  Œ–≈Õ‹ Œœ–≈ƒ≈À≈Õ
   IndexVilky=0
   INDEXDF=0
   IIKK=0
   IndexCorrect=0
   IndexRegion=1
   IndexSmena=0
   IKLKORX=0
   IOPZ=0
   IKLRXX=0
   INDEXAD=0
   INDEXRShag=0
   IIHD=0
   IIOXDPZ=0
   INDEXPeresc=0
   DeltaEnerPers=0.D0
   DeltaFunPers=0.D0
   RcoffChengH=1.D0
   DO WHILE(IparametrDeterEnergy.EQ.1)
      NEpsIter=NEpsIter+1
	  ! Œœ–≈ƒ≈Àﬂ≈Ã ÕŒÃ≈– “Œ◊ » —ÿ»¬ » –≈ÿ≈Õ»… OUT AND IN
      call PointIntersection(Npoint,NumeroMin,Exf,Pz,RO1X,Kpoint)
      ! œŒƒœ–Œ√–¿ÃÃ¿ ‘Œ–Ã»–”≈“ Ã¿——»¬€ ƒÀﬂ –¿—◊≈“¿ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ »
      call FormMassivAABB(Npoint,IndexM,Rcof,Exf,A,B,AA,BB,RO1X,E,AZ,FZ,BZ)
      ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » ƒÀﬂ ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€
      call CalculationParameterProgonky(1,IndexM,Kpoint,Npoint,AA,BB,FX,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,AZ,BZ,FZ,DZ,E,AX,BX)
      ! »Ÿ≈Ã —ŒŒ“¬≈“—“¬”ﬁŸ»≈  Œ–Õ» Exf
      call SearchSolution(NMO,NNEL,NEpsIter,Kpoint,IndexM,Vout,Vin,DetM,ExfM,Exf,AZ,BZ,E,Henergy,IparametrDeterEnergy,EPS,IndexVilky,INDEXDF,IIKK,IndexCorrect,EnergyZeroZ,IKLKORX,IOPZ,IKLRXX,INDEXAD,RcoffChengH,ProDet,INDEXRShag,IIHD,IIOXDPZ,INDEXPeresc,DeltaEnerPers,DeltaFunPers)  
      ! Œ—”Ÿ≈—“¬Àﬂ≈Ã  ŒÕ“–ŒÀ‹ «¿ ÿ¿√¿Ã 
	  IF(Niteration.GT.IDFJK) THEN
	     call ControlH(NMO,IndexSmena,NumbreRegion(NMO),IndexRegion,EnergyRegion,Exf,Henergy)
      ENDIF 
   ENDDO

   ! «¿œ»—€¬¿≈Ã ◊»—ÀŒ  Œ–Õ≈… –¿——ÃŒ“–≈ÕÕ€’ ¬ ’Œƒ≈ œŒ»— ¿
   IF(IndexExit.EQ.0) THEN
      IF(Niteration.EQ.1) THEN
         NumbreRegion(NMO)=IndexCorrect
      ENDIF
   ENDIF
   IF(IndexExit.EQ.1) THEN
      IF(Niteration.EQ.2) THEN
         NumbreRegion(NMO)=IndexCorrect
      ENDIF
   ENDIF
   ! ‘Œ–Ã»–”≈Ã Œ¡À¿—“» √ƒ≈ ÿ¿√ ¡”ƒ≈“ ”Ã≈Õ‹ÿ»Õ
   IF(IndexExit.EQ.0) THEN
      IF(Niteration.GT.1) THEN
         ! ÷» À œŒ Õ¿…ƒ≈ÕÕ€Ã  Œ–ÕﬂÃ
	     DO IIFG=1,NumbreRegion(NMO)
            Delta=DABS(EnergyZeroZ(NMO,IIFG,2)-EnergyZeroZ(NMO,IIFG,1))
		    IF(Delta.LT.0.1D0) THEN
               Delta=0.1D0
		    ENDIF
            ! Œœ–≈ƒ≈Àﬂ≈Ã  Œ›‘‘»÷»≈Õ“  Œ“Œ–€… ‘Œ–Ã»–”≈“ »Õ“≈–¬¿À
            IF(Delta.LT.1.D0) THEN
               RcoffInterval=10.D0  
			ENDIF
            IF(Delta.GT.1.D0.AND.Delta.LT.5.D0) THEN
               RcoffInterval=5.D0 
			ENDIF
            IF(Delta.GT.10.D0.AND.Delta.LT.15.D0) THEN
               RcoffInterval=2.5D0 
			ENDIF
            IF(Delta.GT.15.D0) THEN
               RcoffInterval=1.D0 
			ENDIF

		    ! œ–¿¬¿ﬂ √–¿Õ»÷¿ 
		    EnergyRegion(NMO,IIFG,2)=EnergyZeroZ(NMO,IIFG,2)+RcoffInterval*Delta 
		    ! À≈¬¿ﬂ √–¿Õ»÷¿
			! œ–Œ¬≈–ﬂ≈Ã À≈¬”ﬁ √–¿Õ»÷” ŒÕ¿ Õ≈ ÃŒ∆≈“ «¿…“» ¬ Œ“–»÷¿“≈À‹Õ”ﬁ Œ¡À¿—“‹
			IF((EnergyZeroZ(NMO,IIFG,2)-RcoffInterval*Delta).LT.0.D0) THEN
			    EnergyRegion(NMO,IIFG,1)=0.D0 
			   ELSE    
		        EnergyRegion(NMO,IIFG,1)=EnergyZeroZ(NMO,IIFG,2)-RcoffInterval*Delta 
			ENDIF
			! œ–Œ¬≈–ﬂ≈Ã ◊“Œ¡€ Œ¡À¿—“»  Œ–Õ≈… Õ≈ œ≈–≈—» ¿À»—‹ Õ¿◊»Õ¿ﬂ — ¬“Œ–Œ√Œ  Œ–Õﬂ
			IF(IIFG.GT.1) THEN
			   ! œ–Œ¬≈–ﬂ≈Ã ◊“Œ¡€ œ–¿¬¿ﬂ √–¿Õ»÷¿ ƒ¿ÕÕŒ… Œ¡À¿—“» Õ≈ ¡€À¿ ¡ŒÀ‹ÿ≈ À≈¬Œ… √–¿Õ»÷€ œ–≈ƒ€ƒ”Ÿ≈… Œ¡À¿—“»
               IF(EnergyRegion(NMO,IIFG,2).GT.EnergyRegion(NMO,IIFG-1,1)) THEN
                  ! œ–»–¿¬Õ»¬¿≈Ã √–¿Õ»÷€ œ–¿¬¿ﬂ √–¿Õ»÷¿ ƒ¿ÕÕŒ… Œ¡À¿—“» ¡”ƒ≈“ —Œ¬œ¿ƒ¿“‹ — À≈¬Œ… √–¿Õ»÷Œ… œ–≈ƒ€ƒ”Ÿ≈… Œ¡À¿—“»
				  EnergyRegion(NMO,IIFG-1,1)=EnergyRegion(NMO,IIFG,2) 
			   ENDIF
			ENDIF
	     ENDDO
         !DO IIFG=1,NumbreRegion(NMO)
         !   Write(6,*) 'grani',NMO,EnergyRegion(NMO,IIFG,1),EnergyRegion(NMO,IIFG,2)
         !   Write(6,*) 'ZERO and Delta',NMO,EnergyZeroZ(NMO,IIFG,2),DABS(EnergyZeroZ(NMO,IIFG,2)-EnergyZeroZ(NMO,IIFG,1))
		 !ENDDO
	  ENDIF
   ENDIF
   IF(IndexExit.EQ.1) THEN
      IF(Niteration.GT.2) THEN
         ! ÷» À œŒ Õ¿…ƒ≈ÕÕ€Ã  Œ–ÕﬂÃ
	     DO IIFG=1,NumbreRegion(NMO)
            Delta=DABS(EnergyZeroZ(NMO,IIFG,2)-EnergyZeroZ(NMO,IIFG,1))
		    IF(Delta.LT.0.1D0) THEN
               Delta=0.1D0
		    ENDIF
			! Œœ–≈ƒ≈Àﬂ≈Ã  Œ›‘‘»÷»≈Õ“  Œ“Œ–€… ‘Œ–Ã»–”≈“ »Õ“≈–¬¿À
            IF(Delta.LT.1.D0) THEN
               RcoffInterval=10.D0  
			ENDIF
            IF(Delta.GT.1.D0.AND.Delta.LT.5.D0) THEN
               RcoffInterval=5.D0 
			ENDIF
            IF(Delta.GT.10.D0.AND.Delta.LT.15.D0) THEN
               RcoffInterval=2.5D0 
			ENDIF
            IF(Delta.GT.15.D0) THEN
               RcoffInterval=1.D0 
			ENDIF

		    ! œ–¿¬¿ﬂ √–¿Õ»÷¿ 
		    EnergyRegion(NMO,IIFG,2)=EnergyZeroZ(NMO,IIFG,2)+RcoffInterval*Delta 
		    ! À≈¬¿ﬂ √–¿Õ»÷¿
			! œ–Œ¬≈–ﬂ≈Ã À≈¬”ﬁ √–¿Õ»÷” ŒÕ¿ Õ≈ ÃŒ∆≈“ «¿…“» ¬ Œ“–»÷¿“≈À‹Õ”ﬁ Œ¡À¿—“‹
			IF((EnergyZeroZ(NMO,IIFG,2)-RcoffInterval*Delta).LT.0.D0) THEN
			    EnergyRegion(NMO,IIFG,1)=0.D0 
			   ELSE    
		        EnergyRegion(NMO,IIFG,1)=EnergyZeroZ(NMO,IIFG,2)-RcoffInterval*Delta 
			ENDIF 
			! œ–Œ¬≈–ﬂ≈Ã ◊“Œ¡€ Œ¡À¿—“»  Œ–Õ≈… Õ≈ œ≈–≈—» ¿À»—‹ Õ¿◊»Õ¿ﬂ — ¬“Œ–Œ√Œ  Œ–Õﬂ
			IF(IIFG.GT.1) THEN
			   ! œ–Œ¬≈–ﬂ≈Ã ◊“Œ¡€ œ–¿¬¿ﬂ √–¿Õ»÷¿ ƒ¿ÕÕŒ… Œ¡À¿—“» Õ≈ ¡€À¿ ¡ŒÀ‹ÿ≈ À≈¬Œ… √–¿Õ»÷€ œ–≈ƒ€ƒ”Ÿ≈… Œ¡À¿—“»
               IF(EnergyRegion(NMO,IIFG,2).GT.EnergyRegion(NMO,IIFG-1,1)) THEN
                  ! œ–»–¿¬Õ»¬¿≈Ã √–¿Õ»÷€ œ–¿¬¿ﬂ √–¿Õ»÷¿ ƒ¿ÕÕŒ… Œ¡À¿—“» ¡”ƒ≈“ —Œ¬œ¿ƒ¿“‹ — À≈¬Œ… √–¿Õ»÷Œ… œ–≈ƒ€ƒ”Ÿ≈… Œ¡À¿—“»
				  EnergyRegion(NMO,IIFG-1,1)=EnergyRegion(NMO,IIFG,2) 
			   ENDIF
			ENDIF
	     ENDDO
      ENDIF
   ENDIF

   ! –≈ÿ≈Õ»≈ ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€ ”–¿¬Õ≈Õ»… 
   ExfZero=Exf


   return
 end subroutine SearchEnergySolutionHomogeneousSystemStandard 


 !! SUBPROGRAMME SEARCH FOR THE OWN ENERGY OF THE HOMOGENEOUS SYSTEM OF EQUATIONS IN THE "ACCELERATED" METHOD
†!! IndexExit-PARAMETER INDICATING EMERGENCY STOPPING OF THE PROGRAM
†!! IndexExit = 0-PROGRAM WORKS WITHOUT FAILURES
†!! IndexExit = 1-HAS FAILED THROUGH READING INFORMATION FROM EMERGENCY FILES
†!! Niteration-NUMBER OF INTERACTION
†!! NMO-NUMBER OF MOLECULAR ORBITALS
†!! NNEL- MAIN QUANTUM NUMBER
†!! Npoint-NUMBER OF POINTS
†!! NumeroMin-MINIMUM HARMONIC NUMBER
†!! Kpoint-NUMBER OF POINT OF SOLVING SOLUTIONS
†!! IndexM-SIZE OF MASSIVE
†!! Rcof-EQUITY RATIO H * H / 12
†!! EPS-ACCURACY
†!! Pz (NumbreGarmMO (NMO), NumbreGarmMO (NMO), Npoint) - VALUE MAP of the P (ro) -particle of the log function P entering the equation Y '' = P * Y + Q-LOCAL POTENTIAL
†!! RO1X (Npoint) - MASSIVE VALUES OF THE FIRST DERIVATIVE ON THE NEW VARIABLE
†!! A (Isize, Isize, Npoint) -MASSIVE FOR CALCULATING FUNCTION PARAMETERS
†!! B (Isize, Isize, Npoint) -MASSIVE FOR CALCULATING FUNCTION PARAMETERS
†!! AA (Isize, Isize, Npoint) -MASSIVE FOR CALCULATING THE PARAMETERS OF THE PROLONG WITH ADDED ESSENTIAL SINGLE-ELECTRONIC ENERGY
†!! BB (Isize, Isize, Npoint) -MASSIVE FOR CALCULATING THE PARAMETERS OF THE PROLONG WITH ADDED ESSENTIAL SINGLE-ELECTRONIC ENERGY
†!! FX (IndexM, Npoint) -MASSIVE F
†!! Vout (IndexM, IndexM, Npoint) -MASSIVE OF FREQUENCY ON THE DIRECTION OF "OUTSIDE"
†!! Uout (IndexM, Npoint) -MASSIVE OF FREQUENCY ON THE DIRECTION OF "OUTSIDE"
†!! Vin (IndexM, IndexM, Npoint) -MASSIVE OF FIRING ON THE DIRECTION "INSIDE"
†!! Uin (IndexM, Npoint) -MASSIVE OF FIRING ON THE DIRECTION "INSIDE"
†!! RO1X (Npoint) -MASSIVE FIRST DERIVATIVE NEW VARIABLE FOR THE OLD VARIABLE
†!! VNout, UNout, VNin, UNin, E, AZ, FZ, DZ, BZ, AX, BX-AUXILIARY MASSIVE
†!! ENN0-LOWER ENERGY BORDER
†!! ExfSolutions (3) -SOLUTION OF A HOMOGENEOUS SYSTEM OF EQUATIONS SINGLE-ELECTRONIC ENERGY FOR NUMBER QUANTITY NUMERALS NNEL-1, NNEL, NNEL + 1
†!! NumbreRegion (NumbreMO) -MASSIVE NUMBER OF REGIONS IN WHICH A ROOT REDUCTION IS CARRIED OUT
†!! EnergyZeroZ (NumbreMO, NNEL + 1,2) -MASSIVE OF THE ROOTS OF A HOMOGENEOUS EQUATION
†!! EnergyRegion (NumbreMO, NNEL + 1,2) -MASSIVE OF AREAS IN WHICH STEP DECREASES
 subroutine SearchEnergySolutionHomogeneousSystemAccelerated(IndexExit,Niteration,NMO,NNEL,Npoint,NumeroMin,Kpoint,IndexM,Rcof,EPS,Pz,RO1X,A,B,AA,BB,E,AZ,FZ,BZ,FX,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,DZ,AX,BX,ENN0,ExfSolutions,IndexCorrectSET,IndexSolutionsSET,HenergySET,ExfSETT,ExfSET,DetSET,NumbreRegion,EnergyZeroZ,EnergyRegion) 
   implicit none
   integer::IndexExit,Niteration,NMO,NNEL,Npoint,NumeroMin,Kpoint,IndexM,IndexCorrectSET,IndexSolutionsSET
   real(8)::Rcof,EPS,ENN0,ExfZero,HenergySET,ExfSETT
   integer,dimension(:)::NumbreRegion 
   real(8),dimension(:)::RO1X,UNout,UNin,AX,BX,ExfSolutions,ExfSET,DetSET
   real(8),dimension(:,:)::E,AZ,FZ,BZ,FX,Uout,Uin,VNout,VNin,DZ
   real(8),dimension(:,:,:)::Pz,A,B,AA,BB,Vout,Vin,EnergyZeroZ,EnergyRegion 
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   integer::IparametrDeterEnergy,NEpsIter,IndexVilky,INDEXDF,IIKK,IndexCorrect,IndexRegion,IndexSmena,IndexSolutions,IKLKORX,IOPZ,IKLRXX,IDFJK,IIFG,INDEXAD,INDEXRShag,IIHD,IIOXDPZ,INDEXPeresc
   real(8)::Henergy,Exf,ExfTemp,Delta,RcoffInterval,RcoffChengH,DeltaEnerPers,DeltaFunPers
   real(8),dimension(10)::DetM,ExfM,DetMA,ExfMA,ProDet  
   
   
   ! ”— Œ–≈ÕÕ€… Ã≈“Œƒ –¿—◊≈“¿
   ! «¿Õ”Àﬂ≈Ã œ≈–≈ƒ –¿—◊≈“ŒÃ
   DetM=0.D0
   ExfM=0.D0
   DetMA=0.D0
   ExfMA=0.D0
   ExfSolutions=0.D0
   ! Õ¿◊¿À‹ÕŒ≈ œ–»¡À»∆≈Õ»≈ ƒÀﬂ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»
   Exf=ENN0  
   ! Õ¿◊¿À‹Õ€… ÿ¿√ œŒ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»
   Henergy=0.1D0
   ! Õ¿ œ≈–¬€’ ƒ¬”’ »“≈–¿÷»ﬂ’ ”Ã≈Õ‹ÿ¿≈Ã ÿ¿√ ¬ 10 –¿«
   IF(IndexExit.EQ.0) THEN
      IF(Niteration.EQ.2) THEN
         Henergy=Henergy/10.D0
      ENDIF
	  ! ÕŒÃ≈– »“≈–¿÷»»
	  IDFJK=2
   ENDIF
   ! Õ¿ œ≈–¬€’ ƒ¬”’ »“≈–¿÷»ﬂ’ ”Ã≈Õ‹ÿ¿≈Ã ÿ¿√ ¬ 10 –¿«
   IF(IndexExit.EQ.1) THEN
      IF(Niteration.EQ.2) THEN
         Henergy=Henergy/10.D0
      ENDIF
      IF(Niteration.EQ.3) THEN
         Henergy=Henergy/10.D0
      ENDIF
	  ! ÕŒÃ≈– »“≈–¿÷»»
	  IDFJK=3
   ENDIF

   ! œ¿–¿Ã≈“– ¬€’Œƒ¿ »« ÷» À¿  
   IparametrDeterEnergy=1
   ! »Õƒ≈ — ÷» À¿ 
   NEpsIter=0
   ! œ¿–¿Ã≈“– ” ¿«€¬¿ﬁŸ»… Õ¿ “Œ ◊“Œ »Õ“≈–¬¿À √ƒ≈ Õ¿’Œƒ»“—ﬂ  Œ–≈Õ‹ Œœ–≈ƒ≈À≈Õ
   IndexVilky=0
   INDEXDF=0
   IIKK=0
   IndexCorrect=0
   IndexRegion=1
   IndexSmena=0
   IndexSolutions=0
   IKLKORX=0
   IOPZ=0
   IKLRXX=0
   INDEXAD=0
   INDEXRShag=0
   IIHD=0
   IIOXDPZ=0
   INDEXPeresc=0
   DeltaEnerPers=0.D0
   DeltaFunPers=0.D0
   RcoffChengH=1.D0
   DO WHILE(IparametrDeterEnergy.EQ.1)
      NEpsIter=NEpsIter+1
      ! Œœ–≈ƒ≈Àﬂ≈Ã ÕŒÃ≈– “Œ◊ » —ÿ»¬ » –≈ÿ≈Õ»… OUT AND IN
      call PointIntersection(Npoint,NumeroMin,Exf,Pz,RO1X,Kpoint)
      ! œŒƒœ–Œ√–¿ÃÃ¿ ‘Œ–Ã»–”≈“ Ã¿——»¬€ ƒÀﬂ –¿—◊≈“¿ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ »
      call FormMassivAABB(Npoint,IndexM,Rcof,Exf,A,B,AA,BB,RO1X,E,AZ,FZ,BZ)
      ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » ƒÀﬂ ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€
      call CalculationParameterProgonky(1,IndexM,Kpoint,Npoint,AA,BB,FX,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,AZ,BZ,FZ,DZ,E,AX,BX)
      ! »Ÿ≈Ã —ŒŒ“¬≈“—“¬”ﬁŸ»≈  Œ–Õ» Exf
      call SearchSolutionAccelerated(NMO,NNEL,NEpsIter,Kpoint,IndexM,Vout,Vin,DetM,ExfM,DetMA,ExfMA,Exf,AZ,BZ,E,Henergy,IparametrDeterEnergy,EPS,IndexVilky,INDEXDF,IIKK,IndexCorrect,IndexSolutions,ExfSolutions,ExfTemp,IndexCorrectSET,IndexSolutionsSET,HenergySET,ExfSETT,ExfSET,DetSET,IKLKORX,IOPZ,IKLRXX,EnergyZeroZ,INDEXAD,RcoffChengH,ProDet,INDEXRShag,IIHD,IIOXDPZ,INDEXPeresc,DeltaEnerPers,DeltaFunPers)  
      ! Œ—”Ÿ≈—“¬Àﬂ≈Ã  ŒÕ“–ŒÀ‹ «¿ ÿ¿√¿Ã 
	  IF(Niteration.GT.IDFJK) THEN
	     call ControlH(NMO,IndexSmena,NumbreRegion(NMO),IndexRegion,EnergyRegion,Exf,Henergy)
      ENDIF 
   ENDDO

   ! «¿œ»—€¬¿≈Ã ◊»—ÀŒ  Œ–Õ≈… –¿——ÃŒ“–≈ÕÕ€’ ¬ ’Œƒ≈ œŒ»— ¿
   IF(IndexExit.EQ.1) THEN
      IF(Niteration.EQ.2) THEN
         NumbreRegion(NMO)=IndexCorrect
      ENDIF
   ENDIF

   ! ‘Œ–Ã»–”≈Ã Œ¡À¿—“» √ƒ≈ ÿ¿√ ¡”ƒ≈“ ”Ã≈Õ‹ÿ»Õ
   IF(IndexExit.EQ.0) THEN
      IF(Niteration.GT.1) THEN
         ! ÷» À œŒ Õ¿…ƒ≈ÕÕ€Ã  Œ–ÕﬂÃ
	     DO IIFG=1,NumbreRegion(NMO)
            Delta=DABS(EnergyZeroZ(NMO,IIFG,2)-EnergyZeroZ(NMO,IIFG,1))
		    IF(Delta.LT.0.1D0) THEN
               Delta=0.1D0
		    ENDIF
			! Œœ–≈ƒ≈Àﬂ≈Ã  Œ›‘‘»÷»≈Õ“  Œ“Œ–€… ‘Œ–Ã»–”≈“ »Õ“≈–¬¿À
            IF(Delta.LT.1.D0) THEN
               RcoffInterval=10.D0  
			ENDIF
            IF(Delta.GT.1.D0.AND.Delta.LT.5.D0) THEN
               RcoffInterval=5.D0 
			ENDIF
            IF(Delta.GT.10.D0.AND.Delta.LT.15.D0) THEN
               RcoffInterval=2.5D0 
			ENDIF
            IF(Delta.GT.15.D0) THEN
               RcoffInterval=1.D0 
			ENDIF

		    ! œ–¿¬¿ﬂ √–¿Õ»÷¿ 
		    EnergyRegion(NMO,IIFG,2)=EnergyZeroZ(NMO,IIFG,2)+RcoffInterval*Delta 
		    ! À≈¬¿ﬂ √–¿Õ»÷¿
			! œ–Œ¬≈–ﬂ≈Ã À≈¬”ﬁ √–¿Õ»÷” ŒÕ¿ Õ≈ ÃŒ∆≈“ «¿…“» ¬ Œ“–»÷¿“≈À‹Õ”ﬁ Œ¡À¿—“‹
			IF((EnergyZeroZ(NMO,IIFG,2)-RcoffInterval*Delta).LT.0.D0) THEN
			    EnergyRegion(NMO,IIFG,1)=0.D0 
			   ELSE    
		        EnergyRegion(NMO,IIFG,1)=EnergyZeroZ(NMO,IIFG,2)-RcoffInterval*Delta 
			ENDIF
			! œ–Œ¬≈–ﬂ≈Ã ◊“Œ¡€ Œ¡À¿—“»  Œ–Õ≈… Õ≈ œ≈–≈—» ¿À»—‹ Õ¿◊»Õ¿ﬂ — ¬“Œ–Œ√Œ  Œ–Õﬂ
			IF(IIFG.GT.1) THEN
			   ! œ–Œ¬≈–ﬂ≈Ã ◊“Œ¡€ œ–¿¬¿ﬂ √–¿Õ»÷¿ ƒ¿ÕÕŒ… Œ¡À¿—“» Õ≈ ¡€À¿ ¡ŒÀ‹ÿ≈ À≈¬Œ… √–¿Õ»÷€ œ–≈ƒ€ƒ”Ÿ≈… Œ¡À¿—“»
               IF(EnergyRegion(NMO,IIFG,2).GT.EnergyRegion(NMO,IIFG-1,1)) THEN
                  ! œ–»–¿¬Õ»¬¿≈Ã √–¿Õ»÷€ œ–¿¬¿ﬂ √–¿Õ»÷¿ ƒ¿ÕÕŒ… Œ¡À¿—“» ¡”ƒ≈“ —Œ¬œ¿ƒ¿“‹ — À≈¬Œ… √–¿Õ»÷Œ… œ–≈ƒ€ƒ”Ÿ≈… Œ¡À¿—“»
				  EnergyRegion(NMO,IIFG-1,1)=EnergyRegion(NMO,IIFG,2) 
			   ENDIF
			ENDIF
	     ENDDO
         !DO IIFG=1,NumbreRegion(NMO)
         !   Write(6,*) 'grani',NMO,EnergyRegion(NMO,IIFG,1),EnergyRegion(NMO,IIFG,2)
		 !   Write(6,*) 'ZERO and Delta',NMO,EnergyZeroZ(NMO,IIFG,2),DABS(EnergyZeroZ(NMO,IIFG,2)-EnergyZeroZ(NMO,IIFG,1))
		 !ENDDO
	  ENDIF
   ENDIF
   IF(IndexExit.EQ.1) THEN
      IF(Niteration.GT.2) THEN
         ! ÷» À œŒ Õ¿…ƒ≈ÕÕ€Ã  Œ–ÕﬂÃ
	     DO IIFG=1,NumbreRegion(NMO)
            Delta=DABS(EnergyZeroZ(NMO,IIFG,2)-EnergyZeroZ(NMO,IIFG,1))
		    IF(Delta.LT.0.1D0) THEN
               Delta=0.1D0
		    ENDIF
			! Œœ–≈ƒ≈Àﬂ≈Ã  Œ›‘‘»÷»≈Õ“  Œ“Œ–€… ‘Œ–Ã»–”≈“ »Õ“≈–¬¿À
            IF(Delta.LT.1.D0) THEN
               RcoffInterval=10.D0  
			ENDIF
            IF(Delta.GT.1.D0.AND.Delta.LT.5.D0) THEN
               RcoffInterval=5.D0 
			ENDIF
            IF(Delta.GT.10.D0.AND.Delta.LT.15.D0) THEN
               RcoffInterval=2.5D0 
			ENDIF
            IF(Delta.GT.15.D0) THEN
               RcoffInterval=1.D0 
			ENDIF
		    ! œ–¿¬¿ﬂ √–¿Õ»÷¿ 
		    EnergyRegion(NMO,IIFG,2)=EnergyZeroZ(NMO,IIFG,2)+RcoffInterval*Delta 
		    ! À≈¬¿ﬂ √–¿Õ»÷¿
			! œ–Œ¬≈–ﬂ≈Ã À≈¬”ﬁ √–¿Õ»÷” ŒÕ¿ Õ≈ ÃŒ∆≈“ «¿…“» ¬ Œ“–»÷¿“≈À‹Õ”ﬁ Œ¡À¿—“‹
			IF((EnergyZeroZ(NMO,IIFG,2)-RcoffInterval*Delta).LT.0.D0) THEN
			    EnergyRegion(NMO,IIFG,1)=0.D0 
			   ELSE    
		        EnergyRegion(NMO,IIFG,1)=EnergyZeroZ(NMO,IIFG,2)-RcoffInterval*Delta 
			ENDIF 
			! œ–Œ¬≈–ﬂ≈Ã ◊“Œ¡€ Œ¡À¿—“»  Œ–Õ≈… Õ≈ œ≈–≈—» ¿À»—‹ Õ¿◊»Õ¿ﬂ — ¬“Œ–Œ√Œ  Œ–Õﬂ
			IF(IIFG.GT.1) THEN
			   ! œ–Œ¬≈–ﬂ≈Ã ◊“Œ¡€ œ–¿¬¿ﬂ √–¿Õ»÷¿ ƒ¿ÕÕŒ… Œ¡À¿—“» Õ≈ ¡€À¿ ¡ŒÀ‹ÿ≈ À≈¬Œ… √–¿Õ»÷€ œ–≈ƒ€ƒ”Ÿ≈… Œ¡À¿—“»
               IF(EnergyRegion(NMO,IIFG,2).GT.EnergyRegion(NMO,IIFG-1,1)) THEN
                  ! œ–»–¿¬Õ»¬¿≈Ã √–¿Õ»÷€ œ–¿¬¿ﬂ √–¿Õ»÷¿ ƒ¿ÕÕŒ… Œ¡À¿—“» ¡”ƒ≈“ —Œ¬œ¿ƒ¿“‹ — À≈¬Œ… √–¿Õ»÷Œ… œ–≈ƒ€ƒ”Ÿ≈… Œ¡À¿—“»
				  EnergyRegion(NMO,IIFG-1,1)=EnergyRegion(NMO,IIFG,2) 
			   ENDIF
			ENDIF
	     ENDDO
      ENDIF
   ENDIF


          

   return
 end subroutine SearchEnergySolutionHomogeneousSystemAccelerated


 !! SUBPROGRAMME SEARCH FOR THE OWN ENERGY OF THE HOMOGENEOUS SYSTEM OF EQUATIONS IN THE "ACCELERATED" METHOD
†!! IndexExit-PARAMETER INDICATING EMERGENCY STOPPING OF THE PROGRAM
†!! IndexExit = 0-PROGRAM WORKS WITHOUT FAILURES
†!! IndexExit = 1-HAS FAILED THROUGH READING INFORMATION FROM EMERGENCY FILES
†!! Niteration-NUMBER OF INTERACTION
†!! NMO-NUMBER OF MOLECULAR ORBITALS
†!! NNEL- MAIN QUANTUM NUMBER
†!! Npoint-NUMBER OF POINTS
†!! NumeroMin-MINIMUM HARMONIC NUMBER
†!! Kpoint-NUMBER OF POINT OF SOLVING SOLUTIONS
†!! IndexM-SIZE OF MASSIVE
†!! Rcof-EQUITY RATIO H * H / 12
†!! EPS-ACCURACY
†!! Pz (NumbreGarmMO (NMO), NumbreGarmMO (NMO), Npoint) - VALUE MAP of the P (ro) -particle of the log function P entering the equation Y '' = P * Y + Q-LOCAL POTENTIAL
†!! RO1X (Npoint) - MASSIVE VALUES OF THE FIRST DERIVATIVE ON THE NEW VARIABLE
†!! A (Isize, Isize, Npoint) -MASSIVE FOR CALCULATING FUNCTION PARAMETERS
†!! B (Isize, Isize, Npoint) -MASSIVE FOR CALCULATING FUNCTION PARAMETERS
†!! AA (Isize, Isize, Npoint) -MASSIVE FOR CALCULATING THE PARAMETERS OF THE PROLONG WITH ADDED ESSENTIAL SINGLE-ELECTRONIC ENERGY
†!! BB (Isize, Isize, Npoint) -MASSIVE FOR CALCULATING THE PARAMETERS OF THE PROLONG WITH ADDED ESSENTIAL SINGLE-ELECTRONIC ENERGY
†!! FX (IndexM, Npoint) -MASSIVE F
†!! Vout (IndexM, IndexM, Npoint) -MASSIVE OF FREQUENCY ON THE DIRECTION OF "OUTSIDE"
†!! Uout (IndexM, Npoint) -MASSIVE OF FREQUENCY ON THE DIRECTION OF "OUTSIDE"
†!! Vin (IndexM, IndexM, Npoint) -MASSIVE OF FIRING ON THE DIRECTION "INSIDE"
†!! Uin (IndexM, Npoint) -MASSIVE OF FIRING ON THE DIRECTION "INSIDE"
†!! RO1X (Npoint) -MASSIVE FIRST DERIVATIVE NEW VARIABLE FOR THE OLD VARIABLE
†!! VNout, UNout, VNin, UNin, E, AZ, FZ, DZ, BZ, AX, BX-AUXILIARY MASSIVE
†!! ENN0-LOWER ENERGY BORDER
†!! ExfSolutions (3) -SOLUTION OF A HOMOGENEOUS SYSTEM OF EQUATIONS SINGLE-ELECTRONIC ENERGY FOR NUMBER QUANTITY NUMERALS NNEL-1, NNEL, NNEL + 1
†!! NumbreRegion (NumbreMO) -MASSIVE NUMBER OF REGIONS IN WHICH A ROOT REDUCTION IS CARRIED OUT
†!! EnergyZeroZ (NumbreMO, NNEL + 1,2) -MASSIVE OF THE ROOTS OF A HOMOGENEOUS EQUATION
†!! EnergyRegion (NumbreMO, NNEL + 1,2) -MASSIVE OF AREAS IN WHICH STEP DECREASES
 subroutine SearchEnergySolutionHomogeneousSystemAccelerated2(IndexExit,Niteration,NMO,NNEL,Npoint,NumeroMin,Kpoint,IndexM,Rcof,EPS,Pz,RO1X,A,B,AA,BB,E,AZ,FZ,BZ,FX,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,DZ,AX,BX,ENN0,ExfSolutions,IndexCorrectSET,IndexSolutionsSET,HenergySET,ExfSETT,ExfSET,DetSET,NumbreRegion,EnergyZeroZ,EnergyRegion) 
   implicit none
   integer::IndexExit,Niteration,NMO,NNEL,Npoint,NumeroMin,Kpoint,IndexM,IndexCorrectSET,IndexSolutionsSET
   real(8)::Rcof,EPS,ENN0,ExfZero,HenergySET,ExfSETT
   integer,dimension(:)::NumbreRegion 
   real(8),dimension(:)::RO1X,UNout,UNin,AX,BX,ExfSolutions,ExfSET,DetSET
   real(8),dimension(:,:)::E,AZ,FZ,BZ,FX,Uout,Uin,VNout,VNin,DZ
   real(8),dimension(:,:,:)::Pz,A,B,AA,BB,Vout,Vin,EnergyZeroZ,EnergyRegion 
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   integer::IparametrDeterEnergy,NEpsIter,IndexVilky,INDEXDF,IIKK,IndexCorrect,IndexRegion,IndexSmena,IndexSolutions,IKLKORX,IOPZ,IKLRXX,IDFJK,IIFG,INDEXAD,INDEXRShag,IIHD,IIOXDPZ,INDEXPeresc
   real(8)::Henergy,Exf,ExfTemp,Delta,RcoffInterval,RcoffChengH,DeltaEnerPers,DeltaFunPers
   real(8),dimension(10)::DetM,ExfM,DetMA,ExfMA,ProDet  
   
   
   ! ”— Œ–≈ÕÕ€… Ã≈“Œƒ –¿—◊≈“¿
   ! «¿Õ”Àﬂ≈Ã œ≈–≈ƒ –¿—◊≈“ŒÃ
   DetM=0.D0
   ExfM=0.D0
   DetMA=0.D0
   ExfMA=0.D0
   ExfSolutions=0.D0
   ! Õ¿◊¿À‹ÕŒ≈ œ–»¡À»∆≈Õ»≈ ƒÀﬂ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»
   Exf=ENN0  
   ! Õ¿◊¿À‹Õ€… ÿ¿√ œŒ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»
   Henergy=0.1D0
   ! Õ¿ œ≈–¬€’ ƒ¬”’ »“≈–¿÷»ﬂ’ ”Ã≈Õ‹ÿ¿≈Ã ÿ¿√ ¬ 10 –¿«
   IF(IndexExit.EQ.0) THEN
      IF(Niteration.EQ.2) THEN
         Henergy=Henergy/10.D0
      ENDIF
	  ! ÕŒÃ≈– »“≈–¿÷»»
	  IDFJK=2
   ENDIF
   ! Õ¿ œ≈–¬€’ ƒ¬”’ »“≈–¿÷»ﬂ’ ”Ã≈Õ‹ÿ¿≈Ã ÿ¿√ ¬ 10 –¿«
   IF(IndexExit.EQ.1) THEN
      IF(Niteration.EQ.2) THEN
         Henergy=Henergy/10.D0
      ENDIF
      IF(Niteration.EQ.3) THEN
         Henergy=Henergy/10.D0
      ENDIF
	  ! ÕŒÃ≈– »“≈–¿÷»»
	  IDFJK=3
   ENDIF

   ! œ¿–¿Ã≈“– ¬€’Œƒ¿ »« ÷» À¿  
   IparametrDeterEnergy=1
   ! »Õƒ≈ — ÷» À¿ 
   NEpsIter=0
   ! œ¿–¿Ã≈“– ” ¿«€¬¿ﬁŸ»… Õ¿ “Œ ◊“Œ »Õ“≈–¬¿À √ƒ≈ Õ¿’Œƒ»“—ﬂ  Œ–≈Õ‹ Œœ–≈ƒ≈À≈Õ
   IndexVilky=0
   INDEXDF=0
   IIKK=0
   IndexCorrect=0
   IndexRegion=1
   IndexSmena=0
   IndexSolutions=0
   IKLKORX=0
   IOPZ=0
   IKLRXX=0
   INDEXAD=0
   INDEXRShag=0
   IIHD=0
   IIOXDPZ=0
   INDEXPeresc=0
   DeltaEnerPers=0.D0
   DeltaFunPers=0.D0
   RcoffChengH=1.D0
   DO WHILE(IparametrDeterEnergy.EQ.1)
      NEpsIter=NEpsIter+1
      ! Œœ–≈ƒ≈Àﬂ≈Ã ÕŒÃ≈– “Œ◊ » —ÿ»¬ » –≈ÿ≈Õ»… OUT AND IN
      call PointIntersection(Npoint,NumeroMin,Exf,Pz,RO1X,Kpoint)
      ! œŒƒœ–Œ√–¿ÃÃ¿ ‘Œ–Ã»–”≈“ Ã¿——»¬€ ƒÀﬂ –¿—◊≈“¿ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ »
      call FormMassivAABB(Npoint,IndexM,Rcof,Exf,A,B,AA,BB,RO1X,E,AZ,FZ,BZ)
      ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » ƒÀﬂ ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€
      call CalculationParameterProgonky(1,IndexM,Kpoint,Npoint,AA,BB,FX,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,AZ,BZ,FZ,DZ,E,AX,BX)
      ! »Ÿ≈Ã —ŒŒ“¬≈“—“¬”ﬁŸ»≈  Œ–Õ» Exf
      call SearchSolutionAccelerated2(NMO,NNEL,NEpsIter,Kpoint,IndexM,Vout,Vin,DetM,ExfM,DetMA,ExfMA,Exf,AZ,BZ,E,Henergy,IparametrDeterEnergy,EPS,IndexVilky,INDEXDF,IIKK,IndexCorrect,IndexSolutions,ExfSolutions,ExfTemp,IndexCorrectSET,IndexSolutionsSET,HenergySET,ExfSETT,ExfSET,DetSET,IKLKORX,IOPZ,IKLRXX,EnergyZeroZ,INDEXAD,RcoffChengH,ProDet,INDEXRShag,IIHD,IIOXDPZ,INDEXPeresc,DeltaEnerPers,DeltaFunPers)  
      ! Œ—”Ÿ≈—“¬Àﬂ≈Ã  ŒÕ“–ŒÀ‹ «¿ ÿ¿√¿Ã 
	  IF(Niteration.GT.IDFJK) THEN
	     call ControlH(NMO,IndexSmena,NumbreRegion(NMO),IndexRegion,EnergyRegion,Exf,Henergy)
      ENDIF 
   ENDDO

  

   ! ‘Œ–Ã»–”≈Ã Œ¡À¿—“» √ƒ≈ ÿ¿√ ¡”ƒ≈“ ”Ã≈Õ‹ÿ»Õ ƒÀﬂ œ≈–¬Œ√Œ  Œ–Õﬂ
   IF(IndexExit.EQ.0) THEN
      IF(Niteration.GT.1) THEN
       
            Delta=DABS(EnergyZeroZ(NMO,1,2)-EnergyZeroZ(NMO,1,1))
		    IF(Delta.LT.0.1D0) THEN
               Delta=0.1D0
		    ENDIF
			! Œœ–≈ƒ≈Àﬂ≈Ã  Œ›‘‘»÷»≈Õ“  Œ“Œ–€… ‘Œ–Ã»–”≈“ »Õ“≈–¬¿À
            IF(Delta.LT.1.D0) THEN
               RcoffInterval=10.D0  
			ENDIF
            IF(Delta.GT.1.D0.AND.Delta.LT.5.D0) THEN
               RcoffInterval=5.D0 
			ENDIF
            IF(Delta.GT.10.D0.AND.Delta.LT.15.D0) THEN
               RcoffInterval=2.5D0 
			ENDIF
            IF(Delta.GT.15.D0) THEN
               RcoffInterval=1.D0 
			ENDIF

		    ! œ–¿¬¿ﬂ √–¿Õ»÷¿ 
		    EnergyRegion(NMO,1,2)=EnergyZeroZ(NMO,1,2)+RcoffInterval*Delta 
		    ! À≈¬¿ﬂ √–¿Õ»÷¿
			! œ–Œ¬≈–ﬂ≈Ã À≈¬”ﬁ √–¿Õ»÷” ŒÕ¿ Õ≈ ÃŒ∆≈“ «¿…“» ¬ Œ“–»÷¿“≈À‹Õ”ﬁ Œ¡À¿—“‹
			IF((EnergyZeroZ(NMO,1,2)-RcoffInterval*Delta).LT.0.D0) THEN
			    EnergyRegion(NMO,1,1)=0.D0 
			   ELSE    
		        EnergyRegion(NMO,1,1)=EnergyZeroZ(NMO,1,2)-RcoffInterval*Delta 
			ENDIF
	  ENDIF
   ENDIF
   IF(IndexExit.EQ.1) THEN
      IF(Niteration.GT.2) THEN
            Delta=DABS(EnergyZeroZ(NMO,1,2)-EnergyZeroZ(NMO,1,1))
		    IF(Delta.LT.0.1D0) THEN
               Delta=0.1D0
		    ENDIF
			! Œœ–≈ƒ≈Àﬂ≈Ã  Œ›‘‘»÷»≈Õ“  Œ“Œ–€… ‘Œ–Ã»–”≈“ »Õ“≈–¬¿À
            IF(Delta.LT.1.D0) THEN
               RcoffInterval=10.D0  
			ENDIF
            IF(Delta.GT.1.D0.AND.Delta.LT.5.D0) THEN
               RcoffInterval=5.D0 
			ENDIF
            IF(Delta.GT.10.D0.AND.Delta.LT.15.D0) THEN
               RcoffInterval=2.5D0 
			ENDIF
            IF(Delta.GT.15.D0) THEN
               RcoffInterval=1.D0 
			ENDIF
		    ! œ–¿¬¿ﬂ √–¿Õ»÷¿ 
		    EnergyRegion(NMO,1,2)=EnergyZeroZ(NMO,1,2)+RcoffInterval*Delta 
		    ! À≈¬¿ﬂ √–¿Õ»÷¿
			! œ–Œ¬≈–ﬂ≈Ã À≈¬”ﬁ √–¿Õ»÷” ŒÕ¿ Õ≈ ÃŒ∆≈“ «¿…“» ¬ Œ“–»÷¿“≈À‹Õ”ﬁ Œ¡À¿—“‹
			IF((EnergyZeroZ(NMO,1,2)-RcoffInterval*Delta).LT.0.D0) THEN
			    EnergyRegion(NMO,1,1)=0.D0 
			   ELSE    
		        EnergyRegion(NMO,1,1)=EnergyZeroZ(NMO,1,2)-RcoffInterval*Delta 
			ENDIF 
      ENDIF
   ENDIF


          

   return
 end subroutine SearchEnergySolutionHomogeneousSystemAccelerated2


 !! SUBPROGRAMME SEARCH FOR THE OWN ENERGY OF THE HOMOGENEOUS SYSTEM OF EQUATIONS IN THE "ACCELERATED" METHOD FOR FINDING THE SOLUTION OF LEFT
†!! NNEL- MAIN QUANTUM NUMBER
†!! Npoint-NUMBER OF POINTS
†!! NumeroMin-MINIMUM HARMONIC NUMBER
†!! Kpoint-NUMBER OF POINT OF SOLVING SOLUTIONS
†!! IndexM-SIZE OF MASSIVE
†!! Rcof-EQUITY RATIO H * H / 12
†!! EPS-ACCURACY
†!! Pz (NumbreGarmMO (NMO), NumbreGarmMO (NMO), Npoint) - VALUE MAP of the P (ro) -particle of the log function P entering the equation Y '' = P * Y + Q-LOCAL POTENTIAL
†!! RO1X (Npoint) - MASSIVE VALUES OF THE FIRST DERIVATIVE ON THE NEW VARIABLE
†!! A (Isize, Isize, Npoint) -MASSIVE FOR CALCULATING FUNCTION PARAMETERS
†!! B (Isize, Isize, Npoint) -MASSIVE FOR CALCULATING FUNCTION PARAMETERS
†!! AA (Isize, Isize, Npoint) -MASSIVE FOR CALCULATING THE PARAMETERS OF THE PROLONG WITH ADDED ESSENTIAL SINGLE-ELECTRONIC ENERGY
†!! BB (Isize, Isize, Npoint) -MASSIVE FOR CALCULATING THE PARAMETERS OF THE PROLONG WITH ADDED ESSENTIAL SINGLE-ELECTRONIC ENERGY
†!! FX (IndexM, Npoint) -MASSIVE F
†!! Vout (IndexM, IndexM, Npoint) -MASSIVE OF FREQUENCY ON THE DIRECTION OF "OUTSIDE"
†!! Uout (IndexM, Npoint) -MASSIVE OF FREQUENCY ON THE DIRECTION OF "OUTSIDE"
†!! Vin (IndexM, IndexM, Npoint) -MASSIVE OF FIRING ON THE DIRECTION "INSIDE"
†!! Uin (IndexM, Npoint) -MASSIVE OF FIRING ON THE DIRECTION "INSIDE"
†!! RO1X (Npoint) -MASSIVE FIRST DERIVATIVE NEW VARIABLE FOR THE OLD VARIABLE
†!! VNout, UNout, VNin, UNin, E, AZ, FZ, DZ, BZ, AX, BX-AUXILIARY MASSIVE
†!! ENN0-LOWER ENERGY BORDER
†!! ExfSolutions (3) -SOLUTION OF A HOMOGENEOUS SYSTEM OF EQUATIONS SINGLE-ELECTRONIC ENERGY FOR NUMBER QUANTITY NUMERALS NNEL-1, NNEL, NNEL + 1
 subroutine SearchEnergySolutionHomogeneousSystemAcceleratedLeft(NNEL,Npoint,NumeroMin,Kpoint,IndexM,Rcof,EPS,Pz,RO1X,A,B,AA,BB,E,AZ,FZ,BZ,FX,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,DZ,AX,BX,ENN0,ExfSolutions,IndexCorrectSET,IndexSolutionsSET,HenergySET,ExfSETT,ExfSET,DetSET) 
   implicit none
   integer::NNEL,Npoint,NumeroMin,Kpoint,IndexM,IndexCorrectSET,IndexSolutionsSET
   real(8)::Rcof,EPS,ENN0,ExfZero,HenergySET,ExfSETT
   real(8),dimension(:)::RO1X,UNout,UNin,AX,BX,ExfSolutions,ExfSET,DetSET
   real(8),dimension(:,:)::E,AZ,FZ,BZ,FX,Uout,Uin,VNout,VNin,DZ
   real(8),dimension(:,:,:)::Pz,A,B,AA,BB,Vout,Vin 
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   integer::IparametrDeterEnergy,NEpsIter,IndexVilky,INDEXDF,IIKK,IndexCorrect,IndexSolutions,IKLKORX,IOPZ,IKLRXX,INDEXAD,INDEXRShag,IIHD,IIOXDPZ,INDEXPeresc
   real(8)::Henergy,Exf,ExfTemp,RcoffChengH,DeltaEnerPers,DeltaFunPers
   real(8),dimension(10)::DetM,ExfM,DetMA,ExfMA,ProDet   
   
   
   ! ”— Œ–≈ÕÕ€… Ã≈“Œƒ –¿—◊≈“¿
   ! «¿Õ”Àﬂ≈Ã œ≈–≈ƒ –¿—◊≈“ŒÃ
   DetM=DetSET
   ExfM=ExfSET
   DetMA=0.D0
   ExfMA=0.D0
   
   ! Õ¿◊¿À‹ÕŒ≈ œ–»¡À»∆≈Õ»≈ ƒÀﬂ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»
   Exf=ExfSETT
   ! Õ¿◊¿À‹Õ€… ÿ¿√ œŒ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»
   ! ”◊»“€¬¿≈Ã “Œ ‘¿ “, ◊“Œ ƒÀﬂ œŒ»— ¿ ƒ¿ÕÕŒ√Œ  Œ–Õﬂ ”Ã≈Õ‹ÿ¿≈Ã ÿ¿√ ¬ 10 –¿«
   ! ƒ¿ÕÕ€… Ã≈“Œƒ »—œŒÀ‹«Œ¬¿Õ ¬Œ ¬—≈’ œŒƒœ–Œ√–¿ÃÃ¿ œŒ œŒ»— ”  Œ–Õﬂ ŒƒÕŒ–ŒƒÕŒ√Œ ”–¿¬Õ≈Õ»ﬂ
   ! ”Ã≈Õ‹ÿ≈Õ»≈ ÿ¿√¿ œ–Œ»«¬Œƒ»“—ﬂ ¬ Œ¡À¿—“» ¬Œ«ÃŒ∆ÕŒ√Œ Õ¿’Œ∆ƒ≈Õ»ﬂ  Œ–Õﬂ
   ! œŒ— ŒÀ‹ ” ƒ¿ÕÕ¿ﬂ œ–Œ÷≈ƒ”–¿ «¿œ”— ¿≈“—ﬂ Õ≈ Õ¿  ¿∆ƒŒ… »“≈–¿÷»»
   ! ¿ “ŒÀ‹ Œ œ–» ”—ÀŒ¬»» Œ“—”“—“¬»ﬂ —œ–¿¬¿ “Œ Œ¡À¿—“‹ﬁ ”Ã≈Õ‹ÿ≈Õ»ﬂ ÿ¿√¿ —◊»“¿≈Ã ¬—ﬁ Œ¡À¿—“‹ œŒ»— ¿    
   Henergy=HenergySET !*0.1D0

   ! œ¿–¿Ã≈“– ¬€’Œƒ¿ »« ÷» À¿  
   IparametrDeterEnergy=1
   ! »Õƒ≈ — ÷» À¿ 
   NEpsIter=3
   ! œ¿–¿Ã≈“– ” ¿«€¬¿ﬁŸ»… Õ¿ “Œ ◊“Œ »Õ“≈–¬¿À √ƒ≈ Õ¿’Œƒ»“—ﬂ  Œ–≈Õ‹ Œœ–≈ƒ≈À≈Õ
   IndexVilky=0
   INDEXDF=0
   IIKK=0
   IndexCorrect=IndexCorrectSET
   IndexSolutions=IndexSolutionsSET
   IKLKORX=0
   IOPZ=0
   IKLRXX=0
   INDEXAD=0
   INDEXRShag=0
   IIHD=0
   IIOXDPZ=0
   INDEXPeresc=0
   DeltaEnerPers=0.D0
   DeltaFunPers=0.D0
   RcoffChengH=1.D0
   DO WHILE(IparametrDeterEnergy.EQ.1)
      NEpsIter=NEpsIter+1
      ! Œœ–≈ƒ≈Àﬂ≈Ã ÕŒÃ≈– “Œ◊ » —ÿ»¬ » –≈ÿ≈Õ»… OUT AND IN
      call PointIntersection(Npoint,NumeroMin,Exf,Pz,RO1X,Kpoint)
      ! œŒƒœ–Œ√–¿ÃÃ¿ ‘Œ–Ã»–”≈“ Ã¿——»¬€ ƒÀﬂ –¿—◊≈“¿ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ »
      call FormMassivAABB(Npoint,IndexM,Rcof,Exf,A,B,AA,BB,RO1X,E,AZ,FZ,BZ)
      ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » ƒÀﬂ ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€
      call CalculationParameterProgonky(1,IndexM,Kpoint,Npoint,AA,BB,FX,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,AZ,BZ,FZ,DZ,E,AX,BX)
      ! »Ÿ≈Ã —ŒŒ“¬≈“—“¬”ﬁŸ»≈  Œ–Õ» Exf
      call SearchSolutionAcceleratedLeft(NNEL,NEpsIter,Kpoint,IndexM,Vout,Vin,DetM,ExfM,DetMA,ExfMA,Exf,AZ,BZ,E,Henergy,IparametrDeterEnergy,EPS,IndexVilky,INDEXDF,IIKK,IndexCorrect,IndexSolutions,ExfSolutions,ExfTemp,IKLKORX,IOPZ,IKLRXX,INDEXAD,RcoffChengH,ProDet,INDEXRShag,IIHD,IIOXDPZ,INDEXPeresc,DeltaEnerPers,DeltaFunPers)  
   ENDDO
          

   return
 end subroutine SearchEnergySolutionHomogeneousSystemAcceleratedLeft

!! SUBPROGRAMME SEARCH FOR THE OWN ENERGY OF THE HOMOGENEOUS SYSTEM OF EQUATIONS IN THE "ACCELERATED" METHOD FOR FINDING THE SOLUTION OF LEFT
†!! NNEL- MAIN QUANTUM NUMBER
†!! Npoint-NUMBER OF POINTS
†!! NumeroMin-MINIMUM HARMONIC NUMBER
†!! Kpoint-NUMBER OF POINT OF SOLVING SOLUTIONS
†!! IndexM-SIZE OF MASSIVE
†!! Rcof-EQUITY RATIO H * H / 12
†!! EPS-ACCURACY
†!! Pz (NumbreGarmMO (NMO), NumbreGarmMO (NMO), Npoint) - VALUE MAP of the P (ro) -particle of the log function P entering the equation Y '' = P * Y + Q-LOCAL POTENTIAL
†!! RO1X (Npoint) - MASSIVE VALUES OF THE FIRST DERIVATIVE ON THE NEW VARIABLE
†!! A (Isize, Isize, Npoint) -MASSIVE FOR CALCULATING FUNCTION PARAMETERS
†!! B (Isize, Isize, Npoint) -MASSIVE FOR CALCULATING FUNCTION PARAMETERS
†!! AA (Isize, Isize, Npoint) -MASSIVE FOR CALCULATING THE PARAMETERS OF THE PROLONG WITH ADDED ESSENTIAL SINGLE-ELECTRONIC ENERGY
†!! BB (Isize, Isize, Npoint) -MASSIVE FOR CALCULATING THE PARAMETERS OF THE PROLONG WITH ADDED ESSENTIAL SINGLE-ELECTRONIC ENERGY
†!! FX (IndexM, Npoint) -MASSIVE F
†!! Vout (IndexM, IndexM, Npoint) -MASSIVE OF FREQUENCY ON THE DIRECTION OF "OUTSIDE"
†!! Uout (IndexM, Npoint) -MASSIVE OF FREQUENCY ON THE DIRECTION OF "OUTSIDE"
†!! Vin (IndexM, IndexM, Npoint) -MASSIVE OF FIRING ON THE DIRECTION "INSIDE"
†!! Uin (IndexM, Npoint) -MASSIVE OF FIRING ON THE DIRECTION "INSIDE"
†!! RO1X (Npoint) -MASSIVE FIRST DERIVATIVE NEW VARIABLE FOR THE OLD VARIABLE
†!! VNout, UNout, VNin, UNin, E, AZ, FZ, DZ, BZ, AX, BX-AUXILIARY MASSIVE
†!! ENN0-LOWER ENERGY BORDER
†!! ExfSolutions (3) -SOLUTION OF A HOMOGENEOUS SYSTEM OF EQUATIONS SINGLE-ELECTRONIC ENERGY FOR NUMBER QUANTITY NUMERALS NNEL-1, NNEL, NNEL + 1
†!! INDEXGRNYT-TYPE OF DEFINED INTERVAL BORDER
 subroutine SearchEnergySolutionHomogeneousSystemAcceleratedLeft2(NNEL,Npoint,NumeroMin,Kpoint,IndexM,Rcof,EPS,Pz,RO1X,A,B,AA,BB,E,AZ,FZ,BZ,FX,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,DZ,AX,BX,ENN0,ExfSolutions,IndexCorrectSET,IndexSolutionsSET,HenergySET,ExfSETT,ExfSET,DetSET,INDEXGRNYT) 
   implicit none
   integer::NNEL,Npoint,NumeroMin,Kpoint,IndexM,IndexCorrectSET,IndexSolutionsSET,INDEXGRNYT
   real(8)::Rcof,EPS,ENN0,ExfZero,HenergySET,ExfSETT
   real(8),dimension(:)::RO1X,UNout,UNin,AX,BX,ExfSolutions,ExfSET,DetSET
   real(8),dimension(:,:)::E,AZ,FZ,BZ,FX,Uout,Uin,VNout,VNin,DZ
   real(8),dimension(:,:,:)::Pz,A,B,AA,BB,Vout,Vin 
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   integer::IparametrDeterEnergy,NEpsIter,IndexVilky,INDEXDF,IIKK,IndexCorrect,IndexSolutions,IKLKORX,IOPZ,IKLRXX,INDEXAD,INDEXRShag,INDEXSHAA,IIHD,IIOXDPZ,INDEXPeresc
   real(8)::Henergy,Exf,ExfTemp,RcoffChengH,DeltaEnerPers,DeltaFunPers
   real(8),dimension(10)::DetM,ExfM,DetMA,ExfMA,ProDet   
   
   
   ! ”— Œ–≈ÕÕ€… Ã≈“Œƒ –¿—◊≈“¿  
   ! «¿Õ”Àﬂ≈Ã œ≈–≈ƒ –¿—◊≈“ŒÃ
   DetM=DetSET
   ExfM=ExfSET
   DetMA=0.D0
   ExfMA=0.D0
   
   ! Õ¿◊¿À‹ÕŒ≈ œ–»¡À»∆≈Õ»≈ ƒÀﬂ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»
   Exf=ExfSETT
   ! Õ¿◊¿À‹Õ€… ÿ¿√ œŒ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»
   ! ”◊»“€¬¿≈Ã “Œ ‘¿ “, ◊“Œ ƒÀﬂ œŒ»— ¿ ƒ¿ÕÕŒ√Œ  Œ–Õﬂ ”Ã≈Õ‹ÿ¿≈Ã ÿ¿√ ¬ 10 –¿«
   ! ƒ¿ÕÕ€… Ã≈“Œƒ »—œŒÀ‹«Œ¬¿Õ ¬Œ ¬—≈’ œŒƒœ–Œ√–¿ÃÃ¿ œŒ œŒ»— ”  Œ–Õﬂ ŒƒÕŒ–ŒƒÕŒ√Œ ”–¿¬Õ≈Õ»ﬂ
   ! ”Ã≈Õ‹ÿ≈Õ»≈ ÿ¿√¿ œ–Œ»«¬Œƒ»“—ﬂ ¬ Œ¡À¿—“» ¬Œ«ÃŒ∆ÕŒ√Œ Õ¿’Œ∆ƒ≈Õ»ﬂ  Œ–Õﬂ
   ! œŒ— ŒÀ‹ ” ƒ¿ÕÕ¿ﬂ œ–Œ÷≈ƒ”–¿ «¿œ”— ¿≈“—ﬂ Õ≈ Õ¿  ¿∆ƒŒ… »“≈–¿÷»»
   ! ¿ “ŒÀ‹ Œ œ–» ”—ÀŒ¬»» Œ“—”“—“¬»ﬂ —œ–¿¬¿ “Œ Œ¡À¿—“‹ﬁ ”Ã≈Õ‹ÿ≈Õ»ﬂ ÿ¿√¿ —◊»“¿≈Ã ¬—ﬁ Œ¡À¿—“‹ œŒ»— ¿    
   Henergy=HenergySET !*0.1D0

   ! œ¿–¿Ã≈“– ¬€’Œƒ¿ »« ÷» À¿  
   IparametrDeterEnergy=1
   ! »Õƒ≈ — ÷» À¿ 
   NEpsIter=3
   ! œ¿–¿Ã≈“– ” ¿«€¬¿ﬁŸ»… Õ¿ “Œ ◊“Œ »Õ“≈–¬¿À √ƒ≈ Õ¿’Œƒ»“—ﬂ  Œ–≈Õ‹ Œœ–≈ƒ≈À≈Õ
   IndexVilky=0
   INDEXDF=0
   IIKK=0
   IndexCorrect=IndexCorrectSET
   IndexSolutions=IndexSolutionsSET
   IKLKORX=0
   IOPZ=0
   IKLRXX=0
   INDEXAD=0
   INDEXRShag=0
   INDEXSHAA=0
   IIHD=0
   IIOXDPZ=0
   INDEXPeresc=0
   DeltaEnerPers=0.D0
   DeltaFunPers=0.D0
   RcoffChengH=1.D0
   DO WHILE(IparametrDeterEnergy.EQ.1)
      NEpsIter=NEpsIter+1
      ! Œœ–≈ƒ≈Àﬂ≈Ã ÕŒÃ≈– “Œ◊ » —ÿ»¬ » –≈ÿ≈Õ»… OUT AND IN
      call PointIntersection(Npoint,NumeroMin,Exf,Pz,RO1X,Kpoint)
      ! œŒƒœ–Œ√–¿ÃÃ¿ ‘Œ–Ã»–”≈“ Ã¿——»¬€ ƒÀﬂ –¿—◊≈“¿ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ »
      call FormMassivAABB(Npoint,IndexM,Rcof,Exf,A,B,AA,BB,RO1X,E,AZ,FZ,BZ)
      ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » ƒÀﬂ ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€
      call CalculationParameterProgonky(1,IndexM,Kpoint,Npoint,AA,BB,FX,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,AZ,BZ,FZ,DZ,E,AX,BX)
      ! »Ÿ≈Ã —ŒŒ“¬≈“—“¬”ﬁŸ»≈  Œ–Õ» Exf
      call SearchSolutionAcceleratedLeft2(NNEL,NEpsIter,Kpoint,IndexM,Vout,Vin,DetM,ExfM,DetMA,ExfMA,Exf,AZ,BZ,E,Henergy,IparametrDeterEnergy,EPS,IndexVilky,INDEXDF,IIKK,IndexCorrect,IndexSolutions,ExfSolutions,ExfTemp,IKLKORX,IOPZ,IKLRXX,INDEXAD,RcoffChengH,ProDet,INDEXRShag,INDEXGRNYT,INDEXSHAA,IIHD,IIOXDPZ,INDEXPeresc,DeltaEnerPers,DeltaFunPers)  
   ENDDO
          

   return
 end subroutine SearchEnergySolutionHomogeneousSystemAcceleratedLeft2




!! SUBPROGRAMME DETERMINES THE MINIMUM VALUE OF NORM IN THE ENERGY INTERVAL
†!! NMO-NUMBER OF MOLECULAR ORBITALS
†!! Npoint-NUMBER OF POINTS
†!! IndexM-SIZE OF MASSIVE
†!! Kpoint-NUMBER OF POINT OF SOLVING SOLUTIONS
†!! NumeroMin-MINIMUM HARMONIC NUMBER
†!! H-STEP
†!! Rcof-EQUITY RATIO H * H / 12
†!! Pz (NumbreGarmMO (NMO), NumbreGarmMO (NMO), Npoint) - VALUE MAP of the P (ro) -particle of the log function P entering the equation Y '' = P * Y + Q-LOCAL POTENTIAL
†!! RO1X (Npoint) - MASSIVE VALUES OF THE FIRST DERIVATIVE ON THE NEW VARIABLE
†!! A (Isize, Isize, Npoint) -MASSIVE FOR CALCULATING FUNCTION PARAMETERS
†!! B (Isize, Isize, Npoint) -MASSIVE FOR CALCULATING FUNCTION PARAMETERS
†!! AA (Isize, Isize, Npoint) -MASSIVE FOR CALCULATING THE PARAMETERS OF THE PROLONG WITH ADDED ESSENTIAL SINGLE-ELECTRONIC ENERGY
†!! BB (Isize, Isize, Npoint) -MASSIVE FOR CALCULATING THE PARAMETERS OF THE PROLONG WITH ADDED ESSENTIAL SINGLE-ELECTRONIC ENERGY
†!! FX (IndexM, Npoint) -MASSIVE F
†!! Vout (IndexM, IndexM, Npoint) -MASSIVE OF FREQUENCY ON THE DIRECTION OF "OUTSIDE"
†!! Uout (IndexM, Npoint) -MASSIVE OF FREQUENCY ON THE DIRECTION OF "OUTSIDE"
†!! Vin (IndexM, IndexM, Npoint) -MASSIVE OF FIRING ON THE DIRECTION "INSIDE"
†!! Uin (IndexM, Npoint) -MASSIVE OF FIRING ON THE DIRECTION "INSIDE"
†!! VNout, UNout, VNin, UNIN, AZ, BZ, FZ, DZ, E, AX, BX, CX, IXM-AUXILIARY MASSIVE FOR CALCULATION
†!! FunMO-IN THIS CASE AUXILIARY MASSIVE
†!! NumeroMaxLimid-MAXIMUM NUMBER OF HARMONIC MOLECULAR ORBITALS
†!! NumbreLigand (NumbreMO) -MASSIVE NUMBER OF LIGANDES WHICH FUNCTIONS DESCRIBE HIGHER HARMONICS OF THIS MOLECULAR ORBITAL
†!! NLigands (NumbreMO, NumbreLigand (NumbreMO)) - MASSIVE OF LIGAND NUMBERS FUNCTIONS WHICH DESCRIBE HIGHER HARMONICS OF THIS MOLECULAR ORBITAL
†!! NFunLigands (NumbreMO, NumbreLigand (NumbreMO)) - A MASSIVE OF THE NUMBER OF FUNCTIONS OF EACH LIGAND DESCRIBING HIGHER HARMONICS OF THIS MOLECULAR ORBITAL
†!! NumbreFunctionLig (NumbreMO, NumbreLigand (NumbreMO), NFunLigands (NumbreMO, NumbreLigand (NumbreMO)))) - MASSIVE OF NUMBERS OF LIGAND FUNCTIONS THAT COMPLY WITH THIS MOLECULAR ORBITAL
†!! RfunLigands (Nnuclei, NumbreFunctionLig, NumbreGarmLigand, Npoint + 2) -MASSIVE OF VALUES OF LIGAND FUNCTIONS
†!! AlfaCoffMO (NumbreMO, NumbreLigand, NumbreFunLigand) -MASSIVE OF COEFFICIENTS WITH WHICH LIGANDA FUNCTIONS COME INTO THE STRUCTURE OF MOLECULAR ORBITAL
†!! ExfMin, ExfMax-Energetic interval in which the minimum is searched
†!! REmin-Energy corresponding to a minimum
†!! RfunMIN-Value of the norm
 subroutine  MinValueNormEnergyFunction(NMO,Npoint,IndexM,NumeroMin,NumeroMax,Kpoint,NumeroMaxLimid,Rcof,H,Uout,Uin,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,AlfaCoffMO,RfunLigands,RO1X,FunMO,Pz,IXM,UNout,UNin,Vout,Vin,AX,BX,CX,E,AZ,FZ,BZ,FX,VNout,VNin,DZ,A,B,AA,BB,ExfMin,ExfMax,REmin,RfunMIN)
   implicit none
   integer::NMO,Npoint,IndexM,NumeroMin,NumeroMax,Kpoint,NumeroMaxLimid
   real(8)::Rcof,ExfMin,ExfMax,H,RfunMIN,REmin
   integer,dimension(:)::NumbreLigand
   integer,dimension(:,:)::IXM,NLigands,NFunLigands
   integer,dimension(:,:,:)::NumbreFunctionLig
   real(8),dimension(:)::RO1X,UNout,UNin,AX,BX,CX
   real(8),dimension(:,:)::E,AZ,FZ,BZ,FX,Uout,Uin,VNout,VNin,DZ,FunMO
   real(8),dimension(:,:,:)::Pz,A,B,AA,BB,Vout,Vin,AlfaCoffMO
   real(8),dimension(:,:,:,:)::RfunLigands
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   integer::NEpsIter,IparametrDeterEnergy 
   real(8)::RHS,RX0,RX1,RX2,Rfun0XZ,RnormX0,Xfun0XZ,Rfun1XZ,RnormX1,Xfun1XZ,Rfun2XZ,RnormX2,Xfun2XZ 
   
   ! Õ¿◊¿À‹Õ€… ÿ¿√
   RHS=(ExfMax-ExfMin)/100.D0
   ! Õ¿◊¿À‹Õ€≈ “Œ◊ »
   ! —≈–≈ƒ»Õ¿ »Õ“≈–¬¿À¿ 
   RX0=(ExfMax+ExfMin)*0.5D0 
   ! ¡Œ Œ¬€≈ “Œ◊ »
   RX1=RX0-RHS
   RX2=RX0+RHS
   NEpsIter=0
   ! œ¿–¿Ã≈“– ¬€’Œƒ¿ »« ÷» À¿ 
   IparametrDeterEnergy=1 
   DO WHILE(IparametrDeterEnergy.EQ.1)
      NEpsIter=NEpsIter+1
      ! Õ¿’Œƒ»Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ ƒÀﬂ «Õ¿◊≈Õ»ﬂ ›Õ≈–√»» RX0
	  ! Œœ–≈ƒ≈Àﬂ≈Ã ÕŒÃ≈– “Œ◊ » —ÿ»¬ » –≈ÿ≈Õ»… OUT AND IN
	  call PointIntersection(Npoint,NumeroMin,RX0,Pz,RO1X,Kpoint) 

	  ! œŒƒœ–Œ√–¿ÃÃ¿ ‘Œ–Ã»–”≈“ Ã¿——»¬€ ƒÀﬂ –¿—◊≈“¬¿ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ »
	  call FormMassivAABB(Npoint,IndexM,Rcof,RX0,A,B,AA,BB,RO1X,E,AZ,FZ,BZ)
	 
      ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » ƒÀﬂ Õ≈ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€
      call CalculationParameterProgonky(2,IndexM,Kpoint,Npoint,AA,BB,FX,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,AZ,BZ,FZ,DZ,E,AX,BX)
                  
      ! Œœ–≈ƒ≈Àﬂ≈Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ —ŒŒ“¬≈“—“¬”ﬁŸ≈≈ ƒ¿ÕÕŒÃ” «Õ¿◊≈Õ»ﬁ ›Õ≈–√»» RX0
      call CalculationNormFunE(RnormX0,Kpoint,Npoint,IndexM,NumeroMin,NumeroMax,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,AZ,BZ,E,AX,BX,CX,IXM,FunMO,RO1X,H,NMO,NumeroMaxLimid,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,RfunLigands,AlfaCoffMO)    
        
	  ! Õ¿’Œƒ»Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ ƒÀﬂ «Õ¿◊≈Õ»ﬂ ›Õ≈–√»» RX1
	  ! Œœ–≈ƒ≈Àﬂ≈Ã ÕŒÃ≈– “Œ◊ » —ÿ»¬ » –≈ÿ≈Õ»… OUT AND IN
	  call PointIntersection(Npoint,NumeroMin,RX1,Pz,RO1X,Kpoint)
	  
	  ! œŒƒœ–Œ√–¿ÃÃ¿ ‘Œ–Ã»–”≈“ Ã¿——»¬€ ƒÀﬂ –¿—◊≈“¬¿ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ »
	  call FormMassivAABB(Npoint,IndexM,Rcof,RX1,A,B,AA,BB,RO1X,E,AZ,FZ,BZ)
	  
	  ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » ƒÀﬂ Õ≈ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€
      call CalculationParameterProgonky(2,IndexM,Kpoint,Npoint,AA,BB,FX,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,AZ,BZ,FZ,DZ,E,AX,BX)
            
      ! Œœ–≈ƒ≈Àﬂ≈Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ —ŒŒ“¬≈“—“¬”ﬁŸ≈≈ ƒ¿ÕÕŒÃ” «Õ¿◊≈Õ»ﬁ ›Õ≈–√»» RX0
      call CalculationNormFunE(RnormX1,Kpoint,Npoint,IndexM,NumeroMin,NumeroMax,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,AZ,BZ,E,AX,BX,CX,IXM,FunMO,RO1X,H,NMO,NumeroMaxLimid,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,RfunLigands,AlfaCoffMO)    
            
      ! Õ¿’Œƒ»Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ ƒÀﬂ «Õ¿◊≈Õ»ﬂ ›Õ≈–√»» RX2
	  ! Œœ–≈ƒ≈Àﬂ≈Ã ÕŒÃ≈– “Œ◊ » —ÿ»¬ » –≈ÿ≈Õ»… OUT AND IN
	  call PointIntersection(Npoint,NumeroMin,RX2,Pz,RO1X,Kpoint)
	  
	  ! œŒƒœ–Œ√–¿ÃÃ¿ ‘Œ–Ã»–”≈“ Ã¿——»¬€ ƒÀﬂ –¿—◊≈“¬¿ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ »
	  call FormMassivAABB(Npoint,IndexM,Rcof,RX2,A,B,AA,BB,RO1X,E,AZ,FZ,BZ)
	 
      ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » ƒÀﬂ Õ≈ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€
      call CalculationParameterProgonky(2,IndexM,Kpoint,Npoint,AA,BB,FX,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,AZ,BZ,FZ,DZ,E,AX,BX)
             
      ! Œœ–≈ƒ≈Àﬂ≈Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ —ŒŒ“¬≈“—“¬”ﬁŸ≈≈ ƒ¿ÕÕŒÃ” «Õ¿◊≈Õ»ﬁ ›Õ≈–√»» RX0
      call CalculationNormFunE(RnormX2,Kpoint,Npoint,IndexM,NumeroMin,NumeroMax,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,AZ,BZ,E,AX,BX,CX,IXM,FunMO,RO1X,H,NMO,NumeroMaxLimid,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,RfunLigands,AlfaCoffMO)    
     
	  
	  ! «¿œ»—€¬¿≈Ã «Õ¿◊≈Õ»≈  
      IF(NEpsIter.EQ.1) THEN
           ! œ≈–¬¿ﬂ »“≈–¿÷»ﬂ 
           Rfun0XZ=RnormX0
	       Xfun0XZ=RX0
           Rfun1XZ=RnormX1
           Xfun1XZ=RX1
		   Rfun2XZ=RnormX2
           Xfun2XZ=RX2 
		   RX0=Xfun0XZ-RHS*(Rfun2XZ-Rfun1XZ)*0.5D0/(Rfun2XZ-2.D0*Rfun0XZ+Rfun1XZ)
           RX1=RX0-RHS
		   RX2=RX0+RHS
		 ELSE
           
		   WRITE(17,*) NEpsIter,RX0,RnormX0          
		   ! œ–Œ¬≈–ﬂ≈Ã Œƒ»Õ¿ Œ¬€≈ «Õ¿◊≈Õ»ﬂ ‘”Õ ÷»» Ã€ œŒÀ”◊¿≈Ã
		   ! —À≈ƒŒ¬¿“≈À‹Õ¿ﬂ œ≈–¬¿ﬂ œ–Œ»«¬ŒƒÕ¿ﬂ –¿¬Õ¿ Õ”Àﬁ	 
           IF(RnormX0.EQ.Rfun0XZ) THEN
              ! Ã»Õ»Ã¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ ‘”Õ ÷»»
		      RfunMIN=RnormX0 
		      ! —ŒŒ“¬≈“—“¬”ﬁŸ»… ¿–√”Ã≈Õ“
              REmin=RX0
			  ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
              IparametrDeterEnergy=2 
           ENDIF 

		
		   ! œ–Œ¬≈–ﬂ≈Ã œŒÀ”◊≈ÕÕŒ≈ ÕŒ¬Œ≈ œ–»¡À»∆≈Õ»≈ Ã≈Õ‹ÿ≈ œ–≈ƒ≈ƒ”Ÿ≈√Œ »À» Õ≈“
		   IF(RnormX0.LT.Rfun0XZ) THEN
                ! Ã»Õ»Ã¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ ‘”Õ ÷»»
		        RfunMIN=RnormX0 
		        ! —ŒŒ“¬≈“—“¬”ﬁŸ»… ¿–√”Ã≈Õ“
                REmin=RX0
              
			    ! œ–Œ¬≈–ﬂ≈Ã ”—ÀŒ¬»≈ ¬€’Œƒ¿ (œ–Œ¬≈–ﬂ≈Ã –¿¬≈Õ—“¬Œ Õ”Àﬁ œ≈–¬Œ… œ–Œ«¬ŒƒÕŒ…)
			    IF(DABS((RfunMIN-Rfun0XZ)/(REmin-Xfun0XZ)).LT.10.D0**(-10)) THEN
			       ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
                   IparametrDeterEnergy=2 
			    ENDIF   
              
			    ! «¿œ»—€¬¿≈Ã œ–≈ƒ€ƒ”Ÿ≈≈ «Õ¿◊≈Õ»≈
			    Rfun0XZ=RnormX0
			    Xfun0XZ=RX0
                Rfun1XZ=RnormX1
                Xfun1XZ=RX1
			    Rfun2XZ=RnormX2
                Xfun2XZ=RX2 

                ! œ–Œ¬≈–ﬂ≈Ã –¿¬Õ¿ Õ”Àﬁ œ≈–¬¿ﬂ œ–Œ»«¬ŒƒÕ¿ﬂ »À» Õ≈“ 
                IF(Rfun2XZ.EQ.Rfun1XZ) THEN
				     ! Ã»Õ»Ã¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ ‘”Õ ÷»»
		             RfunMIN=RnormX0 
		             ! —ŒŒ“¬≈“—“¬”ﬁŸ»… ¿–√”Ã≈Õ“
                     REmin=RX0
			         ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
                     IparametrDeterEnergy=2 
				ENDIF 
				!œ–Œ¬≈–ﬂ≈Ã –¿¬Õ¿ Õ”Àﬁ ¬“Œ–¿ﬂ œ–Œ»«¬ŒƒÕ¿ﬂ  œ–» ›“ŒÃ –¿—◊≈“ Œ—“¿Õ¿¬À»¬¿≈“—ﬂ
				IF(DABS((Rfun2XZ-2.D0*Rfun0XZ+Rfun1XZ)/RHS**2).LT.10.D0**(-10)) THEN
                   ! Ã»Õ»Ã¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ ‘”Õ ÷»»
		           RfunMIN=RnormX0 
		           ! —ŒŒ“¬≈“—“¬”ﬁŸ»… ¿–√”Ã≈Õ“
                   REmin=RX0
			       ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
                   IparametrDeterEnergy=2 
				ENDIF

			
                ! ÕŒ¬Œ≈ œ–»¡À»∆≈Õ»≈
				IF(IparametrDeterEnergy.EQ.1) THEN
			       RX0=Xfun0XZ-RHS*(Rfun2XZ-Rfun1XZ)*0.5D0/(Rfun2XZ-2.D0*Rfun0XZ+Rfun1XZ)
                   RX1=RX0-RHS
			       RX2=RX0+RHS
			    ENDIF
			
			  ELSE
				! «Õ¿◊≈Õ»≈ ‘”Õ ÷»» –¿—“≈“
				! Ã≈Õﬂ≈Ã ÿ¿√
				RHS=-RHS*0.5D0
			

				! œ–Œ¬≈–ﬂ≈Ã –¿¬Õ¿ Õ”Àﬁ œ≈–¬¿ﬂ œ–Œ»«¬ŒƒÕ¿ﬂ »À» Õ≈“ 
                IF(Rfun2XZ.EQ.Rfun1XZ) THEN
				   ! Ã»Õ»Ã¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ ‘”Õ ÷»»
		           RfunMIN=Rfun0XZ
		           ! —ŒŒ“¬≈“—“¬”ﬁŸ»… ¿–√”Ã≈Õ“
                   REmin=Xfun0XZ
			       ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
                   IparametrDeterEnergy=2 
				ENDIF 
				!œ–Œ¬≈–ﬂ≈Ã –¿¬Õ¿ Õ”Àﬁ ¬“Œ–¿ﬂ œ–Œ»«¬ŒƒÕ¿ﬂ  œ–» ›“ŒÃ –¿—◊≈“ Œ—“¿Õ¿¬À»¬¿≈“—ﬂ
				IF(DABS((Rfun2XZ-2.D0*Rfun0XZ+Rfun1XZ)/RHS**2).LT.10.D0**(-10)) THEN
                   ! Ã»Õ»Ã¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ ‘”Õ ÷»»
		           RfunMIN=Rfun0XZ
		           ! —ŒŒ“¬≈“—“¬”ﬁŸ»… ¿–√”Ã≈Õ“
                   REmin=Xfun0XZ
			       ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
                   IparametrDeterEnergy=2 
				ENDIF

				! ÕŒ¬Œ≈ œ–»¡À»∆≈Õ»≈
				IF(IparametrDeterEnergy.EQ.1) THEN
				   RX0=Xfun0XZ-RHS*(Rfun2XZ-Rfun1XZ)*0.5D0/(Rfun2XZ-2.D0*Rfun0XZ+Rfun1XZ)
                   RX1=RX0-RHS
			       RX2=RX0+RHS
			    ENDIF
				
		   ENDIF
	  ENDIF
   ENDDO

 

   return
 end subroutine MinValueNormEnergyFunction

!! SUBPROGRAMME DETERMINES THE MINIMUM VALUE OF NORM IN THE ENERGY INTERVAL
†!! NMO-NUMBER OF MOLECULAR ORBITALS
†!! Npoint-NUMBER OF POINTS
†!! IndexM-SIZE OF MASSIVE
†!! Kpoint-NUMBER OF POINT OF SOLVING SOLUTIONS
†!! NumeroMin-MINIMUM HARMONIC NUMBER
†!! H-STEP
†!! Rcof-EQUITY RATIO H * H / 12
†!! Pz (NumbreGarmMO (NMO), NumbreGarmMO (NMO), Npoint) - VALUE MAP of the P (ro) -particle of the log function P entering the equation Y '' = P * Y + Q-LOCAL POTENTIAL
†!! RO1X (Npoint) - MASSIVE VALUES OF THE FIRST DERIVATIVE ON THE NEW VARIABLE
†!! A (Isize, Isize, Npoint) -MASSIVE FOR CALCULATING FUNCTION PARAMETERS
†!! B (Isize, Isize, Npoint) -MASSIVE FOR CALCULATING FUNCTION PARAMETERS
†!! AA (Isize, Isize, Npoint) -MASSIVE FOR CALCULATING THE PARAMETERS OF THE PROLONG WITH ADDED ESSENTIAL SINGLE-ELECTRONIC ENERGY
†!! BB (Isize, Isize, Npoint) -MASSIVE FOR CALCULATING THE PARAMETERS OF THE PROLONG WITH ADDED ESSENTIAL SINGLE-ELECTRONIC ENERGY
†!! FX (IndexM, Npoint) -MASSIVE F
†!! Vout (IndexM, IndexM, Npoint) -MASSIVE OF FREQUENCY ON THE DIRECTION OF "OUTSIDE"
†!! Uout (IndexM, Npoint) -MASSIVE OF FREQUENCY ON THE DIRECTION OF "OUTSIDE"
†!! Vin (IndexM, IndexM, Npoint) -MASSIVE OF FIRING ON THE DIRECTION "INSIDE"
†!! Uin (IndexM, Npoint) -MASSIVE OF FIRING ON THE DIRECTION "INSIDE"
†!! VNout, UNout, VNin, UNIN, AZ, BZ, FZ, DZ, E, AX, BX, CX, IXM-AUXILIARY MASSIVE FOR CALCULATION
†!! FunMO-IN THIS CASE AUXILIARY MASSIVE
†!! NumeroMaxLimid-MAXIMUM NUMBER OF HARMONIC MOLECULAR ORBITALS
†!! NumbreLigand (NumbreMO) -MASSIVE NUMBER OF LIGANDES WHICH FUNCTIONS DESCRIBE HIGHER HARMONICS OF THIS MOLECULAR ORBITAL
†!! NLigands (NumbreMO, NumbreLigand (NumbreMO)) - MASSIVE OF LIGAND NUMBERS FUNCTIONS WHICH DESCRIBE HIGHER HARMONICS OF THIS MOLECULAR ORBITAL
†!! NFunLigands (NumbreMO, NumbreLigand (NumbreMO)) - A MASSIVE OF THE NUMBER OF FUNCTIONS OF EACH LIGAND DESCRIBING HIGHER HARMONICS OF THIS MOLECULAR ORBITAL
†!! NumbreFunctionLig (NumbreMO, NumbreLigand (NumbreMO), NFunLigands (NumbreMO, NumbreLigand (NumbreMO)))) - MASSIVE OF NUMBERS OF LIGAND FUNCTIONS THAT COMPLY WITH THIS MOLECULAR ORBITAL
†!! RfunLigands (Nnuclei, NumbreFunctionLig, NumbreGarmLigand, Npoint + 2) -MASSIVE OF VALUES OF LIGAND FUNCTIONS
†!! AlfaCoffMO (NumbreMO, NumbreLigand, NumbreFunLigand) -MASSIVE OF COEFFICIENTS WITH WHICH LIGANDA FUNCTIONS COME INTO THE STRUCTURE OF MOLECULAR ORBITAL
†!! ExfMin, ExfMax-Energetic interval in which the minimum is searched. The minimum is in the vicinity of ExfMin
†!! REmin-Energy corresponding to a minimum
†!! RfunMIN-Value of the norm
 subroutine  MinValueNormEnergyFunctionD(NMO,Npoint,IndexM,NumeroMin,NumeroMax,Kpoint,NumeroMaxLimid,Rcof,H,Uout,Uin,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,AlfaCoffMO,RfunLigands,RO1X,FunMO,Pz,IXM,UNout,UNin,Vout,Vin,AX,BX,CX,E,AZ,FZ,BZ,FX,VNout,VNin,DZ,A,B,AA,BB,ExfMin,ExfMax,REmin,RfunMIN)
   implicit none
   integer::NMO,Npoint,IndexM,NumeroMin,NumeroMax,Kpoint,NumeroMaxLimid
   real(8)::Rcof,ExfMin,ExfMax,H,RfunMIN,REmin
   integer,dimension(:)::NumbreLigand
   integer,dimension(:,:)::IXM,NLigands,NFunLigands
   integer,dimension(:,:,:)::NumbreFunctionLig
   real(8),dimension(:)::RO1X,UNout,UNin,AX,BX,CX
   real(8),dimension(:,:)::E,AZ,FZ,BZ,FX,Uout,Uin,VNout,VNin,DZ,FunMO
   real(8),dimension(:,:,:)::Pz,A,B,AA,BB,Vout,Vin,AlfaCoffMO
   real(8),dimension(:,:,:,:)::RfunLigands
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   integer::NEpsIter,IparametrDeterEnergy 
   real(8)::RHS,RX0,RX1,RX2,Rfun0XZ,RnormX0,Xfun0XZ,Rfun1XZ,RnormX1,Xfun1XZ,Rfun2XZ,RnormX2,Xfun2XZ 
   
   ! Õ¿◊¿À‹Õ€… ÿ¿√
   RHS=(ExfMax-ExfMin)/100.D0
   ! Õ¿◊¿À‹Õ€≈ “Œ◊ »
   RX0=ExfMin  
   ! ¡Œ Œ¬€≈ “Œ◊ »
   RX1=RX0-RHS
   RX2=RX0+RHS
   NEpsIter=0
   ! œ¿–¿Ã≈“– ¬€’Œƒ¿ »« ÷» À¿ 
   IparametrDeterEnergy=1 
   DO WHILE(IparametrDeterEnergy.EQ.1)
      NEpsIter=NEpsIter+1
      ! Õ¿’Œƒ»Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ ƒÀﬂ «Õ¿◊≈Õ»ﬂ ›Õ≈–√»» RX0
	  ! Œœ–≈ƒ≈Àﬂ≈Ã ÕŒÃ≈– “Œ◊ » —ÿ»¬ » –≈ÿ≈Õ»… OUT AND IN
	  call PointIntersection(Npoint,NumeroMin,RX0,Pz,RO1X,Kpoint) 

	  ! œŒƒœ–Œ√–¿ÃÃ¿ ‘Œ–Ã»–”≈“ Ã¿——»¬€ ƒÀﬂ –¿—◊≈“¬¿ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ »
	  call FormMassivAABB(Npoint,IndexM,Rcof,RX0,A,B,AA,BB,RO1X,E,AZ,FZ,BZ)
	 
      ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » ƒÀﬂ Õ≈ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€
      call CalculationParameterProgonky(2,IndexM,Kpoint,Npoint,AA,BB,FX,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,AZ,BZ,FZ,DZ,E,AX,BX)
                  
      ! Œœ–≈ƒ≈Àﬂ≈Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ —ŒŒ“¬≈“—“¬”ﬁŸ≈≈ ƒ¿ÕÕŒÃ” «Õ¿◊≈Õ»ﬁ ›Õ≈–√»» RX0
      call CalculationNormFunE(RnormX0,Kpoint,Npoint,IndexM,NumeroMin,NumeroMax,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,AZ,BZ,E,AX,BX,CX,IXM,FunMO,RO1X,H,NMO,NumeroMaxLimid,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,RfunLigands,AlfaCoffMO)    
        
	  ! Õ¿’Œƒ»Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ ƒÀﬂ «Õ¿◊≈Õ»ﬂ ›Õ≈–√»» RX1
	  ! Œœ–≈ƒ≈Àﬂ≈Ã ÕŒÃ≈– “Œ◊ » —ÿ»¬ » –≈ÿ≈Õ»… OUT AND IN
	  call PointIntersection(Npoint,NumeroMin,RX1,Pz,RO1X,Kpoint)
	  
	  ! œŒƒœ–Œ√–¿ÃÃ¿ ‘Œ–Ã»–”≈“ Ã¿——»¬€ ƒÀﬂ –¿—◊≈“¬¿ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ »
	  call FormMassivAABB(Npoint,IndexM,Rcof,RX1,A,B,AA,BB,RO1X,E,AZ,FZ,BZ)
	  
	  ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » ƒÀﬂ Õ≈ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€
      call CalculationParameterProgonky(2,IndexM,Kpoint,Npoint,AA,BB,FX,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,AZ,BZ,FZ,DZ,E,AX,BX)
            
      ! Œœ–≈ƒ≈Àﬂ≈Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ —ŒŒ“¬≈“—“¬”ﬁŸ≈≈ ƒ¿ÕÕŒÃ” «Õ¿◊≈Õ»ﬁ ›Õ≈–√»» RX0
      call CalculationNormFunE(RnormX1,Kpoint,Npoint,IndexM,NumeroMin,NumeroMax,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,AZ,BZ,E,AX,BX,CX,IXM,FunMO,RO1X,H,NMO,NumeroMaxLimid,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,RfunLigands,AlfaCoffMO)    
            
      ! Õ¿’Œƒ»Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ ƒÀﬂ «Õ¿◊≈Õ»ﬂ ›Õ≈–√»» RX2
	  ! Œœ–≈ƒ≈Àﬂ≈Ã ÕŒÃ≈– “Œ◊ » —ÿ»¬ » –≈ÿ≈Õ»… OUT AND IN
	  call PointIntersection(Npoint,NumeroMin,RX2,Pz,RO1X,Kpoint)
	  
	  ! œŒƒœ–Œ√–¿ÃÃ¿ ‘Œ–Ã»–”≈“ Ã¿——»¬€ ƒÀﬂ –¿—◊≈“¬¿ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ »
	  call FormMassivAABB(Npoint,IndexM,Rcof,RX2,A,B,AA,BB,RO1X,E,AZ,FZ,BZ)
	 
      ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » ƒÀﬂ Õ≈ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€
      call CalculationParameterProgonky(2,IndexM,Kpoint,Npoint,AA,BB,FX,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,AZ,BZ,FZ,DZ,E,AX,BX)
             
      ! Œœ–≈ƒ≈Àﬂ≈Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ —ŒŒ“¬≈“—“¬”ﬁŸ≈≈ ƒ¿ÕÕŒÃ” «Õ¿◊≈Õ»ﬁ ›Õ≈–√»» RX0
      call CalculationNormFunE(RnormX2,Kpoint,Npoint,IndexM,NumeroMin,NumeroMax,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,AZ,BZ,E,AX,BX,CX,IXM,FunMO,RO1X,H,NMO,NumeroMaxLimid,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,RfunLigands,AlfaCoffMO)    
     
	  
	  ! «¿œ»—€¬¿≈Ã «Õ¿◊≈Õ»≈  
      IF(NEpsIter.EQ.1) THEN
           ! œ≈–¬¿ﬂ »“≈–¿÷»ﬂ 
           Rfun0XZ=RnormX0
	       Xfun0XZ=RX0
           Rfun1XZ=RnormX1
           Xfun1XZ=RX1
		   Rfun2XZ=RnormX2
           Xfun2XZ=RX2 
		   RX0=Xfun0XZ-RHS*(Rfun2XZ-Rfun1XZ)*0.5D0/(Rfun2XZ-2.D0*Rfun0XZ+Rfun1XZ)
           RX1=RX0-RHS
		   RX2=RX0+RHS
		 ELSE
           
		   WRITE(17,*) NEpsIter,RX0,RnormX0          
		   ! œ–Œ¬≈–ﬂ≈Ã Œƒ»Õ¿ Œ¬€≈ «Õ¿◊≈Õ»ﬂ ‘”Õ ÷»» Ã€ œŒÀ”◊¿≈Ã
		   ! —À≈ƒŒ¬¿“≈À‹Õ¿ﬂ œ≈–¬¿ﬂ œ–Œ»«¬ŒƒÕ¿ﬂ –¿¬Õ¿ Õ”Àﬁ	 
           IF(RnormX0.EQ.Rfun0XZ) THEN
              ! Ã»Õ»Ã¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ ‘”Õ ÷»»
		      RfunMIN=RnormX0 
		      ! —ŒŒ“¬≈“—“¬”ﬁŸ»… ¿–√”Ã≈Õ“
              REmin=RX0
			  ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
              IparametrDeterEnergy=2 
           ENDIF 

		
		   ! œ–Œ¬≈–ﬂ≈Ã œŒÀ”◊≈ÕÕŒ≈ ÕŒ¬Œ≈ œ–»¡À»∆≈Õ»≈ Ã≈Õ‹ÿ≈ œ–≈ƒ≈ƒ”Ÿ≈√Œ »À» Õ≈“
		   IF(RnormX0.LT.Rfun0XZ) THEN
                ! Ã»Õ»Ã¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ ‘”Õ ÷»»
		        RfunMIN=RnormX0 
		        ! —ŒŒ“¬≈“—“¬”ﬁŸ»… ¿–√”Ã≈Õ“
                REmin=RX0
              
			    ! œ–Œ¬≈–ﬂ≈Ã ”—ÀŒ¬»≈ ¬€’Œƒ¿ (œ–Œ¬≈–ﬂ≈Ã –¿¬≈Õ—“¬Œ Õ”Àﬁ œ≈–¬Œ… œ–Œ«¬ŒƒÕŒ…)
			    IF(DABS((RfunMIN-Rfun0XZ)/(REmin-Xfun0XZ)).LT.10.D0**(-10)) THEN
			       ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
                   IparametrDeterEnergy=2 
			    ENDIF   
              
			    ! «¿œ»—€¬¿≈Ã œ–≈ƒ€ƒ”Ÿ≈≈ «Õ¿◊≈Õ»≈
			    Rfun0XZ=RnormX0
			    Xfun0XZ=RX0
                Rfun1XZ=RnormX1
                Xfun1XZ=RX1
			    Rfun2XZ=RnormX2
                Xfun2XZ=RX2 

                ! œ–Œ¬≈–ﬂ≈Ã –¿¬Õ¿ Õ”Àﬁ œ≈–¬¿ﬂ œ–Œ»«¬ŒƒÕ¿ﬂ »À» Õ≈“ 
                IF(Rfun2XZ.EQ.Rfun1XZ) THEN
				     ! Ã»Õ»Ã¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ ‘”Õ ÷»»
		             RfunMIN=RnormX0 
		             ! —ŒŒ“¬≈“—“¬”ﬁŸ»… ¿–√”Ã≈Õ“
                     REmin=RX0
			         ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
                     IparametrDeterEnergy=2 
				ENDIF 
				!œ–Œ¬≈–ﬂ≈Ã –¿¬Õ¿ Õ”Àﬁ ¬“Œ–¿ﬂ œ–Œ»«¬ŒƒÕ¿ﬂ  œ–» ›“ŒÃ –¿—◊≈“ Œ—“¿Õ¿¬À»¬¿≈“—ﬂ
				IF(DABS((Rfun2XZ-2.D0*Rfun0XZ+Rfun1XZ)/RHS**2).LT.10.D0**(-10)) THEN
                   ! Ã»Õ»Ã¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ ‘”Õ ÷»»
		           RfunMIN=RnormX0 
		           ! —ŒŒ“¬≈“—“¬”ﬁŸ»… ¿–√”Ã≈Õ“
                   REmin=RX0
			       ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
                   IparametrDeterEnergy=2 
				ENDIF

			
                ! ÕŒ¬Œ≈ œ–»¡À»∆≈Õ»≈
				IF(IparametrDeterEnergy.EQ.1) THEN
			       RX0=Xfun0XZ-RHS*(Rfun2XZ-Rfun1XZ)*0.5D0/(Rfun2XZ-2.D0*Rfun0XZ+Rfun1XZ)
                   RX1=RX0-RHS
			       RX2=RX0+RHS
			    ENDIF
			
			  ELSE
				! «Õ¿◊≈Õ»≈ ‘”Õ ÷»» –¿—“≈“
				! Ã≈Õﬂ≈Ã ÿ¿√
				RHS=-RHS*0.5D0
			

				! œ–Œ¬≈–ﬂ≈Ã –¿¬Õ¿ Õ”Àﬁ œ≈–¬¿ﬂ œ–Œ»«¬ŒƒÕ¿ﬂ »À» Õ≈“ 
                IF(Rfun2XZ.EQ.Rfun1XZ) THEN
				   ! Ã»Õ»Ã¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ ‘”Õ ÷»»
		           RfunMIN=Rfun0XZ
		           ! —ŒŒ“¬≈“—“¬”ﬁŸ»… ¿–√”Ã≈Õ“
                   REmin=Xfun0XZ
			       ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
                   IparametrDeterEnergy=2 
				ENDIF 
				!œ–Œ¬≈–ﬂ≈Ã –¿¬Õ¿ Õ”Àﬁ ¬“Œ–¿ﬂ œ–Œ»«¬ŒƒÕ¿ﬂ  œ–» ›“ŒÃ –¿—◊≈“ Œ—“¿Õ¿¬À»¬¿≈“—ﬂ
				IF(DABS((Rfun2XZ-2.D0*Rfun0XZ+Rfun1XZ)/RHS**2).LT.10.D0**(-10)) THEN
                   ! Ã»Õ»Ã¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ ‘”Õ ÷»»
		           RfunMIN=Rfun0XZ
		           ! —ŒŒ“¬≈“—“¬”ﬁŸ»… ¿–√”Ã≈Õ“
                   REmin=Xfun0XZ
			       ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
                   IparametrDeterEnergy=2 
				ENDIF

				! ÕŒ¬Œ≈ œ–»¡À»∆≈Õ»≈
				IF(IparametrDeterEnergy.EQ.1) THEN
				   RX0=Xfun0XZ-RHS*(Rfun2XZ-Rfun1XZ)*0.5D0/(Rfun2XZ-2.D0*Rfun0XZ+Rfun1XZ)
                   RX1=RX0-RHS
			       RX2=RX0+RHS
			    ENDIF
				
		   ENDIF
	  ENDIF
   ENDDO

 

   return
 end subroutine MinValueNormEnergyFunctionD


 !! SUBPROGRAMME DETERMINES THE MINIMUM VALUE OF NORM IN THE ENERGY INTERVAL
†!! NMO-NUMBER OF MOLECULAR ORBITALS
†!! Npoint-NUMBER OF POINTS
†!! IndexM-SIZE OF MASSIVE
†!! Kpoint-NUMBER OF POINT OF SOLVING SOLUTIONS
†!! NumeroMin-MINIMUM HARMONIC NUMBER
†!! H-STEP
†!! Rcof-EQUITY RATIO H * H / 12
†!! Pz (NumbreGarmMO (NMO), NumbreGarmMO (NMO), Npoint) - VALUE MAP of the P (ro) -particle of the log function P entering the equation Y '' = P * Y + Q-LOCAL POTENTIAL
†!! RO1X (Npoint) - MASSIVE VALUES OF THE FIRST DERIVATIVE ON THE NEW VARIABLE
†!! A (Isize, Isize, Npoint) -MASSIVE FOR CALCULATING FUNCTION PARAMETERS
†!! B (Isize, Isize, Npoint) -MASSIVE FOR CALCULATING FUNCTION PARAMETERS
†!! AA (Isize, Isize, Npoint) -MASSIVE FOR CALCULATING THE PARAMETERS OF THE PROLONG WITH ADDED ESSENTIAL SINGLE-ELECTRONIC ENERGY
†!! BB (Isize, Isize, Npoint) -MASSIVE FOR CALCULATING THE PARAMETERS OF THE PROLONG WITH ADDED ESSENTIAL SINGLE-ELECTRONIC ENERGY
†!! FX (IndexM, Npoint) -MASSIVE F
†!! Vout (IndexM, IndexM, Npoint) -MASSIVE OF FREQUENCY ON THE DIRECTION OF "OUTSIDE"
†!! Uout (IndexM, Npoint) -MASSIVE OF FREQUENCY ON THE DIRECTION OF "OUTSIDE"
†!! Vin (IndexM, IndexM, Npoint) -MASSIVE OF FIRING ON THE DIRECTION "INSIDE"
†!! Uin (IndexM, Npoint) -MASSIVE OF FIRING ON THE DIRECTION "INSIDE"
†!! VNout, UNout, VNin, UNIN, AZ, BZ, FZ, DZ, E, AX, BX, CX, IXM-AUXILIARY MASSIVE FOR CALCULATION
†!! FunMO-IN THIS CASE AUXILIARY MASSIVE
†!! NumeroMaxLimid-MAXIMUM NUMBER OF HARMONIC MOLECULAR ORBITALS
†!! NumbreLigand (NumbreMO) -MASSIVE NUMBER OF LIGANDES WHICH FUNCTIONS DESCRIBE HIGHER HARMONICS OF THIS MOLECULAR ORBITAL
†!! NLigands (NumbreMO, NumbreLigand (NumbreMO)) - MASSIVE OF LIGAND NUMBERS FUNCTIONS WHICH DESCRIBE HIGHER HARMONICS OF THIS MOLECULAR ORBITAL
†!! NFunLigands (NumbreMO, NumbreLigand (NumbreMO)) - A MASSIVE OF THE NUMBER OF FUNCTIONS OF EACH LIGAND DESCRIBING HIGHER HARMONICS OF THIS MOLECULAR ORBITAL
†!! NumbreFunctionLig (NumbreMO, NumbreLigand (NumbreMO), NFunLigands (NumbreMO, NumbreLigand (NumbreMO)))) - MASSIVE OF NUMBERS OF LIGAND FUNCTIONS THAT COMPLY WITH THIS MOLECULAR ORBITAL
†!! RfunLigands (Nnuclei, NumbreFunctionLig, NumbreGarmLigand, Npoint + 2) -MASSIVE OF VALUES OF LIGAND FUNCTIONS
†!! AlfaCoffMO (NumbreMO, NumbreLigand, NumbreFunLigand) -MASSIVE OF COEFFICIENTS WITH WHICH LIGANDA FUNCTIONS COME INTO THE STRUCTURE OF MOLECULAR ORBITAL
†!! ExfMin, ExfMax-Energetic interval in which the minimum is searched. The minimum is in the vicinity of ExfMin
†!! REmin-Energy corresponding to a minimum
†!! RfunMIN-Value of the norm
†!! IndexX-INDEX INDICATES A BORDER OF A MINIMUM BORDER OR NOT
†!! IndexX = 0-NOT INSTALLED
†!! IndexX = 1-INSTALLED
†!! EminIndex-LEFT BORDER OF THE MINIMUM FIELD
†!! EmaxIndex-MINIMUM
†!! RFUNmaxIndex-The value of the norm in the minimum
†!! RELEFT-LEFT BORDER OF "NEW" MINIMUM
†!! REright-RIGHT BORDER OF "NEW" MINIMUM
†!! IndexMinDifini-INDEX INDICATOR DETERMINED BY NEW MINIMUM OR ORDERED BY OLD MINIMUM
†!! IndexMinDifini = 0-NEW MINIMUM DEFINED
†!! IndexMinDifini = 1-DEFINED AGAIN "OLD" MINIMUM
†!! IndexHDXX-INDEX INDICATOR DETERMINED THE INITIAL STEP TO DETERMINE BORDERS OF MINIMUM
†!! HXXZXL-STEP FOR LEFT ARE FROM MINIMUM
†!! HXXZXR-STEP FOR THE RIGHT OF THE RIGHT FROM THE MINIMUM
 subroutine  MinValueNormEnergyFunctionD2(NMO,Npoint,IndexM,NumeroMin,NumeroMax,Kpoint,NumeroMaxLimid,Rcof,H,Uout,Uin,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,AlfaCoffMO,RfunLigands,RO1X,FunMO,Pz,IXM,UNout,UNin,Vout,Vin,AX,BX,CX,E,AZ,FZ,BZ,FX,VNout,VNin,DZ,A,B,AA,BB,HNN,ExfNN,REmin,RfunMIN,IndexX,EminIndex,EmaxIndex,RFUNmaxIndex,REleft,REright,IndexMinDifini,IndexHDXX,HXXZXL,HXXZXR)
   implicit none
   integer::NMO,Npoint,IndexM,NumeroMin,NumeroMax,Kpoint,NumeroMaxLimid,IndexX,IndexMinDifini,IndexHDXX
   real(8)::Rcof,HNN,ExfNN,H,RfunMIN,REmin,EminIndex,EmaxIndex,RFUNmaxIndex,REleft,REright,HXXZXL,HXXZXR
   integer,dimension(:)::NumbreLigand
   integer,dimension(:,:)::IXM,NLigands,NFunLigands
   integer,dimension(:,:,:)::NumbreFunctionLig
   real(8),dimension(:)::RO1X,UNout,UNin,AX,BX,CX
   real(8),dimension(:,:)::E,AZ,FZ,BZ,FX,Uout,Uin,VNout,VNin,DZ,FunMO
   real(8),dimension(:,:,:)::Pz,A,B,AA,BB,Vout,Vin,AlfaCoffMO
   real(8),dimension(:,:,:,:)::RfunLigands
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   integer::NEpsIter,IparametrDeterEnergy,IndexRESX,IndexSUMZKX,IndexIIUMNX,INDEXEXITRFX,INDEXZZSFAX,IndexCorGRANF,IndexPovNorma,IndexNORMSDS 
   real(8)::RHS,RX0,RX1,RX2,Rfun0XZ,RnormX0,Xfun0XZ,Rfun1XZ,RnormX1,Xfun1XZ,Rfun2XZ,RnormX2,Xfun2XZ,EXDmin,EXDmax
   real(8)::RXDF,RfunLR,RcoffSD,HenergyX,E1XX,D1XX,RcofXZSDX,DetxfNN 
   real(8),dimension(10)::DetMX,ExfMX,DetMAX

   ! «¿Õ”Àﬂ≈Ã œ≈–≈ƒ –¿—◊≈“ŒÃ
   IndexMinDifini=0
   REleft=0.D0
   REright=0.D0
   
   ! Õ¿◊¿À‹Õ€≈ “Œ◊ »
   EXDmin=ExfNN*(1.D0-HNN)
   EXDmax=ExfNN*(1.D0+HNN)

   ! Õ¿◊¿À‹Õ€… ÿ¿√
   RHS=DABS(EXDmax-EXDmin)*0.5D0
   ! Õ¿◊¿À‹Õ€≈ “Œ◊ »
   RX0=ExfNN 
   ! ¡Œ Œ¬€≈ “Œ◊ »
   RX1=RX0-RHS
   RX2=RX0+RHS
   NEpsIter=0
   ! œ¿–¿Ã≈“– ¬€’Œƒ¿ »« ÷» À¿ 
   IparametrDeterEnergy=1 
   DO WHILE(IparametrDeterEnergy.EQ.1)
      ! »Õƒ≈ — “»œ¿ —Ã≈Ÿ≈Õ»ﬂ
	  IndexNORMSDS=0 
	  ! —◊≈“◊» 
      NEpsIter=NEpsIter+1
      ! Õ¿’Œƒ»Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ ƒÀﬂ «Õ¿◊≈Õ»ﬂ ›Õ≈–√»» RX0
	  ! Œœ–≈ƒ≈Àﬂ≈Ã ÕŒÃ≈– “Œ◊ » —ÿ»¬ » –≈ÿ≈Õ»… OUT AND IN
	  call PointIntersection(Npoint,NumeroMin,RX0,Pz,RO1X,Kpoint) 

	  ! œŒƒœ–Œ√–¿ÃÃ¿ ‘Œ–Ã»–”≈“ Ã¿——»¬€ ƒÀﬂ –¿—◊≈“¬¿ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ »
	  call FormMassivAABB(Npoint,IndexM,Rcof,RX0,A,B,AA,BB,RO1X,E,AZ,FZ,BZ)
	 
      ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » ƒÀﬂ Õ≈ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€
      call CalculationParameterProgonky(2,IndexM,Kpoint,Npoint,AA,BB,FX,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,AZ,BZ,FZ,DZ,E,AX,BX)
                  
      ! Œœ–≈ƒ≈Àﬂ≈Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ —ŒŒ“¬≈“—“¬”ﬁŸ≈≈ ƒ¿ÕÕŒÃ” «Õ¿◊≈Õ»ﬁ ›Õ≈–√»» RX0
      call CalculationNormFunE(RnormX0,Kpoint,Npoint,IndexM,NumeroMin,NumeroMax,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,AZ,BZ,E,AX,BX,CX,IXM,FunMO,RO1X,H,NMO,NumeroMaxLimid,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,RfunLigands,AlfaCoffMO)    
        
	  ! Õ¿’Œƒ»Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ ƒÀﬂ «Õ¿◊≈Õ»ﬂ ›Õ≈–√»» RX1
	  ! Œœ–≈ƒ≈Àﬂ≈Ã ÕŒÃ≈– “Œ◊ » —ÿ»¬ » –≈ÿ≈Õ»… OUT AND IN
	  call PointIntersection(Npoint,NumeroMin,RX1,Pz,RO1X,Kpoint)
	  
	  ! œŒƒœ–Œ√–¿ÃÃ¿ ‘Œ–Ã»–”≈“ Ã¿——»¬€ ƒÀﬂ –¿—◊≈“¬¿ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ »
	  call FormMassivAABB(Npoint,IndexM,Rcof,RX1,A,B,AA,BB,RO1X,E,AZ,FZ,BZ)
	  
	  ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » ƒÀﬂ Õ≈ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€
      call CalculationParameterProgonky(2,IndexM,Kpoint,Npoint,AA,BB,FX,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,AZ,BZ,FZ,DZ,E,AX,BX)
            
      ! Œœ–≈ƒ≈Àﬂ≈Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ —ŒŒ“¬≈“—“¬”ﬁŸ≈≈ ƒ¿ÕÕŒÃ” «Õ¿◊≈Õ»ﬁ ›Õ≈–√»» RX0
      call CalculationNormFunE(RnormX1,Kpoint,Npoint,IndexM,NumeroMin,NumeroMax,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,AZ,BZ,E,AX,BX,CX,IXM,FunMO,RO1X,H,NMO,NumeroMaxLimid,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,RfunLigands,AlfaCoffMO)    
            
      ! Õ¿’Œƒ»Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ ƒÀﬂ «Õ¿◊≈Õ»ﬂ ›Õ≈–√»» RX2
	  ! Œœ–≈ƒ≈Àﬂ≈Ã ÕŒÃ≈– “Œ◊ » —ÿ»¬ » –≈ÿ≈Õ»… OUT AND IN
	  call PointIntersection(Npoint,NumeroMin,RX2,Pz,RO1X,Kpoint)
	  
	  ! œŒƒœ–Œ√–¿ÃÃ¿ ‘Œ–Ã»–”≈“ Ã¿——»¬€ ƒÀﬂ –¿—◊≈“¬¿ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ »
	  call FormMassivAABB(Npoint,IndexM,Rcof,RX2,A,B,AA,BB,RO1X,E,AZ,FZ,BZ)
	 
      ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » ƒÀﬂ Õ≈ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€
      call CalculationParameterProgonky(2,IndexM,Kpoint,Npoint,AA,BB,FX,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,AZ,BZ,FZ,DZ,E,AX,BX)
             
      ! Œœ–≈ƒ≈Àﬂ≈Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ —ŒŒ“¬≈“—“¬”ﬁŸ≈≈ ƒ¿ÕÕŒÃ” «Õ¿◊≈Õ»ﬁ ›Õ≈–√»» RX0
      call CalculationNormFunE(RnormX2,Kpoint,Npoint,IndexM,NumeroMin,NumeroMax,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,AZ,BZ,E,AX,BX,CX,IXM,FunMO,RO1X,H,NMO,NumeroMaxLimid,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,RfunLigands,AlfaCoffMO)    
     
	  
	  ! «¿œ»—€¬¿≈Ã «Õ¿◊≈Õ»≈  
      IF(NEpsIter.EQ.1) THEN
           ! œ≈–¬¿ﬂ »“≈–¿÷»ﬂ 
           ! ”—“¿Õ¿¬À»¬¿≈Ã œŒ¬≈ƒ≈Õ»≈ ÕŒ–Ã€
		   IndexPovNorma=0
		   IF(RnormX1.GT.RnormX0.AND.RnormX0.GT.RnormX2) THEN
              IndexPovNorma=1
		   ENDIF
		   IF(RnormX2.GT.RnormX0.AND.RnormX0.GT.RnormX1) THEN
              IndexPovNorma=1
           ENDIF


           Rfun0XZ=RnormX0
	       Xfun0XZ=RX0
           Rfun1XZ=RnormX1
           Xfun1XZ=RX1
		   Rfun2XZ=RnormX2
           Xfun2XZ=RX2 
		   IF(IndexPovNorma.EQ.1) THEN
		       RX0=Xfun0XZ-RHS*(Rfun2XZ-Rfun1XZ)*0.5D0/(Rfun2XZ-2.D0*Rfun0XZ+Rfun1XZ)
              ELSE
			   RX0=Xfun0XZ-RHS*2.D0
		   ENDIF
		   RX1=RX0-RHS
		   RX2=RX0+RHS
		   ! «¿œ»—€¬¿≈Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ ƒÀﬂ ƒ¿À‹Õ≈…ÿ≈√Œ –¿—◊≈“¿
		   DetxfNN=RnormX0 
		 ELSE
           
		   ! œ–Œ¬≈–ﬂ≈Ã œŒœ¿ƒ¿≈“ ƒ¿ÕÕŒ≈ œ–»¡À»∆≈Õ»≈ œŒ ›Õ≈–√»» ¬ Œ¡À¿—“‹ ”∆≈ Õ¿…ƒ≈ÕÕŒ√Œ Ã»Õ»Ã”Ã¿ 
           IF(IndexX.EQ.1) THEN
              ! À≈¬¿ﬂ √–¿Õ»÷¿ Œ¡À¿—“» Œœ–≈ƒ≈À≈Õ¿
			  IF(RX0.GT.EminIndex.AND.RX0.LT.EmaxIndex) THEN
                 ! ›Õ≈–√»ﬂ œŒœ¿À¿ ¬ Œ¡À¿—“‹ œ–≈ƒ€ƒ”Ÿ≈√Œ Ã»Õ»Ã”Ã¿
                 ! Ã»Õ»Ã¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ ‘”Õ ÷»»
		         RfunMIN=RFUNmaxIndex
		         ! —ŒŒ“¬≈“—“¬”ﬁŸ»… ¿–√”Ã≈Õ“
                 REmin=EmaxIndex
				 ! œ¿–¿Ã≈“– ” ¿«€¬¿ﬁŸ»…, ◊“Œ ›Õ≈–√»ﬂ œŒœ¿À¿ ¬ Œ¡À¿—“‹ Œœ–≈ƒ≈À≈ÕÕŒ√Œ Ã»Õ»Ã”Ã¿
                 IndexMinDifini=1
				 ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
                 IparametrDeterEnergy=2 
				 WRITE(17,*) NEpsIter,REmin,RfunMIN
			  ENDIF
		   ENDIF
           
		   ! œ–Œ¬≈–ﬂ≈Ã Õ≈ Œ—”Ÿ≈—“¬À≈Õ ¬€’Œƒ 
		   IF(IparametrDeterEnergy.NE.2) THEN
		      WRITE(17,*) NEpsIter,RX0,RnormX0          
		      ! œ–Œ¬≈–ﬂ≈Ã Œƒ»Õ¿ Œ¬€≈ «Õ¿◊≈Õ»ﬂ ‘”Õ ÷»» Ã€ œŒÀ”◊¿≈Ã
		      ! —À≈ƒŒ¬¿“≈À‹Õ¿ﬂ œ≈–¬¿ﬂ œ–Œ»«¬ŒƒÕ¿ﬂ –¿¬Õ¿ Õ”Àﬁ	 
              IF(RnormX0.EQ.Rfun0XZ) THEN
			     ! œ–Œ¬≈–ﬂ≈Ã ÕŒÃ≈– »“≈–¿÷»»
				 IF(NEpsIter.EQ.2) THEN
                     IndexNORMSDS=1
					ELSE 
					 ! Ã»Õ»Ã¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ ‘”Õ ÷»»
		             RfunMIN=RnormX0 
		             ! —ŒŒ“¬≈“—“¬”ﬁŸ»… ¿–√”Ã≈Õ“
                     REmin=RX0
			         ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
                     IparametrDeterEnergy=2 
                 ENDIF
			  ENDIF 

		
		      ! œ–Œ¬≈–ﬂ≈Ã œŒÀ”◊≈ÕÕŒ≈ ÕŒ¬Œ≈ œ–»¡À»∆≈Õ»≈ Ã≈Õ‹ÿ≈ œ–≈ƒ≈ƒ”Ÿ≈√Œ »À» Õ≈“
		      IF(RnormX0.LT.Rfun0XZ) THEN
                  ! Ã»Õ»Ã¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ ‘”Õ ÷»»
		          RfunMIN=RnormX0 
		          ! —ŒŒ“¬≈“—“¬”ﬁŸ»… ¿–√”Ã≈Õ“
                  REmin=RX0
              
			      ! œ–Œ¬≈–ﬂ≈Ã ”—ÀŒ¬»≈ ¬€’Œƒ¿ (œ–Œ¬≈–ﬂ≈Ã –¿¬≈Õ—“¬Œ Õ”Àﬁ œ≈–¬Œ… œ–Œ«¬ŒƒÕŒ…)
			      IF(DABS((RfunMIN-Rfun0XZ)/(REmin-Xfun0XZ)).LT.10.D0**(-10)) THEN
				     ! œ–Œ¬≈–ﬂ≈Ã ÕŒÃ≈– »“≈–¿÷»»
				     IF(NEpsIter.EQ.2) THEN
                         IndexNORMSDS=1
					    ELSE 
			             ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
                         IparametrDeterEnergy=2 
			         ENDIF 
				  ENDIF   
              
			      ! «¿œ»—€¬¿≈Ã œ–≈ƒ€ƒ”Ÿ≈≈ «Õ¿◊≈Õ»≈
			      Rfun0XZ=RnormX0
			      Xfun0XZ=RX0
                  Rfun1XZ=RnormX1
                  Xfun1XZ=RX1
			      Rfun2XZ=RnormX2
                  Xfun2XZ=RX2 

                  ! œ–Œ¬≈–ﬂ≈Ã –¿¬Õ¿ Õ”Àﬁ œ≈–¬¿ﬂ œ–Œ»«¬ŒƒÕ¿ﬂ »À» Õ≈“ 
                  IF(Rfun2XZ.EQ.Rfun1XZ) THEN
				     ! œ–Œ¬≈–ﬂ≈Ã ÕŒÃ≈– »“≈–¿÷»»
				     IF(NEpsIter.EQ.2) THEN
                         IndexNORMSDS=1
					    ELSE 
				         ! Ã»Õ»Ã¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ ‘”Õ ÷»»
		                 RfunMIN=RnormX0 
		                 ! —ŒŒ“¬≈“—“¬”ﬁŸ»… ¿–√”Ã≈Õ“
                         REmin=RX0
			             ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
                         IparametrDeterEnergy=2 
				     ENDIF
				  ENDIF 
				  !œ–Œ¬≈–ﬂ≈Ã –¿¬Õ¿ Õ”Àﬁ ¬“Œ–¿ﬂ œ–Œ»«¬ŒƒÕ¿ﬂ  œ–» ›“ŒÃ –¿—◊≈“ Œ—“¿Õ¿¬À»¬¿≈“—ﬂ
				  IF(DABS((Rfun2XZ-2.D0*Rfun0XZ+Rfun1XZ)/RHS**2).LT.10.D0**(-10)) THEN
                     ! œ–Œ¬≈–ﬂ≈Ã ÕŒÃ≈– »“≈–¿÷»»
				     IF(NEpsIter.EQ.2) THEN
                         IndexNORMSDS=1
					    ELSE 
					     ! Ã»Õ»Ã¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ ‘”Õ ÷»»
		                 RfunMIN=RnormX0 
		                 ! —ŒŒ“¬≈“—“¬”ﬁŸ»… ¿–√”Ã≈Õ“
                         REmin=RX0
			             ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
                         IparametrDeterEnergy=2 
				     ENDIF
				  ENDIF

			
                  ! ÕŒ¬Œ≈ œ–»¡À»∆≈Õ»≈
				  IF(IparametrDeterEnergy.EQ.1) THEN
				     ! œ–Œ¬≈–ﬂ≈Ã »Õƒ≈ — “»œ¿ —Ã≈Ÿ≈Õ»ﬂ
					 IF(IndexNORMSDS.EQ.0) THEN
			             RX0=Xfun0XZ-RHS*(Rfun2XZ-Rfun1XZ)*0.5D0/(Rfun2XZ-2.D0*Rfun0XZ+Rfun1XZ)
                        ELSE
                         RX0=Xfun0XZ-RHS*2.D0
					 ENDIF
					 RX1=RX0-RHS
			         RX2=RX0+RHS
			      ENDIF
			
			    ELSE
				  ! «Õ¿◊≈Õ»≈ ‘”Õ ÷»» –¿—“≈“
				  ! Ã≈Õﬂ≈Ã ÿ¿√
				  RHS=-RHS*0.5D0
			

				  ! œ–Œ¬≈–ﬂ≈Ã –¿¬Õ¿ Õ”Àﬁ œ≈–¬¿ﬂ œ–Œ»«¬ŒƒÕ¿ﬂ »À» Õ≈“ 
                  IF(Rfun2XZ.EQ.Rfun1XZ) THEN
				     ! œ–Œ¬≈–ﬂ≈Ã ÕŒÃ≈– »“≈–¿÷»»
				     IF(NEpsIter.EQ.2) THEN
                         IndexNORMSDS=1
					    ELSE 
				         ! Ã»Õ»Ã¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ ‘”Õ ÷»»
		                 RfunMIN=Rfun0XZ
		                 ! —ŒŒ“¬≈“—“¬”ﬁŸ»… ¿–√”Ã≈Õ“
                         REmin=Xfun0XZ
			             ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
                         IparametrDeterEnergy=2 
				     ENDIF
				  ENDIF 
				  !œ–Œ¬≈–ﬂ≈Ã –¿¬Õ¿ Õ”Àﬁ ¬“Œ–¿ﬂ œ–Œ»«¬ŒƒÕ¿ﬂ  œ–» ›“ŒÃ –¿—◊≈“ Œ—“¿Õ¿¬À»¬¿≈“—ﬂ
				  IF(DABS((Rfun2XZ-2.D0*Rfun0XZ+Rfun1XZ)/RHS**2).LT.10.D0**(-10)) THEN
				     ! œ–Œ¬≈–ﬂ≈Ã ÕŒÃ≈– »“≈–¿÷»»
				     IF(NEpsIter.EQ.2) THEN
                         IndexNORMSDS=1
					    ELSE 
                         ! Ã»Õ»Ã¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ ‘”Õ ÷»»
		                 RfunMIN=Rfun0XZ
		                 ! —ŒŒ“¬≈“—“¬”ﬁŸ»… ¿–√”Ã≈Õ“
                         REmin=Xfun0XZ
			             ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
                         IparametrDeterEnergy=2 
				     ENDIF 
				  ENDIF

				  ! ÕŒ¬Œ≈ œ–»¡À»∆≈Õ»≈
				  IF(IparametrDeterEnergy.EQ.1) THEN
				     ! œ–Œ¬≈–ﬂ≈Ã »Õƒ≈ — “»œ¿ —Ã≈Ÿ≈Õ»ﬂ
					 IF(IndexNORMSDS.EQ.0) THEN
				         RX0=Xfun0XZ-RHS*(Rfun2XZ-Rfun1XZ)*0.5D0/(Rfun2XZ-2.D0*Rfun0XZ+Rfun1XZ)
                        ELSE
                         RX0=Xfun0XZ-RHS*4.D0
					 ENDIF 
					 RX1=RX0-RHS
			         RX2=RX0+RHS
			      ENDIF
			  ENDIF
           ENDIF
	  ENDIF
   ENDDO

   ! œ–Œ¬≈–ﬂ≈Ã Œœ–≈ƒ≈À≈Õ ÕŒ¬€… Ã»Õ»Ã”Ã »À» Œœ–≈ƒ≈À≈Õ »«¬≈—“Õ€… Ã»Õ»Ã”Ã
   IF(IndexMinDifini.EQ.0) THEN
	  ! ”—“¿Õ¿¬À»¬¿≈Ã  ¿ ”ﬁ √–¿Õ»÷” Õ”∆ÕŒ Œœ–≈ƒ≈À»“‹
	  IF(REmin.GT.ExfNN) THEN
           ! Õ”∆ÕŒ Œœ–≈ƒ≈À»“‹ œ–¿¬”ﬁ √–¿Õ»÷”
		   ! À≈¬¿ﬂ √–¿Õ»÷¿
           REleft=ExfNN 
		   ! œ¿–¿Ã≈“– —ƒ¬»√¿ 
		   RcoffSD=1.D0
		 ELSE
           ! Õ”∆ÕŒ Œœ–≈ƒ≈À»“‹ À≈¬”ﬁ √–¿Õ»÷”
		   ! œ–¿¬¿ﬂ √–¿Õ»÷¿
           REright=ExfNN
		   ! œ¿–¿Ã≈“– —ƒ¬»√¿
           RcoffSD=-1.D0
	  ENDIF

	  ! ”—“¿Õ¿¬À»¬¿≈Ã  –»“≈–»… ƒÀﬂ Œœ–≈ƒ≈À≈Õ»ﬂ À≈¬Œ… √–¿Õ»÷€ Ã»Õ»Ã”Ã¿
      IF(0.2D0*RfunMIN.LT.0.5D0) THEN
           RXDF=1.2D0*RfunMIN
         ELSE
 	       RXDF=RfunMIN+0.2D0
      ENDIF

	  ! Œœ–≈ƒ≈Àﬂ≈Ã “” √–¿Õ»÷”  Œ“Œ–”ﬁ Õ≈Œœ–≈ƒ≈À»À»
      ! Œœ–≈ƒ≈Àﬂ≈Ã À≈¬”ﬁ √–¿Õ»÷” Ã»Õ»Ã”Ã¿
      WRITE(17,*)
	  IF(RcoffSD.LT.0.D0) THEN
         WRITE(17,*) 'Defeni grany left min'
      ENDIF
	  IF(RcoffSD.GT.0.D0) THEN
         WRITE(17,*) 'Defeni grany right min' 
	  ENDIF

      ! «¿Õ”Àﬂ≈Ã œ≈–≈ƒ –¿—◊≈“ŒÃ
      DetMX=0.D0
      DetMAX=0.D0
      ExfMX=0.D0
      ! Œœ–≈ƒ≈Àﬂ≈Ã Õ¿◊¿À‹Õ€… ÿ¿√
	  IF(IndexHDXX.EQ.0) THEN
          HenergyX=0.02D0*DABS(ExfNN-REmin)
		  ! ‘» —»–”≈Ã Œ√–¿Õ»◊≈Õ»≈ ƒÀﬂ ÿ¿√¿
		  IF(HenergyX.GT.0.1D0) THEN
             HenergyX=0.1D0  
		  ENDIF
         ELSE
          IF(RcoffSD.LT.0.D0) THEN
              HenergyX=0.1D0*HXXZXL
			 ELSE
			  HenergyX=0.1D0*HXXZXR
		  ENDIF
	  ENDIF
	  ! «¿œ»—€¬¿≈Ã œ≈–¬Œ≈ «Õ¿◊≈Õ»≈
      ExfMX(7)=REmin
      DetMX(7)=RfunMIN
	  ! Œœ–≈ƒ≈Àﬂ≈Ã Õ¿◊¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ ƒÀﬂ ›Õ≈–√»» 
      E1XX=REmin*(1+RcoffSD*HenergyX) 
      IndexSUMZKX=0	
      ! »Õƒ≈ — ” ¿«€¬¿≈“ — ŒÀ‹ Œ –¿« Œ—”Ÿ≈—“¬ÀﬂÀŒ—‹ ”Ã≈Õ‹ÿ≈Õ»≈ ¬ 10 –¿« ÿ¿√¿
      IndexIIUMNX=0	         			  
      ! œ¿–¿Ã≈“– ¬€’Œƒ¿ »« ÷» À¿ 
      IparametrDeterEnergy=1 
      ! œ¿–¿Ã≈“– ¬€’Œƒ¿ »« ÷» À¿
      INDEXEXITRFX=0
      INDEXZZSFAX=0
      RcofXZSDX=1.D0
      DO WHILE(IparametrDeterEnergy.EQ.1) 
         ! »Õƒ≈ — ÷» À¿
	     IndexSUMZKX=IndexSUMZKX+1
	     ! Õ¿’Œƒ»Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ ƒÀﬂ «Õ¿◊≈Õ»ﬂ ›Õ≈–√»» E1XX
	     call CalculationNormFunctionEnergyXF(E1XX,D1XX,NMO,NumeroMaxLimid,Npoint,IndexM,Kpoint,NumeroMin,NumeroMax,Rcof,H,NumbreLigand,IXM,NLigands,NFunLigands,NumbreFunctionLig,RO1X,UNout,UNin,AX,BX,CX,FX,Uout,Uin,VNout,VNin,AZ,BZ,FZ,DZ,E,FunMO,Pz,A,B,AA,BB,Vout,Vin,AlfaCoffMO,RfunLigands)
	     WRITE(17,*) E1XX,D1XX,HenergyX
	     ! «¿œ»—€¬¿≈Ã –≈«”À‹“¿“€ –¿—◊≈“¿
	     ExfMX(1)=ExfMX(2)
         DetMX(1)=DetMX(2)
	     ExfMX(2)=ExfMX(3)
         DetMX(2)=DetMX(3)
	     ExfMX(3)=ExfMX(4)
         DetMX(3)=DetMX(4)
	     ExfMX(4)=ExfMX(5)
         DetMX(4)=DetMX(5)
         ExfMX(5)=ExfMX(6)
         DetMX(5)=DetMX(6)
         ExfMX(6)=ExfMX(7)
         DetMX(6)=DetMX(7)
	     ExfMX(7)=E1XX
         DetMX(7)=D1XX
							 
	     IF(IndexSUMZKX.EQ.1) THEN
            ! –¿—◊»“€¬¿≈Ã œ–Œ»«¬ŒƒÕ”ﬁ
            DetMAX(7)=DetMX(7)*(1.D0-DetMX(6)/DetMX(7))/(ExfMX(7)*(1.D0-ExfMX(6)/ExfMX(7)))
         ENDIF
         IF(IndexSUMZKX.GT.1) THEN
            ! –¿—◊»“€¬¿≈Ã œ–Œ»«¬ŒƒÕ”ﬁ
		    DetMAX(1)=DetMAX(2)
		    DetMAX(2)=DetMAX(3)
            DetMAX(3)=DetMAX(4)
		    DetMAX(4)=DetMAX(5)
		    DetMAX(5)=DetMAX(6)
            DetMAX(6)=DetMAX(7)
		    DetMAX(7)=DetMX(7)*(1.D0-DetMX(6)/DetMX(7))/(ExfMX(7)*(1.D0-ExfMX(6)/ExfMX(7)))

            ! œ–Œ¬Œƒ»Ã ¿Õ¿À»« »  Œ––≈ “»–Œ¬ ” ÿ¿√¿
			IF(RcoffSD.LT.0.D0) THEN
		       call CorrectHRightD(IndexSUMZKX,INDEXZZSFAX,IndexIIUMNX,HenergyX,RcofXZSDX,DetMAX)
			ENDIF
			IF(RcoffSD.GT.0.D0) THEN
			   call CorrectHLeftD(IndexSUMZKX,INDEXZZSFAX,IndexIIUMNX,HenergyX,RcofXZSDX,DetMAX)
			ENDIF    		 
		    ! œ–Œ¬≈–ﬂ≈Ã Õ≈Œ¡’Œƒ»ÃŒ ¬≈–Õ”“—ﬂ Õ¿ ƒ¬≈ “Œ◊ » Õ¿«¿ƒ »À» Õ≈“
		    IF(INDEXZZSFAX.EQ.1) THEN
               ! Õ≈Œ¡’Œƒ»ÃŒ ¬≈–Õ”“—ﬂ Õ¿ ƒ¬≈ “Œ◊ » Õ¿«¿ƒ
               E1XX=ExfMX(5) 
               ExfMX(7)=ExfMX(5) 
               DetMX(7)=DetMX(5)
               ExfMX(6)=ExfMX(4) 
               DetMX(6)=DetMX(4)
			   ExfMX(5)=ExfMX(3) 
               DetMX(5)=DetMX(3)
			   ExfMX(4)=ExfMX(2) 
               DetMX(4)=DetMX(2)
			   ExfMX(3)=ExfMX(1) 
               DetMX(3)=DetMX(1)
               DetMAX(7)=DetMAX(5)
               DetMAX(6)=DetMAX(4)
			   DetMAX(5)=DetMAX(3)
			   DetMAX(4)=DetMAX(2)
			   DetMAX(3)=DetMAX(1)
			   ! Œ¡Õ”Àﬂ≈Ã ¬€’Œƒ »« ÷» À¿
			   INDEXEXITRFX=0
			   ! œ–Œ¬≈–ﬂ≈Ã ◊»—ÀŒ »“≈–¿÷»…
			   IF(IndexSUMZKX.LT.3) THEN
                  ! Œ¡Õ”Àﬂ≈Ã —◊≈“◊»  œŒ— ŒÀ‹ ” œŒ—À≈ ¬Œ«¬–¿Ÿ≈Õ»ﬂ Õ¿ ƒ¬≈ “Œ◊ » Ã€ œŒœ¿ƒ¿≈Ã ¬ Õ¿◊¿À‹Õ”ﬁ “Œ◊ ”
				  IndexSUMZKX=0 
			   ENDIF
	        ENDIF
	     ENDIF

	     ! ÕŒ¬Œ≈ œ–»¡À»∆≈Õ»≈ ƒÀﬂ ›Õ≈–√»»                 
         E1XX=E1XX*(1+RcoffSD*HenergyX)
	     ! œ–Œ¬≈–ﬂ≈Ã ¬€œŒÀÕ»ÀŒ—‹ ”—ÀŒ¬»≈ »À» Õ≈“
	     IF(INDEXZZSFAX.EQ.0) THEN
            IF(D1XX.GT.RXDF) THEN 
               INDEXEXITRFX=INDEXEXITRFX+1
		    ENDIF
		    ! œ–Œ¬≈–ﬂ≈Ã ¬€œŒÀÕ≈ÕŒ ”—ÀŒ¬»≈ ¬€’Œƒ¿ »À» Õ≈“
		    IF(INDEXEXITRFX.EQ.5) THEN 
			   IF(RcoffSD.LT.0.D0) THEN 
                   ! À≈¬¿ﬂ √–¿Õ»÷¿ Œœ–≈ƒ≈À≈Õ¿
			       REleft=ExfMX(7)
			       RfunLR=DetMX(7)
			   ENDIF
			   IF(RcoffSD.GT.0.D0) THEN 
                   ! œ–¿¬¿ﬂ √–¿Õ»÷¿ Œœ–≈ƒ≈À≈Õ¿
			       REright=ExfMX(7)
			       RfunLR=DetMX(7)
			   ENDIF    
		       ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈Õ€
               IparametrDeterEnergy=2
		    ENDIF
	     ENDIF
      ENDDO
      
	  ! œ–Œ¬≈–ﬂ≈Ã √–¿Õ»÷”  Œ“Œ–¿ﬂ »«Õ¿◊¿À‹ÕŒ ¡€À¿ Œœ–≈ƒ≈À≈Õ¿
      ! œ–Œ¬≈–ﬂ≈Ã ƒ–”√¿ﬂ (À≈¬¿ﬂ »À» œ–¿¬¿ﬂ) √–¿Õ»÷¿ —ŒŒ“¬≈“—“¬”≈“ ”—ÀŒ¬»ﬁ »À» Õ≈“
      ! ”—“¿Õ¿¬À»¬¿≈Ã  ¿ ”ﬁ √–¿Õ»÷” Õ”∆ÕŒ Œœ–≈ƒ≈À»“‹
	  !  –»“≈–»…  Œ–≈ “»–Œ¬ » √–¿Õ»÷€
	  IndexCorGRANF=0
	  IF(REmin.GT.ExfNN) THEN
	       ! œ–Œ¬≈–ﬂ≈Ã ¬€œŒÀÕﬂ≈“—ﬂ ”—ÀŒ¬»≈ ƒÀﬂ À≈¬Œ… √–¿Õ»÷€
		   IF(DetxfNN.LT.RXDF) THEN
              ! ÕŒ–Ã¿ ¬ À≈¬Œ… √–¿Õ»÷≈ Ã≈Õ‹ÿ≈  –»“≈–»ﬂ Õ≈Œ¡’Œƒ»ÃŒ  Œ––≈ “»–Œ¬ ¿ À≈¬Œ… √–¿Õ»÷€
			  ! œ¿–¿Ã≈“– —ƒ¬»√¿ 
		      RcoffSD=-1.D0
			  IndexCorGRANF=1   
		   ENDIF		   
		 ELSE
           ! œ–Œ¬≈–ﬂ≈Ã ¬€œŒÀÕﬂ≈“—ﬂ ”—ÀŒ¬»≈ ƒÀﬂ œ–¿¬Œ… √–¿Õ»÷€
		   IF(DetxfNN.LT.RXDF) THEN
              ! ÕŒ–Ã¿ ¬ œ–¿¬Œ… √–¿Õ»÷≈ Ã≈Õ‹ÿ≈  –»“≈–»ﬂ Õ≈Œ¡’Œƒ»ÃŒ  Œ––≈ “»–Œ¬ ¿ œ–¿¬Œ… √–¿Õ»÷€
			  ! œ¿–¿Ã≈“– —ƒ¬»√¿ 
		      RcoffSD=1.D0
			  IndexCorGRANF=1   
		   ENDIF	
	  ENDIF

	  ! œ–Œ¬≈–ﬂ≈Ã Õ≈Œ¡’Œƒ»ÃŒ  Œ–≈ “»–Œ¬ ¿ √–¿Õ»÷€ »À» Õ≈“
	  IF(IndexCorGRANF.EQ.1) THEN
	     
		 ! Œœ–≈ƒ≈Àﬂ≈Ã “” √–¿Õ»÷”  Œ“Œ–”ﬁ Õ≈Œœ–≈ƒ≈À»À»
         ! Œœ–≈ƒ≈Àﬂ≈Ã À≈¬”ﬁ √–¿Õ»÷” Ã»Õ»Ã”Ã¿
         WRITE(17,*)
	     IF(RcoffSD.LT.0.D0) THEN
            WRITE(17,*) 'Defeni grany left min'
         ENDIF
	     IF(RcoffSD.GT.0.D0) THEN
            WRITE(17,*) 'Defeni grany right min' 
	     ENDIF

         ! «¿Õ”Àﬂ≈Ã œ≈–≈ƒ –¿—◊≈“ŒÃ
         DetMX=0.D0
         DetMAX=0.D0
         ExfMX=0.D0
         ! «¿œ»—€¬¿≈Ã œ≈–¬Œ≈ «Õ¿◊≈Õ»≈
         ExfMX(7)=REmin
         DetMX(7)=RfunMIN
         ! Œœ–≈ƒ≈Àﬂ≈Ã Õ¿◊¿À‹Õ€… ÿ¿√
         IF(IndexHDXX.EQ.0) THEN
             HenergyX=0.02D0*DABS(ExfNN-REmin)
			 ! ‘» —»–”≈Ã Œ√–¿Õ»◊≈Õ»≈ ƒÀﬂ ÿ¿√¿
		     IF(HenergyX.GT.0.1D0) THEN
                HenergyX=0.1D0  
		     ENDIF
            ELSE
             IF(RcoffSD.LT.0.D0) THEN
                 HenergyX=0.1D0*HXXZXL
			    ELSE
			     HenergyX=0.1D0*HXXZXR
		     ENDIF
	     ENDIF 
         ! Œœ–≈ƒ≈Àﬂ≈Ã Õ¿◊¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ ƒÀﬂ ›Õ≈–√»» 
         E1XX=REmin*(1+RcoffSD*HenergyX) 
         IndexSUMZKX=0	
         ! »Õƒ≈ — ” ¿«€¬¿≈“ — ŒÀ‹ Œ –¿« Œ—”Ÿ≈—“¬ÀﬂÀŒ—‹ ”Ã≈Õ‹ÿ≈Õ»≈ ¬ 10 –¿« ÿ¿√¿
         IndexIIUMNX=0	         			  
         ! œ¿–¿Ã≈“– ¬€’Œƒ¿ »« ÷» À¿ 
         IparametrDeterEnergy=1 
         ! œ¿–¿Ã≈“– ¬€’Œƒ¿ »« ÷» À¿
         INDEXEXITRFX=0
         INDEXZZSFAX=0
         RcofXZSDX=1.D0
         DO WHILE(IparametrDeterEnergy.EQ.1) 
            ! »Õƒ≈ — ÷» À¿
	        IndexSUMZKX=IndexSUMZKX+1
	        ! Õ¿’Œƒ»Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ ƒÀﬂ «Õ¿◊≈Õ»ﬂ ›Õ≈–√»» E1XX
	        call CalculationNormFunctionEnergyXF(E1XX,D1XX,NMO,NumeroMaxLimid,Npoint,IndexM,Kpoint,NumeroMin,NumeroMax,Rcof,H,NumbreLigand,IXM,NLigands,NFunLigands,NumbreFunctionLig,RO1X,UNout,UNin,AX,BX,CX,FX,Uout,Uin,VNout,VNin,AZ,BZ,FZ,DZ,E,FunMO,Pz,A,B,AA,BB,Vout,Vin,AlfaCoffMO,RfunLigands)
	        WRITE(17,*) E1XX,D1XX,HenergyX
	        ! «¿œ»—€¬¿≈Ã –≈«”À‹“¿“€ –¿—◊≈“¿
	        ExfMX(1)=ExfMX(2)
            DetMX(1)=DetMX(2)
	        ExfMX(2)=ExfMX(3)
            DetMX(2)=DetMX(3)
	        ExfMX(3)=ExfMX(4)
            DetMX(3)=DetMX(4)
	        ExfMX(4)=ExfMX(5)
            DetMX(4)=DetMX(5)
            ExfMX(5)=ExfMX(6)
            DetMX(5)=DetMX(6)
            ExfMX(6)=ExfMX(7)
            DetMX(6)=DetMX(7)
	        ExfMX(7)=E1XX
            DetMX(7)=D1XX
							 
	        IF(IndexSUMZKX.EQ.1) THEN
               ! –¿—◊»“€¬¿≈Ã œ–Œ»«¬ŒƒÕ”ﬁ
               DetMAX(7)=DetMX(7)*(1.D0-DetMX(6)/DetMX(7))/(ExfMX(7)*(1.D0-ExfMX(6)/ExfMX(7)))
            ENDIF
            IF(IndexSUMZKX.GT.1) THEN
               ! –¿—◊»“€¬¿≈Ã œ–Œ»«¬ŒƒÕ”ﬁ
		       DetMAX(1)=DetMAX(2)
		       DetMAX(2)=DetMAX(3)
               DetMAX(3)=DetMAX(4)
		       DetMAX(4)=DetMAX(5)
		       DetMAX(5)=DetMAX(6)
               DetMAX(6)=DetMAX(7)
		       DetMAX(7)=DetMX(7)*(1.D0-DetMX(6)/DetMX(7))/(ExfMX(7)*(1.D0-ExfMX(6)/ExfMX(7)))

            
			   ! œ–Œ¬Œƒ»Ã ¿Õ¿À»« »  Œ––≈ “»–Œ¬ ” ÿ¿√¿
			   IF(RcoffSD.LT.0.D0) THEN
		          call CorrectHRightD(IndexSUMZKX,INDEXZZSFAX,IndexIIUMNX,HenergyX,RcofXZSDX,DetMAX)
			   ENDIF
			   IF(RcoffSD.GT.0.D0) THEN
			      call CorrectHLeftD(IndexSUMZKX,INDEXZZSFAX,IndexIIUMNX,HenergyX,RcofXZSDX,DetMAX)
			   ENDIF    	  		 
		       ! œ–Œ¬≈–ﬂ≈Ã Õ≈Œ¡’Œƒ»ÃŒ ¬≈–Õ”“—ﬂ Õ¿ ƒ¬≈ “Œ◊ » Õ¿«¿ƒ »À» Õ≈“
		       IF(INDEXZZSFAX.EQ.1) THEN
                  ! Õ≈Œ¡’Œƒ»ÃŒ ¬≈–Õ”“—ﬂ Õ¿ ƒ¬≈ “Œ◊ » Õ¿«¿ƒ
                  E1XX=ExfMX(5) 
                  ExfMX(7)=ExfMX(5) 
                  DetMX(7)=DetMX(5)
                  ExfMX(6)=ExfMX(4) 
                  DetMX(6)=DetMX(4)
			      ExfMX(5)=ExfMX(3) 
                  DetMX(5)=DetMX(3)
			      ExfMX(4)=ExfMX(2) 
                  DetMX(4)=DetMX(2)
			      ExfMX(3)=ExfMX(1) 
                  DetMX(3)=DetMX(1)
                  DetMAX(7)=DetMAX(5)
                  DetMAX(6)=DetMAX(4)
			      DetMAX(5)=DetMAX(3)
			      DetMAX(4)=DetMAX(2)
			      DetMAX(3)=DetMAX(1)
			      ! Œ¡Õ”Àﬂ≈Ã ¬€’Œƒ »« ÷» À¿
			      INDEXEXITRFX=0
				  ! œ–Œ¬≈–ﬂ≈Ã ◊»—ÀŒ »“≈–¿÷»…
			      IF(IndexSUMZKX.LT.3) THEN
                     ! Œ¡Õ”Àﬂ≈Ã —◊≈“◊»  œŒ— ŒÀ‹ ” œŒ—À≈ ¬Œ«¬–¿Ÿ≈Õ»ﬂ Õ¿ ƒ¬≈ “Œ◊ » Ã€ œŒœ¿ƒ¿≈Ã ¬ Õ¿◊¿À‹Õ”ﬁ “Œ◊ ”
				     IndexSUMZKX=0 
			      ENDIF
	           ENDIF
	        ENDIF

	        ! ÕŒ¬Œ≈ œ–»¡À»∆≈Õ»≈ ƒÀﬂ ›Õ≈–√»»                 
            E1XX=E1XX*(1+RcoffSD*HenergyX)
	        ! œ–Œ¬≈–ﬂ≈Ã ¬€œŒÀÕ»ÀŒ—‹ ”—ÀŒ¬»≈ »À» Õ≈“
	        IF(INDEXZZSFAX.EQ.0) THEN
               IF(D1XX.GT.RXDF) THEN 
                  INDEXEXITRFX=INDEXEXITRFX+1
		       ENDIF
		       ! œ–Œ¬≈–ﬂ≈Ã ¬€œŒÀÕ≈ÕŒ ”—ÀŒ¬»≈ ¬€’Œƒ¿ »À» Õ≈“
		       IF(INDEXEXITRFX.EQ.5) THEN 
			      IF(RcoffSD.LT.0.D0) THEN 
                     ! À≈¬¿ﬂ √–¿Õ»÷¿ Œœ–≈ƒ≈À≈Õ¿
			         REleft=ExfMX(7)
			         RfunLR=DetMX(7)
			      ENDIF
			      IF(RcoffSD.GT.0.D0) THEN 
                     ! œ–¿¬¿ﬂ √–¿Õ»÷¿ Œœ–≈ƒ≈À≈Õ¿
			         REright=ExfMX(7)
			         RfunLR=DetMX(7)
			      ENDIF    
		          ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈Õ€
                  IparametrDeterEnergy=2
		       ENDIF
	        ENDIF
         ENDDO
	  ENDIF  


   ENDIF


 

   return
 end subroutine MinValueNormEnergyFunctionD2


 
 !! SUBPROGRAMME DETERMINES THE MINIMUM VALUE OF NORM IN THE ENERGY INTERVAL
†!! NMO-NUMBER OF MOLECULAR ORBITALS
†!! Npoint-NUMBER OF POINTS
†!! IndexM-SIZE OF MASSIVE
†!! Kpoint-NUMBER OF POINT OF SOLVING SOLUTIONS
†!! NumeroMin-MINIMUM HARMONIC NUMBER
†!! H-STEP
†!! Rcof-EQUITY RATIO H * H / 12
†!! Pz (NumbreGarmMO (NMO), NumbreGarmMO (NMO), Npoint) - VALUE MAP of the P (ro) -particle of the log function P entering the equation Y '' = P * Y + Q-LOCAL POTENTIAL
†!! RO1X (Npoint) - MASSIVE VALUES OF THE FIRST DERIVATIVE ON THE NEW VARIABLE
†!! A (Isize, Isize, Npoint) -MASSIVE FOR CALCULATING FUNCTION PARAMETERS
†!! B (Isize, Isize, Npoint) -MASSIVE FOR CALCULATING FUNCTION PARAMETERS
†!! AA (Isize, Isize, Npoint) -MASSIVE FOR CALCULATING THE PARAMETERS OF THE PROLONG WITH ADDED ESSENTIAL SINGLE-ELECTRONIC ENERGY
†!! BB (Isize, Isize, Npoint) -MASSIVE FOR CALCULATING THE PARAMETERS OF THE PROLONG WITH ADDED ESSENTIAL SINGLE-ELECTRONIC ENERGY
†!! FX (IndexM, Npoint) -MASSIVE F
†!! Vout (IndexM, IndexM, Npoint) -MASSIVE OF FREQUENCY ON THE DIRECTION OF "OUTSIDE"
†!! Uout (IndexM, Npoint) -MASSIVE OF FREQUENCY ON THE DIRECTION OF "OUTSIDE"
†!! Vin (IndexM, IndexM, Npoint) -MASSIVE OF FIRING ON THE DIRECTION "INSIDE"
†!! Uin (IndexM, Npoint) -MASSIVE OF FIRING ON THE DIRECTION "INSIDE"
†!! VNout, UNout, VNin, UNIN, AZ, BZ, FZ, DZ, E, AX, BX, CX, IXM-AUXILIARY MASSIVE FOR CALCULATION
†!! FunMO-IN THIS CASE AUXILIARY MASSIVE
†!! NumeroMaxLimid-MAXIMUM NUMBER OF HARMONIC MOLECULAR ORBITALS
†!! NumbreLigand (NumbreMO) -MASSIVE NUMBER OF LIGANDES WHICH FUNCTIONS DESCRIBE HIGHER HARMONICS OF THIS MOLECULAR ORBITAL
†!! NLigands (NumbreMO, NumbreLigand (NumbreMO)) - MASSIVE OF LIGAND NUMBERS FUNCTIONS WHICH DESCRIBE HIGHER HARMONICS OF THIS MOLECULAR ORBITAL
†!! NFunLigands (NumbreMO, NumbreLigand (NumbreMO)) - A MASSIVE OF THE NUMBER OF FUNCTIONS OF EACH LIGAND DESCRIBING HIGHER HARMONICS OF THIS MOLECULAR ORBITAL
†!! NumbreFunctionLig (NumbreMO, NumbreLigand (NumbreMO), NFunLigands (NumbreMO, NumbreLigand (NumbreMO)))) - MASSIVE OF NUMBERS OF LIGAND FUNCTIONS THAT COMPLY WITH THIS MOLECULAR ORBITAL
†!! RfunLigands (Nnuclei, NumbreFunctionLig, NumbreGarmLigand, Npoint + 2) -MASSIVE OF VALUES OF LIGAND FUNCTIONS
†!! AlfaCoffMO (NumbreMO, NumbreLigand, NumbreFunLigand) -MASSIVE OF COEFFICIENTS WITH WHICH LIGANDA FUNCTIONS COME INTO THE STRUCTURE OF MOLECULAR ORBITAL
†!! ExfMin, ExfMax-Energetic interval in which the minimum is searched. The minimum is in the vicinity of ExfMin
†!! REmin-Energy corresponding to a minimum
†!! RfunMIN-Value of the norm
†!! IndexXL-INDEX INDICATES A BORDER OF A MINIMUM BORDER OR NOT (LEFT MINIMUM)
†!! IndexXL = 0-NOT INSTALLED (LEFT MINIMUM)
†!! IndexXL = 1-INSTALLED (LEFT MINIMUM)
†!! EminIndexL-MINIMUM
†!! EmaxIndexL-BORDER OF A MINIMUM AREA
†!! RFUNmaxIndexL-MEANING OF THE NORM IN MINIMUM
†!! IndexXR-INDEX INDICATES A BORDER OF A MINIMUM BORDER OR NOT (RIGHT MINIMUM)
†!! IndexXR = 0-NOT INSTALLED (RIGHT MINIMUM)
†!! IndexXR = 1-INSTALLED (RIGHT MINIMUM)
†!! EminIndexR-BORDER OF A MINIMUM AREA
†!! EmaxIndexR-MINIMUM
†!! RFUNmaxIndexR-VALUE OF NORM IN MINIMUM
†!! IndexMinDifini-INDEX INDICATOR DEFINES A NEW MINIMUM OR FOUND AN RIGHT OR LEFT MINIMUM
†!! IndexMinDifini = 0-NEW MINIMUM DEFINED
†!! IndexMinDifini = 1-DEFINED AGAINST LEFT MINIMUM
†!! IndexMinDifini = 2-DETERMINED AGAIN RIGHT MINIMUM
†!! EminGranL-LEFT BORDER OF A NEW MINIMUM
†!! EminGranR-RIGHT BORDER OF A NEW MINIMUM
†!! IndexHDXX-INDEX INDICATOR DETERMINED THE INITIAL STEP TO DETERMINE BORDERS OF MINIMUM
†!! HXXZXL-STEP FOR LEFT ARE FROM MINIMUM
†!! HXXZXR-STEP FOR THE RIGHT OF THE RIGHT FROM THE MINIMUM
 subroutine MinValueNormEnergyFunctionD3(NMO,Npoint,IndexM,NumeroMin,NumeroMax,Kpoint,NumeroMaxLimid,Rcof,H,Uout,Uin,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,AlfaCoffMO,RfunLigands,RO1X,FunMO,Pz,IXM,UNout,UNin,Vout,Vin,AX,BX,CX,E,AZ,FZ,BZ,FX,VNout,VNin,DZ,A,B,AA,BB,HNN,ExfNN,REmin,RfunMIN,IndexXL,EminIndexL,EmaxIndexL,RFUNmaxIndexL,IndexXR,EminIndexR,EmaxIndexR,RFUNmaxIndexR,IndexMinDifini,EminGranL,EminGranR,IndexHDXX,HXXZXL,HXXZXR)
   implicit none
   integer::NMO,Npoint,IndexM,NumeroMin,NumeroMax,Kpoint,NumeroMaxLimid,IndexXL,IndexXR,IndexMinDifini,IndexHDXX
   real(8)::Rcof,HNN,ExfNN,H,RfunMIN,REmin,EminIndexL,EmaxIndexL,RFUNmaxIndexL,EminIndexR,EmaxIndexR,RFUNmaxIndexR,EminGranL,EminGranR,HXXZXL,HXXZXR
   integer,dimension(:)::NumbreLigand
   integer,dimension(:,:)::IXM,NLigands,NFunLigands
   integer,dimension(:,:,:)::NumbreFunctionLig
   real(8),dimension(:)::RO1X,UNout,UNin,AX,BX,CX
   real(8),dimension(:,:)::E,AZ,FZ,BZ,FX,Uout,Uin,VNout,VNin,DZ,FunMO
   real(8),dimension(:,:,:)::Pz,A,B,AA,BB,Vout,Vin,AlfaCoffMO
   real(8),dimension(:,:,:,:)::RfunLigands
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   integer::NEpsIter,IparametrDeterEnergy,IndexRESX,IndexSUMZKX,IndexIIUMNX,INDEXEXITRFX,INDEXZZSFAX,IndexCorGRANF,IndexPovNorma,IndexNORMSDS 
   real(8)::RHS,RX0,RX1,RX2,Rfun0XZ,RnormX0,Xfun0XZ,Rfun1XZ,RnormX1,Xfun1XZ,Rfun2XZ,RnormX2,Xfun2XZ,EXDmin,EXDmax,RcoffSD,RXDF,RfunLR,HenergyX,E1XX,D1XX,RcofXZSDX,DetxfNN   
   real(8),dimension(10)::DetMX,ExfMX,DetMAX

   ! «¿Õ”Àﬂ≈Ã ƒÀﬂ Õ¿◊¿À¿ –¿—◊≈“¿
   IndexMinDifini=0
   EminGranL=0.D0
   EminGranR=0.D0
   
   ! Õ¿◊¿À‹Õ€≈ “Œ◊ »
   EXDmin=ExfNN*(1.D0-HNN)
   EXDmax=ExfNN*(1.D0+HNN)

   ! Õ¿◊¿À‹Õ€… ÿ¿√
   RHS=DABS(EXDmax-EXDmin)*0.5D0
   ! Õ¿◊¿À‹Õ€≈ “Œ◊ »
   RX0=ExfNN 
   ! ¡Œ Œ¬€≈ “Œ◊ »
   RX1=RX0-RHS
   RX2=RX0+RHS
   NEpsIter=0
   ! œ¿–¿Ã≈“– ¬€’Œƒ¿ »« ÷» À¿ 
   IparametrDeterEnergy=1 
   DO WHILE(IparametrDeterEnergy.EQ.1)
      ! »Õƒ≈ — “»œ¿ —Ã≈Ÿ≈Õ»ﬂ
	  IndexNORMSDS=0 
	  ! —◊≈“◊» 
      NEpsIter=NEpsIter+1
      ! Õ¿’Œƒ»Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ ƒÀﬂ «Õ¿◊≈Õ»ﬂ ›Õ≈–√»» RX0
	  ! Œœ–≈ƒ≈Àﬂ≈Ã ÕŒÃ≈– “Œ◊ » —ÿ»¬ » –≈ÿ≈Õ»… OUT AND IN
	  call PointIntersection(Npoint,NumeroMin,RX0,Pz,RO1X,Kpoint) 

	  ! œŒƒœ–Œ√–¿ÃÃ¿ ‘Œ–Ã»–”≈“ Ã¿——»¬€ ƒÀﬂ –¿—◊≈“¬¿ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ »
	  call FormMassivAABB(Npoint,IndexM,Rcof,RX0,A,B,AA,BB,RO1X,E,AZ,FZ,BZ)
	 
      ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » ƒÀﬂ Õ≈ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€
      call CalculationParameterProgonky(2,IndexM,Kpoint,Npoint,AA,BB,FX,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,AZ,BZ,FZ,DZ,E,AX,BX)
                  
      ! Œœ–≈ƒ≈Àﬂ≈Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ —ŒŒ“¬≈“—“¬”ﬁŸ≈≈ ƒ¿ÕÕŒÃ” «Õ¿◊≈Õ»ﬁ ›Õ≈–√»» RX0
      call CalculationNormFunE(RnormX0,Kpoint,Npoint,IndexM,NumeroMin,NumeroMax,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,AZ,BZ,E,AX,BX,CX,IXM,FunMO,RO1X,H,NMO,NumeroMaxLimid,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,RfunLigands,AlfaCoffMO)    
        
	  ! Õ¿’Œƒ»Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ ƒÀﬂ «Õ¿◊≈Õ»ﬂ ›Õ≈–√»» RX1
	  ! Œœ–≈ƒ≈Àﬂ≈Ã ÕŒÃ≈– “Œ◊ » —ÿ»¬ » –≈ÿ≈Õ»… OUT AND IN
	  call PointIntersection(Npoint,NumeroMin,RX1,Pz,RO1X,Kpoint)
	  
	  ! œŒƒœ–Œ√–¿ÃÃ¿ ‘Œ–Ã»–”≈“ Ã¿——»¬€ ƒÀﬂ –¿—◊≈“¬¿ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ »
	  call FormMassivAABB(Npoint,IndexM,Rcof,RX1,A,B,AA,BB,RO1X,E,AZ,FZ,BZ)
	  
	  ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » ƒÀﬂ Õ≈ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€
      call CalculationParameterProgonky(2,IndexM,Kpoint,Npoint,AA,BB,FX,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,AZ,BZ,FZ,DZ,E,AX,BX)
            
      ! Œœ–≈ƒ≈Àﬂ≈Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ —ŒŒ“¬≈“—“¬”ﬁŸ≈≈ ƒ¿ÕÕŒÃ” «Õ¿◊≈Õ»ﬁ ›Õ≈–√»» RX0
      call CalculationNormFunE(RnormX1,Kpoint,Npoint,IndexM,NumeroMin,NumeroMax,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,AZ,BZ,E,AX,BX,CX,IXM,FunMO,RO1X,H,NMO,NumeroMaxLimid,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,RfunLigands,AlfaCoffMO)    
            
      ! Õ¿’Œƒ»Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ ƒÀﬂ «Õ¿◊≈Õ»ﬂ ›Õ≈–√»» RX2
	  ! Œœ–≈ƒ≈Àﬂ≈Ã ÕŒÃ≈– “Œ◊ » —ÿ»¬ » –≈ÿ≈Õ»… OUT AND IN
	  call PointIntersection(Npoint,NumeroMin,RX2,Pz,RO1X,Kpoint)
	  
	  ! œŒƒœ–Œ√–¿ÃÃ¿ ‘Œ–Ã»–”≈“ Ã¿——»¬€ ƒÀﬂ –¿—◊≈“¬¿ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ »
	  call FormMassivAABB(Npoint,IndexM,Rcof,RX2,A,B,AA,BB,RO1X,E,AZ,FZ,BZ)
	 
      ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » ƒÀﬂ Õ≈ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€
      call CalculationParameterProgonky(2,IndexM,Kpoint,Npoint,AA,BB,FX,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,AZ,BZ,FZ,DZ,E,AX,BX)
             
      ! Œœ–≈ƒ≈Àﬂ≈Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ —ŒŒ“¬≈“—“¬”ﬁŸ≈≈ ƒ¿ÕÕŒÃ” «Õ¿◊≈Õ»ﬁ ›Õ≈–√»» RX0
      call CalculationNormFunE(RnormX2,Kpoint,Npoint,IndexM,NumeroMin,NumeroMax,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,AZ,BZ,E,AX,BX,CX,IXM,FunMO,RO1X,H,NMO,NumeroMaxLimid,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,RfunLigands,AlfaCoffMO)    
     
	  
	  ! «¿œ»—€¬¿≈Ã «Õ¿◊≈Õ»≈  
      IF(NEpsIter.EQ.1) THEN
           ! œ≈–¬¿ﬂ »“≈–¿÷»ﬂ
		   WRITE(17,*) NEpsIter,RX0,RnormX0 
		   ! œ≈–¬¿ﬂ »“≈–¿÷»ﬂ 
           ! ”—“¿Õ¿¬À»¬¿≈Ã œŒ¬≈ƒ≈Õ»≈ ÕŒ–Ã€
		   IndexPovNorma=0
		   IF(RnormX1.GT.RnormX0.AND.RnormX0.GT.RnormX2) THEN
              IndexPovNorma=1
		   ENDIF
		   IF(RnormX2.GT.RnormX0.AND.RnormX0.GT.RnormX1) THEN
              IndexPovNorma=1
           ENDIF
           Rfun0XZ=RnormX0
	       Xfun0XZ=RX0
           Rfun1XZ=RnormX1
           Xfun1XZ=RX1
		   Rfun2XZ=RnormX2
           Xfun2XZ=RX2 
		   IF(IndexPovNorma.EQ.1) THEN
		       RX0=Xfun0XZ-RHS*(Rfun2XZ-Rfun1XZ)*0.5D0/(Rfun2XZ-2.D0*Rfun0XZ+Rfun1XZ)
              ELSE
			   RX0=Xfun0XZ-RHS*2.D0
		   ENDIF
           RX1=RX0-RHS
		   RX2=RX0+RHS
		   ! «¿œ»—€¬¿≈Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ ƒÀﬂ ƒ¿À‹Õ≈…ÿ≈√Œ –¿—◊≈“¿
		   DetxfNN=RnormX0 
		 ELSE
           
		   ! œ–Œ¬≈–ﬂ≈Ã œŒœ¿ƒ¿≈“ ƒ¿ÕÕŒ≈ œ–»¡À»∆≈Õ»≈ œŒ ›Õ≈–√»» ¬ Œ¡À¿—“‹ ”∆≈ Õ¿…ƒ≈ÕÕŒ√Œ Ã»Õ»Ã”Ã¿ ƒÀﬂ À≈¬Œ√Œ Ã»Õ»Ã”Ã¿ 
           IF(IndexXL.EQ.1) THEN
              ! √–¿Õ»÷¿ Œ¡À¿—“» Œœ–≈ƒ≈À≈Õ¿
			  IF(RX0.GT.EminIndexL.AND.RX0.LT.EmaxIndexL) THEN
                 ! ›Õ≈–√»ﬂ œŒœ¿À¿ ¬ Œ¡À¿—“‹ œ–≈ƒ€ƒ”Ÿ≈√Œ Ã»Õ»Ã”Ã¿
                 ! Ã»Õ»Ã¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ ‘”Õ ÷»»
		         RfunMIN=RFUNmaxIndexL
		         ! —ŒŒ“¬≈“—“¬”ﬁŸ»… ¿–√”Ã≈Õ“
                 REmin=EminIndexL
				 ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
                 IparametrDeterEnergy=2 
				 WRITE(17,*) NEpsIter,REmin,RfunMIN
				 ! ‘» —»–”≈Ã, ◊“Œ Œ¡Õ¿–”∆≈Õ ”∆≈ »«¬≈—“Õ€… À≈¬€… Ã»Õ»Ã”Ã
                 IndexMinDifini=1
			  ENDIF
		   ENDIF
		   
		   ! œ–Œ¬≈–ﬂ≈Ã œŒœ¿ƒ¿≈“ ƒ¿ÕÕŒ≈ œ–»¡À»∆≈Õ»≈ œŒ ›Õ≈–√»» ¬ Œ¡À¿—“‹ ”∆≈ Õ¿…ƒ≈ÕÕŒ√Œ Ã»Õ»Ã”Ã¿ ƒÀﬂ œ–¿¬Œ√Œ Ã»Õ»Ã”Ã¿ 
           IF(IndexXR.EQ.1) THEN
              ! √–¿Õ»÷¿ Œ¡À¿—“» Œœ–≈ƒ≈À≈Õ¿
			  IF(RX0.GT.EminIndexR.AND.RX0.LT.EmaxIndexR) THEN
                 ! ›Õ≈–√»ﬂ œŒœ¿À¿ ¬ Œ¡À¿—“‹ œ–≈ƒ€ƒ”Ÿ≈√Œ Ã»Õ»Ã”Ã¿
                 ! Ã»Õ»Ã¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ ‘”Õ ÷»»
		         RfunMIN=RFUNmaxIndexR
		         ! —ŒŒ“¬≈“—“¬”ﬁŸ»… ¿–√”Ã≈Õ“
                 REmin=EmaxIndexR
				 ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
                 IparametrDeterEnergy=2 
				 WRITE(17,*) NEpsIter,REmin,RfunMIN
				 ! ‘» —»–”≈Ã, ◊“Œ Œ¡Õ¿–”∆≈Õ ”∆≈ »«¬≈—“Õ€… œ–¿¬€… Ã»Õ»Ã”Ã
                 IndexMinDifini=2
			  ENDIF
		   ENDIF
           
		   ! œ–Œ¬≈–ﬂ≈Ã Õ≈ Œ—”Ÿ≈—“¬À≈Õ ¬€’Œƒ 
		   IF(IparametrDeterEnergy.NE.2) THEN
		      WRITE(17,*) NEpsIter,RX0,RnormX0          
		      ! œ–Œ¬≈–ﬂ≈Ã Œƒ»Õ¿ Œ¬€≈ «Õ¿◊≈Õ»ﬂ ‘”Õ ÷»» Ã€ œŒÀ”◊¿≈Ã
		      ! —À≈ƒŒ¬¿“≈À‹Õ¿ﬂ œ≈–¬¿ﬂ œ–Œ»«¬ŒƒÕ¿ﬂ –¿¬Õ¿ Õ”Àﬁ	 
              IF(RnormX0.EQ.Rfun0XZ) THEN
			     ! œ–Œ¬≈–ﬂ≈Ã ÕŒÃ≈– »“≈–¿÷»»
				 IF(NEpsIter.EQ.2) THEN
                     IndexNORMSDS=1
					ELSE 
					 ! Ã»Õ»Ã¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ ‘”Õ ÷»»
		             RfunMIN=RnormX0 
		             ! —ŒŒ“¬≈“—“¬”ﬁŸ»… ¿–√”Ã≈Õ“
                     REmin=RX0
			         ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
                     IparametrDeterEnergy=2 
                 ENDIF
              ENDIF 

		
		      ! œ–Œ¬≈–ﬂ≈Ã œŒÀ”◊≈ÕÕŒ≈ ÕŒ¬Œ≈ œ–»¡À»∆≈Õ»≈ Ã≈Õ‹ÿ≈ œ–≈ƒ≈ƒ”Ÿ≈√Œ »À» Õ≈“
		      IF(RnormX0.LT.Rfun0XZ) THEN
                  ! Ã»Õ»Ã¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ ‘”Õ ÷»»
		          RfunMIN=RnormX0 
		          ! —ŒŒ“¬≈“—“¬”ﬁŸ»… ¿–√”Ã≈Õ“
                  REmin=RX0
              
			      ! œ–Œ¬≈–ﬂ≈Ã ”—ÀŒ¬»≈ ¬€’Œƒ¿ (œ–Œ¬≈–ﬂ≈Ã –¿¬≈Õ—“¬Œ Õ”Àﬁ œ≈–¬Œ… œ–Œ«¬ŒƒÕŒ…)
			      IF(DABS((RfunMIN-Rfun0XZ)/(REmin-Xfun0XZ)).LT.10.D0**(-10)) THEN
				     ! œ–Œ¬≈–ﬂ≈Ã ÕŒÃ≈– »“≈–¿÷»»
				     IF(NEpsIter.EQ.2) THEN
                         IndexNORMSDS=1
					    ELSE 
			             ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
                         IparametrDeterEnergy=2 
			         ENDIF 
			      ENDIF   
              
			      ! «¿œ»—€¬¿≈Ã œ–≈ƒ€ƒ”Ÿ≈≈ «Õ¿◊≈Õ»≈
			      Rfun0XZ=RnormX0
			      Xfun0XZ=RX0
                  Rfun1XZ=RnormX1
                  Xfun1XZ=RX1
			      Rfun2XZ=RnormX2
                  Xfun2XZ=RX2 

                  ! œ–Œ¬≈–ﬂ≈Ã –¿¬Õ¿ Õ”Àﬁ œ≈–¬¿ﬂ œ–Œ»«¬ŒƒÕ¿ﬂ »À» Õ≈“ 
                  IF(Rfun2XZ.EQ.Rfun1XZ) THEN
				     ! œ–Œ¬≈–ﬂ≈Ã ÕŒÃ≈– »“≈–¿÷»»
				     IF(NEpsIter.EQ.2) THEN
                         IndexNORMSDS=1
					    ELSE 
				         ! Ã»Õ»Ã¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ ‘”Õ ÷»»
		                 RfunMIN=RnormX0 
		                 ! —ŒŒ“¬≈“—“¬”ﬁŸ»… ¿–√”Ã≈Õ“
                         REmin=RX0
			             ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
                         IparametrDeterEnergy=2 
				     ENDIF 
				  ENDIF 
				  !œ–Œ¬≈–ﬂ≈Ã –¿¬Õ¿ Õ”Àﬁ ¬“Œ–¿ﬂ œ–Œ»«¬ŒƒÕ¿ﬂ  œ–» ›“ŒÃ –¿—◊≈“ Œ—“¿Õ¿¬À»¬¿≈“—ﬂ
				  IF(DABS((Rfun2XZ-2.D0*Rfun0XZ+Rfun1XZ)/RHS**2).LT.10.D0**(-10)) THEN
                     ! œ–Œ¬≈–ﬂ≈Ã ÕŒÃ≈– »“≈–¿÷»»
				     IF(NEpsIter.EQ.2) THEN
                         IndexNORMSDS=1
					    ELSE 
				         ! Ã»Õ»Ã¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ ‘”Õ ÷»»
		                 RfunMIN=RnormX0 
		                 ! —ŒŒ“¬≈“—“¬”ﬁŸ»… ¿–√”Ã≈Õ“
                         REmin=RX0
			             ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
                         IparametrDeterEnergy=2 
				     ENDIF
				  ENDIF

			
                  ! ÕŒ¬Œ≈ œ–»¡À»∆≈Õ»≈
				  IF(IparametrDeterEnergy.EQ.1) THEN
				     ! œ–Œ¬≈–ﬂ≈Ã »Õƒ≈ — “»œ¿ —Ã≈Ÿ≈Õ»ﬂ
					 IF(IndexNORMSDS.EQ.0) THEN
			             RX0=Xfun0XZ-RHS*(Rfun2XZ-Rfun1XZ)*0.5D0/(Rfun2XZ-2.D0*Rfun0XZ+Rfun1XZ)
                        ELSE
                         RX0=Xfun0XZ-RHS*2.D0
					 ENDIF
                     RX1=RX0-RHS
			         RX2=RX0+RHS
			      ENDIF
			
			    ELSE
				  ! «Õ¿◊≈Õ»≈ ‘”Õ ÷»» –¿—“≈“
				  ! Ã≈Õﬂ≈Ã ÿ¿√
				  RHS=-RHS*0.5D0
			

				  ! œ–Œ¬≈–ﬂ≈Ã –¿¬Õ¿ Õ”Àﬁ œ≈–¬¿ﬂ œ–Œ»«¬ŒƒÕ¿ﬂ »À» Õ≈“ 
                  IF(Rfun2XZ.EQ.Rfun1XZ) THEN
				     ! œ–Œ¬≈–ﬂ≈Ã ÕŒÃ≈– »“≈–¿÷»»
				     IF(NEpsIter.EQ.2) THEN
                         IndexNORMSDS=1
					    ELSE 
				         ! Ã»Õ»Ã¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ ‘”Õ ÷»»
		                 RfunMIN=Rfun0XZ
		                 ! —ŒŒ“¬≈“—“¬”ﬁŸ»… ¿–√”Ã≈Õ“
                         REmin=Xfun0XZ
			             ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
                         IparametrDeterEnergy=2 
				     ENDIF
				  ENDIF 
				  !œ–Œ¬≈–ﬂ≈Ã –¿¬Õ¿ Õ”Àﬁ ¬“Œ–¿ﬂ œ–Œ»«¬ŒƒÕ¿ﬂ  œ–» ›“ŒÃ –¿—◊≈“ Œ—“¿Õ¿¬À»¬¿≈“—ﬂ
				  IF(DABS((Rfun2XZ-2.D0*Rfun0XZ+Rfun1XZ)/RHS**2).LT.10.D0**(-10)) THEN
				     ! œ–Œ¬≈–ﬂ≈Ã ÕŒÃ≈– »“≈–¿÷»»
				     IF(NEpsIter.EQ.2) THEN
                         IndexNORMSDS=1
					    ELSE 
                         ! Ã»Õ»Ã¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ ‘”Õ ÷»»
		                 RfunMIN=Rfun0XZ
		                 ! —ŒŒ“¬≈“—“¬”ﬁŸ»… ¿–√”Ã≈Õ“
                         REmin=Xfun0XZ
			             ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
                         IparametrDeterEnergy=2 
				     ENDIF 
				  ENDIF

				  ! ÕŒ¬Œ≈ œ–»¡À»∆≈Õ»≈
				  IF(IparametrDeterEnergy.EQ.1) THEN
				     ! œ–Œ¬≈–ﬂ≈Ã »Õƒ≈ — “»œ¿ —Ã≈Ÿ≈Õ»ﬂ
					 IF(IndexNORMSDS.EQ.0) THEN
				         RX0=Xfun0XZ-RHS*(Rfun2XZ-Rfun1XZ)*0.5D0/(Rfun2XZ-2.D0*Rfun0XZ+Rfun1XZ)
                        ELSE
                         RX0=Xfun0XZ-RHS*4.D0
					 ENDIF 
                     RX1=RX0-RHS
			         RX2=RX0+RHS
			      ENDIF
			  ENDIF
           ENDIF
	  ENDIF
   ENDDO

   ! œ–Œ¬≈–ﬂ≈Ã Õ¿…ƒ≈Õ ÕŒ¬€… Ã»Õ»Ã”Ã »À» Œ¡Õ¿–”∆≈Õ —“¿–€…
   IF(IndexMinDifini.EQ.0) THEN
      ! ”—“¿Õ¿¬À»¬¿≈Ã  ¿ ”ﬁ √–¿Õ»÷” Õ”∆ÕŒ Œœ–≈ƒ≈À»“‹
	  IF(REmin.GT.ExfNN) THEN
           ! Õ”∆ÕŒ Œœ–≈ƒ≈À»“‹ œ–¿¬”ﬁ √–¿Õ»÷”
		   ! À≈¬¿ﬂ √–¿Õ»÷¿
           EminGranL=ExfNN
		   ! œ¿–¿Ã≈“– —ƒ¬»√¿ 
		   RcoffSD=1.D0
		 ELSE
           ! Õ”∆ÕŒ Œœ–≈ƒ≈À»“‹ À≈¬”ﬁ √–¿Õ»÷”
		   ! œ–¿¬¿ﬂ √–¿Õ»÷¿
           EminGranR=ExfNN
		   ! œ¿–¿Ã≈“– —ƒ¬»√¿
           RcoffSD=-1.D0
	  ENDIF

	  ! Œœ–≈ƒ≈Àﬂ≈Ã “” √–¿Õ»÷”  Œ“Œ–”ﬁ Õ≈Œœ–≈ƒ≈À»À»
      ! Œœ–≈ƒ≈Àﬂ≈Ã À≈¬”ﬁ √–¿Õ»÷” Ã»Õ»Ã”Ã¿
      WRITE(17,*)
	  IF(RcoffSD.LT.0.D0) THEN
         WRITE(17,*) 'Defeni grany left min'
      ENDIF
	  IF(RcoffSD.GT.0.D0) THEN
         WRITE(17,*) 'Defeni grany right min' 
	  ENDIF

	  
	  ! ”—“¿Õ¿¬À»¬¿≈Ã  –»“≈–»… ƒÀﬂ Œœ–≈ƒ≈À≈Õ»ﬂ À≈¬Œ… √–¿Õ»÷€ Ã»Õ»Ã”Ã¿
      IF(0.2D0*RfunMIN.LT.0.5D0) THEN
           RXDF=1.2D0*RfunMIN
         ELSE
 	       RXDF=RfunMIN+0.2D0
      ENDIF

	 
      ! «¿Õ”Àﬂ≈Ã œ≈–≈ƒ –¿—◊≈“ŒÃ
      DetMX=0.D0
      DetMAX=0.D0
      ExfMX=0.D0
      ! «¿œ»—€¬¿≈Ã œ≈–¬Œ≈ «Õ¿◊≈Õ»≈
      ExfMX(7)=REmin
      DetMX(7)=RfunMIN
      ! Œœ–≈ƒ≈Àﬂ≈Ã Õ¿◊¿À‹Õ€… ÿ¿√
	  IF(IndexHDXX.EQ.0) THEN
          HenergyX=0.02D0*DABS(ExfNN-REmin)
		  ! ‘» —»–”≈Ã Œ√–¿Õ»◊≈Õ»≈ ƒÀﬂ ÿ¿√¿
		  IF(HenergyX.GT.0.1D0) THEN
             HenergyX=0.1D0  
		  ENDIF
         ELSE
          IF(RcoffSD.LT.0.D0) THEN
              HenergyX=0.1D0*HXXZXL
		     ELSE
		      HenergyX=0.1D0*HXXZXR
		  ENDIF
	  ENDIF 
      ! Œœ–≈ƒ≈Àﬂ≈Ã Õ¿◊¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ ƒÀﬂ ›Õ≈–√»» 
      E1XX=REmin*(1+RcoffSD*HenergyX) 
      IndexSUMZKX=0	
      ! »Õƒ≈ — ” ¿«€¬¿≈“ — ŒÀ‹ Œ –¿« Œ—”Ÿ≈—“¬ÀﬂÀŒ—‹ ”Ã≈Õ‹ÿ≈Õ»≈ ¬ 10 –¿« ÿ¿√¿
      IndexIIUMNX=0	         			  
      ! œ¿–¿Ã≈“– ¬€’Œƒ¿ »« ÷» À¿ 
      IparametrDeterEnergy=1 
      ! œ¿–¿Ã≈“– ¬€’Œƒ¿ »« ÷» À¿
      INDEXEXITRFX=0
      INDEXZZSFAX=0
      RcofXZSDX=1.D0
      DO WHILE(IparametrDeterEnergy.EQ.1) 
         ! »Õƒ≈ — ÷» À¿
	     IndexSUMZKX=IndexSUMZKX+1
	     ! Õ¿’Œƒ»Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ ƒÀﬂ «Õ¿◊≈Õ»ﬂ ›Õ≈–√»» E1XX
	     call CalculationNormFunctionEnergyXF(E1XX,D1XX,NMO,NumeroMaxLimid,Npoint,IndexM,Kpoint,NumeroMin,NumeroMax,Rcof,H,NumbreLigand,IXM,NLigands,NFunLigands,NumbreFunctionLig,RO1X,UNout,UNin,AX,BX,CX,FX,Uout,Uin,VNout,VNin,AZ,BZ,FZ,DZ,E,FunMO,Pz,A,B,AA,BB,Vout,Vin,AlfaCoffMO,RfunLigands)
	     WRITE(17,*) E1XX,D1XX,HenergyX
	     ! «¿œ»—€¬¿≈Ã –≈«”À‹“¿“€ –¿—◊≈“¿
	     ExfMX(1)=ExfMX(2)
         DetMX(1)=DetMX(2)
	     ExfMX(2)=ExfMX(3)
         DetMX(2)=DetMX(3)
	     ExfMX(3)=ExfMX(4)
         DetMX(3)=DetMX(4)
	     ExfMX(4)=ExfMX(5)
         DetMX(4)=DetMX(5)
         ExfMX(5)=ExfMX(6)
         DetMX(5)=DetMX(6)
         ExfMX(6)=ExfMX(7)
         DetMX(6)=DetMX(7)
	     ExfMX(7)=E1XX
         DetMX(7)=D1XX
							 
	     IF(IndexSUMZKX.EQ.1) THEN
            ! –¿—◊»“€¬¿≈Ã œ–Œ»«¬ŒƒÕ”ﬁ
            DetMAX(7)=DetMX(7)*(1.D0-DetMX(6)/DetMX(7))/(ExfMX(7)*(1.D0-ExfMX(6)/ExfMX(7)))
         ENDIF
         IF(IndexSUMZKX.GT.1) THEN
            ! –¿—◊»“€¬¿≈Ã œ–Œ»«¬ŒƒÕ”ﬁ
		    DetMAX(1)=DetMAX(2)
		    DetMAX(2)=DetMAX(3)
            DetMAX(3)=DetMAX(4)
		    DetMAX(4)=DetMAX(5)
		    DetMAX(5)=DetMAX(6)
            DetMAX(6)=DetMAX(7)
		    DetMAX(7)=DetMX(7)*(1.D0-DetMX(6)/DetMX(7))/(ExfMX(7)*(1.D0-ExfMX(6)/ExfMX(7)))

           	! œ–Œ¬Œƒ»Ã ¿Õ¿À»« »  Œ––≈ “»–Œ¬ ” ÿ¿√¿
			IF(RcoffSD.LT.0.D0) THEN
		       call CorrectHRightD(IndexSUMZKX,INDEXZZSFAX,IndexIIUMNX,HenergyX,RcofXZSDX,DetMAX)
			ENDIF
			IF(RcoffSD.GT.0.D0) THEN
			   call CorrectHLeftD(IndexSUMZKX,INDEXZZSFAX,IndexIIUMNX,HenergyX,RcofXZSDX,DetMAX)
			ENDIF   
		    ! œ–Œ¬≈–ﬂ≈Ã Õ≈Œ¡’Œƒ»ÃŒ ¬≈–Õ”“—ﬂ Õ¿ ƒ¬≈ “Œ◊ » Õ¿«¿ƒ »À» Õ≈“
		    IF(INDEXZZSFAX.EQ.1) THEN
               ! Õ≈Œ¡’Œƒ»ÃŒ ¬≈–Õ”“—ﬂ Õ¿ ƒ¬≈ “Œ◊ » Õ¿«¿ƒ
               E1XX=ExfMX(5) 
               ExfMX(7)=ExfMX(5) 
               DetMX(7)=DetMX(5)
               ExfMX(6)=ExfMX(4) 
               DetMX(6)=DetMX(4)
			   ExfMX(5)=ExfMX(3) 
               DetMX(5)=DetMX(3)
			   ExfMX(4)=ExfMX(2) 
               DetMX(4)=DetMX(2)
			   ExfMX(3)=ExfMX(1) 
               DetMX(3)=DetMX(1)
               DetMAX(7)=DetMAX(5)
               DetMAX(6)=DetMAX(4)
			   DetMAX(5)=DetMAX(3)
			   DetMAX(4)=DetMAX(2)
			   DetMAX(3)=DetMAX(1)
			   ! Œ¡Õ”Àﬂ≈Ã ¬€’Œƒ »« ÷» À¿
			   INDEXEXITRFX=0
			   ! œ–Œ¬≈–ﬂ≈Ã ◊»—ÀŒ »“≈–¿÷»…
			   IF(IndexSUMZKX.LT.3) THEN
                  ! Œ¡Õ”Àﬂ≈Ã —◊≈“◊»  œŒ— ŒÀ‹ ” œŒ—À≈ ¬Œ«¬–¿Ÿ≈Õ»ﬂ Õ¿ ƒ¬≈ “Œ◊ » Ã€ œŒœ¿ƒ¿≈Ã ¬ Õ¿◊¿À‹Õ”ﬁ “Œ◊ ”
				  IndexSUMZKX=0 
			   ENDIF
	        ENDIF
	     ENDIF

	     ! ÕŒ¬Œ≈ œ–»¡À»∆≈Õ»≈ ƒÀﬂ ›Õ≈–√»»                 
         E1XX=E1XX*(1+RcoffSD*HenergyX)
	     ! œ–Œ¬≈–ﬂ≈Ã ¬€œŒÀÕ»ÀŒ—‹ ”—ÀŒ¬»≈ »À» Õ≈“
	     IF(INDEXZZSFAX.EQ.0) THEN
            IF(D1XX.GT.RXDF) THEN 
               INDEXEXITRFX=INDEXEXITRFX+1
		    ENDIF
		    ! œ–Œ¬≈–ﬂ≈Ã ¬€œŒÀÕ≈ÕŒ ”—ÀŒ¬»≈ ¬€’Œƒ¿ »À» Õ≈“
		    IF(INDEXEXITRFX.EQ.5) THEN              
			   IF(RcoffSD.LT.0.D0) THEN 
                  ! À≈¬¿ﬂ √–¿Õ»÷¿ Œœ–≈ƒ≈À≈Õ¿
			      EminGranL=ExfMX(7)
			      RfunLR=DetMX(7)
			   ENDIF
			   IF(RcoffSD.GT.0.D0) THEN 
                  ! œ–¿¬¿ﬂ √–¿Õ»÷¿ Œœ–≈ƒ≈À≈Õ¿
			      EminGranR=ExfMX(7)
			      RfunLR=DetMX(7)
			   ENDIF    
		       ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈Õ€
               IparametrDeterEnergy=2
		    ENDIF
	     ENDIF
      ENDDO
      
      
	  ! œ–Œ¬≈–ﬂ≈Ã √–¿Õ»÷”  Œ“Œ–¿ﬂ »«Õ¿◊¿À‹ÕŒ ¡€À¿ Œœ–≈ƒ≈À≈Õ¿
      ! œ–Œ¬≈–ﬂ≈Ã ƒ–”√¿ﬂ (À≈¬¿ﬂ »À» œ–¿¬¿ﬂ) √–¿Õ»÷¿ —ŒŒ“¬≈“—“¬”≈“ ”—ÀŒ¬»ﬁ »À» Õ≈“
      ! ”—“¿Õ¿¬À»¬¿≈Ã  ¿ ”ﬁ √–¿Õ»÷” Õ”∆ÕŒ Œœ–≈ƒ≈À»“‹
	  !  –»“≈–»…  Œ–≈ “»–Œ¬ » √–¿Õ»÷€
	  IndexCorGRANF=0
	  IF(REmin.GT.ExfNN) THEN
	       ! œ–Œ¬≈–ﬂ≈Ã ¬€œŒÀÕﬂ≈“—ﬂ ”—ÀŒ¬»≈ ƒÀﬂ À≈¬Œ… √–¿Õ»÷€
		   IF(DetxfNN.LT.RXDF) THEN
              ! ÕŒ–Ã¿ ¬ À≈¬Œ… √–¿Õ»÷≈ Ã≈Õ‹ÿ≈  –»“≈–»ﬂ Õ≈Œ¡’Œƒ»ÃŒ  Œ––≈ “»–Œ¬ ¿ À≈¬Œ… √–¿Õ»÷€
			  ! œ¿–¿Ã≈“– —ƒ¬»√¿ 
		      RcoffSD=-1.D0
			  IndexCorGRANF=1   
		   ENDIF		   
		 ELSE
           ! œ–Œ¬≈–ﬂ≈Ã ¬€œŒÀÕﬂ≈“—ﬂ ”—ÀŒ¬»≈ ƒÀﬂ œ–¿¬Œ… √–¿Õ»÷€
		   IF(DetxfNN.LT.RXDF) THEN
              ! ÕŒ–Ã¿ ¬ œ–¿¬Œ… √–¿Õ»÷≈ Ã≈Õ‹ÿ≈  –»“≈–»ﬂ Õ≈Œ¡’Œƒ»ÃŒ  Œ––≈ “»–Œ¬ ¿ œ–¿¬Œ… √–¿Õ»÷€
			  ! œ¿–¿Ã≈“– —ƒ¬»√¿ 
		      RcoffSD=1.D0
			  IndexCorGRANF=1   
		   ENDIF	
	  ENDIF

	  ! œ–Œ¬≈–ﬂ≈Ã Õ≈Œ¡’Œƒ»ÃŒ  Œ–≈ “»–Œ¬ ¿ √–¿Õ»÷€ »À» Õ≈“
	  IF(IndexCorGRANF.EQ.1) THEN
	     
		 ! Œœ–≈ƒ≈Àﬂ≈Ã “” √–¿Õ»÷”  Œ“Œ–”ﬁ Õ≈Œœ–≈ƒ≈À»À»
         ! Œœ–≈ƒ≈Àﬂ≈Ã À≈¬”ﬁ √–¿Õ»÷” Ã»Õ»Ã”Ã¿
         WRITE(17,*)
	     IF(RcoffSD.LT.0.D0) THEN
            WRITE(17,*) 'Defeni grany left min'
         ENDIF
	     IF(RcoffSD.GT.0.D0) THEN
            WRITE(17,*) 'Defeni grany right min' 
	     ENDIF

         ! «¿Õ”Àﬂ≈Ã œ≈–≈ƒ –¿—◊≈“ŒÃ
         DetMX=0.D0
         DetMAX=0.D0
         ExfMX=0.D0
         ! «¿œ»—€¬¿≈Ã œ≈–¬Œ≈ «Õ¿◊≈Õ»≈
         ExfMX(7)=REmin
         DetMX(7)=RfunMIN
         ! Œœ–≈ƒ≈Àﬂ≈Ã Õ¿◊¿À‹Õ€… ÿ¿√
		 IF(IndexHDXX.EQ.0) THEN
             HenergyX=0.02D0*DABS(ExfNN-REmin)
			 ! ‘» —»–”≈Ã Œ√–¿Õ»◊≈Õ»≈ ƒÀﬂ ÿ¿√¿
		     IF(HenergyX.GT.0.1D0) THEN
                HenergyX=0.1D0  
		     ENDIF
            ELSE
             IF(RcoffSD.LT.0.D0) THEN
                 HenergyX=0.1D0*HXXZXL
		        ELSE
		         HenergyX=0.1D0*HXXZXR
		     ENDIF
	     ENDIF 
         ! Œœ–≈ƒ≈Àﬂ≈Ã Õ¿◊¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ ƒÀﬂ ›Õ≈–√»» 
         E1XX=REmin*(1+RcoffSD*HenergyX) 
         IndexSUMZKX=0	
         ! »Õƒ≈ — ” ¿«€¬¿≈“ — ŒÀ‹ Œ –¿« Œ—”Ÿ≈—“¬ÀﬂÀŒ—‹ ”Ã≈Õ‹ÿ≈Õ»≈ ¬ 10 –¿« ÿ¿√¿
         IndexIIUMNX=0	         			  
         ! œ¿–¿Ã≈“– ¬€’Œƒ¿ »« ÷» À¿ 
         IparametrDeterEnergy=1 
         ! œ¿–¿Ã≈“– ¬€’Œƒ¿ »« ÷» À¿
         INDEXEXITRFX=0
         INDEXZZSFAX=0
         RcofXZSDX=1.D0
         DO WHILE(IparametrDeterEnergy.EQ.1) 
            ! »Õƒ≈ — ÷» À¿
	        IndexSUMZKX=IndexSUMZKX+1
	        ! Õ¿’Œƒ»Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ ƒÀﬂ «Õ¿◊≈Õ»ﬂ ›Õ≈–√»» E1XX
	        call CalculationNormFunctionEnergyXF(E1XX,D1XX,NMO,NumeroMaxLimid,Npoint,IndexM,Kpoint,NumeroMin,NumeroMax,Rcof,H,NumbreLigand,IXM,NLigands,NFunLigands,NumbreFunctionLig,RO1X,UNout,UNin,AX,BX,CX,FX,Uout,Uin,VNout,VNin,AZ,BZ,FZ,DZ,E,FunMO,Pz,A,B,AA,BB,Vout,Vin,AlfaCoffMO,RfunLigands)
	        WRITE(17,*) E1XX,D1XX,HenergyX
	        ! «¿œ»—€¬¿≈Ã –≈«”À‹“¿“€ –¿—◊≈“¿
	        ExfMX(1)=ExfMX(2)
            DetMX(1)=DetMX(2)
	        ExfMX(2)=ExfMX(3)
            DetMX(2)=DetMX(3)
	        ExfMX(3)=ExfMX(4)
            DetMX(3)=DetMX(4)
	        ExfMX(4)=ExfMX(5)
            DetMX(4)=DetMX(5)
            ExfMX(5)=ExfMX(6)
            DetMX(5)=DetMX(6)
            ExfMX(6)=ExfMX(7)
            DetMX(6)=DetMX(7)
	        ExfMX(7)=E1XX
            DetMX(7)=D1XX
							 
	        IF(IndexSUMZKX.EQ.1) THEN
               ! –¿—◊»“€¬¿≈Ã œ–Œ»«¬ŒƒÕ”ﬁ
               DetMAX(7)=DetMX(7)*(1.D0-DetMX(6)/DetMX(7))/(ExfMX(7)*(1.D0-ExfMX(6)/ExfMX(7)))
            ENDIF
            IF(IndexSUMZKX.GT.1) THEN
               ! –¿—◊»“€¬¿≈Ã œ–Œ»«¬ŒƒÕ”ﬁ
		       DetMAX(1)=DetMAX(2)
		       DetMAX(2)=DetMAX(3)
               DetMAX(3)=DetMAX(4)
		       DetMAX(4)=DetMAX(5)
		       DetMAX(5)=DetMAX(6)
               DetMAX(6)=DetMAX(7)
		       DetMAX(7)=DetMX(7)*(1.D0-DetMX(6)/DetMX(7))/(ExfMX(7)*(1.D0-ExfMX(6)/ExfMX(7)))

               
			   ! œ–Œ¬Œƒ»Ã ¿Õ¿À»« »  Œ––≈ “»–Œ¬ ” ÿ¿√¿
			   IF(RcoffSD.LT.0.D0) THEN
		          call CorrectHRightD(IndexSUMZKX,INDEXZZSFAX,IndexIIUMNX,HenergyX,RcofXZSDX,DetMAX)
			   ENDIF
			   IF(RcoffSD.GT.0.D0) THEN
			      call CorrectHLeftD(IndexSUMZKX,INDEXZZSFAX,IndexIIUMNX,HenergyX,RcofXZSDX,DetMAX)
			   ENDIF      		 
		       ! œ–Œ¬≈–ﬂ≈Ã Õ≈Œ¡’Œƒ»ÃŒ ¬≈–Õ”“—ﬂ Õ¿ ƒ¬≈ “Œ◊ » Õ¿«¿ƒ »À» Õ≈“
		       IF(INDEXZZSFAX.EQ.1) THEN
                  ! Õ≈Œ¡’Œƒ»ÃŒ ¬≈–Õ”“—ﬂ Õ¿ ƒ¬≈ “Œ◊ » Õ¿«¿ƒ
                  E1XX=ExfMX(5) 
                  ExfMX(7)=ExfMX(5) 
                  DetMX(7)=DetMX(5)
                  ExfMX(6)=ExfMX(4) 
                  DetMX(6)=DetMX(4)
			      ExfMX(5)=ExfMX(3) 
                  DetMX(5)=DetMX(3)
			      ExfMX(4)=ExfMX(2) 
                  DetMX(4)=DetMX(2)
			      ExfMX(3)=ExfMX(1) 
                  DetMX(3)=DetMX(1)
                  DetMAX(7)=DetMAX(5)
                  DetMAX(6)=DetMAX(4)
			      DetMAX(5)=DetMAX(3)
			      DetMAX(4)=DetMAX(2)
			      DetMAX(3)=DetMAX(1)
			      ! Œ¡Õ”Àﬂ≈Ã ¬€’Œƒ »« ÷» À¿
			      INDEXEXITRFX=0
				  ! œ–Œ¬≈–ﬂ≈Ã ◊»—ÀŒ »“≈–¿÷»…
			      IF(IndexSUMZKX.LT.3) THEN
                     ! Œ¡Õ”Àﬂ≈Ã —◊≈“◊»  œŒ— ŒÀ‹ ” œŒ—À≈ ¬Œ«¬–¿Ÿ≈Õ»ﬂ Õ¿ ƒ¬≈ “Œ◊ » Ã€ œŒœ¿ƒ¿≈Ã ¬ Õ¿◊¿À‹Õ”ﬁ “Œ◊ ”
				     IndexSUMZKX=0 
			      ENDIF
	           ENDIF
	        ENDIF

	        ! ÕŒ¬Œ≈ œ–»¡À»∆≈Õ»≈ ƒÀﬂ ›Õ≈–√»»                 
            E1XX=E1XX*(1+RcoffSD*HenergyX)
	        ! œ–Œ¬≈–ﬂ≈Ã ¬€œŒÀÕ»ÀŒ—‹ ”—ÀŒ¬»≈ »À» Õ≈“
	        IF(INDEXZZSFAX.EQ.0) THEN
               IF(D1XX.GT.RXDF) THEN 
                  INDEXEXITRFX=INDEXEXITRFX+1
		       ENDIF
		       ! œ–Œ¬≈–ﬂ≈Ã ¬€œŒÀÕ≈ÕŒ ”—ÀŒ¬»≈ ¬€’Œƒ¿ »À» Õ≈“
		       IF(INDEXEXITRFX.EQ.5) THEN 
			       IF(RcoffSD.LT.0.D0) THEN 
                      ! À≈¬¿ﬂ √–¿Õ»÷¿ Œœ–≈ƒ≈À≈Õ¿
			          EminGranL=ExfMX(7)
			          RfunLR=DetMX(7)
			       ENDIF
			       IF(RcoffSD.GT.0.D0) THEN 
                      ! œ–¿¬¿ﬂ √–¿Õ»÷¿ Œœ–≈ƒ≈À≈Õ¿
			          EminGranR=ExfMX(7)
			          RfunLR=DetMX(7)
			       ENDIF    
		           ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈Õ€
                   IparametrDeterEnergy=2
		       ENDIF
	        ENDIF
         ENDDO
	  ENDIF  


   ENDIF 

   return
 end subroutine MinValueNormEnergyFunctionD3




!! SUBPROGRAMME DETERMINES THE MINIMUM VALUE OF NORM IN THE ENERGY INTERVAL
†!! NMO-NUMBER OF MOLECULAR ORBITALS
†!! Npoint-NUMBER OF POINTS
†!! IndexM-SIZE OF MASSIVE
†!! Kpoint-NUMBER OF POINT OF SOLVING SOLUTIONS
†!! NumeroMin-MINIMUM HARMONIC NUMBER
†!! H-STEP
†!! Rcof-EQUITY RATIO H * H / 12
†!! Pz (NumbreGarmMO (NMO), NumbreGarmMO (NMO), Npoint) - VALUE MAP of the P (ro) -particle of the log function P entering the equation Y '' = P * Y + Q-LOCAL POTENTIAL
†!! RO1X (Npoint) - MASSIVE VALUES OF THE FIRST DERIVATIVE ON THE NEW VARIABLE
†!! A (Isize, Isize, Npoint) -MASSIVE FOR CALCULATING FUNCTION PARAMETERS
†!! B (Isize, Isize, Npoint) -MASSIVE FOR CALCULATING FUNCTION PARAMETERS
†!! AA (Isize, Isize, Npoint) -MASSIVE FOR CALCULATING THE PARAMETERS OF THE PROLONG WITH ADDED ESSENTIAL SINGLE-ELECTRONIC ENERGY
†!! BB (Isize, Isize, Npoint) -MASSIVE FOR CALCULATING THE PARAMETERS OF THE PROLONG WITH ADDED ESSENTIAL SINGLE-ELECTRONIC ENERGY
†!! FX (IndexM, Npoint) -MASSIVE F
†!! Vout (IndexM, IndexM, Npoint) -MASSIVE OF FREQUENCY ON THE DIRECTION OF "OUTSIDE"
†!! Uout (IndexM, Npoint) -MASSIVE OF FREQUENCY ON THE DIRECTION OF "OUTSIDE"
†!! Vin (IndexM, IndexM, Npoint) -MASSIVE OF FIRING ON THE DIRECTION "INSIDE"
†!! Uin (IndexM, Npoint) -MASSIVE OF FIRING ON THE DIRECTION "INSIDE"
†!! VNout, UNout, VNin, UNIN, AZ, BZ, FZ, DZ, E, AX, BX, CX, IXM-AUXILIARY MASSIVE FOR CALCULATION
†!! FunMO-IN THIS CASE AUXILIARY MASSIVE
†!! NumeroMaxLimid-MAXIMUM NUMBER OF HARMONIC MOLECULAR ORBITALS
†!! NumbreLigand (NumbreMO) -MASSIVE NUMBER OF LIGANDES WHICH FUNCTIONS DESCRIBE HIGHER HARMONICS OF THIS MOLECULAR ORBITAL
†!! NLigands (NumbreMO, NumbreLigand (NumbreMO)) - MASSIVE OF LIGAND NUMBERS FUNCTIONS WHICH DESCRIBE HIGHER HARMONICS OF THIS MOLECULAR ORBITAL
†!! NFunLigands (NumbreMO, NumbreLigand (NumbreMO)) - A MASSIVE OF THE NUMBER OF FUNCTIONS OF EACH LIGAND DESCRIBING HIGHER HARMONICS OF THIS MOLECULAR ORBITAL
†!! NumbreFunctionLig (NumbreMO, NumbreLigand (NumbreMO), NFunLigands (NumbreMO, NumbreLigand (NumbreMO)))) - MASSIVE OF NUMBERS OF LIGAND FUNCTIONS THAT COMPLY WITH THIS MOLECULAR ORBITAL
†!! RfunLigands (Nnuclei, NumbreFunctionLig, NumbreGarmLigand, Npoint + 2) -MASSIVE OF VALUES OF LIGAND FUNCTIONS
†!! AlfaCoffMO (NumbreMO, NumbreLigand, NumbreFunLigand) -MASSIVE OF COEFFICIENTS WITH WHICH LIGANDA FUNCTIONS COME INTO THE STRUCTURE OF MOLECULAR ORBITAL
†!! ExfMin, ExfMax-Energetic interval in which the minimum is searched. The minimum is in the vicinity of ExfMin
†!! REmin-Energy corresponding to a minimum
†!! RfunMIN-Value of the norm
†!! REleft-Left Low Limit
†!! IndexHDXX-INDEX INDICATOR DETERMINED THE INITIAL STEP TO DETERMINE BORDERS OF MINIMUM
†!! HXXZXL-STEP FOR LEFT ARE FROM MINIMUM
 subroutine MinValueNormEnergyFunctionDD(NMO,Npoint,IndexM,NumeroMin,NumeroMax,Kpoint,NumeroMaxLimid,Rcof,H,Uout,Uin,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,AlfaCoffMO,RfunLigands,RO1X,FunMO,Pz,IXM,UNout,UNin,Vout,Vin,AX,BX,CX,E,AZ,FZ,BZ,FX,VNout,VNin,DZ,A,B,AA,BB,ExfMin,Exf0,ExfMax,REmin,RfunMIN,REleft,IndexHDXX,HXXZXL)
   implicit none
   integer::NMO,Npoint,IndexM,NumeroMin,NumeroMax,Kpoint,NumeroMaxLimid,IndexHDXX
   real(8)::Rcof,ExfMin,Exf0,ExfMax,H,RfunMIN,REmin,REleft,HXXZXL
   integer,dimension(:)::NumbreLigand
   integer,dimension(:,:)::IXM,NLigands,NFunLigands
   integer,dimension(:,:,:)::NumbreFunctionLig
   real(8),dimension(:)::RO1X,UNout,UNin,AX,BX,CX
   real(8),dimension(:,:)::E,AZ,FZ,BZ,FX,Uout,Uin,VNout,VNin,DZ,FunMO
   real(8),dimension(:,:,:)::Pz,A,B,AA,BB,Vout,Vin,AlfaCoffMO
   real(8),dimension(:,:,:,:)::RfunLigands
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   integer::NEpsIter,IparametrDeterEnergy,IndexRESX,IndexSUMZKX,IndexIIUMNX,INDEXEXITRFX,INDEXZZSFAX 
   real(8)::RHS,RX0,RX1,RX2,Rfun0XZ,RnormX0,Xfun0XZ,Rfun1XZ,RnormX1,Xfun1XZ,Rfun2XZ,RnormX2,Xfun2XZ,RcofXZSDX 
   real(8)::RfunLeft,RXDF,HenergyX,E1XX,D1XX  
   real(8),dimension(10)::DetMX,ExfMX,DetMAX
 
   ! Õ¿◊¿À‹Õ€… ÿ¿√
   RHS=DABS(ExfMin-Exf0)
   ! Õ¿◊¿À‹Õ€≈ “Œ◊ »
   RX0=Exf0 
   ! ¡Œ Œ¬€≈ “Œ◊ »
   RX1=ExfMin
   RX2=ExfMax
   NEpsIter=0
   ! œ¿–¿Ã≈“– ¬€’Œƒ¿ »« ÷» À¿ 
   IparametrDeterEnergy=1 
   DO WHILE(IparametrDeterEnergy.EQ.1)
      NEpsIter=NEpsIter+1
      ! Õ¿’Œƒ»Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ ƒÀﬂ «Õ¿◊≈Õ»ﬂ ›Õ≈–√»» RX0
	  ! Œœ–≈ƒ≈Àﬂ≈Ã ÕŒÃ≈– “Œ◊ » —ÿ»¬ » –≈ÿ≈Õ»… OUT AND IN
	  call PointIntersection(Npoint,NumeroMin,RX0,Pz,RO1X,Kpoint) 

	  ! œŒƒœ–Œ√–¿ÃÃ¿ ‘Œ–Ã»–”≈“ Ã¿——»¬€ ƒÀﬂ –¿—◊≈“¬¿ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ »
	  call FormMassivAABB(Npoint,IndexM,Rcof,RX0,A,B,AA,BB,RO1X,E,AZ,FZ,BZ)
	 
      ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » ƒÀﬂ Õ≈ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€
      call CalculationParameterProgonky(2,IndexM,Kpoint,Npoint,AA,BB,FX,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,AZ,BZ,FZ,DZ,E,AX,BX)
                  
      ! Œœ–≈ƒ≈Àﬂ≈Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ —ŒŒ“¬≈“—“¬”ﬁŸ≈≈ ƒ¿ÕÕŒÃ” «Õ¿◊≈Õ»ﬁ ›Õ≈–√»» RX0
      call CalculationNormFunE(RnormX0,Kpoint,Npoint,IndexM,NumeroMin,NumeroMax,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,AZ,BZ,E,AX,BX,CX,IXM,FunMO,RO1X,H,NMO,NumeroMaxLimid,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,RfunLigands,AlfaCoffMO)    
        
	  ! Õ¿’Œƒ»Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ ƒÀﬂ «Õ¿◊≈Õ»ﬂ ›Õ≈–√»» RX1
	  ! Œœ–≈ƒ≈Àﬂ≈Ã ÕŒÃ≈– “Œ◊ » —ÿ»¬ » –≈ÿ≈Õ»… OUT AND IN
	  call PointIntersection(Npoint,NumeroMin,RX1,Pz,RO1X,Kpoint)
	  
	  ! œŒƒœ–Œ√–¿ÃÃ¿ ‘Œ–Ã»–”≈“ Ã¿——»¬€ ƒÀﬂ –¿—◊≈“¬¿ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ »
	  call FormMassivAABB(Npoint,IndexM,Rcof,RX1,A,B,AA,BB,RO1X,E,AZ,FZ,BZ)
	  
	  ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » ƒÀﬂ Õ≈ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€
      call CalculationParameterProgonky(2,IndexM,Kpoint,Npoint,AA,BB,FX,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,AZ,BZ,FZ,DZ,E,AX,BX)
            
      ! Œœ–≈ƒ≈Àﬂ≈Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ —ŒŒ“¬≈“—“¬”ﬁŸ≈≈ ƒ¿ÕÕŒÃ” «Õ¿◊≈Õ»ﬁ ›Õ≈–√»» RX0
      call CalculationNormFunE(RnormX1,Kpoint,Npoint,IndexM,NumeroMin,NumeroMax,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,AZ,BZ,E,AX,BX,CX,IXM,FunMO,RO1X,H,NMO,NumeroMaxLimid,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,RfunLigands,AlfaCoffMO)    
            
      ! Õ¿’Œƒ»Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ ƒÀﬂ «Õ¿◊≈Õ»ﬂ ›Õ≈–√»» RX2
	  ! Œœ–≈ƒ≈Àﬂ≈Ã ÕŒÃ≈– “Œ◊ » —ÿ»¬ » –≈ÿ≈Õ»… OUT AND IN
	  call PointIntersection(Npoint,NumeroMin,RX2,Pz,RO1X,Kpoint)
	  
	  ! œŒƒœ–Œ√–¿ÃÃ¿ ‘Œ–Ã»–”≈“ Ã¿——»¬€ ƒÀﬂ –¿—◊≈“¬¿ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ »
	  call FormMassivAABB(Npoint,IndexM,Rcof,RX2,A,B,AA,BB,RO1X,E,AZ,FZ,BZ)
	 
      ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » ƒÀﬂ Õ≈ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€
      call CalculationParameterProgonky(2,IndexM,Kpoint,Npoint,AA,BB,FX,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,AZ,BZ,FZ,DZ,E,AX,BX)
             
      ! Œœ–≈ƒ≈Àﬂ≈Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ —ŒŒ“¬≈“—“¬”ﬁŸ≈≈ ƒ¿ÕÕŒÃ” «Õ¿◊≈Õ»ﬁ ›Õ≈–√»» RX0
      call CalculationNormFunE(RnormX2,Kpoint,Npoint,IndexM,NumeroMin,NumeroMax,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,AZ,BZ,E,AX,BX,CX,IXM,FunMO,RO1X,H,NMO,NumeroMaxLimid,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,RfunLigands,AlfaCoffMO)    
     
	  
	  ! «¿œ»—€¬¿≈Ã «Õ¿◊≈Õ»≈  
      IF(NEpsIter.EQ.1) THEN
           ! œ≈–¬¿ﬂ »“≈–¿÷»ﬂ 
           Rfun0XZ=RnormX0
	       Xfun0XZ=RX0
           Rfun1XZ=RnormX1
           Xfun1XZ=RX1
		   Rfun2XZ=RnormX2
           Xfun2XZ=RX2 
		   RX0=Xfun0XZ-RHS*(Rfun2XZ-Rfun1XZ)*0.5D0/(Rfun2XZ-2.D0*Rfun0XZ+Rfun1XZ)
           RX1=RX0-RHS
		   RX2=RX0+RHS
		 ELSE
           
		   WRITE(17,*) NEpsIter,RX0,RnormX0          
		   ! œ–Œ¬≈–ﬂ≈Ã Œƒ»Õ¿ Œ¬€≈ «Õ¿◊≈Õ»ﬂ ‘”Õ ÷»» Ã€ œŒÀ”◊¿≈Ã
		   ! —À≈ƒŒ¬¿“≈À‹Õ¿ﬂ œ≈–¬¿ﬂ œ–Œ»«¬ŒƒÕ¿ﬂ –¿¬Õ¿ Õ”Àﬁ	 
           IF(RnormX0.EQ.Rfun0XZ) THEN
              ! Ã»Õ»Ã¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ ‘”Õ ÷»»
		      RfunMIN=RnormX0 
		      ! —ŒŒ“¬≈“—“¬”ﬁŸ»… ¿–√”Ã≈Õ“
              REmin=RX0
			  ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
              IparametrDeterEnergy=2
           ENDIF 

		
		   ! œ–Œ¬≈–ﬂ≈Ã œŒÀ”◊≈ÕÕŒ≈ ÕŒ¬Œ≈ œ–»¡À»∆≈Õ»≈ Ã≈Õ‹ÿ≈ œ–≈ƒ≈ƒ”Ÿ≈√Œ »À» Õ≈“
		   IF(RnormX0.LT.Rfun0XZ) THEN
                ! Ã»Õ»Ã¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ ‘”Õ ÷»»
		        RfunMIN=RnormX0 
		        ! —ŒŒ“¬≈“—“¬”ﬁŸ»… ¿–√”Ã≈Õ“
                REmin=RX0

			              
			    ! œ–Œ¬≈–ﬂ≈Ã ”—ÀŒ¬»≈ ¬€’Œƒ¿ (œ–Œ¬≈–ﬂ≈Ã –¿¬≈Õ—“¬Œ Õ”Àﬁ œ≈–¬Œ… œ–Œ«¬ŒƒÕŒ…)
			    IF(DABS((RfunMIN-Rfun0XZ)/(REmin-Xfun0XZ)).LT.10.D0**(-10)) THEN
			       ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
                   IparametrDeterEnergy=2 
			    ENDIF   
              
			    ! «¿œ»—€¬¿≈Ã œ–≈ƒ€ƒ”Ÿ≈≈ «Õ¿◊≈Õ»≈
			    Rfun0XZ=RnormX0
			    Xfun0XZ=RX0
                Rfun1XZ=RnormX1
                Xfun1XZ=RX1
			    Rfun2XZ=RnormX2
                Xfun2XZ=RX2 

                ! œ–Œ¬≈–ﬂ≈Ã –¿¬Õ¿ Õ”Àﬁ œ≈–¬¿ﬂ œ–Œ»«¬ŒƒÕ¿ﬂ »À» Õ≈“ 
                IF(Rfun2XZ.EQ.Rfun1XZ) THEN
				     ! Ã»Õ»Ã¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ ‘”Õ ÷»»
		             RfunMIN=RnormX0 
		             ! —ŒŒ“¬≈“—“¬”ﬁŸ»… ¿–√”Ã≈Õ“
                     REmin=RX0
			         ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
                     IparametrDeterEnergy=2 
				ENDIF 
				!œ–Œ¬≈–ﬂ≈Ã –¿¬Õ¿ Õ”Àﬁ ¬“Œ–¿ﬂ œ–Œ»«¬ŒƒÕ¿ﬂ  œ–» ›“ŒÃ –¿—◊≈“ Œ—“¿Õ¿¬À»¬¿≈“—ﬂ
				IF(DABS((Rfun2XZ-2.D0*Rfun0XZ+Rfun1XZ)/RHS**2).LT.10.D0**(-10)) THEN
                   ! Ã»Õ»Ã¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ ‘”Õ ÷»»
		           RfunMIN=RnormX0 
		           ! —ŒŒ“¬≈“—“¬”ﬁŸ»… ¿–√”Ã≈Õ“
                   REmin=RX0
			       ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
                   IparametrDeterEnergy=2 
				ENDIF

			
                ! ÕŒ¬Œ≈ œ–»¡À»∆≈Õ»≈
				IF(IparametrDeterEnergy.EQ.1) THEN
			       RX0=Xfun0XZ-RHS*(Rfun2XZ-Rfun1XZ)*0.5D0/(Rfun2XZ-2.D0*Rfun0XZ+Rfun1XZ)
                   RX1=RX0-RHS
			       RX2=RX0+RHS
			    ENDIF
			
			  ELSE
				! «Õ¿◊≈Õ»≈ ‘”Õ ÷»» –¿—“≈“
				! Ã≈Õﬂ≈Ã ÿ¿√
				RHS=-RHS*0.5D0
			

				! œ–Œ¬≈–ﬂ≈Ã –¿¬Õ¿ Õ”Àﬁ œ≈–¬¿ﬂ œ–Œ»«¬ŒƒÕ¿ﬂ »À» Õ≈“ 
                IF(Rfun2XZ.EQ.Rfun1XZ) THEN
				   ! Ã»Õ»Ã¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ ‘”Õ ÷»»
		           RfunMIN=Rfun0XZ
		           ! —ŒŒ“¬≈“—“¬”ﬁŸ»… ¿–√”Ã≈Õ“
                   REmin=Xfun0XZ
			       ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
                   IparametrDeterEnergy=2 
				ENDIF 
				!œ–Œ¬≈–ﬂ≈Ã –¿¬Õ¿ Õ”Àﬁ ¬“Œ–¿ﬂ œ–Œ»«¬ŒƒÕ¿ﬂ  œ–» ›“ŒÃ –¿—◊≈“ Œ—“¿Õ¿¬À»¬¿≈“—ﬂ
				IF(DABS((Rfun2XZ-2.D0*Rfun0XZ+Rfun1XZ)/RHS**2).LT.10.D0**(-10)) THEN
                   ! Ã»Õ»Ã¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ ‘”Õ ÷»»
		           RfunMIN=Rfun0XZ
		           ! —ŒŒ“¬≈“—“¬”ﬁŸ»… ¿–√”Ã≈Õ“
                   REmin=Xfun0XZ
			       ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
                   IparametrDeterEnergy=2 
				ENDIF

				! ÕŒ¬Œ≈ œ–»¡À»∆≈Õ»≈
				IF(IparametrDeterEnergy.EQ.1) THEN
				   RX0=Xfun0XZ-RHS*(Rfun2XZ-Rfun1XZ)*0.5D0/(Rfun2XZ-2.D0*Rfun0XZ+Rfun1XZ)
                   RX1=RX0-RHS
			       RX2=RX0+RHS
			    ENDIF
				
		   ENDIF
	  ENDIF
   ENDDO

   ! Œœ–≈ƒ≈Àﬂ≈Ã À≈¬”ﬁ √–¿Õ»÷” Ã»Õ»Ã”Ã¿
   WRITE(17,*)
   WRITE(17,*) 'Defeni grany left min'
 
   ! ”—“¿Õ¿¬À»¬¿≈Ã  –»“≈–»… ƒÀﬂ Œœ–≈ƒ≈À≈Õ»ﬂ À≈¬Œ… √–¿Õ»÷€ Ã»Õ»Ã”Ã¿
   IF(0.2D0*RfunMIN.LT.0.5D0) THEN
        RXDF=1.2D0*RfunMIN
      ELSE
 	    RXDF=RfunMIN+0.2D0
   ENDIF
    
   ! Œ—”Ÿ≈—“¬Àﬂ≈Ã Œœ–≈ƒ≈À≈Õ»≈ À≈¬Œ… √–¿Õ»÷€ »Õ“≈–¬¿À¿ 
   ! «¿Õ”Àﬂ≈Ã œ≈–≈ƒ –¿—◊≈“ŒÃ
   DetMX=0.D0
   DetMAX=0.D0
   ExfMX=0.D0
   ! «¿œ»—€¬¿≈Ã œ≈–¬Œ≈ «Õ¿◊≈Õ»≈
   ExfMX(7)=REmin
   DetMX(7)=RfunMIN
   ! Œœ–≈ƒ≈Àﬂ≈Ã Õ¿◊¿À‹Õ€… ÿ¿√
   IF(IndexHDXX.EQ.0) THEN
       HenergyX=0.02D0*DABS(Exf0-REmin)
	   ! ‘» —»–”≈Ã Œ√–¿Õ»◊≈Õ»≈ ƒÀﬂ ÿ¿√¿
	   IF(HenergyX.GT.0.1D0) THEN
          HenergyX=0.1D0  
	   ENDIF
      ELSE
	   HenergyX=0.1D0*HXXZXL
   ENDIF
   ! Œœ–≈ƒ≈Àﬂ≈Ã Õ¿◊¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ ƒÀﬂ ›Õ≈–√»» 
   E1XX=REmin*(1-HenergyX) 
   IndexSUMZKX=0	
   ! »Õƒ≈ — ” ¿«€¬¿≈“ — ŒÀ‹ Œ –¿« Œ—”Ÿ≈—“¬ÀﬂÀŒ—‹ ”Ã≈Õ‹ÿ≈Õ»≈ ¬ 10 –¿« ÿ¿√¿
   IndexIIUMNX=0	         			  
   ! œ¿–¿Ã≈“– ¬€’Œƒ¿ »« ÷» À¿ 
   IparametrDeterEnergy=1 
   ! œ¿–¿Ã≈“– ¬€’Œƒ¿ »« ÷» À¿
   INDEXEXITRFX=0
   INDEXZZSFAX=0
   RcofXZSDX=1.D0
   DO WHILE(IparametrDeterEnergy.EQ.1) 
      ! »Õƒ≈ — ÷» À¿
	  IndexSUMZKX=IndexSUMZKX+1
	  ! Õ¿’Œƒ»Ã «Õ¿◊≈Õ»≈ ÕŒ–Ã€ ƒÀﬂ «Õ¿◊≈Õ»ﬂ ›Õ≈–√»» E1XX
	  call CalculationNormFunctionEnergyXF(E1XX,D1XX,NMO,NumeroMaxLimid,Npoint,IndexM,Kpoint,NumeroMin,NumeroMax,Rcof,H,NumbreLigand,IXM,NLigands,NFunLigands,NumbreFunctionLig,RO1X,UNout,UNin,AX,BX,CX,FX,Uout,Uin,VNout,VNin,AZ,BZ,FZ,DZ,E,FunMO,Pz,A,B,AA,BB,Vout,Vin,AlfaCoffMO,RfunLigands)
	  WRITE(17,*) E1XX,D1XX,HenergyX
	  ! «¿œ»—€¬¿≈Ã –≈«”À‹“¿“€ –¿—◊≈“¿
	  ExfMX(1)=ExfMX(2)
      DetMX(1)=DetMX(2)
	  ExfMX(2)=ExfMX(3)
      DetMX(2)=DetMX(3)
	  ExfMX(3)=ExfMX(4)
      DetMX(3)=DetMX(4)
	  ExfMX(4)=ExfMX(5)
      DetMX(4)=DetMX(5)
      ExfMX(5)=ExfMX(6)
      DetMX(5)=DetMX(6)
      ExfMX(6)=ExfMX(7)
      DetMX(6)=DetMX(7)
	  ExfMX(7)=E1XX
      DetMX(7)=D1XX
							 
	  IF(IndexSUMZKX.EQ.1) THEN
         ! –¿—◊»“€¬¿≈Ã œ–Œ»«¬ŒƒÕ”ﬁ
         DetMAX(7)=DetMX(7)*(1.D0-DetMX(6)/DetMX(7))/(ExfMX(7)*(1.D0-ExfMX(6)/ExfMX(7)))
      ENDIF
      IF(IndexSUMZKX.GT.1) THEN
         ! –¿—◊»“€¬¿≈Ã œ–Œ»«¬ŒƒÕ”ﬁ
		 DetMAX(1)=DetMAX(2)
		 DetMAX(2)=DetMAX(3)
         DetMAX(3)=DetMAX(4)
		 DetMAX(4)=DetMAX(5)
		 DetMAX(5)=DetMAX(6)
         DetMAX(6)=DetMAX(7)
		 DetMAX(7)=DetMX(7)*(1.D0-DetMX(6)/DetMX(7))/(ExfMX(7)*(1.D0-ExfMX(6)/ExfMX(7)))

         ! œ–Œ¬Œƒ»Ã ¿Õ¿À»« »  Œ––≈ “»–Œ¬ ” ÿ¿√¿
		 call CorrectHRightD(IndexSUMZKX,INDEXZZSFAX,IndexIIUMNX,HenergyX,RcofXZSDX,DetMAX)
		
					 
		 ! œ–Œ¬≈–ﬂ≈Ã Õ≈Œ¡’Œƒ»ÃŒ ¬≈–Õ”“—ﬂ Õ¿ ƒ¬≈ “Œ◊ » Õ¿«¿ƒ »À» Õ≈“
		 IF(INDEXZZSFAX.EQ.1) THEN
            ! Õ≈Œ¡’Œƒ»ÃŒ ¬≈–Õ”“—ﬂ Õ¿ ƒ¬≈ “Œ◊ » Õ¿«¿ƒ
            E1XX=ExfMX(5) 
            ExfMX(7)=ExfMX(5) 
            DetMX(7)=DetMX(5)
            ExfMX(6)=ExfMX(4) 
            DetMX(6)=DetMX(4)
			ExfMX(5)=ExfMX(3) 
            DetMX(5)=DetMX(3)
			ExfMX(4)=ExfMX(2) 
            DetMX(4)=DetMX(2)
			ExfMX(3)=ExfMX(1) 
            DetMX(3)=DetMX(1)
            DetMAX(7)=DetMAX(5)
            DetMAX(6)=DetMAX(4)
			DetMAX(5)=DetMAX(3)
			DetMAX(4)=DetMAX(2)
			DetMAX(3)=DetMAX(1)
			! Œ¡Õ”Àﬂ≈Ã ¬€’Œƒ »« ÷» À¿
			INDEXEXITRFX=0
			! œ–Œ¬≈–ﬂ≈Ã ◊»—ÀŒ »“≈–¿÷»…
			IF(IndexSUMZKX.LT.3) THEN
               ! Œ¡Õ”Àﬂ≈Ã —◊≈“◊»  œŒ— ŒÀ‹ ” œŒ—À≈ ¬Œ«¬–¿Ÿ≈Õ»ﬂ Õ¿ ƒ¬≈ “Œ◊ » Ã€ œŒœ¿ƒ¿≈Ã ¬ Õ¿◊¿À‹Õ”ﬁ “Œ◊ ”
			   IndexSUMZKX=0 
			ENDIF
	     ENDIF
	  ENDIF

	  ! ÕŒ¬Œ≈ œ–»¡À»∆≈Õ»≈ ƒÀﬂ ›Õ≈–√»»                 
      E1XX=E1XX*(1-HenergyX)
	  ! œ–Œ¬≈–ﬂ≈Ã ¬€œŒÀÕ»ÀŒ—‹ ”—ÀŒ¬»≈ »À» Õ≈“
	  IF(INDEXZZSFAX.EQ.0) THEN
         IF(D1XX.GT.RXDF) THEN 
            INDEXEXITRFX=INDEXEXITRFX+1
		 ENDIF
		 ! œ–Œ¬≈–ﬂ≈Ã ¬€œŒÀÕ≈ÕŒ ”—ÀŒ¬»≈ ¬€’Œƒ¿ »À» Õ≈“
		 IF(INDEXEXITRFX.EQ.5) THEN 
			! À≈¬¿ﬂ √–¿Õ»÷¿ Œœ–≈ƒ≈À≈Õ¿
			REleft=ExfMX(7)
            RfunLeft=DetMX(7)
		    ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈Õ€
            IparametrDeterEnergy=2
		 ENDIF
	  ENDIF
   ENDDO
    

 

   return
 end subroutine MinValueNormEnergyFunctionDD




 
 ! œŒƒœ–Œ√–¿ÃÃ¿  ŒÕ“–ŒÀﬂ ÿ¿√¿
 ! NMO-ÕŒÃ≈– ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
 ! IndexSmena-»Õƒ≈ — »«Ã≈Õ≈Õ»ﬂ ÿ¿√¿
 ! NumbreMaxRegion-Ã¿ —»Ã¿À‹ÕŒ≈ ◊»—ÀŒ »Õ“≈–¬¿ÀŒ¬  Œ–Õ≈…
 ! IndexRegion- ÕŒÃ≈– Œ¡À¿—“»  Œ–Õﬂ
 ! EnergyRegion(NMO,IndexRegion,2)-Ã¿——»¬ »Õ“≈–¬¿ÀŒ¬  Œ–Õ≈…
 ! Exf-ŒƒÕŒ›À≈ “–ŒÕÕ¿ﬂ ›Õ≈–√»ﬂ
 ! Henergy-ÿ¿√
 subroutine ControlH(NMO,IndexSmena,NumbreMaxRegion,IndexRegion,EnergyRegion,Exf,Henergy)
   implicit none
   integer::NMO,IndexSmena,NumbreMaxRegion,IndexRegion
   real(8)::Exf,Henergy
   real(8),dimension(:,:,:)::EnergyRegion
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   integer::IKLDF,IIIUU


   ! œ–Œ¬≈–ﬂ≈Ã Õ≈“ œ–»¬€ÿ≈Õ»ﬂ œŒ ◊»—À” »Õ“≈–¬¿ÀŒ¬  Œ–Õ≈…
   IF(IndexRegion.GT.NumbreMaxRegion) THEN
      ! ¬€’Œƒ»Ã »«-«¿ “Œ√Œ, ◊“Œ ¬—≈ »Õ“≈–¬¿À€ œ–Œ—ÃŒ“–≈Õ€
	  return
   ENDIF
   
   IKLDF=0
   IF(IndexSmena.EQ.0) THEN
      IKLDF=1
   ENDIF
   IF(IndexSmena.EQ.1) THEN
      IKLDF=2
   ENDIF 
   
      
   ! œ–Œ¬≈–ﬂ≈Ã ›Õ≈–√»ﬂ Õ¿’Œƒ»“—ﬂ ¬€ÿ≈ √–¿Õ»÷€ »Õ“≈–¬¿À¿
   IF(Exf.GT.EnergyRegion(NMO,IndexRegion,2)) THEN
      ! –≈∆»Ã ”Ã≈Õ‹ÿ≈Õ»ﬂ ÿ¿√¿ Œ“ Àﬁ◊»“‹
	  IndexSmena=0  
   ENDIF
   ! ›Õ≈–√»ﬂ Õ¿’Œƒ»“—ﬂ ¬ »Õ“≈–¬¿À≈
   IF(Exf.LT.EnergyRegion(NMO,IndexRegion,2).AND.Exf.GT.EnergyRegion(NMO,IndexRegion,1)) THEN
      ! ›Õ≈–√»ﬂ œŒœ¿À¿ ¬ »Õ“≈–¬¿À
      ! Œ—”Ÿ≈—“¬»“‹ ”Ã≈Õ‹ÿ≈Õ»≈ ÿ¿√¿
      IndexSmena=1
   ENDIF

   ! ›Õ≈–√»ﬂ Õ¿’Œƒ»“—ﬂ Õ»∆≈ √–¿Õ»÷€
   IIIUU=0
   IF(Exf.LT.EnergyRegion(NMO,IndexRegion,1)) THEN
      ! Œ“ Àﬁ◊¿≈Ã –≈∆»Ã ”Ã≈Õ‹ÿ≈Õ»ﬂ  Œ–Õﬂ
      IndexSmena=0
	  ! Œ¡À¿—“‹ ›Õ≈–√»» «¿ ŒÕ◊≈Õ¿ œ≈–≈’Œƒ»Ã   —À≈ƒ”ﬁŸ≈… Œ¡À¿—“»
      IndexRegion=IndexRegion+1
	  IIIUU=1
   ENDIF

   ! Œ—”Ÿ≈—“¬Àﬂ≈Ã ”Ã≈Õ‹ÿ≈Õ»≈ ÿ¿√¿
   IF(IndexSmena.EQ.1.AND.IKLDF.EQ.1) THEN
      Henergy=Henergy*0.1D0
   ENDIF

   ! ¬Œ«¬–¿Ÿ¿≈Ã –≈∆»Ã ¬ »—’ŒƒÕŒ≈ —Œ—“ŒﬂÕ»≈
   IF(IndexSmena.EQ.0.AND.IKLDF.EQ.2) THEN
      Henergy=Henergy*10.D0
   ENDIF

   
   ! œ–Œ¬≈–ﬂ≈Ã œ≈–≈ÿÀ»   ÕŒ¬Œ… Œ¡À¿—“» »À» Õ≈“
   IF(IIIUU.EQ.1) THEN
      ! œ–Œ¬≈–ﬂ≈Ã ◊“Œ¡€ ◊»—ÀŒ »Õ“≈–¬¿ÀŒ¬ Õ≈ œ–≈¬Œ—’Œƒ»ÀŒ Ã¿ —»Ã¿À‹ÕŒ√Œ ◊»—À¿ «Õ¿◊≈Õ»… 
      IF(IndexRegion.LE.NumbreMaxRegion) THEN
         ! œ–Œ¬≈–ﬂ≈Ã œŒœ¿À» Ã€ ¬ ÕŒ¬”ﬁ Œ¡À¿—“‹ »À» Õ≈“
	     IF(Exf.LT.EnergyRegion(NMO,IndexRegion,2).AND.Exf.GT.EnergyRegion(NMO,IndexRegion,1)) THEN
            ! ›Õ≈–√»ﬂ œŒœ¿À¿ ¬ »Õ“≈–¬¿À
            ! Œ—”Ÿ≈—“¬»“‹ ”Ã≈Õ‹ÿ≈Õ»≈ ÿ¿√¿
            IndexSmena=1
            Henergy=Henergy*0.1D0
	     ENDIF
      ENDIF
   ENDIF  
   
   return
 end subroutine ControlH

 ! œŒƒœ–Œ√–¿ÃÃ¿ ”—“¿Õ¿¬À»¬¿≈“  Œ›‘‘»÷»≈Õ“ —Ã≈ÿ»¬¿Õ»ﬂ
 ! N-ÕŒÃ≈– »“≈–¿÷»»
 ! E3-ŒƒÕŒ›À≈ “–ŒÕÕ¿ﬂ ›Õ≈–√»ﬂ Õ¿ N-2 »“≈–¿÷»»
 ! E2-ŒƒÕŒ›À≈ “–ŒÕÕ¿ﬂ ›Õ≈–√»ﬂ Õ¿ N-1 »“≈–¿÷»»
 ! E1-ŒƒÕŒ›À≈ “–ŒÕÕ¿ﬂ ›Õ≈–√»ﬂ Õ¿ N »“≈–¿÷»»
 real(8) function AnalysCoffMixing(N,E3,E2,E1)
   implicit none
   integer::N
   real(8)::E3,E2,E1
   !!!!!!!!!!!!!!!!!!!!!
   integer::NumbreStatus
   
   ! ‘» —»–Œ¬¿ÕÕŒ≈ «Õ¿◊≈Õ»≈ 
   AnalysCoffMixing=0.8D0
    
   ! ”—“¿Õ¿¬À»¬¿≈Ã –≈∆»Ã —Œ√À¿—Œ¬¿Õ»ﬂ
   IF((E3-E2).GT.0.D0.AND.(E2-E1).GT.0.D0) THEN
      NumbreStatus=1
   ENDIF
   IF((E3-E2).LT.0.D0.AND.(E2-E1).LT.0.D0) THEN
      NumbreStatus=1
   ENDIF
   IF((E3-E2).LT.0.D0.AND.(E2-E1).GT.0.D0) THEN
      NumbreStatus=2
   ENDIF 
   IF((E3-E1).GT.0.D0.AND.(E2-E1).LT.0.D0) THEN
      NumbreStatus=2
   ENDIF 
   
   IF(NumbreStatus.EQ.1) THEN
      IF(N.LT.10) THEN
          AnalysCoffMixing=0.8D0
	     ELSE
	      AnalysCoffMixing=0.8D0 
	      IF(DABS(E3-E2).LT.0.1D0) THEN
             AnalysCoffMixing=0.7D0
	      ENDIF
          IF(DABS(E3-E2).LT.0.01D0) THEN
             AnalysCoffMixing=0.6D0
	      ENDIF  
          IF(DABS(E3-E2).LT.0.001D0) THEN
             AnalysCoffMixing=0.5D0
	      ENDIF  
          IF(DABS(E3-E2).LT.0.0001D0) THEN
             AnalysCoffMixing=0.45D0
	      ENDIF  
          IF(DABS(E3-E2).LT.0.00001D0) THEN
             AnalysCoffMixing=0.4D0
	      ENDIF
      ENDIF	  
   ENDIF

   IF(NumbreStatus.EQ.2) THEN
      AnalysCoffMixing=0.9D0
   ENDIF	   
   
   return
 end function AnalysCoffMixing

 ! œŒƒœ–Œ√–¿ÃÃ¿ ”—“¿Õ¿¬À»¬¿≈“  Œ›‘‘»÷»≈Õ“ —Ã≈ÿ»¬¿Õ»ﬂ (¬ ”—»À≈ÕÕŒÃ –≈∆»Ã≈)
 ! N-ÕŒÃ≈– »“≈–¿÷»»
 ! E3-ŒƒÕŒ›À≈ “–ŒÕÕ¿ﬂ ›Õ≈–√»ﬂ Õ¿ N-2 »“≈–¿÷»»
 ! E2-ŒƒÕŒ›À≈ “–ŒÕÕ¿ﬂ ›Õ≈–√»ﬂ Õ¿ N-1 »“≈–¿÷»»
 ! E1-ŒƒÕŒ›À≈ “–ŒÕÕ¿ﬂ ›Õ≈–√»ﬂ Õ¿ N »“≈–¿÷»»
 real(8) function AnalysCoffMixingStrong(N,E3,E2,E1)
   implicit none
   integer::N
   real(8)::E3,E2,E1
   !!!!!!!!!!!!!!!!!!!!!
   integer::NumbreStatus
   
   ! ‘» —»–Œ¬¿ÕÕŒ≈ «Õ¿◊≈Õ»≈ 
   AnalysCoffMixingStrong=0.88D0
    
   ! ”—“¿Õ¿¬À»¬¿≈Ã –≈∆»Ã —Œ√À¿—Œ¬¿Õ»ﬂ
   IF((E3-E2).GT.0.D0.AND.(E2-E1).GT.0.D0) THEN
      NumbreStatus=1
   ENDIF
   IF((E3-E2).LT.0.D0.AND.(E2-E1).LT.0.D0) THEN
      NumbreStatus=1
   ENDIF
   IF((E3-E2).LT.0.D0.AND.(E2-E1).GT.0.D0) THEN
      NumbreStatus=2
   ENDIF 
   IF((E3-E1).GT.0.D0.AND.(E2-E1).LT.0.D0) THEN
      NumbreStatus=2
   ENDIF 
   
   IF(NumbreStatus.EQ.1) THEN
      IF(N.LT.10) THEN
          AnalysCoffMixingStrong=0.9D0
	     ELSE
	      AnalysCoffMixingStrong=0.9D0 
	      IF(DABS(E3-E2).LT.0.1D0) THEN
             AnalysCoffMixingStrong=0.86D0
	      ENDIF
          IF(DABS(E3-E2).LT.0.01D0) THEN
             AnalysCoffMixingStrong=0.83D0
	      ENDIF  
          IF(DABS(E3-E2).LT.0.001D0) THEN
             AnalysCoffMixingStrong=0.8D0
	      ENDIF  
          IF(DABS(E3-E2).LT.0.0001D0) THEN
             AnalysCoffMixingStrong=0.78D0
	      ENDIF  
          IF(DABS(E3-E2).LT.0.00001D0) THEN
             AnalysCoffMixingStrong=0.75D0
	      ENDIF
      ENDIF	  
   ENDIF

   IF(NumbreStatus.EQ.2) THEN
      AnalysCoffMixingStrong=0.95D0
   ENDIF	   
   
   return
 end function AnalysCoffMixingStrong 



 ! œŒƒœ–Œ√–¿ÃÃ¿ ”—“¿Õ¿¬À»¬¿≈“  Œ›‘‘»÷»≈Õ“ —Ã≈ÿ»¬¿Õ»ﬂ (¬ ”—»À≈ÕÕŒÃ –≈∆»Ã≈ 2)
 ! N-ÕŒÃ≈– »“≈–¿÷»»
 ! E3-ŒƒÕŒ›À≈ “–ŒÕÕ¿ﬂ ›Õ≈–√»ﬂ Õ¿ N-2 »“≈–¿÷»»
 ! E2-ŒƒÕŒ›À≈ “–ŒÕÕ¿ﬂ ›Õ≈–√»ﬂ Õ¿ N-1 »“≈–¿÷»»
 ! E1-ŒƒÕŒ›À≈ “–ŒÕÕ¿ﬂ ›Õ≈–√»ﬂ Õ¿ N »“≈–¿÷»»
 real(8) function AnalysCoffMixingStrong2(N,E3,E2,E1)
   implicit none
   integer::N
   real(8)::E3,E2,E1
   !!!!!!!!!!!!!!!!!!!!!
   integer::NumbreStatus
   
   ! ‘» —»–Œ¬¿ÕÕŒ≈ «Õ¿◊≈Õ»≈ 
   AnalysCoffMixingStrong2=0.93D0
    
   ! ”—“¿Õ¿¬À»¬¿≈Ã –≈∆»Ã —Œ√À¿—Œ¬¿Õ»ﬂ
   IF((E3-E2).GT.0.D0.AND.(E2-E1).GT.0.D0) THEN
      NumbreStatus=1
   ENDIF
   IF((E3-E2).LT.0.D0.AND.(E2-E1).LT.0.D0) THEN
      NumbreStatus=1
   ENDIF
   IF((E3-E2).LT.0.D0.AND.(E2-E1).GT.0.D0) THEN
      NumbreStatus=2
   ENDIF 
   IF((E3-E1).GT.0.D0.AND.(E2-E1).LT.0.D0) THEN
      NumbreStatus=2
   ENDIF 
   
   IF(NumbreStatus.EQ.1) THEN
      IF(N.LT.10) THEN
          AnalysCoffMixingStrong2=0.95D0
	     ELSE
	      AnalysCoffMixingStrong2=0.96D0 
	      IF(DABS(E3-E2).LT.0.1D0) THEN
             AnalysCoffMixingStrong2=0.98D0
	      ENDIF
          IF(DABS(E3-E2).LT.0.01D0) THEN
             AnalysCoffMixingStrong2=0.91D0
	      ENDIF  
          IF(DABS(E3-E2).LT.0.001D0) THEN
             AnalysCoffMixingStrong2=0.9D0
	      ENDIF  
          IF(DABS(E3-E2).LT.0.0001D0) THEN
             AnalysCoffMixingStrong2=0.89D0
	      ENDIF  
          IF(DABS(E3-E2).LT.0.00001D0) THEN
             AnalysCoffMixingStrong2=0.88D0
	      ENDIF
      ENDIF	  
   ENDIF

   IF(NumbreStatus.EQ.2) THEN
      AnalysCoffMixingStrong2=0.99D0
   ENDIF	   
   
   return
 end function AnalysCoffMixingStrong2 

 ! œŒƒœ–Œ√–¿ÃÃ¿ ”—“¿Õ¿¬À»¬¿≈“  Œ›‘‘»÷»≈Õ“ —Ã≈ÿ»¬¿Õ»ﬂ (¬ ”—»À≈ÕÕŒÃ –≈∆»Ã≈ 3)
 ! N-ÕŒÃ≈– »“≈–¿÷»»
 ! E3-ŒƒÕŒ›À≈ “–ŒÕÕ¿ﬂ ›Õ≈–√»ﬂ Õ¿ N-2 »“≈–¿÷»»
 ! E2-ŒƒÕŒ›À≈ “–ŒÕÕ¿ﬂ ›Õ≈–√»ﬂ Õ¿ N-1 »“≈–¿÷»»
 ! E1-ŒƒÕŒ›À≈ “–ŒÕÕ¿ﬂ ›Õ≈–√»ﬂ Õ¿ N »“≈–¿÷»»
 real(8) function AnalysCoffMixingStrong3(N,E3,E2,E1)
   implicit none
   integer::N
   real(8)::E3,E2,E1
   !!!!!!!!!!!!!!!!!!!!!
   integer::NumbreStatus
   
   ! ‘» —»–Œ¬¿ÕÕŒ≈ «Õ¿◊≈Õ»≈ 
   AnalysCoffMixingStrong3=0.97D0
    
   ! ”—“¿Õ¿¬À»¬¿≈Ã –≈∆»Ã —Œ√À¿—Œ¬¿Õ»ﬂ
   IF((E3-E2).GT.0.D0.AND.(E2-E1).GT.0.D0) THEN
      NumbreStatus=1
   ENDIF
   IF((E3-E2).LT.0.D0.AND.(E2-E1).LT.0.D0) THEN
      NumbreStatus=1
   ENDIF
   IF((E3-E2).LT.0.D0.AND.(E2-E1).GT.0.D0) THEN
      NumbreStatus=2
   ENDIF 
   IF((E3-E1).GT.0.D0.AND.(E2-E1).LT.0.D0) THEN
      NumbreStatus=2
   ENDIF 
   
   IF(NumbreStatus.EQ.1) THEN
      IF(N.LT.10) THEN
          AnalysCoffMixingStrong3=0.98D0
	     ELSE
	      AnalysCoffMixingStrong3=0.975D0 
	      IF(DABS(E3-E2).LT.0.1D0) THEN
             AnalysCoffMixingStrong3=0.99D0
	      ENDIF
          IF(DABS(E3-E2).LT.0.01D0) THEN
             AnalysCoffMixingStrong3=0.96D0
	      ENDIF  
          IF(DABS(E3-E2).LT.0.001D0) THEN
             AnalysCoffMixingStrong3=0.955D0
	      ENDIF  
          IF(DABS(E3-E2).LT.0.0001D0) THEN
             AnalysCoffMixingStrong3=0.94D0
	      ENDIF  
          IF(DABS(E3-E2).LT.0.00001D0) THEN
             AnalysCoffMixingStrong3=0.92D0
	      ENDIF
      ENDIF	  
   ENDIF

   IF(NumbreStatus.EQ.2) THEN
      AnalysCoffMixingStrong3=0.99D0
   ENDIF	   
   
   return
 end function AnalysCoffMixingStrong3 

 ! œŒƒœ–Œ√–¿ÃÃ¿ ‘Œ–Ã»–”≈Ã Ã¿——»¬€ ”◊¿¬—“¬”ﬁŸ»≈ ¬ –¿—◊≈“≈
 ! Npoint-◊»—ÀŒ “Œ◊≈  
 ! Isize-–¿«Ã≈– Ã¿——»¬¿
 ! Rcof- Œ›‘‘»÷»≈Õ“ –¿¬Õ€… H*H/12
 ! A(Isize,Isize,Npoint)-Ã¿——»¬ ƒÀﬂ –¿—◊≈“¿ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ »
 ! B(Isize,Isize,Npoint)-Ã¿——»¬ ƒÀﬂ –¿—◊≈“¿ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ »
 ! AA(Isize,Isize,Npoint)-Ã¿——»¬ ƒÀﬂ –¿—◊≈“¿ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » — ƒŒ¡¿¬À≈ÕÕ€Ã —À¿√¿≈Ã€Ã ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»» 
 ! BB(Isize,Isize,Npoint)-Ã¿——»¬ ƒÀﬂ –¿—◊≈“¿ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » — ƒŒ¡¿¬À≈ÕÕ€Ã —À¿√¿≈Ã€Ã ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»» 
 ! RO1X(Npoint)-Ã¿——»¬ œ≈–¬Œ… œ–Œ»«¬ŒƒÕŒ… ÕŒ¬Œ… œ≈–≈Ã≈ÕŒ… œŒ —“¿–Œ… œ≈–≈Ã≈ÕÕŒ…
 ! E,AZ,FZ,BZ-¬—œŒÃŒ√¿“≈À‹Õ€≈ Ã¿——»¬€
 subroutine FormMassivAABB(Npoint,Isize,Rcof,Exf,A,B,AA,BB,RO1X,E,AZ,FZ,BZ)
   implicit none
   integer::Npoint,Isize
   real(8)::Rcof,Exf
   real(8),dimension(:)::RO1X
   real(8),dimension(:,:)::E,AZ,FZ,BZ
   real(8),dimension(:,:,:)::A,B,AA,BB
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   integer::IIX,IYXDS
   
   ! ‘Œ–Ã»–”≈Ã Ã¿——»¬€ — ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»≈…
   E=0.D0
   DO IIX=1,Npoint
      ! œ≈–≈—◊»“€¬¿≈Ã «Õ¿◊≈Õ»≈ — ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»≈…         
  	  !DO IYXDS=1,Isize
      !    E(IYXDS,IYXDS)=Exf/RO1X(IIX)**2
      !ENDDO
	  FORALL (IYXDS=1:Isize) E(IYXDS,IYXDS)=Exf/RO1X(IIX)**2  
	    
	  ! ‘Œ–Ã»–”≈Ã œŒÀÕ€… Ã¿——»¬ A
      call ReadWriteMassiv2(2,IIX,Isize,A,FZ) 
      AZ=FZ-Rcof*E
	  call ReadWriteMassiv2(1,IIX,Isize,AA,AZ) 
	  ! ‘Œ–Ã»–”≈Ã œŒÀÕ€… Ã¿——»¬ B
	  call ReadWriteMassiv2(2,IIX,Isize,B,FZ) 
	  BZ=FZ+10.D0*Rcof*E
      call ReadWriteMassiv2(1,IIX,Isize,BB,BZ)  
   ENDDO

   return
 end subroutine FormMassivAABB

 ! œŒƒœ–Œ√–¿ÃÃ¿ ¬Œ——“¿ÕŒ¬À≈Õ»ﬂ «Õ¿◊≈Õ»… ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» ¬Œ ¬—≈’ “Œ◊ ¿’ »« “Œ◊ » —ÿ»¬ »
 ! NKLZ- Àﬁ◊ ” ¿«¬¿ﬁŸ»… “»œ –¿—◊≈“¿
 ! NKLZ=1-–¿—◊≈“ œ¿–¿Ã≈“–Œ¬ ƒÀﬂ —À”◊¿ﬂ ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€ ”–¿¬Õ≈Õ»…
 ! NKLZ=2-–¿—◊≈“ œ¿–¿Ã≈“–Œ¬ ƒÀﬂ —À”◊¿ﬂ Õ≈ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€ ”–¿¬Õ≈Õ»…
 ! Kpoint-“Œ◊ ¿ —ÿ»¬ »
 ! IndexM-–¿«Ã≈– Ã¿——»¬¿
 ! Npoint-◊»—ÀŒ “Œ◊≈ 
 ! NumeroMin-ÕŒÃ≈– œ≈–¬Œ… √¿–ÃŒÕ» »
 ! NumeroMax-ÕŒÃ≈– œŒ—À≈ƒÕ≈… √¿–ÃŒÕ» »
 ! H-ÿ¿√
 ! Vout(IndexM,IndexM,Npoint)- Ã¿——»¬ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » "Õ¿–”∆”"
 ! Uout(IndexM,Npoint)-Ã¿——»¬ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » "Õ¿–”∆”"
 ! Vin(IndexM,IndexM,Npoint)- Ã¿——»¬ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » "¬Õ”“–‹"
 ! Uin(IndexM,Npoint)-Ã¿——»¬ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » "¬Õ”“–‹"
 ! FunMO(NGarmonik,Npoint+2)-Ã¿——»¬ «Õ¿◊≈Õ»… –¿ƒ»¿À‹ÕŒ… ◊¿—“» ‘”Õ ÷»» ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
 ! AX,BX,BXL,CX,VNout,UNout,VNin,UNin-¬—œŒÃŒ√¿“≈À‹Õ€≈ Ã¿——»¬€
 ! RO1X(Npoint)-¬—œŒÃŒ√¿“≈À‹Õ€… Ã¿——»¬  œ≈–¬¿ﬂ œ–Œ»«¬ŒƒÕ¿ﬂ ÕŒ¬Œ… œ≈–≈Ã≈ÕÕŒ… œŒ —“¿–Œ… 
 ! NMO-ÕŒÃ≈– ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
 ! NumeroMaxLimid-Ã¿ —»Ã¿À‹ÕŒ≈ ◊»—ÀŒ √¿–ÃŒÕ»  ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
 ! NumbreLigand(NumbreMO)-Ã¿——»¬ ◊»—À¿ À»√¿ÕƒŒ¬ ‘”Õ ÷»»  Œ“Œ–€’ Œœ»—€¬¿ﬁ“ ¬€—ÿ»≈ √¿–ÃŒÕ» » ƒ¿ÕÕŒ… ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
 ! NLigands(NumbreMO,NumbreLigand(NumbreMO))-Ã¿——»¬ ÕŒÃ≈–Œ¬ À»√¿ÕƒŒ¬ ‘”Õ ÷»»  Œ“Œ–€’ Œœ»—€¬¿ﬁ“ ¬€—ÿ»≈ √¿–ÃŒÕ» » ƒ¿ÕÕŒ… ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
 ! NFunLigands(NumbreMO,NumbreLigand(NumbreMO))-Ã¿——»¬ ◊»—À¿ ‘”Õ ÷»…  ¿∆ƒŒ√Œ À»√¿Õƒ¿ Œœ»—€¬¿ﬁŸ»’ ¬€—ÿ»≈ √¿–ÃŒÕ» » ƒ¿ÕÕŒ… ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
 ! NumbreFunctionLig(NumbreMO,NumbreLigand(NumbreMO),NFunLigands(NumbreMO,NumbreLigand(NumbreMO)))-Ã¿——»¬ ÕŒÃ≈–Œ¬ ‘”Õ ÷»… À»√¿ÕƒŒ¬  Œ“Œ–€≈ —ŒŒ“¬≈“—“¬”ﬁ“ ƒ¿ÕÕŒ… ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
 ! RfunLigands(Nnuclei,NumbreFunctionLig,NumbreGarmLigand,Npoint+2)-Ã¿——»¬ «Õ¿◊≈Õ»… ‘”Õ ÷»… À»√¿ÕƒŒ¬
 ! AlfaCoffMO(NumbreMO,NumbreLigand,NumbreFunLigand)-Ã¿——»¬  Œ›‘‘»÷»≈Õ“Œ¬ —  Œ“Œ–€Ã» ‘”Õ ÷»… À»√¿Õƒ¿ ¬’Œƒﬂ“ ¬ —“–” “”–” ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» 
 subroutine FunctionRecovery(NKLZ,Kpoint,IndexM,Npoint,NumeroMin,NumeroMax,H,Vout,Uout,Vin,Uin,FunMO,AX,BX,BXL,CX,VNout,UNout,VNin,UNin,RO1X,NMO,NumeroMaxLimid,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,RfunLigands,AlfaCoffMO)
   implicit none
   integer::Kpoint,IndexM,Npoint,NumeroMin,NumeroMax,NKLZ,NMO,NumeroMaxLimid
   real(8)::H
   integer,dimension(:)::NumbreLigand
   integer,dimension(:,:)::NLigands,NFunLigands
   integer,dimension(:,:,:)::NumbreFunctionLig
   real(8),dimension(:)::AX,BX,BXL,CX,UNout,UNin,RO1X
   real(8),dimension(:,:)::Uout,Uin,FunMO,VNout,VNin
   real(8),dimension(:,:,:)::Vout,Vin,AlfaCoffMO 
   real(8),dimension(:,:,:,:)::RfunLigands
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   integer::IXXZ,IILV,IIDF,IOFG
   real(8)::RnormConstas
   
   10000 FORMAT(2X,100(1X,F20.16))

   IF(NKLZ.EQ.1) THEN
        ! œŒÀ”◊¿≈Ã –≈ÿ≈Õ»≈ ƒÀﬂ ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€  
        
		! ¬Œ——“¿Õ¿¬À»¬¿≈Ã «Õ¿◊≈Õ»≈ –¿ƒ»¿À‹ÕŒ… ◊¿—“» ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» ¬ “Œ◊ ¿’ (1,Kpoint-1)
		DO IXXZ=Kpoint-1,1,-1 
           ! —◊»“€¬¿≈Ã «Õ¿◊≈Õ»≈ ‘”Õ ÷»» ¬ “Œ◊ ≈  IXXZ+1 +(2)-Õ¿◊¿ÀŒ Õ”Ã≈–¿÷»» — 3 “Œ◊ ≈ ¬ Ã¿——»¬≈
	       call ReadWriteMassiv1X(2,IXXZ+3,NumeroMin,NumeroMax,FunMO,AX)
	       !WRITE(6,*) 'POINTGGGGGG',IXXZ+1
	       !WRITE(6,10000) (AX(IOFG),IOFG=1,IndexM)
           ! —◊»“€¬¿≈Ã «Õ¿◊≈Õ»≈ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ »
	       call ReadWriteMassiv2(2,IXXZ,IndexM,Vout,VNout)
	       !WRITE(6,*) 'POINT',IXXZ
	       !DO IIDF=1,IndexM
           !   WRITE(6,10000) (VNout(IIDF,IOFG),IOFG=1,IndexM)
	       !ENDDO
	       !WRITE(6,*)
	       ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ «Õ¿◊≈Õ»… ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» (œ¿–÷»¿À‹Õ€’ √¿–ÃŒÕ» ) ¬ “Œ◊ ≈ IXXZ 
	       BX=MATMUL(VNout,AX)
	       ! «¿œ»—€¬¿≈Ã –≈«”À‹“¿“ 
           call ReadWriteMassiv1X(1,IXXZ+2,NumeroMin,NumeroMax,FunMO,BX)
        ENDDO
   
        ! ¬Œ——“¿Õ¿¬À»¬¿≈Ã «Õ¿◊≈Õ»≈ –¿ƒ»¿À‹ÕŒ… ◊¿—“» ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» ¬ “Œ◊ ¿’ (Kpoint+1,Npoint)
        DO IXXZ=Kpoint+1,Npoint 
           ! —◊»“€¬¿≈Ã «Õ¿◊≈Õ»≈ ‘”Õ ÷»» ¬ “Œ◊ ≈  IXXZ-1 +(2)-Õ¿◊¿ÀŒ Õ”Ã≈–¿÷»» — 3 “Œ◊ ≈ ¬ Ã¿——»¬≈
	       call ReadWriteMassiv1X(2,IXXZ+1,NumeroMin,NumeroMax,FunMO,AX)
	       !WRITE(6,*) 'POINTGGGGGG',IXXZ-1
	       !WRITE(6,10000) (AX(IOFG),IOFG=1,IndexM)
           ! —◊»“€¬¿≈Ã «Õ¿◊≈Õ»≈ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ »
	       call ReadWriteMassiv2(2,IXXZ,IndexM,Vin,VNin)
	       ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ «Õ¿◊≈Õ»… ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» (œ¿–÷»¿À‹Õ€’ √¿–ÃŒÕ» ) ¬ “Œ◊ ≈ IXXZ 
	       BX=MATMUL(VNin,AX)
	       ! «¿œ»—€¬¿≈Ã –≈«”À‹“¿“ 
           call ReadWriteMassiv1X(1,IXXZ+2,NumeroMin,NumeroMax,FunMO,BX)
        ENDDO
   	  
   ENDIF	  

   IF(NKLZ.EQ.2) THEN

        ! œŒÀ”◊¿≈Ã –≈ÿ≈Õ»≈ ƒÀﬂ Õ≈ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€
		! ¬Œ——“¿Õ¿¬À»¬¿≈Ã «Õ¿◊≈Õ»≈ –¿ƒ»¿À‹ÕŒ… ◊¿—“» ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» ¬ “Œ◊ ¿’ (1,Kpoint-1)
		DO IXXZ=Kpoint-1,1,-1 
           ! —◊»“€¬¿≈Ã «Õ¿◊≈Õ»≈ ‘”Õ ÷»» ¬ “Œ◊ ≈  IXXZ+1 +(2)-Õ¿◊¿ÀŒ Õ”Ã≈–¿÷»» — 3 “Œ◊ ≈ ¬ Ã¿——»¬≈
	       call ReadWriteMassiv1X(2,IXXZ+3,NumeroMin,NumeroMax,FunMO,AX)
	       !WRITE(6,*) 'POINTGGGGGG',IXXZ+1
	       !WRITE(6,10000) (AX(IOFG),IOFG=1,IndexM)
           ! —◊»“€¬¿≈Ã «Õ¿◊≈Õ»≈ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ »
	       call ReadWriteMassiv2(2,IXXZ,IndexM,Vout,VNout)
	       call ReadWriteMassiv1(2,IXXZ,IndexM,Uout,UNout)  
           !WRITE(6,*) 'POINT',IXXZ
	       !DO IIDF=1,IndexM
           !   WRITE(6,10000) (VNout(IIDF,IOFG),IOFG=1,IndexM)
	       !ENDDO
	       !WRITE(6,*)
	       ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ «Õ¿◊≈Õ»… ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» (œ¿–÷»¿À‹Õ€’ √¿–ÃŒÕ» ) ¬ “Œ◊ ≈ IXXZ 
	       BX=UNout+MATMUL(VNout,AX)
	       ! «¿œ»—€¬¿≈Ã –≈«”À‹“¿“ 
           call ReadWriteMassiv1X(1,IXXZ+2,NumeroMin,NumeroMax,FunMO,BX)
        ENDDO
   
        ! ¬Œ——“¿Õ¿¬À»¬¿≈Ã «Õ¿◊≈Õ»≈ –¿ƒ»¿À‹ÕŒ… ◊¿—“» ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» ¬ “Œ◊ ¿’ (Kpoint+1,Npoint)
        DO IXXZ=Kpoint+1,Npoint 
           ! —◊»“€¬¿≈Ã «Õ¿◊≈Õ»≈ ‘”Õ ÷»» ¬ “Œ◊ ≈  IXXZ-1 +(2)-Õ¿◊¿ÀŒ Õ”Ã≈–¿÷»» — 3 “Œ◊ ≈ ¬ Ã¿——»¬≈
	       call ReadWriteMassiv1X(2,IXXZ+1,NumeroMin,NumeroMax,FunMO,AX)
	       !WRITE(6,*) 'POINTGGGGGG',IXXZ-1
	       !WRITE(6,10000) (AX(IOFG),IOFG=1,IndexM)
           ! —◊»“€¬¿≈Ã «Õ¿◊≈Õ»≈ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ »
	       call ReadWriteMassiv2(2,IXXZ,IndexM,Vin,VNin)
	       call ReadWriteMassiv1(2,IXXZ,IndexM,Uin,UNin)  
           ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ «Õ¿◊≈Õ»… ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» (œ¿–÷»¿À‹Õ€’ √¿–ÃŒÕ» ) ¬ “Œ◊ ≈ IXXZ 
	       BX=UNin+MATMUL(VNin,AX)
	       ! «¿œ»—€¬¿≈Ã –≈«”À‹“¿“ 
           call ReadWriteMassiv1X(1,IXXZ+2,NumeroMin,NumeroMax,FunMO,BX)
        ENDDO
   ENDIF

   ! ‘Œ–Ã»–”≈Ã —“–” “”–” ¬€—ÿ»’ √¿–ÃŒÕ»  ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
		
   ! Œœ–≈ƒ≈Àﬂ≈Ã  Œ›‘‘»÷»≈Õ“€ ¿À‹‘¿
   call CalculationCoffAlfaMO(NMO,Npoint,H,NumeroMax,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,FunMO,RfunLigands,AlfaCoffMO,RO1X) 
        
   ! ‘Œ–Ã»–”≈Ã —“–” “”–” ¬€—ÿ»’ √¿–ÃŒÕ»  ÃŒÀ≈ ”Àﬂ–Õ€’ Œ–¡»“¿À≈… — ”◊≈“ŒÃ œŒÀ”◊≈ÕÕ€’  Œ›‘‘»÷»≈Õ“Œ¬ ¿À‹‘¿
   call FormStructureMO(NMO,Npoint,H,NumeroMax,NumeroMaxLimid,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,FunMO,RfunLigands,AlfaCoffMO) 



   
   ! ÕŒ–Ã»–”≈Ã œŒÀ”◊≈ÕÕ”ﬁ ÃŒÀ≈ ”Àﬂ–Õ”ﬁ Œ–¡»“¿À‹
   RnormConstas=CalculationNormalizationConsta(NumeroMin,NumeroMaxLimid,Npoint,H,RO1X,FunMO) 

   !WRITE(*,*) 'NORMA',RnormConstas
   !READ(*,*)

   ! «¿œ»—€¬¿≈Ã œŒÀ”◊≈ÕÕ”ﬁ ÕŒ–Ã»–Œ¬Œ◊Õ”ﬁ  ŒÕ—“¿Õ“” 
   BXL=RnormConstas
   call ReadWriteMassiv1X(1,2,NumeroMin,NumeroMaxLimid,FunMO,BXL)

   !WRITE(*,*) 'NORMA',BX
   !READ(*,*)

   
   !DO IXXZ=1,Npoint
   !   WRITE(6,10000) (FunMO(IILV,IXXZ+2)/DSQRT(RnormConstas*RO1X(IXXZ)),IILV=NumeroMin,NumeroMax)
   !ENDDO

   
   return
 end subroutine FunctionRecovery


 ! œŒƒ–Œ√–¿ÃÃ¿ –¿—◊≈“¿ ÕŒ–Ã»–Œ¬Œ◊ÕŒ√Œ  Œ›‘‘»÷»≈Õ“¿ œŒÀ”◊≈ÕÕŒ… ‘”Õ ÷»»
 ! NMO- ÕŒÃ≈– ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
 ! NumeroMin-ÕŒÃ≈– œ≈–¬Œ… √¿–ÃŒÕ» »
 ! NumeroMax-ÕŒÃ≈– œŒ—À≈ƒÕ≈… √¿–ÃŒÕ» »
 ! Npoint-◊»—ÀŒ “Œ◊≈ 
 ! H-ÿ¿√
 ! RO1X(Npoint)-¬—œŒÃŒ√¿“≈À‹Õ€… Ã¿——»¬  œ≈–¬¿ﬂ œ–Œ»«¬ŒƒÕ¿ﬂ ÕŒ¬Œ… œ≈–≈Ã≈ÕÕŒ… œŒ —“¿–Œ… 
 ! FunMO(NMO,NGarmonik,Npoint+2)-Ã¿——»¬ «Õ¿◊≈Õ»… –¿ƒ»¿À‹ÕŒ… ◊¿—“» ‘”Õ ÷»» ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
 real(8) function CalculationNormalizationConstaResult(NMO,NumeroMin,NumeroMax,Npoint,H,RO1X,FunMO) 
   implicit none
   integer::NumeroMin,NumeroMax,Npoint,NMO
   real(8)::H
   real(8),dimension(:)::RO1X
   real(8),dimension(:,:,:)::FunMO
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   integer::INNC,IDFZ
   real(8)::Snorm,SING,SING2,SING1,R0,RN1,RN

  
   Snorm=0.D0
   DO INNC=NumeroMin,NumeroMax
      SING=0.D0 
	  !DO IDFZ=1,Npoint2
      !   SING=SING+(FunMO(NMO,INNC,IDFZ+2)/RO1X(IDFZ))**2
	  !ENDDO
      !Snorm=Snorm+sum((FunMO(NMO,INNC,2+1:Npoint)/RO1X(1:Npoint))**2)
      
	  ! œ–Œ¬≈–ﬂ≈Ã ◊≈“ÕŒ≈ ◊»—ÀŒ “Œ◊≈  »À» Õ≈◊≈“ÕŒ≈ ◊»—ÀŒ “Œ◊≈ 
      IF(Npoint/2..EQ.Npoint/2) THEN
	        ! –¿—◊≈“ œŒ ‘Œ–Ã”À≈ —»Ãœ—ŒÕ¿
            ! ◊≈“ÕŒ≈ ◊»—ÀŒ “Œ◊≈ 
            SING2=0.D0
		    DO IDFZ=2,Npoint-2,2
               SING2=SING2+(FunMO(NMO,INNC,IDFZ+2)/RO1X(IDFZ))**2
	        ENDDO
            SING1=0.D0
		    DO IDFZ=3,Npoint-3,2
               SING1=SING1+(FunMO(NMO,INNC,IDFZ+2)/RO1X(IDFZ))**2
	        ENDDO
		    ! –≈«”À‹“»–”ﬁŸ¿ﬂ —”ÃÃ¿ 
		    R0=(FunMO(NMO,INNC,3)/RO1X(1))**2
		    RN1=(FunMO(NMO,INNC,Npoint+1)/RO1X(Npoint-1))**2
		    RN=(FunMO(NMO,INNC,Npoint+2)/RO1X(Npoint))**2
            SING=(R0+4.D0*SING2+2.D0*SING1+RN1)/3.D0+(RN1+RN)*0.5D0
         ELSE
            ! –¿◊≈“ œŒ ‘Œ–Ã”À≈ —»Ãœ—ŒÕ¿
			! Õ≈◊≈“ÕŒ≈ ◊»—ÀŒ “Œ◊≈ 
            SING2=0.D0
		    DO IDFZ=2,Npoint-1,2
               SING2=SING2+(FunMO(NMO,INNC,IDFZ+2)/RO1X(IDFZ))**2
	        ENDDO
            SING1=0.D0
		    DO IDFZ=3,Npoint-2,2
               SING1=SING1+(FunMO(NMO,INNC,IDFZ+2)/RO1X(IDFZ))**2
	        ENDDO
            ! –≈«”À‹“»–”ﬁŸ¿ﬂ —”ÃÃ¿ 
		    R0=(FunMO(NMO,INNC,3)/RO1X(1))**2
		    RN=(FunMO(NMO,INNC,Npoint+2)/RO1X(Npoint))**2
            SING=(R0+4.D0*SING2+2.D0*SING1+RN)/3.D0
      ENDIF
      ! —”ÃÃ»–”≈Ã »Õ“≈√–¿À€
	  Snorm=Snorm+SING
   ENDDO

   CalculationNormalizationConstaResult=Snorm*H
  

   return
 end function CalculationNormalizationConstaResult




 
 
 ! œŒƒ–Œ√–¿ÃÃ¿ –¿—◊≈“¿ ÕŒ–Ã»–Œ¬Œ◊ÕŒ√Œ  Œ›‘‘»÷»≈Õ“¿
 ! NumeroMin-ÕŒÃ≈– œ≈–¬Œ… √¿–ÃŒÕ» »
 ! NumeroMax-ÕŒÃ≈– œŒ—À≈ƒÕ≈… √¿–ÃŒÕ» »
 ! Npoint-◊»—ÀŒ “Œ◊≈ 
 ! H-ÿ¿√
 ! RO1X(Npoint)-¬—œŒÃŒ√¿“≈À‹Õ€… Ã¿——»¬  œ≈–¬¿ﬂ œ–Œ»«¬ŒƒÕ¿ﬂ ÕŒ¬Œ… œ≈–≈Ã≈ÕÕŒ… œŒ —“¿–Œ… 
 ! FunMO(NGarmonik,Npoint+2)-Ã¿——»¬ «Õ¿◊≈Õ»… –¿ƒ»¿À‹ÕŒ… ◊¿—“» ‘”Õ ÷»» ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
 real(8) function CalculationNormalizationConsta(NumeroMin,NumeroMax,Npoint,H,RO1X,FunMO) 
   implicit none
   integer::NumeroMin,NumeroMax,Npoint
   real(8)::H
   real(8),dimension(:)::RO1X
   real(8),dimension(:,:)::FunMO
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   integer::INNC,IDFZ
   real(8)::Snorm,SING,SING2,SING1,R0,RN1,RN

   Snorm=0.D0
   DO INNC=NumeroMin,NumeroMax
      SING=0.D0 
	  !DO IDFZ=1,Npoint
      !   SING=SING+(FunMO(INNC,IDFZ+2)/RO1X(IDFZ))**2
	  !ENDDO
	  !Snorm=Snorm+sum((FunMO(INNC,2+1:Npoint)/RO1X(1:Npoint))**2)
      ! œ–Œ¬≈–ﬂ≈Ã ◊≈“ÕŒ≈ ◊»—ÀŒ “Œ◊≈  »À» Õ≈◊≈“ÕŒ≈ ◊»—ÀŒ “Œ◊≈ 
      IF(Npoint/2..EQ.Npoint/2) THEN
	        ! –¿—◊≈“ œŒ ‘Œ–Ã”À≈ —»Ãœ—ŒÕ¿
            ! ◊≈“ÕŒ≈ ◊»—ÀŒ “Œ◊≈ 
            SING2=0.D0
		    DO IDFZ=2,Npoint-2,2
               SING2=SING2+(FunMO(INNC,IDFZ+2)/RO1X(IDFZ))**2
	        ENDDO
            SING1=0.D0
		    DO IDFZ=3,Npoint-3,2
               SING1=SING1+(FunMO(INNC,IDFZ+2)/RO1X(IDFZ))**2
	        ENDDO
		    ! –≈«”À‹“»–”ﬁŸ¿ﬂ —”ÃÃ¿ 
		    R0=(FunMO(INNC,3)/RO1X(1))**2
		    RN1=(FunMO(INNC,Npoint+1)/RO1X(Npoint-1))**2
		    RN=(FunMO(INNC,Npoint+2)/RO1X(Npoint))**2
            SING=(R0+4.D0*SING2+2.D0*SING1+RN1)/3.D0+(RN1+RN)*0.5D0
         ELSE
            ! –¿◊≈“ œŒ ‘Œ–Ã”À≈ —»Ãœ—ŒÕ¿
			! Õ≈◊≈“ÕŒ≈ ◊»—ÀŒ “Œ◊≈ 
            SING2=0.D0
		    DO IDFZ=2,Npoint-1,2
               SING2=SING2+(FunMO(INNC,IDFZ+2)/RO1X(IDFZ))**2
	        ENDDO
            SING1=0.D0
		    DO IDFZ=3,Npoint-2,2
               SING1=SING1+(FunMO(INNC,IDFZ+2)/RO1X(IDFZ))**2
	        ENDDO
            ! –≈«”À‹“»–”ﬁŸ¿ﬂ —”ÃÃ¿ 
		    R0=(FunMO(INNC,3)/RO1X(1))**2
		    RN=(FunMO(INNC,Npoint+2)/RO1X(Npoint))**2
            SING=(R0+4.D0*SING2+2.D0*SING1+RN)/3.D0
      ENDIF
      ! —”ÃÃ»–”≈Ã »Õ“≈√–¿À€
	  Snorm=Snorm+SING
   ENDDO

   CalculationNormalizationConsta=Snorm*H

   return
 end function CalculationNormalizationConsta




  ! œŒƒœ–Œ√–¿ÃÃ¿ Œœ–≈ƒ≈ÀﬂﬁŸ¿ﬂ  Œ›‘‘»÷»≈Õ“ ¿À‹‘¿ ¬’ŒƒﬂŸ»… ¬ —“–” “”–” ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
  ! NMO-ÕŒÃ≈– ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
  ! Npoint-◊»—ÀŒ “Œ◊≈ 
  ! H-ÿ¿√ 
  ! NumbreGarmMO-◊»—ÀŒ √¿–ÃŒÕ»  ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» ƒŒ Lk ¬ Àﬁ◊»“≈À‹ÕŒ
  ! NumbreLigand(NumbreMO)-Ã¿——»¬ ◊»—À¿ À»√¿ÕƒŒ¬ ‘”Õ ÷»»  Œ“Œ–€’ Œœ»—€¬¿ﬁ“ ¬€—ÿ»≈ √¿–ÃŒÕ» » ƒ¿ÕÕŒ… ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
  ! NLigands(NumbreMO,NumbreLigand(NumbreMO))-Ã¿——»¬ ÕŒÃ≈–Œ¬ À»√¿ÕƒŒ¬ ‘”Õ ÷»»  Œ“Œ–€’ Œœ»—€¬¿ﬁ“ ¬€—ÿ»≈ √¿–ÃŒÕ» » ƒ¿ÕÕŒ… ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
  ! NFunLigands(NumbreMO,NumbreLigand(NumbreMO))-Ã¿——»¬ ◊»—À¿ ‘”Õ ÷»…  ¿∆ƒŒ√Œ À»√¿Õƒ¿ Œœ»—€¬¿ﬁŸ»’ ¬€—ÿ»≈ √¿–ÃŒÕ» » ƒ¿ÕÕŒ… ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
  ! NumbreFunctionLig(NumbreMO,NumbreLigand(NumbreMO),NFunLigands(NumbreMO,NumbreLigand(NumbreMO)))-Ã¿——»¬ ÕŒÃ≈–Œ¬ ‘”Õ ÷»… À»√¿ÕƒŒ¬  Œ“Œ–€≈ —ŒŒ“¬≈“—“¬”ﬁ“ ƒ¿ÕÕŒ… ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
  ! RFunMO(NumbreGarmMO,Npoint+2)-Ï‡ÒÒË‚ ÁÌ‡˜ÂÌËÈ ‡‰Ë‡Î¸Ì˚ı ˜‡ÒÚÂÈ  „‡ÏÓÌËÍ ÏÓÎÂÍÛÎˇÌ˚ı Ó·ËÚ‡ÎÂÈ ÍÓÌÙË„Û‡ˆËË  
  ! RfunLigands(Nnuclei,NumbreFunctionLig,NumbreGarmLigand,Npoint+2)-Ã¿——»¬ «Õ¿◊≈Õ»… ‘”Õ ÷»… À»√¿ÕƒŒ¬
  ! AlfaCoffMO(NumbreMO,NumbreLigand,NumbreFunLigand)-Ã¿——»¬  Œ›‘‘»÷»≈Õ“Œ¬ —  Œ“Œ–€Ã» ‘”Õ ÷»… À»√¿Õƒ¿ ¬’Œƒﬂ“ ¬ —“–” “”–” ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» 
  ! RO1X(Npoint)-¬—œŒÃŒ√¿“≈À‹Õ€… Ã¿——»¬  œ≈–¬¿ﬂ œ–Œ»«¬ŒƒÕ¿ﬂ ÕŒ¬Œ… œ≈–≈Ã≈ÕÕŒ… œŒ —“¿–Œ… 
  subroutine CalculationCoffAlfaMO(NMO,Npoint,H,NumbreGarmMO,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,RFunMO,RfunLigands,AlfaCoffMO,RO1X) 
    implicit none
    integer::NMO,Npoint,NumbreGarmMO
	real(8)::H
    integer,dimension(:)::NumbreLigand
    integer,dimension(:,:)::NLigands,NFunLigands
    integer,dimension(:,:,:)::NumbreFunctionLig
	real(8),dimension(:)::RO1X 
    real(8),dimension(:,:)::RFunMO
	real(8),dimension(:,:,:)::AlfaCoffMO
    real(8),dimension(:,:,:,:)::RfunLigands
    !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
	integer::NumbreFunMOZ,IIXX,IIXY,NumbreFunLigZX,NumbreLigandVV,NumbreGMOAS
	integer::NumbreLigandVV1,NumbreLigandVV2,NumbreLigandVV3,NumbreFunLigZX1,NumbreFunLigZX2,NumbreFunLigZX3,NumbreGMOAS1,NumbreGMOAS2,NumbreGMOAS3
    integer::ISUMINDEX,IXZZ1,IXZY1
	real(8)::Snorm,RintMO,RintFL,RintMO1,RintMO2,RintMO3,RintFL11,RintFL12,RintFL13,RintFL21,RintFL22,RintFL23,RintFL31,RintFL32,RintFL33
    real(8)::Rdelta,Rdelta1,Rdelta2,Rdelta3

	! Œœ–≈ƒ≈Àﬂ≈Ã ◊»—ÀŒ ‘”Õ ÷»… À»√¿ÕƒŒ¬ Œœ»—€¬¿ﬁŸ»≈ ¬€—ÿ»≈ √¿–ÃŒÕ» » ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
    NumbreFunMOZ=0
	DO IIXX=1,NumbreLigand(NMO)
       NumbreFunMOZ=NumbreFunMOZ+NFunLigands(NMO,IIXX)
	ENDDO

	! œ–Œ¬≈–ﬂ≈Ã ◊»—ÀŒ ”—“¿ÕŒ¬À≈ÕÕ€’ ‘”Õ ÷»…
	IF(NumbreFunMOZ.GT.3) THEN
       WRITE(6,*) 'ERROR. Numbre function of ligands >3 NumbreFunMOZ= ',NumbreFunMOZ 
	   WRITE(7,*) 'ERROR. Numbre function of ligands >3 NumbreFunMOZ= ',NumbreFunMOZ  
	   WRITE(*,*) 'ERROR. Numbre function of ligands >3 NumbreFunMOZ= ',NumbreFunMOZ 
	   READ(*,*)
	   STOP
	ENDIF
    
	! —À”◊¿… ŒƒÕŒ… ‘”Õ ÷»»
	IF(NumbreFunMOZ.EQ.1) THEN
       ! ÕŒÃ≈– √¿–ÃŒÕ»  œŒ  Œ“Œ–Œ… Œ—”Ÿ≈—“¬ﬂ≈Ã Œœ–≈ƒ≈À≈Õ»≈  Œ›‘‘»÷»≈Õ“Œ¬
	   NumbreGMOAS=NumbreGarmMO
	   ! ÕŒÃ≈– À»√¿Õƒ¿
	   NumbreLigandVV=NLigands(NMO,1)
       ! ÕŒÃ≈– ‘”Õ ÷»» À»√¿Õƒ¿
	   NumbreFunLigZX=NumbreFunctionLig(NMO,1,1)
	   RintMO=sum((RFunMO(NumbreGMOAS,2+1:Npoint)/RO1X(1:Npoint))**2)*H !/RFunMO(NumbreGMOAS,2) 
	   RintFL=sum(RFunMO(NumbreGMOAS,2+1:Npoint)*RfunLigands(NumbreLigandVV,NumbreFunLigZX,NumbreGMOAS,2+1:Npoint)/RO1X(1:Npoint)**2)*H !/DSQRT(RFunMO(NumbreGMOAS,2)*RfunLigands(NumbreLigandVV,NumbreFunLigZX,NumbreGMOAS,2)) 
	   ! –¿—◊»“€¬¿≈Ã  Œ›‘‘»÷»≈Õ“ ¿À‹‘¿
	   AlfaCoffMO(NMO,NumbreLigandVV,NumbreFunLigZX)=RintMO/RintFL
	ENDIF
    
	! —À”◊¿… ƒ¬”’ ‘”Õ ÷»…
    IF(NumbreFunMOZ.EQ.2) THEN
       ! ÕŒÃ≈– √¿–ÃŒÕ»  œŒ  Œ“Œ–Œ… Œ—”Ÿ≈—“¬ﬂ≈Ã Œœ–≈ƒ≈À≈Õ»≈  Œ›‘‘»÷»≈Õ“Œ¬
	   NumbreGMOAS1=NumbreGarmMO-1
	   NumbreGMOAS2=NumbreGarmMO
       ! œ–Œ¬≈–ﬂ≈Ã ◊»—ÀŒ À»√¿ÕƒŒ¬
	   IF(NumbreLigand(NMO).EQ.2) THEN
            ! ÕŒÃ≈– À»√¿ÕƒŒ¬
			NumbreLigandVV1=NLigands(NMO,1)
            NumbreLigandVV2=NLigands(NMO,2)
            ! ÕŒÃ≈– ‘”Õ ÷»…
            NumbreFunLigZX1=NumbreFunctionLig(NMO,1,1)
            NumbreFunLigZX2=NumbreFunctionLig(NMO,2,1)
          ELSE
		    ! ÕŒÃ≈– À»√¿ÕƒŒ¬
			NumbreLigandVV1=NLigands(NMO,1)
            NumbreLigandVV2=NLigands(NMO,1)
            ! ÕŒÃ≈– ‘”Õ ÷»…
			NumbreFunLigZX1=NumbreFunctionLig(NMO,1,1)
            NumbreFunLigZX2=NumbreFunctionLig(NMO,1,2)
       ENDIF
       RintMO1=sum((RFunMO(NumbreGMOAS1,2+1:Npoint)/RO1X(1:Npoint))**2)*H !/RFunMO(NumbreGMOAS1,2)        
       RintMO2=sum((RFunMO(NumbreGMOAS2,2+1:Npoint)/RO1X(1:Npoint))**2)*H !/RFunMO(NumbreGMOAS2,2)
       RintFL11=sum(RFunMO(NumbreGMOAS1,2+1:Npoint)*RfunLigands(NumbreLigandVV1,NumbreFunLigZX1,NumbreGMOAS1,2+1:Npoint)/RO1X(1:Npoint)**2)*H !/DSQRT(RFunMO(NumbreGMOAS1,2)*RfunLigands(NumbreLigandVV1,NumbreFunLigZX1,NumbreGMOAS1,2)) 
	   RintFL12=sum(RFunMO(NumbreGMOAS1,2+1:Npoint)*RfunLigands(NumbreLigandVV2,NumbreFunLigZX2,NumbreGMOAS1,2+1:Npoint)/RO1X(1:Npoint)**2)*H !/DSQRT(RFunMO(NumbreGMOAS1,2)*RfunLigands(NumbreLigandVV2,NumbreFunLigZX2,NumbreGMOAS1,2))
	   RintFL21=sum(RFunMO(NumbreGMOAS2,2+1:Npoint)*RfunLigands(NumbreLigandVV1,NumbreFunLigZX1,NumbreGMOAS2,2+1:Npoint)/RO1X(1:Npoint)**2)*H !/DSQRT(RFunMO(NumbreGMOAS2,2)*RfunLigands(NumbreLigandVV1,NumbreFunLigZX1,NumbreGMOAS2,2)) 
	   RintFL22=sum(RFunMO(NumbreGMOAS2,2+1:Npoint)*RfunLigands(NumbreLigandVV2,NumbreFunLigZX2,NumbreGMOAS2,2+1:Npoint)/RO1X(1:Npoint)**2)*H !/DSQRT(RFunMO(NumbreGMOAS2,2)*RfunLigands(NumbreLigandVV2,NumbreFunLigZX2,NumbreGMOAS2,2))
	   ! –¿—◊»“€¬¿≈Ã  Œ›‘‘»÷»≈Õ“€ ¿À‹‘¿
	   AlfaCoffMO(NMO,NumbreLigandVV2,NumbreFunLigZX2)=(RintFL21*RintMO1-RintFL11*RintMO2)/(RintFL12*RintFL21-RintFL11*RintFL22)  
       AlfaCoffMO(NMO,NumbreLigandVV1,NumbreFunLigZX1)=(RintMO1-AlfaCoffMO(NMO,NumbreLigandVV2,NumbreFunLigZX2)*RintFL12)/RintFL11
	  
	ENDIF

    ! —À”◊¿… “–≈’ ‘”Õ ÷»…
    IF(NumbreFunMOZ.EQ.3) THEN
	   ! ÕŒÃ≈–¿ √¿–ÃŒÕ»  œŒ  Œ“Œ–Œ… Œ—”Ÿ≈—“¬ﬂ≈Ã Œœ–≈ƒ≈À≈Õ»≈  Œ›‘‘»÷»≈Õ“Œ¬
	   NumbreGMOAS1=NumbreGarmMO-2
	   NumbreGMOAS2=NumbreGarmMO-1
	   NumbreGMOAS3=NumbreGarmMO
       
	   ISUMINDEX=0
	   ! ÷» À œŒ À»√¿Õƒ¿Ã
	   DO IXZZ1=1,NumbreLigand(NMO)
	      ! ÷» À œŒ ‘”Õ ÷»ﬂÃ À»√¿Õƒ¿
		  DO IXZY1=1,NFunLigands(NMO,IXZZ1)
		      ! ÕŒ¬Œ≈ —À¿√¿≈ÃŒ≈
			  ISUMINDEX=ISUMINDEX+1
			  IF(ISUMINDEX.EQ.1) THEN
                 ! ÕŒÃ≈– À»√¿Õƒ¿
				 NumbreLigandVV1=NLigands(NMO,IXZZ1) 
                 ! ÕŒÃ≈– ‘”Õ ÷»» À»√¿Õƒ¿
				 NumbreFunLigZX1=NumbreFunctionLig(NMO,IXZZ1,IXZY1)
			  ENDIF		 
              IF(ISUMINDEX.EQ.2) THEN
                 ! ÕŒÃ≈– À»√¿Õƒ¿
				 NumbreLigandVV2=NLigands(NMO,IXZZ1) 
                 ! ÕŒÃ≈– ‘”Õ ÷»» À»√¿Õƒ¿
				 NumbreFunLigZX2=NumbreFunctionLig(NMO,IXZZ1,IXZY1)
			  ENDIF		 
              IF(ISUMINDEX.EQ.3) THEN
                 ! ÕŒÃ≈– À»√¿Õƒ¿
				 NumbreLigandVV3=NLigands(NMO,IXZZ1) 
                 ! ÕŒÃ≈– ‘”Õ ÷»» À»√¿Õƒ¿
				 NumbreFunLigZX3=NumbreFunctionLig(NMO,IXZZ1,IXZY1)
			  ENDIF		 
		  ENDDO
       ENDDO
       ! ‡Ò˜ÂÚ ÔÓ‚Â‰ÂÌ ÔÓ ÏÂÚÓ‰Û Í‡ÏÂÒ‡ (Â¯ÂÌËˇ ÒËÒÚÂÏ˚ ÎËÌÂÈÌ˚ı Û‡‚ÌÂÌËÈ)
	   RintMO1=sum((RFunMO(NumbreGMOAS1,2+1:Npoint)/RO1X(1:Npoint))**2)*H 
       RintMO2=sum((RFunMO(NumbreGMOAS2,2+1:Npoint)/RO1X(1:Npoint))**2)*H 
       RintMO3=sum((RFunMO(NumbreGMOAS3,2+1:Npoint)/RO1X(1:Npoint))**2)*H 
       RintFL11=sum(RFunMO(NumbreGMOAS1,2+1:Npoint)*RfunLigands(NumbreLigandVV1,NumbreFunLigZX1,NumbreGMOAS1,2+1:Npoint)/RO1X(1:Npoint)**2)*H  
	   RintFL12=sum(RFunMO(NumbreGMOAS1,2+1:Npoint)*RfunLigands(NumbreLigandVV2,NumbreFunLigZX2,NumbreGMOAS1,2+1:Npoint)/RO1X(1:Npoint)**2)*H 
	   RintFL13=sum(RFunMO(NumbreGMOAS1,2+1:Npoint)*RfunLigands(NumbreLigandVV3,NumbreFunLigZX3,NumbreGMOAS1,2+1:Npoint)/RO1X(1:Npoint)**2)*H 
	   RintFL21=sum(RFunMO(NumbreGMOAS2,2+1:Npoint)*RfunLigands(NumbreLigandVV1,NumbreFunLigZX1,NumbreGMOAS2,2+1:Npoint)/RO1X(1:Npoint)**2)*H 
	   RintFL22=sum(RFunMO(NumbreGMOAS2,2+1:Npoint)*RfunLigands(NumbreLigandVV2,NumbreFunLigZX2,NumbreGMOAS2,2+1:Npoint)/RO1X(1:Npoint)**2)*H 
	   RintFL23=sum(RFunMO(NumbreGMOAS2,2+1:Npoint)*RfunLigands(NumbreLigandVV3,NumbreFunLigZX3,NumbreGMOAS2,2+1:Npoint)/RO1X(1:Npoint)**2)*H 
	   RintFL31=sum(RFunMO(NumbreGMOAS3,2+1:Npoint)*RfunLigands(NumbreLigandVV1,NumbreFunLigZX1,NumbreGMOAS3,2+1:Npoint)/RO1X(1:Npoint)**2)*H 
	   RintFL32=sum(RFunMO(NumbreGMOAS3,2+1:Npoint)*RfunLigands(NumbreLigandVV2,NumbreFunLigZX2,NumbreGMOAS3,2+1:Npoint)/RO1X(1:Npoint)**2)*H 
	   RintFL33=sum(RFunMO(NumbreGMOAS3,2+1:Npoint)*RfunLigands(NumbreLigandVV3,NumbreFunLigZX3,NumbreGMOAS3,2+1:Npoint)/RO1X(1:Npoint)**2)*H 
	   Rdelta=RintFL11*(RintFL22*RintFL33-RintFL23*RintFL32)-RintFL12*(RintFL21*RintFL33-RintFL23*RintFL31)+RintFL13*(RintFL21*RintFL32-RintFL22*RintFL31)
	   Rdelta1=RintMO1*(RintFL22*RintFL33-RintFL23*RintFL32)-RintFL12*(RintMO2*RintFL33-RintFL23*RintMO3)+RintFL13*(RintMO2*RintFL32-RintFL22*RintMO3)
	   Rdelta2=RintFL11*(RintMO2*RintFL33-RintFL23*RintMO3)-RintMO1*(RintFL21*RintFL33-RintFL23*RintFL31)+RintFL13*(RintFL21*RintMO3-RintMO2*RintFL31)
	   Rdelta3=RintFL11*(RintFL22*RintMO3-RintMO2*RintFL32)-RintFL12*(RintFL21*RintMO3-RintMO2*RintFL31)+RintMO1*(RintFL21*RintFL32-RintFL22*RintFL31)
	   ! –¿—◊»“€¬¿≈Ã  Œ›‘‘»÷»≈Õ“€ ¿À‹‘¿
	   AlfaCoffMO(NMO,NumbreLigandVV1,NumbreFunLigZX1)=Rdelta1/Rdelta
	   AlfaCoffMO(NMO,NumbreLigandVV2,NumbreFunLigZX2)=Rdelta2/Rdelta
       AlfaCoffMO(NMO,NumbreLigandVV3,NumbreFunLigZX3)=Rdelta3/Rdelta
	ENDIF 



    return
  end subroutine CalculationCoffAlfaMO


  ! œŒƒœ–Œ√–¿ÃÃ¿ Œ—”Ÿ≈—“¬Àﬂ≈“ ‘Œ–Ã»–Œ¬¿Õ»≈ —“–” “”–€ ¬—ÿ»’ √¿–ÃŒÕ»  ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
  ! NMO-ÕŒÃ≈– ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
  ! Npoint-◊»—ÀŒ “Œ◊≈ 
  ! H-ÿ¿√ 
  ! NumbreGarmMO-◊»—ÀŒ √¿–ÃŒÕ»  ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» ƒŒ Lk ¬ Àﬁ◊»“≈À‹ÕŒ
  ! NumbreGarmMOLimid-◊»—ÀŒ √¿–ÃŒÕ»  ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» œŒ—À≈ Lk ƒŒ Ã¿ —»Ã¿À‹ÕŒ… √¿–ÃŒÕ» » 
  ! NumbreLigand(NumbreMO)-Ã¿——»¬ ◊»—À¿ À»√¿ÕƒŒ¬ ‘”Õ ÷»»  Œ“Œ–€’ Œœ»—€¬¿ﬁ“ ¬€—ÿ»≈ √¿–ÃŒÕ» » ƒ¿ÕÕŒ… ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
  ! NLigands(NumbreMO,NumbreLigand(NumbreMO))-Ã¿——»¬ ÕŒÃ≈–Œ¬ À»√¿ÕƒŒ¬ ‘”Õ ÷»»  Œ“Œ–€’ Œœ»—€¬¿ﬁ“ ¬€—ÿ»≈ √¿–ÃŒÕ» » ƒ¿ÕÕŒ… ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
  ! NFunLigands(NumbreMO,NumbreLigand(NumbreMO))-Ã¿——»¬ ◊»—À¿ ‘”Õ ÷»…  ¿∆ƒŒ√Œ À»√¿Õƒ¿ Œœ»—€¬¿ﬁŸ»’ ¬€—ÿ»≈ √¿–ÃŒÕ» » ƒ¿ÕÕŒ… ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
  ! NumbreFunctionLig(NumbreMO,NumbreLigand(NumbreMO),NFunLigands(NumbreMO,NumbreLigand(NumbreMO)))-Ã¿——»¬ ÕŒÃ≈–Œ¬ ‘”Õ ÷»… À»√¿ÕƒŒ¬  Œ“Œ–€≈ —ŒŒ“¬≈“—“¬”ﬁ“ ƒ¿ÕÕŒ… ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
  ! RFunMO(NumbreGarmMO,Npoint+2)-Ï‡ÒÒË‚ ÁÌ‡˜ÂÌËÈ ‡‰Ë‡Î¸Ì˚ı ˜‡ÒÚÂÈ  „‡ÏÓÌËÍ ÏÓÎÂÍÛÎˇÌ˚ı Ó·ËÚ‡ÎÂÈ ÍÓÌÙË„Û‡ˆËË  
  ! RfunLigands(Nnuclei,NumbreFunctionLig,NumbreGarmLigand,Npoint+2)-Ã¿——»¬ «Õ¿◊≈Õ»… ‘”Õ ÷»… À»√¿ÕƒŒ¬
  ! AlfaCoffMO(NumbreMO,NumbreLigand,NumbreFunLigand)-Ã¿——»¬  Œ›‘‘»÷»≈Õ“Œ¬ —  Œ“Œ–€Ã» ‘”Õ ÷»… À»√¿Õƒ¿ ¬’Œƒﬂ“ ¬ —“–” “”–” ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» 
  subroutine FormStructureMO(NMO,Npoint,H,NumbreGarmMO,NumbreGarmMOLimid,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,RFunMO,RfunLigands,AlfaCoffMO) 
    implicit none
    integer::NMO,Npoint,NumbreGarmMO,NumbreGarmMOLimid
	real(8)::H
    integer,dimension(:)::NumbreLigand
    integer,dimension(:,:)::NLigands,NFunLigands
    integer,dimension(:,:,:)::NumbreFunctionLig
	real(8),dimension(:,:)::RFunMO
	real(8),dimension(:,:,:)::AlfaCoffMO
    real(8),dimension(:,:,:,:)::RfunLigands
    !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    integer::IIXDGAR,IX1,IX2,IX3,NumbreLigandX,NumbreFunLigX,ierr
	real(8)::Rcoff
    real(8),allocatable,dimension(:)::RfunXD
    
	! ¬€ƒ≈Àﬂ≈Ã œ¿Ãﬂ“‹ œŒƒ Ã¿——»¬
	allocate(RfunXD(Npoint),stat=ierr)
    if(ierr/=0) then
      write(*,*)'FormStructureMO'
      write(*,*)'MEMORY ON THE FILE "RfunXD" IS NOT SELECTED'
      read(*,*)
	  stop 
    endif


    
	! ÷» À œŒ √¿–ÃŒÕ» ¿Ã
	DO IIXDGAR=NumbreGarmMO+1,NumbreGarmMOLimid
       RfunXD=0.D0
	   ! ÷» À œŒ ◊»—À” À»√¿ÕƒŒ¬
	   DO IX1=1,NumbreLigand(NMO)
	      ! ÕŒÃ≈– À»√¿Õƒ¿ 
	      NumbreLigandX=NLigands(NMO,IX1)
          ! ÷» À œŒ ‘”Õ ÷»ﬂÃ
		  DO IX2=1,NFunLigands(NMO,IX1)
             ! ÕŒÃ≈– ‘”Õ ÷»»
			 NumbreFunLigX=NumbreFunctionLig(NMO,IX1,IX2)
             Rcoff=AlfaCoffMO(NMO,NumbreLigandX,NumbreFunLigX)
			 DO IX3=1,Npoint
			    RfunXD(IX3)=RfunXD(IX3)+Rcoff*RfunLigands(NumbreLigandX,NumbreFunLigX,IIXDGAR,2+IX3)
	         ENDDO
		  ENDDO
	   ENDDO
       ! «¿œ»—€¬¿≈Ã —‘Œ–Ã»–Œ¬¿ÕÕ”ﬁ √¿–ÃŒÕ» ”
       RFunMO(IIXDGAR,2+1:Npoint)=RfunXD(1:Npoint)
	ENDDO

	
	! ”ƒ¿Àﬂ≈Ã Ã¿——»¬€ »« œ¿Ãﬂ“» 
    deallocate(RfunXD,stat=ierr)
    if(ierr/=0) then
       write(*,*) 'FormStructureMO'
       write(*,*) 'THE MASSIV "RfunXD" IS NOT REMOVED FROM MEMORY'
       read(*,*)
	   stop 
    endif 

    return
  end subroutine FormStructureMO


 ! œŒƒœ–Œ√–¿ÃÃ¿ –¿—◊≈“¿ «Õ¿◊≈Õ»… ¬ŒÀÕŒ¬€’ ‘”Õ ÷»… ¬ “Œ◊ ≈ —ÿ»¬ » (—À”◊¿… »“≈–¿÷»» œŒ—À≈ œ≈–¬Œ…)
 ! Kpoint-“Œ◊ ¿ —ÿ»¬ »
 ! IndexM-–¿«Ã≈– Ã¿——»¬¿
 ! NumeroMin-ÕŒÃ≈– œ≈–¬Œ… √¿–ÃŒÕ» »
 ! NumeroMax-ÕŒÃ≈– œŒ—À≈ƒÕ≈… √¿–ÃŒÕ» »
 ! Vout(IndexM,IndexM,Npoint)- Ã¿——»¬ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » "Õ¿–”∆”"
 ! Uout(IndexM,Npoint)- Ã¿——»¬ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » "Õ¿–”∆”"
 ! Vin(IndexM,IndexM,Npoint)- Ã¿——»¬ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » "¬Õ”“–‹"
 ! Uin(IndexM,Npoint)- Ã¿——»¬ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » "¬Õ”“–‹"
 ! FunMO(IndexM,Npoint+2)-–¿ƒ»¿À‹Õ¿ﬂ ◊¿—“‹ ¬ŒÀÕŒ¬Œ… ‘”Õ ÷»» ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» 
 ! VNout,UNout,VNin,UNin,E,AX,BX,IXM-¬—œŒÃŒ√¿“≈À‹Õ€≈ Ã¿——»¬€
 subroutine CalculationValuesGarmonikMOFull(Kpoint,IndexM,NumeroMin,NumeroMax,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,FunMO,E,AX,BX,IXM)
   implicit none
   integer::Kpoint,IndexM,NumeroMin,NumeroMax
   integer,dimension(:,:)::IXM
   real(8),dimension(:)::UNout,UNin,AX,BX
   real(8),dimension(:,:)::Uout,Uin,VNout,VNin,E,FunMO
   real(8),dimension(:,:,:)::Vout,Vin
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   integer::IIXD,IIOF,IIDD

   69685 FORMAT(2X,100(F20.16,1X))

   ! —◊»“€¬¿≈Ã œ¿–¿Ã≈“–€ œ–Œ√ŒÕ » ƒÀﬂ ‘Œ–Ã»–Œ¬¿Õ»ﬂ —»—“≈Ã€ ”–¿¬Õ≈Õ»…
   call ReadWriteMassiv2(2,Kpoint,IndexM,Vout,VNout)
   call ReadWriteMassiv1(2,Kpoint,IndexM,Uout,UNout)   
   call ReadWriteMassiv2(2,Kpoint+1,IndexM,Vin,VNin) 
   call ReadWriteMassiv1(2,Kpoint+1,IndexM,Uin,UNin)  

   
   ! ‘Œ–Ã»–”≈Ã ≈ƒ»Õ»◊Õ”ﬁ Ã¿“–»÷”
   E=0.D0
   !DO IIDD=1,IndexM
   !   E(IIDD,IIDD)=1.D0
   !ENDDO
   FORALL (IIDD=1:IndexM) E(IIDD,IIDD)=1.D0 
   
   ! ‘Œ–Ã»–”≈Ã Ã¿“–»÷” —»—“≈Ã€  
   E=E-MATMUL(VNout,VNin)
   
   ! ‘Œ–Ã»–”≈Ã —“ŒÀ¡≈÷ —¬Œ¡ŒƒÕ€’ ◊À≈ÕŒ¬
   AX=MATMUL(VNout,UNin)+UNout
  
   !WRITE(6,*) 'E'
   !DO IIXD=1,IndexM
   !   WRITE(6,69685) (E(IIXD,IIOF),IIOF=1,IndexM)
   !ENDDO
   
   !WRITE(6,*) 'AX'
   !WRITE(6,69685) (AX(IIOF),IIOF=1,IndexM) 



   ! –≈ÿ¿≈Ã œŒÀ”◊≈ÕÕ”ﬁ —»—“≈Ã” ”–¿¬Õ≈Õ»…
   call SolutionSistemLinearEquationFull(E,AX,IXM,BX) 
   
 

   !WRITE(6,*) 'POINT SHIVKA',Kpoint
   !WRITE(6,69685) (BX(IIOF),IIOF=1,IndexM)
   
   ! «¿œ»—€¬¿≈Ã œŒÀ”◊≈ÕÕ€≈ «Õ¿◊≈Õ»ﬂ ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» ¬ “Œ◊ ≈ —ÿ»¬ »  Kpoint+2=>Õ¿◊¿ÀŒ Ã¿——»¬¿ ¬ “Œ◊ ≈ 3 
   call ReadWriteMassiv1X(1,Kpoint+2,NumeroMin,NumeroMax,FunMO,BX)
    
   return
 end subroutine CalculationValuesGarmonikMOFull





 ! œŒƒœ–Œ√–¿ÃÃ¿ –¿—◊≈“¿ «Õ¿◊≈Õ»… ¬ŒÀÕŒ¬€’ ‘”Õ ÷»… ¬ “Œ◊ ≈ —ÿ»¬ »
 ! Kpoint-“Œ◊ ¿ —ÿ»¬ »
 ! IndexM-–¿«Ã≈– Ã¿——»¬¿
 ! NumeroMin-ÕŒÃ≈– œ≈–¬Œ… √¿–ÃŒÕ» »
 ! NumeroMax-ÕŒÃ≈– œŒ—À≈ƒÕ≈… √¿–ÃŒÕ» »
 ! Vout(IndexM,IndexM,Npoint)- Ã¿——»¬ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » "Õ¿–”∆”"
 ! Vin(IndexM,IndexM,Npoint)- Ã¿——»¬ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » "¬Õ”“–‹"
 ! FunMO(IndexM,Npoint+2)-–¿ƒ»¿À‹Õ¿ﬂ ◊¿—“‹ ¬ŒÀÕŒ¬Œ… ‘”Õ ÷»» ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» 
 ! AZ,BZ,AX,BX-¬—œŒÃŒ√¿“≈À‹Õ€≈ Ã¿——»¬€
 subroutine CalculationValuesGarmonikMO(Kpoint,IndexM,NumeroMin,NumeroMax,Vout,Vin,FunMO,AZ,BZ,E,AX,BX)
   implicit none
   integer::Kpoint,IndexM,NumeroMin,NumeroMax
   real(8),dimension(:)::AX,BX
   real(8),dimension(:,:)::FunMO,AZ,BZ,E
   real(8),dimension(:,:,:)::Vout,Vin
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   integer::IIXD,IIOF

   69685 FORMAT(2X,100(F20.16,1X))

   call ReadWriteMassiv2(2,Kpoint,IndexM,Vout,AZ) 
   call ReadWriteMassiv2(2,Kpoint+1,IndexM,Vin,BZ)
   
   !WRITE(6,*) 'AZ'
   !DO IIXD=1,IndexM
   !  WRITE(6,69685) (AZ(IIXD,IIOF),IIOF=1,IndexM)
   !ENDDO
   !WRITE(6,*) 'BZ'
   !DO IIXD=1,IndexM
   !   WRITE(6,69685) (BZ(IIXD,IIOF),IIOF=1,IndexM)
   !ENDDO
  
   E=0.D0
   !DO IIXD=1,IndexM 
   !   E(IIXD,IIXD)=1.D0
   !ENDDO
   FORALL (IIXD=1:IndexM) E(IIXD,IIXD)=1.D0

   ! Ã¿“–»÷¿ —»—“≈Ã€ ”–¿¬Õ≈Õ»… 
   E=E-MATMUL(AZ,BZ)
   !WRITE(6,*) 'E'
   !DO IIXD=1,IndexM
   !   WRITE(6,69685) (E(IIXD,IIOF),IIOF=1,IndexM)
   !ENDDO

   
   !READ(*,*)
   ! œ≈–≈—“–¿»¬¿≈Ã Ã¿“–»÷” –¿—œŒÀŒ√¿ﬂ —“–Œ◊ » ¬ Œ¡–¿“ÕŒÃ œŒ–ﬂƒ ≈ ƒÀﬂ “Œ√Œ, ◊“Œ¡€ œ–»–¿¬Õﬂ“‹   ≈ƒ»Õ»÷≈ «Õ¿◊≈Õ»≈ Ã»Õ»Ã¿À‹ÕŒ… √¿–ÃŒÕ» »
   ! ›“Œ —¬ﬂ«¿ÕŒ — “≈’Õ» Œ… œŒÀ”◊≈Õ»ﬂ –≈ÿ≈Õ»ﬂ —»—“≈Ã€ ”–¿¬Õ≈Õ»… (Œ¡–¿“Õ€… ’Œƒ) »—œŒÀ‹«”ﬁ“ œŒ—À≈ƒÕ»…  Œ–≈Õ‹ ŒÕ ƒŒÀ∆≈Õ ¡€“‹ »«¬≈—“≈Õ
   ! œ≈–≈—“¿¬Àﬂ≈Ã ¬ Œ¡–¿“ÕŒÃ œŒ–ﬂƒ ≈ —“ŒÀ¡÷€ 
   call InterchangeStolbsovMatrix(E)
   ! œ≈–≈—“¿¬Àﬂ≈Ã —“–Œ◊ » 
   call InterchangeStrokMatrix(E)
   ! œ–Œ¬≈–ﬂ≈Ã ƒ»¿√ŒÕ¿À‹Õ€≈ ›À≈Ã≈Õ“€ Ã¿“–»÷€ - ŒÕ» ƒŒÀ∆Õ€ ”¡€¬¿“‹ — ”¬≈À»◊≈Õ»≈ œŒ–ﬂƒ Œ¬Œ√Œ ÕŒÃ≈–¿
   !call ControlMatrix(E)


   !WRITE(6,*) 'DAA-1'
   !DO IIXD=1,IndexM
   !   WRITE(6,69685) (E(IIXD,IIOF),IIOF=1,IndexM)
   !ENDDO
   

   ! Õ¿’Œƒ»Ã –≈ÿ≈Õ»≈ —»—“≈Ã€ ”–¿¬Õ≈Õ»… (œŒÀ”◊¿≈Ã «Õ¿◊≈Õ»≈ ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» ¬ “Œ◊ ≈ —ÿ»¬ »)
   ! Œ—”Ÿ≈—“¬Àﬂ≈“—ﬂ œ≈–≈’Œƒ ƒÀﬂ œŒÀ”◊≈ÕÕŒ√Œ ¬≈ “Œ–¿   Œ¡€◊ÕŒÃ” œŒ–ﬂƒ ” —“–Œ  ( Œ–Õ≈…)
   call SolutionSistemLinearEquation(E,AX,BX)

   !WRITE(6,*) 'POINT SHIVKA',Kpoint
   !WRITE(6,69685) (AX(IIOF),IIOF=1,IndexM)
   !WRITE(6,*) 'Kpoint',Kpoint
  
   ! «¿œ»—€¬¿≈Ã œŒÀ”◊≈ÕÕ€≈ «Õ¿◊≈Õ»ﬂ ! Kpoint+2=>Õ¿◊¿ÀŒ Ã¿——»¬¿ ¬ “Œ◊ ≈ 3 
   call ReadWriteMassiv1X(1,Kpoint+2,NumeroMin,NumeroMax,FunMO,AX)
   
   return
 end subroutine CalculationValuesGarmonikMO



 ! œ–Œ¬≈– ¿ ƒ»¿√ŒÕ¿À‹Õ€’ Ã¿“–»◊Õ€’ ›À≈Ã≈Õ“Œ¬ (ŒÕ» ƒŒÀ∆Õ€ ”¡€¬¿“‹ — –Œ—“ŒÃ ÕŒÃ≈–¿ »Õƒ≈ —¿)
 subroutine  ControlMatrix(E)
   implicit none 
   real(8),dimension(:,:)::E
   !!!!!!!!!!!!!!!!!!!!!!!!!!
   integer::NXX,IIXX

   NXX=size(E,dim=1)

   DO IIXX=1,NXX-1
      IF(DABS(E(IIXX,IIXX)).LT.DABS(E(IIXX+1,IIXX+1))) THEN
	     WRITE(6,*) 'First iteration'
		 WRITE(6,*) 'Irregular order matrix elements'
		 EXIT
	  ENDIF 
   ENDDO 

   return
 end subroutine ControlMatrix

 ! œŒƒœ–Œ√–¿ÃÃ¿ –≈ÿ≈Õ»ﬂ —»—“≈Ã€ ”–¿¬Õ≈Õ»… 
 ! E- ¬¿ƒ–¿“Õ¿ﬂ Ã¿“–»÷¿
 ! AX,BX-ŒƒÕŒÃ≈–Õ€… Ã¿——»¬ (¬≈ “Œ– –≈ÿ≈Õ»…)
 subroutine SolutionSistemLinearEquation(E,AX,P)
   implicit none 
   real(8),dimension(:)::AX,P
   real(8),dimension(:,:)::E
   !!!!!!!!!!!!!!!!!!!!!!!!!!
   integer::NXX,ierr,IIXX,IIYY,IKL
   real(8)::S
  
  
   NXX=size(E,dim=1)
   
   
   ! ¬€œŒÀÕﬂ≈Ã œ–ﬂÃŒ… ’Œƒ
   DO IIXX=1,NXX-1 
      P(IIXX+1:NXX)=E(IIXX+1:NXX,IIXX)/E(IIXX,IIXX)
	  DO IIYY=IIXX+1,NXX
	     DO IKL=1,NXX
            E(IIYY,IKL)=E(IIYY,IKL)-E(IIXX,IKL)*P(IIYY)
		 ENDDO
	  ENDDO
   ENDDO
   
   
       
    
 

   ! ¬€œŒÀÕﬂ≈Ã Œ¡–¿“Õ€… ’Œƒ 
   AX(NXX)=1.D0 ! ‘» —»–”≈Ã –≈ÿ≈Õ»≈ —»—“≈Ã€ œ–»–¿¬Õ»¬¿ﬂ Ã»Õ»Ã¿À‹ÕŒ… √¿–ÃŒÕ» ≈ ¬ “Œ◊ ≈ —ÿ» » ≈ƒ≈Õ»÷”
   DO IIXX=NXX-1,1,-1
      S=sum(E(IIXX,IIXX+1:NXX)*AX(IIXX+1:NXX))
	  AX(IIXX)=-S/E(IIXX,IIXX)   
   ENDDO 

   ! Œ—”Ÿ≈—“¬Àﬂ≈Ã ¬Œ—C“¿ÕŒ¬À≈Õ»≈ œ–¿¬»À‹ÕŒ… œŒ—À≈ƒŒ¬¿“≈À‹ÕŒ—“»
   IIYY=NXX
   DO IIXX=1,NXX 
      P(IIYY)=AX(IIXX)
      IIYY=IIYY-1
   ENDDO
   
   ! «¿œ»—€¬¿≈Ã –≈«”À‹“¿“
   AX=P

   
  
   
   return
 end subroutine SolutionSistemLinearEquation




 ! œŒƒœ–Œ√–¿ÃÃ¿ –≈ÿ≈Õ»ﬂ —»—“≈Ã€ À»Õ≈…Õ€’ ”–¿¬Õ≈Õ»… Ax=B Ã≈“Œƒ¿Ã √¿”——¿ — ¬€¡Œ–ŒÃ ¬≈ƒ”Ÿ≈√Œ ›À≈Ã≈Õ“¿ œŒ ¬—≈… Ã¿“–»÷≈ 
 ! A(N,N)- ¬¿ƒ–¿“Õ¿ﬂ Ã¿“–»÷¿ —»—“≈Ã€
 ! B(N)-—“ŒÀ¡≈÷ —¬Œ¡ŒƒÕ€’ ◊À≈ÕŒ¬
 ! IS(N,2)-Ã¿“–»÷¿ ‘¿ “Œ–»«¿÷»»
 ! X(N)-œŒÀ”◊≈ÕÕŒ≈ –≈ÿ≈Õ»≈ —»—“≈Ã€ 
 subroutine SolutionSistemLinearEquationFull(A,B,IS,X)
   implicit none
   integer,dimension(:,:)::IS
   real(8),dimension(:)::B,X
   real(8),dimensioN(:,:)::A
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   integer::S,N,P,F,I,J,K,L,M,BP,BI,I1,BH
   real(8)::BO,BK,BX,CC,CD,PR,Z,W,R  

         
   ! –¿«Ã≈–ÕŒ—“‹ —»—“≈Ã€
   N=size(A,dim=1)

   IF(N.EQ.1) THEN 
      ! œ–Œ¬≈–ﬂ≈Ã Œ“À»◊»≈ Œ“ Õ”Àﬂ
      IF(A(1,1).NE.0.D0) THEN
         X(1)=B(1)/A(1,1) 
      ENDIF
	  
	  return
   ENDIF   

	
   ! ‘Œ “¿–»«¿÷»ﬂ Ã¿“–»÷€ —»—“≈Ã€
   F=0
   1  F=F+1
      BK=0.0D0
      DO J=F,N
         BP=F
         BO=0.D0
         DO I=F,N
            BX=DABS(A(I,J))
            IF(BO.GE.BX) THEN 
  	           CYCLE 
            ENDIF
		    BO=BX
            BP=I
         ENDDO 
      
	     IF(BK.GT.BO) THEN 
	        CYCLE 
         ENDIF   
	     BK=BO
         BH=BP
         BI=J
      ENDDO 
      
      DO I=1,N,1
         CC=A(I,BI)
         A(I,BI)=A(I,F)
         A(I,F)=CC
      ENDDO 
   
      DO J=1,N,1
         CD=A(BH,J)
         A(BH,J)=A(F,J)
         A(F,J)=CD
      ENDDO

      IS(F,1)=BH
      IS(F,2)=BI
   
      PR=1.D0/A(F,F)
      L=F+1
      DO I=L,N,1
         A(I,F)=-(PR*A(I,F))
      ENDDO
     
      DO J=L,N,1
         DO I=L,N,1
            A(I,J)=A(I,J)+A(F,J)*A(I,F)
         ENDDO
      ENDDO
   IF(L-N.LT.0) THEN 
      GOTO 1
   ENDIF 

   DO I=1,N
      X(I)=B(I)
   ENDDO
   
   M=N-1
   DO I=1,M
      I1=IS(I,1)
      Z=X(I1)
      X(I1)=X(I)
      X(I)=Z
   ENDDO
   
   DO J=1,M
      W=X(J)
      K=J+1
      DO I=K,N
         X(I)=X(I)+A(I,J)*W
      ENDDO
   ENDDO
   
   X(N)=X(N)/A(N,N)
   K=N
   DO I=1,M
      R=0.0D0
      L=K-1
      DO J=K,N
         R=R+A(L,J)*X(J)
      ENDDO
      K=N-I
      X(K)=(X(K)-R)/A(K,K)
   ENDDO
   
   DO J=1,M
      I=N-J
      I1=IS(I,2)
      Z=X(I)
      X(I)=X(I1)
      X(I1)=Z
   ENDDO 
   
   return 
 end subroutine SolutionSistemLinearEquationFull







 
 ! œŒƒœ–Œ√–¿ÃÃ¿ œ≈–≈—“¿ÕŒ¬ » —“ŒÀ¡÷Œ¬ Ã¿“–»÷€ ¬ Œ¡–¿“ÕŒÃ œŒ–ﬂƒ ≈
 ! A- ¬¿ƒ–¿“Õ¿ﬂ Ã¿“–»÷¿
 subroutine InterchangeStolbsovMatrix(A)
   implicit none
   real(8),dimension(:,:)::A
   !!!!!!!!!!!!!!!!!!!!!!!!!
   integer::NNX,III1,III2,III3,ierr
   real(8),allocatable,dimension(:,:)::VC
   
   NNX=size(A,dim=1)
   
   ! ¬€ƒ≈Àﬂ≈Ã œﬂÃﬂ“‹ œŒƒ Ã¿——»¬€
   allocate(VC(NNX,NNX),stat=ierr)
   if(ierr/=0) then
      write(*,*) 'InterchangeStrokMatrix'
      write(*,*) 'MEMORY ON THE FILE "VC" IS NOT SELECTED'
  	  read(*,*)
	  stop 
   endif  

   
   III3=NNX
   DO III1=1,NNX
      DO III2=1,NNX
         VC(III2,III3)=A(III2,III1) 
	  ENDDO
	  III3=III3-1
   ENDDO
   
   ! «¿œ»—€¬¿≈Ã œŒÀ”◊≈ÕÕ”ﬁ Ã¿“–»÷” (— Œ¡–¿“Õ€Ã œŒ–ﬂƒ ŒÃ —“ŒÀ¡÷Œ¬)
   A=VC
   
   ! ”ƒ¿À≈Õ»≈ Ã¿——»¬Œ¬ »« œﬂÃﬂ“»
   deallocate(VC,stat=ierr)
   if(ierr/=0) then
      write(*,*) 'InterchangeStrokMatrix'
      write(*,*) 'THE FILE "VC" IS NOT REMOVED FROM MEMORY'
	  read(*,*) 
	  stop 
   endif

   return
 end subroutine InterchangeStolbsovMatrix


 ! œŒƒœ–Œ√–¿ÃÃ¿ œ≈–≈—“¿ÕŒ¬ » —“–Œ  Ã¿“–»÷€ ¬ Œ¡–¿“ÕŒÃ œŒ–ﬂƒ ≈
 ! A- ¬¿ƒ–¿“Õ¿ﬂ Ã¿“–»÷¿
 subroutine InterchangeStrokMatrix(A)
   implicit none
   real(8),dimension(:,:)::A
   !!!!!!!!!!!!!!!!!!!!!!!!!
   integer::NNX,III1,III2,III3,ierr
   real(8),allocatable,dimension(:,:)::VC
   
   NNX=size(A,dim=1)
   
   ! ¬€ƒ≈Àﬂ≈Ã œﬂÃﬂ“‹ œŒƒ Ã¿——»¬€
   allocate(VC(NNX,NNX),stat=ierr)
   if(ierr/=0) then
      write(*,*) 'InterchangeStrokMatrix'
      write(*,*) 'MEMORY ON THE FILE "VC" IS NOT SELECTED'
  	  read(*,*)
	  stop 
   endif  

   
   III3=NNX
   DO III1=1,NNX
      DO III2=1,NNX
         VC(III3,III2)=A(III1,III2) 
	  ENDDO
	  III3=III3-1
   ENDDO
   
   ! «¿œ»—€¬¿≈Ã œŒÀ”◊≈ÕÕ”ﬁ Ã¿“–»÷” (— Œ¡–¿“Õ€Ã œŒ–ﬂƒ ŒÃ —“–Œ )
   A=VC
   
   ! ”ƒ¿À≈Õ»≈ Ã¿——»¬Œ¬ »« œﬂÃﬂ“»
   deallocate(VC,stat=ierr)
   if(ierr/=0) then
      write(*,*) 'InterchangeStrokMatrix'
      write(*,*) 'THE FILE "VC" IS NOT REMOVED FROM MEMORY'
	  read(*,*) 
	  stop 
   endif

   return
 end subroutine InterchangeStrokMatrix


 ! œŒƒœ–Œ√–¿ÃÃ¿  Œ––≈ “»–Œ¬ » ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»» ’¿–“–»-‘Œ ¿ ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» 
 ! ƒÀﬂ —À”◊¿ﬂ –≈ÿ≈Õ»ﬂ Õ≈ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€ ”–¿¬Õ≈Õ»…
 ! IZNAK-C“≈œ≈Õ‹ ” ¿«€¬¿ﬁŸ¿ﬂ “»œ  Œ–Õﬂ  Œ“Œ–€… »Ÿ≈“—ﬂ À≈¬€… IZNAK=1 »À» œ–¿¬€… IZNAK=2  
 ! NEpsIter-ÕŒÃ≈– »“≈–¿÷»» ƒÀﬂ œŒÀ”◊≈Õ»ﬂ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»
 ! Kpoint-“Œ◊ ¿ —ÿ»¬ »
 ! Npoint-◊»—ÀŒ “Œ◊≈ 
 ! IndexM-–¿«Ã≈– Ã¿——»¬¿
 ! Vout(IndexM,IndexM,Npoint)- Ã¿——»¬ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » "Õ¿–”∆”"
 ! Uout(IndexM,Npoint)- Ã¿——»¬ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » "Õ¿–”∆”"
 ! Vin(IndexM,IndexM,Npoint)- Ã¿——»¬ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » "¬Õ”“–‹"
 ! Uin(IndexM,Npoint)- Ã¿——»¬ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » "¬Õ”“–‹"
 ! DetM-Ã¿——»¬ «Õ¿◊≈Õ»… œ–ŒÃ≈∆”“Œ◊ÕŒ… ÕŒ–Ã»–Œ¬ »
 ! ExfM-Ã¿——»¬ «Õ¿◊≈Õ»… ŒƒÕŒ›À≈ “–ŒÕÕŒ… ‘”Õ ÷»»
 ! Exf-ŒƒÕŒ›À≈ “–ŒÕÕ¿ﬂ ‘”Õ ÷ﬂ
 ! DeltaEnergy-–¿«Õ»÷¿ Ã≈∆ƒ” ŒƒÕŒ›À≈ “–ŒÕÕ€Ã» ‘”Õ ÷»ﬂÃ»
 ! VNout,UNout,VNin,UNin,AZ,BZ,E,AX,BX,CX,IXM-¬—œŒÃŒ√¿“≈À‹Õ€≈ Ã¿——»¬€
 ! FunMO-¬ ƒ¿ÕÕŒÃ —À”◊¿≈ ¬—œŒÃŒ√¿“≈À‹Õ€… Ã¿——»¬
 ! RO1X(Npoint)-Ã¿——»¬ œ–Œ»«¬ŒƒÕŒ… ÕŒ¬Œ… œ≈–≈Ã≈ÕÕŒ… œŒ —“¿–Œ…
 ! H-ÿ¿√
 ! Henergy-¯‡„ ÔÓ Ó‰ÌÓ˝ÎÂÍÚÓÌÌÓÈ ˝ÌÂ„ËË
 ! RnormMO-ÕŒ–Ã»–Œ¬ ¿ ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» œŒÀ”◊≈ÕÕŒ… Õ¿ œ–≈ƒ€ƒ”Ÿ≈… »“≈–¿÷»» ( –»“≈–»… œ–¿¬»À‹ÕŒ—“» œŒÀ”◊≈Õ»ﬂ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»)  
 ! IparametrDeterEnergy-œ¿–¿Ã≈“– ¬€’Œƒ¿ »« ÷» À¿ œŒ ”“Œ◊Õ≈Õ»ﬁ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»
 ! EPS-“Œ◊ÕŒ—“‹
 ! RdeltaZnak(4)-Ã¿——»¬ Œœ–≈ƒ≈ÀﬂﬁŸ»… «Õ¿ » œ–» Œ––≈ “»–Œ¬ » ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»
 ! IndexVilky-»Õƒ≈ — ” ¿«€¬¿ﬁŸ»… Õ¿ “Œ ◊“Œ Œœ–≈ƒ≈À≈Õ »Õ“≈–¬¿À ¬  Œ“Œ–ŒÃ Õ¿’Œƒ»“—ﬂ  Œ–≈Õ‹
 ! IndexVilky=0-»Õ“≈–¬¿À Õ≈ Œœ–≈ƒ≈À≈Õ
 ! IndexVilky=1-»Õ“≈–¬¿À Œœ–≈ƒ≈À≈Õ 
 ! INDEXDF-»Õƒ≈ — ” ¿«€¬¿ﬁŸ»… ◊»—ÀŒ »“≈–¿÷»… —ƒ≈À¿ÕÕ€’ œŒ—À≈ œŒœ¿ƒ¿Õ»ﬂ ¬ ¬»À ”
 ! IndexCorrect-»Õƒ≈ —  Œ––≈ “»–Œ¬ » »—œŒÀ‹«”≈“—ﬂ ¬ –≈∆»Ã≈  Œ––≈ “»–Œ¬ » «Õ¿◊≈Õ»… ‘”Õ ÷»» Õ¿ √–¿Õ»÷¿’ »Õ“≈–¬¿À¿  
 ! IcorenZZ-œ¿–¿Ã≈“– ” ¿«€¬¿ﬁŸ»… Õ¿…ƒ≈Õ  Œ–≈Õ‹ »À» Õ≈“
 ! NMO-ÕŒÃ≈– ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
 ! NumeroMaxLimid-Ã¿ —»Ã¿À‹ÕŒ≈ ◊»—ÀŒ √¿–ÃŒÕ»  ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
 ! NumbreLigand(NumbreMO)-Ã¿——»¬ ◊»—À¿ À»√¿ÕƒŒ¬ ‘”Õ ÷»»  Œ“Œ–€’ Œœ»—€¬¿ﬁ“ ¬€—ÿ»≈ √¿–ÃŒÕ» » ƒ¿ÕÕŒ… ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
 ! NLigands(NumbreMO,NumbreLigand(NumbreMO))-Ã¿——»¬ ÕŒÃ≈–Œ¬ À»√¿ÕƒŒ¬ ‘”Õ ÷»»  Œ“Œ–€’ Œœ»—€¬¿ﬁ“ ¬€—ÿ»≈ √¿–ÃŒÕ» » ƒ¿ÕÕŒ… ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
 ! NFunLigands(NumbreMO,NumbreLigand(NumbreMO))-Ã¿——»¬ ◊»—À¿ ‘”Õ ÷»…  ¿∆ƒŒ√Œ À»√¿Õƒ¿ Œœ»—€¬¿ﬁŸ»’ ¬€—ÿ»≈ √¿–ÃŒÕ» » ƒ¿ÕÕŒ… ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
 ! NumbreFunctionLig(NumbreMO,NumbreLigand(NumbreMO),NFunLigands(NumbreMO,NumbreLigand(NumbreMO)))-Ã¿——»¬ ÕŒÃ≈–Œ¬ ‘”Õ ÷»… À»√¿ÕƒŒ¬  Œ“Œ–€≈ —ŒŒ“¬≈“—“¬”ﬁ“ ƒ¿ÕÕŒ… ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
 ! RfunLigands(Nnuclei,NumbreFunctionLig,NumbreGarmLigand,Npoint+2)-Ã¿——»¬ «Õ¿◊≈Õ»… ‘”Õ ÷»… À»√¿ÕƒŒ¬
 ! AlfaCoffMO(NumbreMO,NumbreLigand,NumbreFunLigand)-Ã¿——»¬  Œ›‘‘»÷»≈Õ“Œ¬ —  Œ“Œ–€Ã» ‘”Õ ÷»… À»√¿Õƒ¿ ¬’Œƒﬂ“ ¬ —“–” “”–” ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» 
 ! IndexExitRerern-»Õƒ≈ — ” ¿«€¬¿ﬁŸ»… ◊≈–≈« — ŒÀ‹ Œ œŒ¬“Œ–≈Õ»… ¬€’Œƒ ¡”ƒ≈“ Œ—”Ÿ≈—“¬À≈Õ 
 subroutine CorrectionEnergy(IZNAK,NEpsIter,Kpoint,Npoint,IndexM,NumeroMin,NumeroMax,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,DetM,ExfM,Exf,AZ,BZ,E,AX,BX,CX,IXM,FunMO,RO1X,H,Henergy,RnormMO,IparametrDeterEnergy,EPS,RdeltaZnak,IndexVilky,INDEXDF,IIKK,IndexCorrect,IcorenZZ,NMO,NumeroMaxLimid,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,RfunLigands,AlfaCoffMO,IndexExitRerern)  
   implicit none
   integer::NEpsIter,Kpoint,IndexM,NumeroMin,NumeroMax,IparametrDeterEnergy,Npoint,IZNAK,IndexVilky,INDEXDF,IIKK,IndexCorrect,IcorenZZ,NMO,NumeroMaxLimid,IndexExitRerern
   real(8)::Exf,Henergy,RnormMO,EPS,H
   integer,dimension(:)::NumbreLigand
   integer,dimension(:,:)::IXM,NLigands,NFunLigands
   integer,dimension(:,:,:)::NumbreFunctionLig
   real(8),dimension(:)::UNout,UNin,DetM,ExfM,AX,BX,CX,RO1X,RdeltaZnak
   real(8),dimension(:,:)::Uout,Uin,VNout,VNin,AZ,BZ,E,FunMO
   real(8),dimension(:,:,:)::Vout,Vin,AlfaCoffMO
   real(8),dimension(:,:,:,:)::RfunLigands
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! 
   integer::IIDD,IBBB,ISUM,klkl,IndexRepete
   real(8)::DeltaEnergy,RnormConstas,Kcoff,RcoffGran,DDD,DMtemp

   ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ ÕŒ–Ã»–Œ¬Œ◊ÕŒ√Œ  Œ›‘‘»÷»≈Õ“¿ (ƒÀﬂ  Œ––≈ “»–Œ¬ » ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»)
   ! —◊»“€¬¿≈Ã œ¿–¿Ã≈“–€ œ–Œ√ŒÕ » ƒÀﬂ ‘Œ–Ã»–Œ¬¿Õ»ﬂ —»—“≈Ã€ ”–¿¬Õ≈Õ»…
   call ReadWriteMassiv2(2,Kpoint,IndexM,Vout,VNout)
   call ReadWriteMassiv1(2,Kpoint,IndexM,Uout,UNout)   
   call ReadWriteMassiv2(2,Kpoint+1,IndexM,Vin,VNin) 
   call ReadWriteMassiv1(2,Kpoint+1,IndexM,Uin,UNin)  
   
   80685 FORMAT(2X,100(I4,1X))
   79685 FORMAT(2X,100(F20.12,1X))
   ! ‘Œ–Ã»–”≈Ã ≈ƒ»Õ»◊Õ”ﬁ Ã¿“–»÷”
   E=0.D0
   !DO IIDD=1,IndexM
   !   E(IIDD,IIDD)=1.D0
   !ENDDO
   FORALL (IIDD=1:IndexM) E(IIDD,IIDD)=1.D0 
   
   ! ‘Œ–Ã»–”≈Ã Ã¿“–»÷” —»—“≈Ã€  
   E=E-MATMUL(VNout,VNin)
   !WRITE(6,*) 'EEEEEX'
   !DO IIDD=1,IndexM
   !   WRITE(6,79685) (E(IIDD,IBBB),IBBB=1,IndexM)
   !ENDDO
   ! ‘Œ–Ã»–”≈Ã —“ŒÀ¡≈÷ —¬Œ¡ŒƒÕ€’ ◊À≈ÕŒ¬
   AX=MATMUL(VNout,UNin)+UNout
   
   !WRITE(6,*) 'AAAAX'
   !WRITE(6,79685) (AX(IBBB),IBBB=1,IndexM)
   
  
   ! –≈ÿ¿≈Ã œŒÀ”◊≈ÕÕ”ﬁ —»—“≈Ã” ”–¿¬Õ≈Õ»…
   call SolutionSistemLinearEquationFull(E,AX,IXM,BX) 
    
  
   !WRITE(*,*) 'BBBBX'
   !WRITE(*,79685) (BX(IBBB),IBBB=1,IndexM)
   !READ(*,*)  
   !WRITE(400,*) Exf,BX(1)
   
   ! «¿œ»—€¬¿≈Ã œŒÀ”◊≈ÕÕ€≈ «Õ¿◊≈Õ»ﬂ ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» ¬ “Œ◊ ≈ —ÿ»¬ »
   call ReadWriteMassiv1X(1,Kpoint+2,NumeroMin,NumeroMax,FunMO,BX)

   ! ¬Œ——“¿Õ¿¬À»¬¿≈Ã «Õ¿◊≈Õ»ﬂ œ¿–÷»¿À‹Õ€’ √¿–ÃŒÕ»  (ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À») ¬Œ ¬—≈’ “Œ◊ ¿’ ƒÀﬂ œŒÀ”◊≈Õ»ﬂ ÕŒ–Ã»–Œ¬Œ◊ÕŒ…  ŒÕ—“¿Õ“€ 
   call FunctionRecoveryCorrection(Kpoint,IndexM,Npoint,NumeroMin,NumeroMax,H,Vout,Uout,Vin,Uin,FunMO,AX,BX,CX,VNout,UNout,VNin,UNin,RO1X,RnormConstas,NMO,NumeroMaxLimid,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,RfunLigands,AlfaCoffMO)
   
     
   WRITE(17,*) Exf,RnormConstas,RnormMO
   !WRITE(*,*) Exf,RnormConstas,RnormMO
   !WRITE(*,*) 'DDD,klkl'
   !READ(*,*) DDD,klkl
   !IF(klkl.EQ.-1) THEN
   !   Exf=ExfTemp
   !  WRITE(*,*) 'CVCV',Exf
   !ENDIF
   !ExfTemp=Exf
   
   
  
   
   
   
   ! «¿œ»—€¬¿≈Ã –≈«”À‹“¿“ –¿—◊≈“¿
   IF(IndexVilky.EQ.0) THEN
        IF(NEpsIter.EQ.1) THEN
           DetM(2)=RnormConstas
		ENDIF
        IF(NEpsIter.EQ.2) THEN
           DetM(3)=RnormConstas
		ENDIF
        IF(NEpsIter.NE.1.AND.NEpsIter.NE.2) THEN
            DetM(4)=DetM(1)
            DetM(1)=DetM(2)
            DetM(2)=DetM(3)
            DetM(3)=RnormConstas
        ENDIF
	  ELSE

        IF(INDEXDF.EQ.0) THEN 
            !  Œ––≈ “»–”≈Ã √–¿Õ»÷€ »Õ“≈–¬¿À¿
			! »Õƒ≈ — ” ¿«€¬¿ﬁŸ»…, ◊“Œ  Œ––≈ “»–Œ¬ ¿ Œ—”Ÿ≈—“¬À≈Õ¿ 
			IndexCorrect=1
            DetM(1)=RnormConstas
		   ELSE
		    IF(INDEXDF.EQ.1) THEN
                DetM(4)=DetM(1)
                DetM(1)=DetM(2)
                DetM(2)=DetM(3)
                DetM(3)=RnormConstas
		      ELSE
		       !  Œ–≈Õ‹ œŒœ¿À ¬ œ≈–¬€… »“≈–¬¿À
               IF(IIKK.EQ.1) THEN
                  DetM(2)=DetM(3)
                  DetM(3)=RnormConstas
		       ENDIF
               !  Œ–≈Õ‹ œŒœ¿À ¬ ¬“Œ–Œ… »“≈–¬¿À
               IF(IIKK.EQ.2) THEN
                  DetM(1)=DetM(3)
                  DetM(3)=RnormConstas
		       ENDIF
            ENDIF
        ENDIF  
   ENDIF
   
   
   !WRITE(*,*) 'ZERO ITERASTION2'
   !write(*,80685)  NEpsIter,IndexVilky,INDEXDF,IIKK
   !write(*,79685)  DetM(1),DetM(3),DetM(2)
   !write(*,79685)  RnormMO,DABS(DetM(3)-RnormMO),DABS(DetM(2)-RnormMO),RcoffGran
   !write(*,79685)  ExfM(1),ExfM(3),ExfM(2)
   !write(*,79685)  Exf
   !read(*,*) 
    		    
      
   ! »Õ“≈–¬¿À  Œ–Õﬂ 
   IF(IndexVilky.EQ.0) THEN
      ! œ–Œ¬Œƒ»Ã ¿Õ¿À»« œŒÀ”◊≈ÕÕŒ√Œ «Õ¿◊≈Õ»ﬂ
      IF(NEpsIter.EQ.1) THEN
           IF((DetM(2)-RnormMO).GT.0.D0) THEN
	           Exf=Exf*(1.D0+(-1.D0)**IZNAK*Henergy)
               ExfM(3)=Exf
	       ENDIF
           IF((DetM(2)-RnormMO).LT.0.D0) THEN
	       	   Exf=Exf*(1.D0-(-1.D0)**IZNAK*Henergy)
               ExfM(3)=Exf
	       ENDIF
           IF((DetM(2)-RnormMO).EQ.0.D0) THEN
	           ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
	           IparametrDeterEnergy=2 
			   !  Œ–≈Õ‹ Õ¿…ƒ≈Õ
	           IcorenZZ=1 
	       ENDIF
         ELSE
	       ! œ–Œ¬≈–ﬂ≈Ã œŒœ¿ƒ¿≈“ ŒƒÕŒ›À≈ “–ŒÕÕ¿ﬂ ›Õ≈–√»ﬂ ¬ ¬»À ” »À» Õ≈“ (Œœ–≈ƒ≈À≈Õ À» »Õ“≈–¬¿À ¬  Œ“Œ–ŒÃ Õ¿’Œƒ»“—ﬂ  Œ–≈Õ‹)
	       IF((DetM(2)-RnormMO)*(DetM(3)-RnormMO).LT.0.D0) THEN
		         !WRITE(*,*) 'VILKA'
				 !READ(*,*)
				 ! œ–Œ¬≈–ﬂ≈Ã ”√ÀŒ¬Œ…  Œ›‘‘»÷»≈Õ“ ƒÀﬂ “Œ√Œ, ◊“Œ ¬€ﬂ—Õ»“‹ œ–¿¬»À‹Õ¿ﬂ Œ¡À¿—“‹ »À» Õ≈“
				 ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ ”√ÀŒ¬Œ√Œ  Œ›‘‘»÷»≈Õ“¿
                 Kcoff=(DetM(3)-DetM(2))/(ExfM(3)-ExfM(2))
				 IF(IZNAK.EQ.1) THEN
				    ! œ–Œ¬≈–ﬂ≈Ã ”√ÀŒ¬Œ…  Œ›‘‘»÷»≈Õ“ ƒÀﬂ À≈¬Œ√Œ  Œ–Õﬂ
                    IF(Kcoff.LT.0.D0) THEN
                       ! Œ¡Õ¿–”∆≈ÕÕ€… »Õ“≈–¬¿À  Œ–Õﬂ Õ¿’Œƒ»“—ﬂ ¬ Œ¡À¿—“» ƒ–”√Œ… ›Õ≈–√»»
					   !  Œ–≈Õ‹ Õ≈ Õ¿…ƒ≈Õ
                       ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
	                   IparametrDeterEnergy=2 
			           !  Œ–≈Õ‹ Õ≈ Õ¿…ƒ≈Õ
	                   IcorenZZ=0 
					   !WRITE(*,*) 'EXIT1'
					   !READ(*,*) 
					   return
					ENDIF
				 ENDIF  
                 IF(IZNAK.EQ.2) THEN
				    ! œ–Œ¬≈–ﬂ≈Ã ”√ÀŒ¬Œ…  Œ›‘‘»÷»≈Õ“ ƒÀﬂ œ–¿¬Œ√Œ  Œ–Õﬂ
                    IF(Kcoff.GT.0.D0) THEN
                       ! Œ¡Õ¿–”∆≈ÕÕ€… »Õ“≈–¬¿À  Œ–Õﬂ Õ¿’Œƒ»“—ﬂ ¬ Œ¡À¿—“» ƒ–”√Œ… ›Õ≈–√»»
					   !  Œ–≈Õ‹ Õ≈ Õ¿…ƒ≈Õ
                       ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
	                   IparametrDeterEnergy=2 
			           !  Œ–≈Õ‹ Õ≈ Õ¿…ƒ≈Õ
	                   IcorenZZ=0 
					   !WRITE(*,*) 'EXIT2'
					   !READ(*,*) 
					   return
					ENDIF
				 ENDIF  
		         ! ”—“¿ÕŒ¬À≈Õ »Õ“≈–¬¿À  Œ–Õﬂ œ≈–≈’Œƒ» ¬ –≈∆»Ã œŒ»— ¿  Œ–Õﬂ 
	             IndexVilky=1                    
			   ELSE

			     ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ ”√ÀŒ¬Œ√Œ  Œ›‘‘»÷»≈Õ“¿
                 Kcoff=(DetM(3)-DetM(2))/(ExfM(3)-ExfM(2))

                 IF(IZNAK.EQ.1) THEN
				    ! œ–Œ¬≈–ﬂ≈Ã ”√ÀŒ¬Œ…  Œ›‘‘»÷»≈Õ“ ƒÀﬂ À≈¬Œ√Œ  Œ–Õﬂ
                    IF(Kcoff.LT.0.D0) THEN
                       ! œŒ»—  ¬€ÿ≈À «¿ √–¿Õ»÷€ ƒ¿ÕÕŒ… Œ¡À¿—“» ›Õ≈–√»…
					   !  Œ–≈Õ‹ Õ≈ Õ¿…ƒ≈Õ
                       ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
	                   IparametrDeterEnergy=2 
			           !  Œ–≈Õ‹ Õ≈ Õ¿…ƒ≈Õ
	                   IcorenZZ=0 
					   return
					ENDIF
				 ENDIF  
                 IF(IZNAK.EQ.2) THEN
				    ! œ–Œ¬≈–ﬂ≈Ã ”√ÀŒ¬Œ…  Œ›‘‘»÷»≈Õ“ ƒÀﬂ œ–¿¬Œ√Œ  Œ–Õﬂ
                    IF(Kcoff.GT.0.D0) THEN
                      ! œŒ»—  ¬€ÿ≈À «¿ √–¿Õ»÷€ ƒ¿ÕÕŒ… Œ¡À¿—“» ›Õ≈–√»…
					   !  Œ–≈Õ‹ Õ≈ Õ¿…ƒ≈Õ
                       ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
	                   IparametrDeterEnergy=2 
			           !  Œ–≈Õ‹ Õ≈ Õ¿…ƒ≈Õ
	                   IcorenZZ=0 
					   return
					ENDIF
				 ENDIF  

                 ! ”—“¿Õ¿¬À»¬¿≈Ã ¬  ¿ Œ… Œ¡À¿—“» Õ¿’Œƒﬂ“—ﬂ “Œ◊ »  
		         IF(DetM(3).GT.RnormMO) THEN
                    ! ”—“¿Õ¿¬À»¬¿≈Ã «Õ¿  ”√ÀŒ¬Œ√Œ  Œ›‘‘»÷»≈Õ“¿
					IF(Kcoff.GT.0.D0) THEN
                         Exf=Exf*(1.D0-Henergy)
                         ExfM(1)=ExfM(2)
                         ExfM(2)=ExfM(3)
			             ExfM(3)=Exf
                       ELSE
					     Exf=Exf*(1.D0+Henergy)
						 ExfM(1)=ExfM(2)
                         ExfM(2)=ExfM(3)
			             ExfM(3)=Exf
					ENDIF
                 ENDIF
				 IF(DetM(3).LT.RnormMO) THEN
				    ! ”—“¿Õ¿¬À»¬¿≈Ã «Õ¿  ”√ÀŒ¬Œ√Œ  Œ›‘‘»÷»≈Õ“¿
					IF(Kcoff.GT.0.D0) THEN
                         Exf=Exf*(1.D0+Henergy)
						 ExfM(1)=ExfM(2)
                         ExfM(2)=ExfM(3)
			             ExfM(3)=Exf
                       ELSE
					     Exf=Exf*(1.D0-Henergy)
                         ExfM(1)=ExfM(2)
                         ExfM(2)=ExfM(3)
			             ExfM(3)=Exf
					ENDIF
				 ENDIF
				 IF(DetM(3).EQ.RnormMO) THEN
				    ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
	                IparametrDeterEnergy=2 
				 ENDIF 
           ENDIF      
	  ENDIF
   ENDIF
   
   ! »Õ“≈–¬¿À ƒÀﬂ  Œ–Õﬂ Œœ–≈ƒ≈À≈Õ
   IF(IndexVilky.EQ.1) THEN
        ! ‘» —»–”≈Ã »Õƒ≈ — œŒ¬“Œ–≈Õ»…
        IndexRepete=0


        ! ”—“¿Õ¿¬À»¬¿≈Ã ¬  ¿ ŒÃ »Õ“≈–¬¿À≈ Õ¿’Œƒ»“—ﬂ  Œ–≈Õ‹
	    IF(IndexCorrect.EQ.1) THEN 
           ! ”—“¿Õ¿¬À»¬¿≈Ã »Õ“≈–¬¿À ¬  Œ“Œ–ŒÃ Õ¿’Œƒ»“—ﬂ  Œ–≈Õ‹
		   IF((DetM(2)-RnormMO)*(DetM(1)-RnormMO).LT.0.D0) THEN
		       ExfM(3)=ExfM(1)
		  	   DetM(3)=DetM(1)   
		   ENDIF
           IF((DetM(1)-RnormMO)*(DetM(3)-RnormMO).LT.0.D0) THEN
		       ExfM(2)=ExfM(1)
			   DetM(2)=DetM(1)   
		   ENDIF
		
	       !  Œ––≈ “»–Œ¬ ¿ œ–Œ¬≈ƒ≈Õ¿ Œœ≈–¿÷»ﬂ «¿ ŒÕ◊≈Õ¿
		   IndexCorrect=0 
        ENDIF
	    

        !  œ–Œ¬≈–ﬂ≈Ã Õ≈Œ¡’Œƒ»Ã¿ »À» Õ≈“  Œ––≈ “»–Œ¬ ¿ √–¿Õ»÷ »Õ“≈–¬¿À¿ œŒ Y (¬ƒŒÀ‹ Œ—» ‘”Õ ÷»»)
        ! ¬¬Œƒ»Ã  Œ›‘‘»÷»≈Õ“ ” ¿«€¬¿ﬁŸ»… Õ¿ Œ“ ÀŒÕ≈Õ»≈ «Õ¿◊≈Õ»… ‘”Õ ÷»» Õ¿ √–¿Õ»÷¿’ »Õ“≈–¬¿À¿    
	    RcoffGran=DABS((DetM(2)-RnormMO)/(DetM(3)-RnormMO))
		! ≈—À»  Œ––≈ “»–Œ¬ ¿ œ–ŒÿÀ¿ » Õ¿◊»À—ﬂ œŒ»—   Œ–Õﬂ ¬ œŒÀ”◊≈ÕÕŒÃ »Õ“≈–¬¿À≈ “Œ  Œ––≈ “»–Œ¬ ¿ Õ≈ ƒŒÀ∆Õ¿ œ–Œ»—’Œƒ»“‹
		IF(INDEXDF.NE.0) THEN
		   RcoffGran=1.D0
		ENDIF 
	    !  Œ––≈ “»–Œ¬ ¿ œ–Œ»—’Œƒ»“ ≈—À» √–¿Õ»÷€ Œ“À»◊¿ﬁ—ﬂ ¬ 5 –¿«
	    IF(RcoffGran.GT.5.D0.OR.RcoffGran.LT.0.2D0) THEN
             ! ”—“¿Õ¿¬À»¬¿≈Ã –¿—œŒÀŒ∆≈Õ»≈ √–¿Õ»÷ 
		     IF(ExfM(2).LT.ExfM(3)) THEN
			     Exf=ExfM(2)+0.5D0*(ExfM(3)-ExfM(2)) 	
				 ExfM(1)=Exf	  
                ELSE
				 Exf=ExfM(3)+0.5D0*(ExfM(2)-ExfM(3)) 	
				 ExfM(1)=Exf	  
  	         ENDIF
           
          ELSE
		      !WRITE(*,*) 'SSSGT'
			  !READ(*,*) 
		      ! Œ—”Ÿ≈—“¬Àﬂ≈Ã œŒ»—   Œ–Õﬂ ¬ Õ¿…ƒ≈ÕŒÃ »Õ“≈–¬¿À≈
              INDEXDF=INDEXDF+1
              ! ƒÀﬂ œ≈–¬Œ√Œ –¿«¿ ” ¿«€¬¿≈Ã œ–»¡À»∆≈ÕÕ€…  Œ–≈Õ‹
	          IF(INDEXDF.EQ.1) THEN
                   Exf=((RnormMO-DetM(2))*ExfM(3)-(RnormMO-DetM(3))*ExfM(2))/(DetM(3)-DetM(2))
		           ExfM(1)=ExfM(2)
                   ExfM(2)=ExfM(3)
		           ExfM(3)=Exf
		         ELSE
                   ! œ–Œ¬≈–ﬂ≈Ã ¬  ¿ ŒÃ »« ƒ¬”’ »Õ“≈–¬¿À¿’  Œ–≈Õ‹
		           ! œ≈–¬€… »Õ“≈–¬¿À
		           IF((DetM(1)-RnormMO)*(DetM(3)-RnormMO).LT.0.D0) THEN
                      IIKK=1
			          Exf=((RnormMO-DetM(1))*ExfM(3)-(RnormMO-DetM(3))*ExfM(1))/(DetM(3)-DetM(1))
		              ! œ–Œ¬≈–ﬂ≈Ã ≈C“‹ Œ“À»◊»≈ Ã≈∆ƒ” ÕŒ¬€Ã œ–»¡À»∆≈Õ»≈ » —“¿–€Ã œ–»¡À»∆≈Õ»≈Ã
					  IF(DABS(Exf-ExfM(3)).EQ.0.D0) THEN
					     Exf=Exf*0.99D0  
						 ! ‘» —»–”≈Ã œŒœ¿ƒ¿Õ»≈ —»—“≈Ã€ ¬ –≈∆»Ã œŒ¬“Œ–≈Õ»ﬂ 
					     IndexExitRerern=IndexExitRerern+1
						 ! –≈∆»Ã œŒ¬“Œ–≈Õ»ﬂ ¬ Àﬁ◊≈Õ
						 IndexRepete=1
					  ENDIF
                      ! ≈—À» œŒœ¿ƒ≈Õ»≈ —»—“≈Ã€ ¬ ƒ¿ÕÕ€… –≈∆»Ã Œ—”Ÿ≈—“¬À≈ÕŒ 20 –¿«
					  ! –≈ÿ≈Õ»≈ —◊»“¿≈“—ﬂ Õ¿…ƒ≈ÕÕ€Ã
					  IF(IndexExitRerern.GT.20) THEN
                         Exf=Exf/0.99D0
						 ! –≈∆»Ã œŒ¬“Œ–≈Õ»… Œ“ Àﬁ◊≈Õ
                         IndexRepete=0
						 ! ‘» —»–”≈Ã ◊“Œ œŒÀ”◊≈ÕŒ –≈ÿ≈Õ»≈  
						 DetM(3)=RnormMO  
					  ENDIF

					  ExfM(2)=ExfM(3)
                      ExfM(3)=Exf
		           ENDIF
		           ! ¬“Œ–Œ… »Õ“≈–¬¿À
                   IF((DetM(3)-RnormMO)*(DetM(2)-RnormMO).LT.0.D0) THEN
		              IIKK=2
                      Exf=((RnormMO-DetM(3))*ExfM(2)-(RnormMO-DetM(2))*ExfM(3))/(DetM(2)-DetM(3))
		              ! œ–Œ¬≈–ﬂ≈Ã ≈C“‹ Œ“À»◊»≈ Ã≈∆ƒ” ÕŒ¬€Ã œ–»¡À»∆≈Õ»≈ » —“¿–€Ã œ–»¡À»∆≈Õ»≈Ã
					  IF(DABS(Exf-ExfM(3)).EQ.0.D0) THEN
					     Exf=Exf*0.99D0 
						 ! ‘» —»–”≈Ã œŒœŒƒ¿Õ»≈ —»—“≈Ã€ ¬ –≈∆»Ã œŒ¬“Œ–≈Õ»ﬂ 
					     IndexExitRerern=IndexExitRerern+1
						 ! –≈∆»Ã œŒ¬“Œ–≈Õ»ﬂ ¬ Àﬁ◊≈Õ
						 IndexRepete=1
					  ENDIF
                      
					  ! ≈—À» œŒœ¿ƒ≈Õ»≈ —»—“≈Ã€ ¬ ƒ¿ÕÕ€… –≈∆»Ã Œ—”Ÿ≈—“¬À≈ÕŒ 20 –¿«
					  ! –≈ÿ≈Õ»≈ —◊»“¿≈“—ﬂ Õ¿…ƒ≈ÕÕ€Ã
					  IF(IndexExitRerern.GT.20) THEN
                         Exf=Exf/0.99D0
						 ! ‘» —»–”≈Ã ◊“Œ œŒÀ”◊≈ÕŒ –≈ÿ≈Õ»≈  
						 DetM(3)=RnormMO  
						 ! –≈∆»Ã œŒ¬“Œ–≈Õ»… Œ“ Àﬁ◊≈Õ
                         IndexRepete=0
					  ENDIF

					  ExfM(1)=ExfM(3)
                      ExfM(3)=Exf
		           ENDIF
	          ENDIF
        ENDIF
		
       
		! œ–Œ¬≈–ﬂ≈Ã ¬€œŒÀÕ»ÀŒ—‹ À» ”—ÀŒ¬»≈
        ! œ–Œ¬≈–ﬂ≈Ã «Õ¿◊≈Õ»≈ Œœ–≈ƒ≈À»“≈Àﬂ ŒÕŒ ƒŒÀ∆ÕŒ ¡€“‹ Ã≈Õ‹ÿ≈ “Œ◊ÕŒ—“»
        IF(DABS(DetM(3)-RnormMO).LT.EPS) THEN
		   ! œ–Œ¬≈–ﬂ≈Ã ¬Àﬁ◊≈Õ –≈∆»Ã œŒ¬“Œ–≈Õ»… »À» Õ≈“
		   IF(IndexRepete.EQ.1) THEN
              ! –≈∆»Ã ¬ Àﬁ◊≈Õ. Œ“ Àﬁ◊¿≈Ã –≈∆»Ã œŒ¬“Œ–≈Õ»…
              Exf=Exf/0.99D0
		   ENDIF
           !       WRITE(*,*) 'SSDD EXIT'
  	       ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
           IparametrDeterEnergy=2
	       !  Œ–≈Õ‹ Õ¿…ƒ≈Õ
	       IcorenZZ=1 
        ENDIF		  		   
   ENDIF

   
  
     !WRITE(*,*) 'ITERASTION2'
     !write(*,80685)  NEpsIter,IndexVilky,INDEXDF,IIKK
     !write(*,79685)  DetM(1),DetM(3),DetM(2)
     !write(*,79685)  RnormMO,DABS(DetM(3)-RnormMO),DABS(DetM(2)-RnormMO),RcoffGran
     !write(*,79685)  ExfM(1),ExfM(3),ExfM(2)
     !write(*,79685)  Exf
     !read(*,*) 
   return
 end subroutine CorrectionEnergy




 ! œŒƒœ–Œ√–¿ÃÃ¿ Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ ÕŒ–Ã€ —ŒŒ“¬≈“—“¬”ﬁŸ≈… ƒ¿ÕÕŒ… ›Õ≈–√»»
 ! ƒÀﬂ —À”◊¿ﬂ –≈ÿ≈Õ»ﬂ Õ≈ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€ ”–¿¬Õ≈Õ»…
 ! RnormConstas-œŒÀ”◊≈ÕÕ¿ﬂ ÕŒ–Ã¿ ‘”Õ ÷»»  
 ! Kpoint-“Œ◊ ¿ —ÿ»¬ »
 ! Npoint-◊»—ÀŒ “Œ◊≈ 
 ! IndexM-–¿«Ã≈– Ã¿——»¬¿
 ! Vout(IndexM,IndexM,Npoint)- Ã¿——»¬ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » "Õ¿–”∆”"
 ! Uout(IndexM,Npoint)- Ã¿——»¬ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » "Õ¿–”∆”"
 ! Vin(IndexM,IndexM,Npoint)- Ã¿——»¬ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » "¬Õ”“–‹"
 ! Uin(IndexM,Npoint)- Ã¿——»¬ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » "¬Õ”“–‹"
 ! DetM-Ã¿——»¬ «Õ¿◊≈Õ»… œ–ŒÃ≈∆”“Œ◊ÕŒ… ÕŒ–Ã»–Œ¬ »
 ! ExfM-Ã¿——»¬ «Õ¿◊≈Õ»… ŒƒÕŒ›À≈ “–ŒÕÕŒ… ‘”Õ ÷»»
 ! Exf-ŒƒÕŒ›À≈ “–ŒÕÕ¿ﬂ ‘”Õ ÷ﬂ
 ! DeltaEnergy-–¿«Õ»÷¿ Ã≈∆ƒ” ŒƒÕŒ›À≈ “–ŒÕÕ€Ã» ‘”Õ ÷»ﬂÃ»
 ! VNout,UNout,VNin,UNin,AZ,BZ,E,AX,BX,CX,IXM-¬—œŒÃŒ√¿“≈À‹Õ€≈ Ã¿——»¬€
 ! FunMO-¬ ƒ¿ÕÕŒÃ —À”◊¿≈ ¬—œŒÃŒ√¿“≈À‹Õ€… Ã¿——»¬
 ! RO1X(Npoint)-Ã¿——»¬ œ–Œ»«¬ŒƒÕŒ… ÕŒ¬Œ… œ≈–≈Ã≈ÕÕŒ… œŒ —“¿–Œ…
 ! H-ÿ¿√
 ! Henergy-¯‡„ ÔÓ Ó‰ÌÓ˝ÎÂÍÚÓÌÌÓÈ ˝ÌÂ„ËË
 ! RnormMO-ÕŒ–Ã»–Œ¬ ¿ ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» œŒÀ”◊≈ÕÕŒ… Õ¿ œ–≈ƒ€ƒ”Ÿ≈… »“≈–¿÷»» ( –»“≈–»… œ–¿¬»À‹ÕŒ—“» œŒÀ”◊≈Õ»ﬂ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»)  
 ! IparametrDeterEnergy-œ¿–¿Ã≈“– ¬€’Œƒ¿ »« ÷» À¿ œŒ ”“Œ◊Õ≈Õ»ﬁ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»
 ! EPS-“Œ◊ÕŒ—“‹
 ! RdeltaZnak(4)-Ã¿——»¬ Œœ–≈ƒ≈ÀﬂﬁŸ»… «Õ¿ » œ–» Œ––≈ “»–Œ¬ » ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»
 ! IndexVilky-»Õƒ≈ — ” ¿«€¬¿ﬁŸ»… Õ¿ “Œ ◊“Œ Œœ–≈ƒ≈À≈Õ »Õ“≈–¬¿À ¬  Œ“Œ–ŒÃ Õ¿’Œƒ»“—ﬂ  Œ–≈Õ‹
 ! IndexVilky=0-»Õ“≈–¬¿À Õ≈ Œœ–≈ƒ≈À≈Õ
 ! IndexVilky=1-»Õ“≈–¬¿À Œœ–≈ƒ≈À≈Õ 
 ! INDEXDF-»Õƒ≈ — ” ¿«€¬¿ﬁŸ»… ◊»—ÀŒ »“≈–¿÷»… —ƒ≈À¿ÕÕ€’ œŒ—À≈ œŒœ¿ƒ¿Õ»ﬂ ¬ ¬»À ”
 ! IndexCorrect-»Õƒ≈ —  Œ––≈ “»–Œ¬ » »—œŒÀ‹«”≈“—ﬂ ¬ –≈∆»Ã≈  Œ––≈ “»–Œ¬ » «Õ¿◊≈Õ»… ‘”Õ ÷»» Õ¿ √–¿Õ»÷¿’ »Õ“≈–¬¿À¿  
 ! IcorenZZ-œ¿–¿Ã≈“– ” ¿«€¬¿ﬁŸ»… Õ¿…ƒ≈Õ  Œ–≈Õ‹ »À» Õ≈“
 ! NMO-ÕŒÃ≈– ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
 ! NumeroMaxLimid-Ã¿ —»Ã¿À‹ÕŒ≈ ◊»—ÀŒ √¿–ÃŒÕ»  ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
 ! NumbreLigand(NumbreMO)-Ã¿——»¬ ◊»—À¿ À»√¿ÕƒŒ¬ ‘”Õ ÷»»  Œ“Œ–€’ Œœ»—€¬¿ﬁ“ ¬€—ÿ»≈ √¿–ÃŒÕ» » ƒ¿ÕÕŒ… ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
 ! NLigands(NumbreMO,NumbreLigand(NumbreMO))-Ã¿——»¬ ÕŒÃ≈–Œ¬ À»√¿ÕƒŒ¬ ‘”Õ ÷»»  Œ“Œ–€’ Œœ»—€¬¿ﬁ“ ¬€—ÿ»≈ √¿–ÃŒÕ» » ƒ¿ÕÕŒ… ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
 ! NFunLigands(NumbreMO,NumbreLigand(NumbreMO))-Ã¿——»¬ ◊»—À¿ ‘”Õ ÷»…  ¿∆ƒŒ√Œ À»√¿Õƒ¿ Œœ»—€¬¿ﬁŸ»’ ¬€—ÿ»≈ √¿–ÃŒÕ» » ƒ¿ÕÕŒ… ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
 ! NumbreFunctionLig(NumbreMO,NumbreLigand(NumbreMO),NFunLigands(NumbreMO,NumbreLigand(NumbreMO)))-Ã¿——»¬ ÕŒÃ≈–Œ¬ ‘”Õ ÷»… À»√¿ÕƒŒ¬  Œ“Œ–€≈ —ŒŒ“¬≈“—“¬”ﬁ“ ƒ¿ÕÕŒ… ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
 ! RfunLigands(Nnuclei,NumbreFunctionLig,NumbreGarmLigand,Npoint+2)-Ã¿——»¬ «Õ¿◊≈Õ»… ‘”Õ ÷»… À»√¿ÕƒŒ¬
 ! AlfaCoffMO(NumbreMO,NumbreLigand,NumbreFunLigand)-Ã¿——»¬  Œ›‘‘»÷»≈Õ“Œ¬ —  Œ“Œ–€Ã» ‘”Õ ÷»… À»√¿Õƒ¿ ¬’Œƒﬂ“ ¬ —“–” “”–” ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» 
 subroutine CalculationNormFunE(RnormConstas,Kpoint,Npoint,IndexM,NumeroMin,NumeroMax,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,AZ,BZ,E,AX,BX,CX,IXM,FunMO,RO1X,H,NMO,NumeroMaxLimid,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,RfunLigands,AlfaCoffMO)  
   implicit none
   integer::Kpoint,IndexM,NumeroMin,NumeroMax,Npoint,NMO,NumeroMaxLimid
   real(8)::RnormConstas,H
   integer,dimension(:)::NumbreLigand
   integer,dimension(:,:)::IXM,NLigands,NFunLigands
   integer,dimension(:,:,:)::NumbreFunctionLig
   real(8),dimension(:)::UNout,UNin,AX,BX,CX,RO1X
   real(8),dimension(:,:)::Uout,Uin,VNout,VNin,AZ,BZ,E,FunMO
   real(8),dimension(:,:,:)::Vout,Vin,AlfaCoffMO
   real(8),dimension(:,:,:,:)::RfunLigands
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! 
   integer::IIDD,IBBB,ISUM,klkl
   

   ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ ÕŒ–Ã»–Œ¬Œ◊ÕŒ√Œ  Œ›‘‘»÷»≈Õ“¿ (ƒÀﬂ  Œ––≈ “»–Œ¬ » ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»)
   ! —◊»“€¬¿≈Ã œ¿–¿Ã≈“–€ œ–Œ√ŒÕ » ƒÀﬂ ‘Œ–Ã»–Œ¬¿Õ»ﬂ —»—“≈Ã€ ”–¿¬Õ≈Õ»…
   call ReadWriteMassiv2(2,Kpoint,IndexM,Vout,VNout)
   call ReadWriteMassiv1(2,Kpoint,IndexM,Uout,UNout)   
   call ReadWriteMassiv2(2,Kpoint+1,IndexM,Vin,VNin) 
   call ReadWriteMassiv1(2,Kpoint+1,IndexM,Uin,UNin)  
   
   80685 FORMAT(2X,100(I4,1X))
   79685 FORMAT(2X,100(F20.12,1X))
   ! ‘Œ–Ã»–”≈Ã ≈ƒ»Õ»◊Õ”ﬁ Ã¿“–»÷”
   E=0.D0
   !DO IIDD=1,IndexM
   !   E(IIDD,IIDD)=1.D0
   !ENDDO
   FORALL (IIDD=1:IndexM) E(IIDD,IIDD)=1.D0 
   
   ! ‘Œ–Ã»–”≈Ã Ã¿“–»÷” —»—“≈Ã€  
   E=E-MATMUL(VNout,VNin)
   !WRITE(6,*) 'EEEEEX'
   !DO IIDD=1,IndexM
   !   WRITE(6,79685) (E(IIDD,IBBB),IBBB=1,IndexM)
   !ENDDO
   ! ‘Œ–Ã»–”≈Ã —“ŒÀ¡≈÷ —¬Œ¡ŒƒÕ€’ ◊À≈ÕŒ¬
   AX=MATMUL(VNout,UNin)+UNout
   
   !WRITE(6,*) 'AAAAX'
   !WRITE(6,79685) (AX(IBBB),IBBB=1,IndexM)
   
  
   ! –≈ÿ¿≈Ã œŒÀ”◊≈ÕÕ”ﬁ —»—“≈Ã” ”–¿¬Õ≈Õ»…
   call SolutionSistemLinearEquationFull(E,AX,IXM,BX) 
    
  
   !WRITE(*,*) 'BBBBX'
   !WRITE(*,79685) (BX(IBBB),IBBB=1,IndexM)
   !READ(*,*)  
   !WRITE(400,*) Exf,BX(1)
   
   ! «¿œ»—€¬¿≈Ã œŒÀ”◊≈ÕÕ€≈ «Õ¿◊≈Õ»ﬂ ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» ¬ “Œ◊ ≈ —ÿ»¬ »
   call ReadWriteMassiv1X(1,Kpoint+2,NumeroMin,NumeroMax,FunMO,BX)

   ! ¬Œ——“¿Õ¿¬À»¬¿≈Ã «Õ¿◊≈Õ»ﬂ œ¿–÷»¿À‹Õ€’ √¿–ÃŒÕ»  (ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À») ¬Œ ¬—≈’ “Œ◊ ¿’ ƒÀﬂ œŒÀ”◊≈Õ»ﬂ ÕŒ–Ã»–Œ¬Œ◊ÕŒ…  ŒÕ—“¿Õ“€ 
   call FunctionRecoveryCorrection(Kpoint,IndexM,Npoint,NumeroMin,NumeroMax,H,Vout,Uout,Vin,Uin,FunMO,AX,BX,CX,VNout,UNout,VNin,UNin,RO1X,RnormConstas,NMO,NumeroMaxLimid,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,RfunLigands,AlfaCoffMO)
   
   
   
    return
 end subroutine CalculationNormFunE





 

 ! œŒƒœ–Œ√–¿ÃÃ¿ œŒÀ”◊¿≈“ «¿¬»—»ÃŒ—“‹ »Õ“≈√–¿À¿ Œ–“Œ√ŒÕ¿À‹ÕŒ—“» Œ“ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»
 ! ¬ »Õ“≈–¬¿À≈ Exf>Emin  
 ! ƒÀﬂ —À”◊¿ﬂ –≈ÿ≈Õ»ﬂ Õ≈ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€ ”–¿¬Õ≈Õ»…
 ! Kpoint-“Œ◊ ¿ —ÿ»¬ »
 ! Npoint-◊»—ÀŒ “Œ◊≈ 
 ! IndexM-–¿«Ã≈– Ã¿——»¬¿
 ! Vout(IndexM,IndexM,Npoint)- Ã¿——»¬ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » "Õ¿–”∆”"
 ! Uout(IndexM,Npoint)- Ã¿——»¬ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » "Õ¿–”∆”"
 ! Vin(IndexM,IndexM,Npoint)- Ã¿——»¬ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » "¬Õ”“–‹"
 ! Uin(IndexM,Npoint)- Ã¿——»¬ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » "¬Õ”“–‹"
 ! Exf-ŒƒÕŒ›À≈ “–ŒÕÕ¿ﬂ ‘”Õ ÷ﬂ
 ! Emin-√–¿Õ»÷¿ »Õ“≈–¬¿À¿
 ! VNout,UNout,VNin,UNin,AZ,BZ,E,AX,BX,CX,IXM-¬—œŒÃŒ√¿“≈À‹Õ€≈ Ã¿——»¬€
 ! FunMO-¬ ƒ¿ÕÕŒÃ —À”◊¿≈ ¬—œŒÃŒ√¿“≈À‹Õ€… Ã¿——»¬
 ! RO1X(Npoint)-Ã¿——»¬ œ–Œ»«¬ŒƒÕŒ… ÕŒ¬Œ… œ≈–≈Ã≈ÕÕŒ… œŒ —“¿–Œ…
 ! H-ÿ¿√
 ! Henergy-¯‡„ ÔÓ Ó‰ÌÓ˝ÎÂÍÚÓÌÌÓÈ ˝ÌÂ„ËË
 ! RnormMO-ÕŒ–Ã»–Œ¬ ¿ ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» œŒÀ”◊≈ÕÕŒ… Õ¿ œ–≈ƒ€ƒ”Ÿ≈… »“≈–¿÷»» ( –»“≈–»… œ–¿¬»À‹ÕŒ—“» œŒÀ”◊≈Õ»ﬂ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»)  
 ! IparametrDeterEnergy-œ¿–¿Ã≈“– ¬€’Œƒ¿ »« ÷» À¿ œŒ ”“Œ◊Õ≈Õ»ﬁ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»
 ! NMO-ÕŒÃ≈– ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
 ! NumeroMaxLimid-Ã¿ —»Ã¿À‹ÕŒ≈ ◊»—ÀŒ √¿–ÃŒÕ»  ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
 ! NumbreLigand(NumbreMO)-Ã¿——»¬ ◊»—À¿ À»√¿ÕƒŒ¬ ‘”Õ ÷»»  Œ“Œ–€’ Œœ»—€¬¿ﬁ“ ¬€—ÿ»≈ √¿–ÃŒÕ» » ƒ¿ÕÕŒ… ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
 ! NLigands(NumbreMO,NumbreLigand(NumbreMO))-Ã¿——»¬ ÕŒÃ≈–Œ¬ À»√¿ÕƒŒ¬ ‘”Õ ÷»»  Œ“Œ–€’ Œœ»—€¬¿ﬁ“ ¬€—ÿ»≈ √¿–ÃŒÕ» » ƒ¿ÕÕŒ… ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
 ! NFunLigands(NumbreMO,NumbreLigand(NumbreMO))-Ã¿——»¬ ◊»—À¿ ‘”Õ ÷»…  ¿∆ƒŒ√Œ À»√¿Õƒ¿ Œœ»—€¬¿ﬁŸ»’ ¬€—ÿ»≈ √¿–ÃŒÕ» » ƒ¿ÕÕŒ… ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
 ! NumbreFunctionLig(NumbreMO,NumbreLigand(NumbreMO),NFunLigands(NumbreMO,NumbreLigand(NumbreMO)))-Ã¿——»¬ ÕŒÃ≈–Œ¬ ‘”Õ ÷»… À»√¿ÕƒŒ¬  Œ“Œ–€≈ —ŒŒ“¬≈“—“¬”ﬁ“ ƒ¿ÕÕŒ… ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
 ! RfunLigands(Nnuclei,NumbreFunctionLig,NumbreGarmLigand,Npoint+2)-Ã¿——»¬ «Õ¿◊≈Õ»… ‘”Õ ÷»… À»√¿ÕƒŒ¬
 ! AlfaCoffMO(NumbreMO,NumbreLigand,NumbreFunLigand)-Ã¿——»¬  Œ›‘‘»÷»≈Õ“Œ¬ —  Œ“Œ–€Ã» ‘”Õ ÷»… À»√¿Õƒ¿ ¬’Œƒﬂ“ ¬ —“–” “”–” ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» 
 subroutine SpectrumEnergy(Kpoint,Npoint,IndexM,NumeroMin,NumeroMax,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,Exf,Emin,AZ,BZ,E,AX,BX,CX,IXM,FunMO,RO1X,H,Henergy,RnormMO,IparametrDeterEnergy,NMO,NumeroMaxLimid,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,RfunLigands,AlfaCoffMO)  
   implicit none
   integer::Niteration,NEpsIter,Kpoint,IndexM,NumeroMin,NumeroMax,IparametrDeterEnergy,Npoint,IZNAK,IndexVilky,INDEXDF,IIKK,IndexCorrect,IcorenZZ,NMO,NumeroMaxLimid
   real(8)::Exf,Emin,Henergy,RnormMO,EPS,H
   integer,dimension(:)::NumbreLigand
   integer,dimension(:,:)::IXM,NLigands,NFunLigands
   integer,dimension(:,:,:)::NumbreFunctionLig
   real(8),dimension(:)::UNout,UNin,AX,BX,CX,RO1X
   real(8),dimension(:,:)::Uout,Uin,VNout,VNin,AZ,BZ,E,FunMO
   real(8),dimension(:,:,:)::Vout,Vin,AlfaCoffMO
   real(8),dimension(:,:,:,:)::RfunLigands
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! 
   integer::IIDD,IBBB,ISUM,klkl
   real(8)::DeltaEnergy,RnormConstas,Kcoff,RcoffGran,DDD,ExfTemp,DMtemp

   ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ ÕŒ–Ã»–Œ¬Œ◊ÕŒ√Œ  Œ›‘‘»÷»≈Õ“¿ (ƒÀﬂ  Œ––≈ “»–Œ¬ » ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»)
   ! —◊»“€¬¿≈Ã œ¿–¿Ã≈“–€ œ–Œ√ŒÕ » ƒÀﬂ ‘Œ–Ã»–Œ¬¿Õ»ﬂ —»—“≈Ã€ ”–¿¬Õ≈Õ»…
   call ReadWriteMassiv2(2,Kpoint,IndexM,Vout,VNout)
   call ReadWriteMassiv1(2,Kpoint,IndexM,Uout,UNout)   
   call ReadWriteMassiv2(2,Kpoint+1,IndexM,Vin,VNin) 
   call ReadWriteMassiv1(2,Kpoint+1,IndexM,Uin,UNin)  
   
   80685 FORMAT(2X,100(I4,1X))
   79685 FORMAT(2X,100(F20.12,1X))
   ! ‘Œ–Ã»–”≈Ã ≈ƒ»Õ»◊Õ”ﬁ Ã¿“–»÷”
   E=0.D0
   DO IIDD=1,IndexM
      E(IIDD,IIDD)=1.D0
   ENDDO
   
   ! ‘Œ–Ã»–”≈Ã Ã¿“–»÷” —»—“≈Ã€  
   E=E-MATMUL(VNout,VNin)
   !WRITE(6,*) 'EEEEEX'
   !DO IIDD=1,IndexM
   !   WRITE(6,79685) (E(IIDD,IBBB),IBBB=1,IndexM)
   !ENDDO
   ! ‘Œ–Ã»–”≈Ã —“ŒÀ¡≈÷ —¬Œ¡ŒƒÕ€’ ◊À≈ÕŒ¬
   AX=MATMUL(VNout,UNin)+UNout
   
   !WRITE(6,*) 'AAAAX'
   !WRITE(6,79685) (AX(IBBB),IBBB=1,IndexM)
   
  
   ! –≈ÿ¿≈Ã œŒÀ”◊≈ÕÕ”ﬁ —»—“≈Ã” ”–¿¬Õ≈Õ»…
   call SolutionSistemLinearEquationFull(E,AX,IXM,BX) 
    
  
   !WRITE(*,*) 'BBBBX'
   !WRITE(*,79685) (BX(IBBB),IBBB=1,IndexM)
   !READ(*,*)  
   !WRITE(400,*) Exf,BX(1)
   
   ! «¿œ»—€¬¿≈Ã œŒÀ”◊≈ÕÕ€≈ «Õ¿◊≈Õ»ﬂ ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» ¬ “Œ◊ ≈ —ÿ»¬ »
   call ReadWriteMassiv1X(1,Kpoint+2,NumeroMin,NumeroMax,FunMO,BX)

   ! ¬Œ——“¿Õ¿¬À»¬¿≈Ã «Õ¿◊≈Õ»ﬂ œ¿–÷»¿À‹Õ€’ √¿–ÃŒÕ»  (ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À») ¬Œ ¬—≈’ “Œ◊ ¿’ ƒÀﬂ œŒÀ”◊≈Õ»ﬂ ÕŒ–Ã»–Œ¬Œ◊ÕŒ…  ŒÕ—“¿Õ“€ 
   call FunctionRecoveryCorrection(Kpoint,IndexM,Npoint,NumeroMin,NumeroMax,H,Vout,Uout,Vin,Uin,FunMO,AX,BX,CX,VNout,UNout,VNin,UNin,RO1X,RnormConstas,NMO,NumeroMaxLimid,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,RfunLigands,AlfaCoffMO)
   
   WRITE(*,*) Exf,RnormConstas,RnormMO
   WRITE(18,*) Exf,RnormConstas,RnormMO
   Exf=Exf*(1.D0-Henergy) 
   
   ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ »« œŒƒœ–Œ√–¿ÃÃ€ ” ¿«€¬¿≈Ã Õ»∆Õ»ﬁ √–¿Õ»÷”   
   IF(Exf.LT.Emin) THEN
      ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
      IparametrDeterEnergy=2
   ENDIF
   
   return
 end subroutine SpectrumEnergy




 ! œŒƒœ–Œ√–¿ÃÃ¿ ¬Œ——“¿ÕŒ¬À≈Õ»ﬂ «Õ¿◊≈Õ»… ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» ¬Œ ¬—≈’ “Œ◊ ¿’ »« “Œ◊ » —ÿ»¬ » 
 ! ¬œŒÃŒ√¿“≈À‹Õ¿ﬂ œŒƒœ–Œ√–¿ÃÃ¿ ƒÀﬂ  Œ––≈ “»–Œ¬ » ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»
 ! Kpoint-“Œ◊ ¿ —ÿ»¬ »
 ! IndexM-–¿«Ã≈– Ã¿——»¬¿
 ! Npoint-◊»—ÀŒ “Œ◊≈ 
 ! NumeroMin-ÕŒÃ≈– œ≈–¬Œ… √¿–ÃŒÕ» »
 ! NumeroMax-ÕŒÃ≈– œŒ—À≈ƒÕ≈… √¿–ÃŒÕ» »
 ! H-ÿ¿√
 ! Vout(IndexM,IndexM,Npoint)- Ã¿——»¬ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » "Õ¿–”∆”"
 ! Uout(IndexM,Npoint)-Ã¿——»¬ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » "Õ¿–”∆”"
 ! Vin(IndexM,IndexM,Npoint)- Ã¿——»¬ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » "¬Õ”“–‹"
 ! Uin(IndexM,Npoint)-Ã¿——»¬ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » "¬Õ”“–‹"
 ! FunMO(NGarmonik,Npoint+2)-Ã¿——»¬ «Õ¿◊≈Õ»… –¿ƒ»¿À‹ÕŒ… ◊¿—“» ‘”Õ ÷»» ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
 ! AX,BX,CX,VNout,UNout,VNin,UNin-¬—œŒÃŒ√¿“≈À‹Õ€≈ Ã¿——»¬€
 ! RO1X(Npoint)-¬—œŒÃŒ√¿“≈À‹Õ€… Ã¿——»¬  œ≈–¬¿ﬂ œ–Œ»«¬ŒƒÕ¿ﬂ ÕŒ¬Œ… œ≈–≈Ã≈ÕÕŒ… œŒ —“¿–Œ… 
 ! RnormConstas-ÕŒ–Ã»–Œ¬Œ◊Õ¿ﬂ  ŒÕ—“¿Õ“¿
 ! NMO-ÕŒÃ≈– ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
 ! NumeroMaxLimid-Ã¿ —»Ã¿À‹ÕŒ≈ ◊»—ÀŒ √¿–ÃŒÕ»  ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
 ! NumbreLigand(NumbreMO)-Ã¿——»¬ ◊»—À¿ À»√¿ÕƒŒ¬ ‘”Õ ÷»»  Œ“Œ–€’ Œœ»—€¬¿ﬁ“ ¬€—ÿ»≈ √¿–ÃŒÕ» » ƒ¿ÕÕŒ… ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
 ! NLigands(NumbreMO,NumbreLigand(NumbreMO))-Ã¿——»¬ ÕŒÃ≈–Œ¬ À»√¿ÕƒŒ¬ ‘”Õ ÷»»  Œ“Œ–€’ Œœ»—€¬¿ﬁ“ ¬€—ÿ»≈ √¿–ÃŒÕ» » ƒ¿ÕÕŒ… ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
 ! NFunLigands(NumbreMO,NumbreLigand(NumbreMO))-Ã¿——»¬ ◊»—À¿ ‘”Õ ÷»…  ¿∆ƒŒ√Œ À»√¿Õƒ¿ Œœ»—€¬¿ﬁŸ»’ ¬€—ÿ»≈ √¿–ÃŒÕ» » ƒ¿ÕÕŒ… ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
 ! NumbreFunctionLig(NumbreMO,NumbreLigand(NumbreMO),NFunLigands(NumbreMO,NumbreLigand(NumbreMO)))-Ã¿——»¬ ÕŒÃ≈–Œ¬ ‘”Õ ÷»… À»√¿ÕƒŒ¬  Œ“Œ–€≈ —ŒŒ“¬≈“—“¬”ﬁ“ ƒ¿ÕÕŒ… ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
 ! RfunLigands(Nnuclei,NumbreFunctionLig,NumbreGarmLigand,Npoint+2)-Ã¿——»¬ «Õ¿◊≈Õ»… ‘”Õ ÷»… À»√¿ÕƒŒ¬
 ! AlfaCoffMO(NumbreMO,NumbreLigand,NumbreFunLigand)-Ã¿——»¬  Œ›‘‘»÷»≈Õ“Œ¬ —  Œ“Œ–€Ã» ‘”Õ ÷»… À»√¿Õƒ¿ ¬’Œƒﬂ“ ¬ —“–” “”–” ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» 
 subroutine FunctionRecoveryCorrection(Kpoint,IndexM,Npoint,NumeroMin,NumeroMax,H,Vout,Uout,Vin,Uin,FunMO,AX,BX,CX,VNout,UNout,VNin,UNin,RO1X,RnormConstas,NMO,NumeroMaxLimid,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,RfunLigands,AlfaCoffMO)
   implicit none
   integer::Kpoint,IndexM,Npoint,NumeroMin,NumeroMax,NMO,NumeroMaxLimid
   real(8)::H,RnormConstas
   integer,dimension(:)::NumbreLigand
   integer,dimension(:,:)::NLigands,NFunLigands
   integer,dimension(:,:,:)::NumbreFunctionLig
   real(8),dimension(:)::AX,BX,CX,UNout,UNin,RO1X
   real(8),dimension(:,:)::Uout,Uin,FunMO,VNout,VNin
   real(8),dimension(:,:,:)::Vout,Vin,AlfaCoffMO 
   real(8),dimension(:,:,:,:)::RfunLigands
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   integer::IXXZ,IILV,IIDF,IOFG
   
   
   10000 FORMAT(2X,100(1X,F20.16))
   ! ¬Œ——“¿Õ¿¬À»¬¿≈Ã «Õ¿◊≈Õ»≈ –¿ƒ»¿À‹ÕŒ… ◊¿—“» ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» ¬ “Œ◊ ¿’ (1,Kpoint-1)
   DO IXXZ=Kpoint-1,1,-1 
      ! —◊»“€¬¿≈Ã «Õ¿◊≈Õ»≈ ‘”Õ ÷»» ¬ “Œ◊ ≈  IXXZ+1 +(2)-Õ¿◊¿ÀŒ Õ”Ã≈–¿÷»» — 3 “Œ◊ ≈ ¬ Ã¿——»¬≈
	  call ReadWriteMassiv1X(2,IXXZ+3,NumeroMin,NumeroMax,FunMO,AX)
	  !WRITE(6,*) 'POINTGGGGGG',IXXZ+1
	  !WRITE(6,10000) (AX(IOFG),IOFG=1,IndexM)
      ! —◊»“€¬¿≈Ã «Õ¿◊≈Õ»≈ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ »
	  call ReadWriteMassiv2(2,IXXZ,IndexM,Vout,VNout)
	  call ReadWriteMassiv1(2,IXXZ,IndexM,Uout,UNout)  
      !WRITE(6,*) 'POINT',IXXZ
	  !DO IIDF=1,IndexM
      !   WRITE(6,10000) (VNout(IIDF,IOFG),IOFG=1,IndexM)
	  !ENDDO
	  !WRITE(6,*)
	  ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ «Õ¿◊≈Õ»… ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» (œ¿–÷»¿À‹Õ€’ √¿–ÃŒÕ» ) ¬ “Œ◊ ≈ IXXZ 
	  BX=UNout+MATMUL(VNout,AX)
	  ! «¿œ»—€¬¿≈Ã –≈«”À‹“¿“ 
      call ReadWriteMassiv1X(1,IXXZ+2,NumeroMin,NumeroMax,FunMO,BX)
   ENDDO
   
   ! ¬Œ——“¿Õ¿¬À»¬¿≈Ã «Õ¿◊≈Õ»≈ –¿ƒ»¿À‹ÕŒ… ◊¿—“» ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» ¬ “Œ◊ ¿’ (Kpoint+1,Npoint)
   DO IXXZ=Kpoint+1,Npoint 
      ! —◊»“€¬¿≈Ã «Õ¿◊≈Õ»≈ ‘”Õ ÷»» ¬ “Œ◊ ≈  IXXZ-1 +(2)-Õ¿◊¿ÀŒ Õ”Ã≈–¿÷»» — 3 “Œ◊ ≈ ¬ Ã¿——»¬≈
	  call ReadWriteMassiv1X(2,IXXZ+1,NumeroMin,NumeroMax,FunMO,AX)
	  !WRITE(6,*) 'POINTGGGGGG',IXXZ-1
	  !WRITE(6,10000) (AX(IOFG),IOFG=1,IndexM)
      ! —◊»“€¬¿≈Ã «Õ¿◊≈Õ»≈ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ »
	  call ReadWriteMassiv2(2,IXXZ,IndexM,Vin,VNin)
	  call ReadWriteMassiv1(2,IXXZ,IndexM,Uin,UNin)  
      ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“ «Õ¿◊≈Õ»… ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» (œ¿–÷»¿À‹Õ€’ √¿–ÃŒÕ» ) ¬ “Œ◊ ≈ IXXZ 
	  BX=UNin+MATMUL(VNin,AX)
	  ! «¿œ»—€¬¿≈Ã –≈«”À‹“¿“ 
      call ReadWriteMassiv1X(1,IXXZ+2,NumeroMin,NumeroMax,FunMO,BX)
   ENDDO   

   ! ‘Œ–Ã»–”≈Ã —“–” “”–” ¬€—ÿ»’ √¿–ÃŒÕ»  ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
		
   ! Œœ–≈ƒ≈Àﬂ≈Ã  Œ›‘‘»÷»≈Õ“€ ¿À‹‘¿
   call CalculationCoffAlfaMO(NMO,Npoint,H,NumeroMax,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,FunMO,RfunLigands,AlfaCoffMO,RO1X) 
        
   ! ‘Œ–Ã»–”≈Ã —“–” “”–” ¬€—ÿ»’ √¿–ÃŒÕ»  ÃŒÀ≈ ”Àﬂ–Õ€’ Œ–¡»“¿À≈… — ”◊≈“ŒÃ œŒÀ”◊≈ÕÕ€’  Œ›‘‘»÷»≈Õ“Œ¬ ¿À‹‘¿
   call FormStructureMO(NMO,Npoint,H,NumeroMax,NumeroMaxLimid,NumbreLigand,NLigands,NFunLigands,NumbreFunctionLig,FunMO,RfunLigands,AlfaCoffMO) 


   
   ! ÕŒ–Ã»–”≈Ã œŒÀ”◊≈ÕÕ”ﬁ ÃŒÀ≈ ”Àﬂ–Õ”ﬁ Œ–¡»“¿À‹
   RnormConstas=CalculationNormalizationConsta(NumeroMin,NumeroMaxLimid,Npoint,H,RO1X,FunMO) 


   !DO IXXZ=1,Npoint
   !   WRITE(6,10000) RR(IXXZ),(FunMO(IILV,IXXZ+2)/DSQRT(RnormConstas*RO1X(IXXZ)),IILV=NumeroMin,NumeroMax)
   !ENDDO


   !WRITE(*,*) 'NORMA',RnormConstas
   !READ(*,*)
      
   return
 end subroutine FunctionRecoveryCorrection

 ! œŒƒœ–Œ√–¿ÃÃ¿ Œ—”Ÿ≈—“¬ÀﬂﬁŸ¿ﬂ œŒ»—  »Õ“≈–¬¿À¿ Õ”∆ÕŒ√Œ  Œ–Õﬂ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»» ’¿–“–»-‘Œ ¿ ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» ƒÀﬂ —À”◊¿ﬂ œ≈–¬Œ… »“≈–¿÷»»
 ! NMO-ÕŒÃ≈– ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
 ! NNEL- √À¿¬ÕŒ≈  ¬¿Õ“Œ¬Œ≈ ◊»—ÀŒ
 ! NEpsIter-ÕŒÃ≈– »“≈–¿÷»» ƒÀﬂ œŒÀ”◊≈Õ»ﬂ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»
 ! Kpoint-“Œ◊ ¿ —ÿ»¬ »
 ! IndexM-–¿«Ã≈– Ã¿——»¬¿
 ! Vout(IndexM,IndexM,Npoint)- Ã¿——»¬ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » "Õ¿–”∆”"
 ! Vin(IndexM,IndexM,Npoint)- Ã¿——»¬ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » "¬Õ”“–‹"
 ! DetM-Ã¿——»¬ «Õ¿◊≈Õ»… ƒ≈“≈–Ã»Õ¿Õ“¿
 ! ExfM-Ã¿——»¬ «Õ¿◊≈Õ»… ŒƒÕŒ›À≈ “–ŒÕÕŒ… ‘”Õ ÷»»
 ! Exf-ŒƒÕŒ›À≈ “–ŒÕÕ¿ﬂ ›Õ≈–√»ﬂ
 ! AZ,BZ,E-¬—œŒÃŒ√¿“≈À‹Õ€≈ Ã¿——»¬€
 ! Henergy-¯‡„ ÔÓ Ó‰ÌÓ˝ÎÂÍÚÓÌÌÓÈ ˝ÌÂ„ËË (œŒ—À≈ Œ ŒÕ◊¿Õ»ﬂ œ–Œ√–¿ÃÃ€ ƒ¿≈“ Õ”À»¬Œ≈ œ–»¡À»∆≈Õ»≈ ƒÀﬂ  Œ–Õﬂ)
 ! IparametrDeterEnergy-œ¿–¿Ã≈“– ¬€’Œƒ¿ »« ÷» À¿ œŒ ”“Œ◊Õ≈Õ»ﬁ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»
 ! EPS-“Œ◊ÕŒ—“‹
 ! IndexVilky-»Õƒ≈ — ” ¿«€¬¿ﬁŸ»… Õ¿ “Œ ◊“Œ Œœ–≈ƒ≈À≈Õ »Õ“≈–¬¿À ¬  Œ“Œ–ŒÃ Õ¿’Œƒ»“—ﬂ  Œ–≈Õ‹
 ! IndexVilky=0-»Õ“≈–¬¿À Õ≈ Œœ–≈ƒ≈À≈Õ
 ! IndexVilky=1-»Õ“≈–¬¿À Œœ–≈ƒ≈À≈Õ 
 ! IndexVilky=2-–≈∆»Ã œŒ»— ¿  Œ–Õﬂ 
 ! INDEXDF-»Õƒ≈ — ” ¿«€¬¿ﬁŸ»… ◊»—ÀŒ »“≈–¿÷»… —ƒ≈À¿ÕÕ€’ œŒ—À≈ œŒœ¿ƒ¿Õ»ﬂ ¬ ¬»À ”
 ! IndexCorrect-»Õƒ≈ — ” ¿«€¬¿ﬁŸ»… ◊»—ÀŒ  Œ–Õ≈… Õ¿…ƒ≈ÕÕ€’ Õ¿ ¬—≈Ã »Õ“≈–¬¿À≈  
 ! EnergyZeroZ(NumbreMO,NNEL+1,2)-Ã¿——»¬  Œ–Õ≈… ŒƒÕŒ–ŒƒÕŒ√Œ ”–¿¬Õ≈Õ»ﬂ 
 ! IKLKORX,IOPZ,IKLRXX-»Õƒ≈ —€  Œ––≈ “»–Œ¬ » ƒÀﬂ ”—“¿Õ¿¬À≈Õ»ﬂ  Œ–≈Õ‹ »À» –¿«–€¬
 ! INDEXAD-»Õƒ≈ — ” ¿«€¬¿ﬁŸ»… ◊»—ÀŒ »“≈–¿÷»… —ƒ≈À¿ÕÕ€’ ¬ —À”◊¿≈  Œ√ƒ¿ »Õ“≈–¬¿À Õ≈Œœ–≈ƒ≈À≈Õ 
 ! RcoffChengH- Œ›‘‘»÷»≈Õ“ »«Ã≈Õ≈Õ»ﬂ ÿ¿√¿
 ! ProDet(2)-Ã¿——»¬ œ–Œ»«¬ŒƒÕ€’
 ! INDEXRShag-–≈∆»Ã »«Ã≈Õ≈Õ»ﬂ ÿ¿√¿
 ! IIHD-»Õƒ≈ — ”Ã≈Õ‹ÿ≈Õ»ﬂ ÿ¿√¿
 ! IIOXDPZ- Àﬁ◊ ” ¿«€¬¿ﬁŸ»… ◊“Œ Ã€ œŒœ¿À» ¬ –≈∆»Ã ”Ã≈Õ‹ÿ≈Õ»ﬂ ÿ¿√¿ »  ŒÕ“–ŒÀ»–”≈Ã ¬Œ«ÃŒ∆ÕŒ—“‹ œ≈–≈— Œ ¿
 ! INDEXPeresc-»Õƒ≈ — ” ¿«€¬¿ﬁŸ»… ◊¿—“» »“≈–¿÷»… ¬ –≈∆»Ã≈ ¬Œ«ÃŒ∆ÕŒ√Œ œ≈–≈— Œ ¿
 ! DeltaEnerPers-»Õ“≈–¬¿À ›Õ≈–√»… ¬ Œ¡À¿—“» œ≈–≈— Œ ¿
 ! DeltaFunPers-»Õ“≈–¬¿À ‘”Õ ÷»… ¬ Œ¡À¿—“» œ≈–≈— Œ ¿ 
 subroutine SearchSolution(NMO,NNEL,NEpsIter,Kpoint,IndexM,Vout,Vin,DetM,ExfM,Exf,AZ,BZ,E,Henergy,IparametrDeterEnergy,EPS,IndexVilky,INDEXDF,IIKK,IndexCorrect,EnergyZeroZ,IKLKORX,IOPZ,IKLRXX,INDEXAD,RcoffChengH,ProDet,INDEXRShag,IIHD,IIOXDPZ,INDEXPeresc,DeltaEnerPers,DeltaFunPers)
   implicit none
   integer::NMO,NNEL,NEpsIter,Kpoint,IndexM,IparametrDeterEnergy,IndexVilky,INDEXDF,IIKK,IndexCorrect,IKLKORX,IOPZ,IKLRXX,INDEXAD,INDEXRShag,IIHD,IIOXDPZ,INDEXPeresc
   real(8)::Exf,Henergy,EPS,RcoffChengH,DeltaEnerPers,DeltaFunPers
   real(8),dimension(:)::DetM,ExfM,ProDet
   real(8),dimension(:,:)::AZ,BZ,E
   real(8),dimension(:,:,:)::Vout,Vin,EnergyZeroZ
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! 
   integer::IIDD,IBBB,IIII,klkl,IIIFKL,IKLCOMBEC
   real(8)::DeltaEnergy,DDD,Kcoff,RcoffGran,ExfTemp,DMtemp,Rdet
   !real(8)::DeltaEnergy,RnormConstas,Kcoff,RcoffGran,ExfTemp,DMtemp,DDD
   ! Œœ–≈ƒ≈Àﬂ≈Ã ƒ≈“≈–Ã»Õ¿Õ“ —»—“≈Ã€
   call ReadWriteMassiv2(2,Kpoint,IndexM,Vout,AZ) 
   call ReadWriteMassiv2(2,Kpoint+1,IndexM,Vin,BZ) 
   10685 FORMAT(2X,100(I4,1X))
   19685 FORMAT(2X,100(F20.12,1X))

   ! ‘Œ–Ã»–”≈Ã ≈ƒ»Õ»◊Õ”ﬁ Ã¿“–»÷”
   E=0.D0
   DO IIDD=1,IndexM
      E(IIDD,IIDD)=1.D0
   ENDDO
   
   ! ‘Œ–Ã»–”≈Ã Ã¿“–»÷” —»—“≈Ã€
   !WRITE(100,*) 'E'
   !DO IIDD=1,IndexM
   !   WRITE(100,19345 ) (E(IIDD,IBBB),IBBB=1,IndexM)
   !ENDDO
   !WRITE(100,*) 'AZ'
   !DO IIDD=1,IndexM
   !   WRITE(100,19345 ) (AZ(IIDD,IBBB),IBBB=1,IndexM)
   !ENDDO 
   !WRITE(100,*) 'BZ'
   !DO IIDD=1,IndexM
   !   WRITE(100,19345 ) (BZ(IIDD,IBBB),IBBB=1,IndexM)
   !ENDDO
   E=E-MATMUL(AZ,BZ)
   !WRITE(100,*) 'E'
   !DO IIDD=1,IndexM
   !   WRITE(100,19345 ) (E(IIDD,IBBB),IBBB=1,IndexM)
   !ENDDO
   ! «¿œ»—€¬¿≈Ã –≈«”À‹“¿“ –¿—◊≈“¿
   ! Œœ–≈ƒ≈Àﬂ≈Ã ƒ≈“≈–Ã»Õ¿Õ“ —»—“≈Ã€
   Rdet=Determenant(E)

   WRITE(17,*) Exf,Rdet,RcoffChengH    !Kpoint
   !WRITE(*,*) 'ENERGY',Exf,Rdet,Kpoint
   !WRITE(*,*) 'DDD,klkl'
   !READ(*,*) DDD,klkl
   !IF(klkl.EQ.-1) THEN
   !   Exf=ExfTemp
   !	  WRITE(*,*) 'CVCV',Exf
   !  ENDIF
   !ExfTemp=Exf
   !DDD=0.0001D0
   !Exf=Exf*(1.D0-DDD)
   !write(*,*) '0 Exf',Exf
   !DeltaEnergy=1.D0
   !IndexVilky=10
  
   
   ! «¿œ»—€¬¿≈Ã –≈«”À‹“¿“ –¿—◊≈“¿
   IF(IndexVilky.EQ.0) THEN
        IF(NEpsIter.EQ.1) THEN
           DetM(4)=Rdet
		ENDIF
        IF(NEpsIter.EQ.2) THEN
           DetM(5)=Rdet
		ENDIF
        IF(NEpsIter.NE.1.AND.NEpsIter.NE.2) THEN
            DetM(1)=DetM(2)
			DetM(2)=DetM(3)
            DetM(3)=DetM(4)
            DetM(4)=DetM(5)
            DetM(5)=Rdet
        ENDIF
		! »Õƒ≈ — ‘» —»–”ﬁŸ»… ◊»—ÀŒ »“≈–¿÷»… ¬ —À”◊¿≈  Œ√ƒ¿ »Õ“≈–¬¿À Õ≈Œœ–≈ƒ≈À≈Õ
		INDEXAD=INDEXAD+1
		! ¬ Õ¿◊¿À≈ ¬Œ«¬–¿Ÿ¿≈Ã—ﬂ   œ–≈ƒ€ƒ”Ÿ≈Ã” ÿ¿√” ”¡»–¿≈Ã  Œ›‘‘»÷»≈Õ“ œŒÀ”◊≈ÕÕ€… ¬ œ–≈ƒ≈ƒ”Ÿ≈Ã »Õ“≈–¬¿À≈ 
		IF(INDEXAD.EQ.4) THEN
		   Henergy=Henergy*RcoffChengH
        ENDIF 
		! Õ¿◊»Õ¿≈Ã  Œ––≈ “»–Œ¬¿“‹ ÿ¿√ 
		IF(INDEXAD.EQ.5) THEN
		   ! ¬Œ«¬–¿Ÿ¿≈Ã  Œ›‘‘»÷»≈Õ“ ¬ »—’ŒƒÕŒ≈ —Œ—“ŒﬂÕ»≈
		   RcoffChengH=1.D0
           ProDet(1)=DABS(DetM(5)*(1.D0-DetM(4)/DetM(5))/(ExfM(5)*(1.D0-ExfM(4)/ExfM(5))))
		ENDIF
	    IF(INDEXAD.EQ.6) THEN
           ProDet(2)=DABS(DetM(5)*(1.D0-DetM(4)/DetM(5))/(ExfM(5)*(1.D0-ExfM(4)/ExfM(5))))
		ENDIF
		IF(INDEXAD.GT.6) THEN
           ProDet(1)=ProDet(2)
           ProDet(2)=DABS(DetM(5)*(1.D0-DetM(4)/DetM(5))/(ExfM(5)*(1.D0-ExfM(4)/ExfM(5))))
		   ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“  Œ›‘‘»÷»≈Õ“¿ » »«Ã≈Õ≈Õ»≈ ÿ¿√¿
		   call ChangeHR(INDEXRShag,IKLCOMBEC,IIHD,IIOXDPZ,IndexCorrect,Henergy,RcoffChengH,ExfM,ProDet,DetM,INDEXPeresc,DeltaEnerPers,DeltaFunPers)
		   
		   ! œ–Œ¬≈–ﬂ≈Ã œ≈–≈’Œƒ ¬ –≈∆»Ã ”Ã≈Õ‹ÿ≈Õ»ﬂ ÿ¿√¿
		   IF(IKLCOMBEC.EQ.1) THEN
              ! ¬Œ«¬–¿Ÿ¿≈Ã—ﬂ Õ¿ ŒƒÕ” “Œ◊ ” Õ¿«¿ƒ
              Exf=ExfM(4)
			  ExfM(5)=ExfM(4)
              ExfM(4)=ExfM(3)
              ExfM(3)=ExfM(2)
              ExfM(2)=ExfM(1)
              DetM(5)=DetM(4)
              DetM(4)=DetM(3)
              DetM(3)=DetM(2)
              DetM(2)=DetM(1)   
		   ENDIF
		ENDIF
   ENDIF

   IF(IndexVilky.EQ.1) THEN	
      IF(INDEXDF.EQ.1) THEN 
         DetM(1)=DetM(2)
	     DetM(2)=DetM(3)
         DetM(3)=DetM(4)
         DetM(4)=DetM(5)
         DetM(5)=Rdet
      ENDIF 
	  IF(INDEXDF.EQ.2) THEN 
         ! œ–Œ¬≈–ﬂ≈Ã  ¿ Œ… »« –≈∆»ÃŒ¬ ¬ Àﬁ◊≈Õ
		 IF(IKLKORX.EQ.1) THEN
            !  Œ––≈ “»–Œ¬ ¿ —œ–¿¬¿
            ! œ–Œ¬≈–ﬂ≈Ã ◊“Œ¡€ «Õ¿◊≈Õ»≈ —œ–¿¬¿ ¡€ÀŒ “Œ√Œ ∆≈ «Õ¿ ¿
			IIIFKL=0
			IF(Rdet.GT.0.D0.AND.DetM(3).GT.0.D0) THEN
               DetM(1)=DetM(2)
	           DetM(2)=DetM(3)
			   DetM(3)=Rdet
               ExfM(1)=ExfM(2)
               ExfM(2)=ExfM(3)
			   ExfM(3)=Exf
			   IIIFKL=1
			   ! ”¬≈À»◊»¬¿≈Ã ◊»—ÀŒ “Œ◊≈  œŒÀ”◊≈ÕÕ€’ ¬ ¡À»«» “Œ◊ » »«Ã≈Õ≈Õ»ﬂ «Õ¿ ¿
			   IKLRXX=IKLRXX+1
			   ! “Œ◊ ¿ Œœ–≈ƒ≈À≈Õ¿ ¬Œ«¬–¿Ÿ¿≈Ã »—’ŒƒÕŒ≈ «Õ¿◊≈Õ»≈  Œ––≈ “–»–”ﬁŸ≈√Œ ÃÕŒ∆»“≈Àﬂ
			   IOPZ=4 
			ENDIF
            IF(Rdet.LT.0.D0.AND.DetM(3).LT.0.D0) THEN
               DetM(1)=DetM(2)
	           DetM(2)=DetM(3)
			   DetM(3)=Rdet
               ExfM(1)=ExfM(2)
               ExfM(2)=ExfM(3)
			   ExfM(3)=Exf
			   IIIFKL=1
			   ! ”¬≈À»◊»¬¿≈Ã ◊»—ÀŒ “Œ◊≈  œŒÀ”◊≈ÕÕ€’ ¬ ¡À»«» “Œ◊ » »«Ã≈Õ≈Õ»ﬂ «Õ¿ ¿
			   IKLRXX=IKLRXX+1
			   ! “Œ◊ ¿ Œœ–≈ƒ≈À≈Õ¿ ¬Œ«¬–¿Ÿ¿≈Ã »—’ŒƒÕŒ≈ «Õ¿◊≈Õ»≈  Œ––≈ “–»–”ﬁŸ≈√Œ ÃÕŒ∆»“≈Àﬂ
			   IOPZ=4 
			ENDIF
			IF(IIIFKL.EQ.0) THEN
               IOPZ=IOPZ*2
			ENDIF
			! ÕŒÃ≈– »“≈–¿÷»» ¬Œ«¬–¿Ÿ¿≈Ã Õ¿ 1 Õ¿«¿ƒ
			INDEXDF=INDEXDF-1
		 ENDIF
         IF(IKLKORX.EQ.2) THEN
            !  Œ––≈ “»–Œ¬ ¿ —À≈¬¿
            ! œ–Œ¬≈–ﬂ≈Ã ◊“Œ¡€ «Õ¿◊≈Õ»≈ —À≈¬¿ ¡€ÀŒ “Œ√Œ ∆≈ «Õ¿ ¿
			IIIFKL=0
			IF(Rdet.GT.0.D0.AND.DetM(4).GT.0.D0) THEN
               DetM(5)=DetM(4)
	           DetM(4)=Rdet
			   ExfM(5)=ExfM(4)
               ExfM(4)=Exf
			   IIIFKL=1
			   ! ”¬≈À»◊»¬¿≈Ã ◊»—ÀŒ “Œ◊≈  œŒÀ”◊≈ÕÕ€’ ¬ ¡À»«» “Œ◊ » »«Ã≈Õ≈Õ»ﬂ «Õ¿ ¿
			   IKLRXX=IKLRXX+1
			   ! “Œ◊ ¿ Œœ–≈ƒ≈À≈Õ¿ ¬Œ«¬–¿Ÿ¿≈Ã »—’ŒƒÕŒ≈ «Õ¿◊≈Õ»≈  Œ––≈ “–»–”ﬁŸ≈√Œ ÃÕŒ∆»“≈Àﬂ
			   IOPZ=4 
			ENDIF
            IF(Rdet.LT.0.D0.AND.DetM(4).LT.0.D0) THEN
               DetM(5)=DetM(4)
	           DetM(4)=Rdet
			   ExfM(5)=ExfM(4)
               ExfM(4)=Exf
			   IIIFKL=1
			   ! ”¬≈À»◊»¬¿≈Ã ◊»—ÀŒ “Œ◊≈  œŒÀ”◊≈ÕÕ€’ ¬ ¡À»«» “Œ◊ » »«Ã≈Õ≈Õ»ﬂ «Õ¿ ¿
			   IKLRXX=IKLRXX+1
			   ! “Œ◊ ¿ Œœ–≈ƒ≈À≈Õ¿ ¬Œ«¬–¿Ÿ¿≈Ã »—’ŒƒÕŒ≈ «Õ¿◊≈Õ»≈  Œ––≈ “–»–”ﬁŸ≈√Œ ÃÕŒ∆»“≈Àﬂ
			   IOPZ=4 
			ENDIF
			IF(IIIFKL.EQ.0) THEN
               IOPZ=IOPZ*2
			ENDIF
			! ÕŒÃ≈– »“≈–¿÷»» ¬Œ«¬–¿Ÿ¿≈Ã Õ¿ 1 Õ¿«¿ƒ
			INDEXDF=INDEXDF-1
		 ENDIF
		
      ENDIF   
   ENDIF 

   
   IF(IndexVilky.EQ.2) THEN
      IF(INDEXDF.EQ.1) THEN
           DetM(4)=DetM(1)
           DetM(1)=DetM(2)
           DetM(2)=DetM(3)
           DetM(3)=Rdet
	     ELSE
	       !  Œ–≈Õ‹ œŒœ¿À ¬ œ≈–¬€… »“≈–¬¿À
           IF(IIKK.EQ.1) THEN
              DetM(2)=DetM(3)
              DetM(3)=Rdet
	       ENDIF
           !  Œ–≈Õ‹ œŒœ¿À ¬ ¬“Œ–Œ… »“≈–¬¿À
           IF(IIKK.EQ.2) THEN
              DetM(1)=DetM(3)
              DetM(3)=Rdet
 	       ENDIF
      ENDIF
   ENDIF 
   		    
      
   ! œ–Œ¬Œƒ»Ã œŒ»—   Œ–Õ≈… Õ¿ ¬—≈Ã ›Õ≈–√»“»◊≈— ŒÃ »Õ“≈–¬¿À≈
   IF(IndexVilky.EQ.0) THEN
      ! œ–Œ¬Œƒ»Ã œ≈–≈¡Œ– «Õ¿◊≈Õ»… ›Õ≈–√»»
      IF(NEpsIter.EQ.1) THEN
	        ExfM(4)=Exf
            Exf=Exf*(1.D0-Henergy)
            ExfM(5)=Exf  
          ELSE
	       ! œ–Œ¬≈–ﬂ≈Ã œŒœ¿ƒ¿≈“ ŒƒÕŒ›À≈ “–ŒÕÕ¿ﬂ ›Õ≈–√»ﬂ ¬ ¬»À ” »À» Õ≈“ (Œœ–≈ƒ≈À≈Õ À» »Õ“≈–¬¿À ¬  Œ“Œ–ŒÃ Õ¿’Œƒ»“—ﬂ  Œ–≈Õ‹)
	       IF((DetM(4)*DetM(5)).LT.0.D0) THEN
	             IndexVilky=1  
				 ! œŒ— ŒÀ‹ ” »Õ“≈–¬¿À Œœ–≈ƒ≈À≈Õ «¿Õ”Àﬂ≈Ã ◊»—ÀŒ »“≈–¿÷»… ¬Õ≈ »Õ“≈–¬¿À¿ ƒÀﬂ ÕŒ¬Œ√Œ —À”◊¿ﬂ ¬Õ≈ »Õ“≈–¬¿À¿  
				 INDEXAD=0
				 ! œŒ— ŒÀ‹ ” »Õ“≈–¬¿À Œœ–≈ƒ≈À≈Õ «¿Õ”Àﬂ≈Ã ◊»—ÀŒ »“≈–¿÷»… — ”Ã≈Õ‹ÿ≈ÕÕ€Ã ÿ¿√ŒÃ
				 INDEXRShag=0  
				 !  ŒÕ“–ŒÀ‹ — ¿◊ ¿ Œ“ Àﬁ◊¿≈Ã
				 IIOXDPZ=0                 
			   ELSE
			     Exf=Exf*(1.D0-Henergy)
                 ExfM(1)=ExfM(2)
                 ExfM(2)=ExfM(3)
				 ExfM(3)=ExfM(4)
                 ExfM(4)=ExfM(5)
				 ExfM(5)=Exf  
           ENDIF      
	  ENDIF
   ENDIF
   
   ! ”—“¿ÕŒ¬À≈Õ¿ Œ¡À¿—“‹ œ≈–≈Ã≈Õ€ «Õ¿ ¿ 
   IF(IndexVilky.EQ.1) THEN
        ! œ–Œ¬≈–ﬂ≈Ã œ≈–≈Ã≈Õ¿ «Õ¿ ¿ —¬ﬂ«¿Õ¿ — ¬Œ«Õ» ÕŒ¬≈Õ≈Ã –¿«–€¬¿ ¬ ƒ¿ÕÕŒ… Œ¡À¿—“» »À» — Õ¿À»◊»≈Ã  Œ–Õﬂ
        ! »Õƒ≈ — ” ¿«€¬¿≈“, ◊“Œ ¬ ƒ¿ÕÕŒÃ –≈∆»Ã≈  œ–Œ√–¿ÃÃ¿ –¿¡Œ“¿≈“ ƒÀﬂ ƒ¿ÕÕŒ√Œ »Õ“≈–¬¿À¿ ¬ œ≈–¬€… –¿«
		INDEXDF=INDEXDF+1
        IF(INDEXDF.EQ.1) THEN
             Exf=Exf*(1.D0-Henergy/FLOAT(IndexCorrect+2))
             ExfM(1)=ExfM(2)
             ExfM(2)=ExfM(3)
		     ExfM(3)=ExfM(4)
             ExfM(4)=ExfM(5)
		     ExfM(5)=Exf 
			 ! ‘» —»–”≈Ã IOPZ ƒÀﬂ  Œ––≈ “»–Œ¬ »  Œ–Õ≈…
			 IOPZ=4 
			 ! ‘» —»–”≈Ã ◊»—ÀŒ “Œ◊≈   Œ“Œ–€≈ ¡€À» ”◊“≈Õ€ œ–» —”∆≈Õ»» Œ¡À¿—“» 
			 IKLRXX=0 
           ELSE   
             IF(DABS(DetM(5)).GT.DABS(DetM(4)).AND.DABS(DetM(2)).GT.DABS(DetM(3))) THEN
                  ! Œ¡Õ¿–”∆≈Õ »Õ“≈–¬¿À  Œ–Õﬂ 
                  IndexCorrect=IndexCorrect+1
                  ! »«Ã≈Õ≈Õ»≈ ÿ¿√¿ 
				  Henergy=Henergy/FLOAT(IndexCorrect+1)
				  ! ‘» —»–”≈Ã ¬Œ«ÃŒ∆Õ€…  Œ–≈Õ‹ ¬ ƒ¿ÕÕŒ… Œ¡À¿—“»
                  EnergyZeroZ(NMO,IndexCorrect,1)=EnergyZeroZ(NMO,IndexCorrect,2)
				  EnergyZeroZ(NMO,IndexCorrect,2)=ExfM(3)  
                  
				  ! ƒ¿ÕÕ¿ﬂ œ≈–≈Ã≈Õ¿ «Õ¿ Œ¬ —¬ﬂ«¿Õ¿ — Õ¿À»◊»≈Ã –¿«–€¬¿
			      ! À»¡Œ  Œ–≈Õ‹ Õ¿…ƒ≈Õ œ–» ›“ŒÃ ¬—≈ –¿¬ÕŒ Õ”∆ÕŒ œ≈–≈…“» ¬ –≈∆»Ã ƒ¿À‹Õ≈…ÿ≈√Œ œŒ»— ¿
			      ! œ≈–≈’Œƒ»Ã ¬ –≈∆»Ã ƒ¿À‹Õ≈…ÿ≈√Œ œŒ»— ¿  Œ–Õ≈…
			      IndexVilky=0 
                  INDEXDF=0 
                  Exf=ExfM(5)
				ELSE
				  ! ”—“¿Õ¿¬À»¬¿≈Ã œ–»◊»Õ¿ ¬ –¿«–€¬≈ »À» Õ≈“
				  ! ¬€ﬂ—Õﬂ≈Ã —”Ÿ≈—“¬”≈“  Œ–≈Õ‹ »À» »Ã≈≈“ Ã≈—“Œ –¿«–€¬
				  ! œ–» ›“ŒÃ, ”—“¿Õ¿¬À»¬¿≈Ã “¿ Œ≈ œŒ¬≈ƒ≈Õ»≈ —¬ﬂ«¿ÕŒ —  ŒÀ≈¡¿Õ»ﬂÃ» ¬ Œ¡À¿—“» œ≈–≈Ã≈Õ€ «Õ¿ ¿
				  ! Œ—”Ÿ≈—“¬Àﬂ≈Ã —”∆≈Õ»≈ Œ¡À¿—“» œ≈–≈Ã≈Õ€ «Õ¿ ¿ ƒÀﬂ ¬Õ≈—≈Õ»ﬂ ﬂ—ÕŒ—“» ¬ œŒ¬≈ƒ≈Õ»» Œœ–≈ƒ≈À»“≈Àﬂ ¬ Œ¡À¿—“» Õ”Àﬂ
                   
				  IIIFKL=0
				  ! ”—“¿Õ¿¬À»¬¿≈Ã œ–»◊»Õ” Œ“—”“—“¬»ﬂ  Œ–Õﬂ
				  ! œ–Œ¬≈–ﬂ≈Ã ¬€œŒÀÕ≈Õ»≈ œ≈–¬Œ√Œ ”—ÀŒ¬»ﬂ
			      IF(DABS(DetM(5)).GT.DABS(DetM(4))) THEN
				     ! ¬“Œ–Œ≈ ”—ÀŒ¬»≈ Õ≈ ¬€œŒÀÕﬂ≈“—ﬂ 
					 ! œ–»¡À»∆¿≈“ «Õ¿◊≈Õ»≈    Œ–Õﬂﬁ (—œ–¿¬¿)     
				     IKLKORX=1
                     Exf=ExfM(3)-DABS(ExfM(3)-ExfM(4))/DBLE(IOPZ)
				     IIIFKL=1
				  ENDIF 
				  ! œ–Œ¬≈–ﬂ≈Ã ¬€œŒÀÕ≈Õ»≈ ¬“Œ–Œ√Œ ”—ÀŒ¬»ﬂ
				  IF(DABS(DetM(2)).GT.DABS(DetM(3))) THEN
				     ! œ≈–¬Œ≈ ”—ÀŒ¬»≈ Õ≈ ¬€œŒÀÕﬂ≈“—ﬂ 
					 ! œ–»¡À»∆¿≈“ «Õ¿◊≈Õ»≈    Œ–Õﬂﬁ (—À≈¬¿)     
				     IKLKORX=2
                     Exf=ExfM(4)+DABS(ExfM(3)-ExfM(4))/DBLE(IOPZ)
				     IIIFKL=1
				  ENDIF 
                  
				  ! œ–Œ¬≈–ﬂ≈Ã — ŒÀ‹ Œ –¿« œŒÀ”◊≈Õ¿ ÕŒ¬¿ﬂ “Œ◊ ¿ “Œ ≈—“‹ — ŒÀ‹ Œ –¿« Ã€ ”Ã≈Õ‹ÿ¿À» Œ¡À¿—“‹ œ≈–≈Ã≈Õ€ «Õ¿ ¿  
                  IF(IKLRXX.EQ.3) THEN
				     ! ◊»—ÀŒ “Œ◊≈  –¿¬ÕŒ “–≈Ã, œ–» ›“ŒÃ Õ≈ œ–Œ»«ŒÿÀŒ »«Ã≈Õ≈Õ»… ¬ œŒ¬≈ƒ≈Õ»» Œœ–≈ƒ≈À»“≈Àﬂ ¬ ¡À»«» “Œ◊ » œ≈–≈Ã≈Õ€ «Õ¿ ¿ 
					 ! “¿ »Ã Œ¡–¿«ŒÃ »Ã≈≈“ Ã≈—“Œ –¿«–€¬ 
					 IIIFKL=0 
				  ENDIF 

				  ! œ–Œ¬≈–ﬂ≈Ã »Ã≈≈“ Ã≈—“Œ –¿«–€¬ »À» Õ≈“ 
				  IF(IIIFKL.EQ.0) THEN
			         ! ƒ¿ÕÕ¿ﬂ œ≈–≈Ã≈Õ¿ «Õ¿ Œ¬ —¬ﬂ«¿Õ¿ — Õ¿À»◊»≈Ã –¿«–€¬¿
			         ! À»¡Œ  Œ–≈Õ‹ Õ¿…ƒ≈Õ œ–» ›“ŒÃ ¬—≈ –¿¬ÕŒ Õ”∆ÕŒ œ≈–≈…“» ¬ –≈∆»Ã ƒ¿À‹Õ≈…ÿ≈√Œ œŒ»— ¿
			         ! œ≈–≈’Œƒ»Ã ¬ –≈∆»Ã ƒ¿À‹Õ≈…ÿ≈√Œ œŒ»— ¿  Œ–Õ≈…
			         IndexVilky=0 
                     INDEXDF=0 
					 Exf=ExfM(5) 
				  ENDIF
			 ENDIF
			
		ENDIF 
	    
		! œ–Œ¬≈–ﬂ≈Ã ¬€œŒÀÕ»ÀŒ—‹ À» ”—ÀŒ¬»≈
        ! ÕŒÃ≈– Õ¿…ƒ≈ÕŒ√Œ  Œ–Õﬂ œŒ œŒ–ﬂƒ ”(»Õ“≈–¬¿À¿ ¬  Œ“Œ–ŒÃ Õ¿’Œƒ»“—ﬂ  Œ–≈Õ‹) —ŒŒ“¬≈“—“¬”≈“ √À¿¬ÕŒÃ”  ¬¿Õ“Œ¬ŒÃ” ◊»—À”
        IF(IndexCorrect.EQ.NNEL) THEN
           ! ‘» —»–”≈Ã –≈∆»Ã œŒ»— ¿  Œ–Õﬂ ¬ »Õ“≈–¬¿À≈
		   IndexVilky=2 
		   !WRITE(*,*) 'ZERO',IndexVilky
		   !WRITE(*,*) DetM(5),DetM(4),DetM(2),DetM(3)
		   !WRITE(*,*) ExfM(5),ExfM(4),ExfM(2),ExfM(3)
		   !READ(*,*) 
		   ! «¿œ»—€¬¿≈Ã √–¿Õ»÷€ »Õ“≈–¬¿À¿ 
           ExfM(2)=ExfM(4)
		   DetM(2)=DetM(4)
		   ExfM(3)=ExfM(3)
		   DetM(3)=DetM(3)
		   !WRITE(*,*) DetM(2),DetM(3)
		   !WRITE(*,*) ExfM(2),ExfM(3)
		   !READ(*,*)   
		   ! «¿Õ”Àﬂ≈Ã œ≈–≈ƒ œŒ»— ŒÃ  Œ–Õﬂ
		   ExfM(1)=0.D0
		   DetM(1)=0.D0
		   ExfM(4)=0.D0
           DetM(4)=0.D0
		   ExfM(5)=0.D0
		   DetM(5)=0.D0
		   INDEXDF=0 
       ENDIF
		  		    
   ENDIF

   ! –≈∆»Ã œŒ»— ¿  Œ–Õﬂ ¬ »Õ“≈–¬¿À≈
   IF(IndexVilky.EQ.2) THEN 
      ! Œ—”Ÿ≈—“¬Àﬂ≈Ã œŒ»—   Œ–Õﬂ ¬ Õ¿…ƒ≈ÕŒÃ »Õ“≈–¬¿À≈
      INDEXDF=INDEXDF+1
      ! ƒÀﬂ œ≈–¬Œ√Œ –¿«¿ ” ¿«€¬¿≈Ã œ–»¡À»∆≈ÕÕ€…  Œ–≈Õ‹
	  IF(INDEXDF.EQ.1) THEN
           Exf=(DetM(3)*ExfM(2)-DetM(2)*ExfM(3))/(DetM(3)-DetM(2))
		   ExfM(1)=ExfM(2)
           ExfM(2)=ExfM(3)
		   ExfM(3)=Exf
		 ELSE
           ! œ–Œ¬≈–ﬂ≈Ã ¬  ¿ ŒÃ »« ƒ¬”’ »Õ“≈–¬¿À¿’  Œ–≈Õ‹
		   ! œ≈–¬€… »Õ“≈–¬¿À
		   IF((DetM(1)*DetM(3)).LT.0.D0) THEN
               IIKK=1
		       Exf=(DetM(3)*ExfM(1)-DetM(1)*ExfM(3))/(DetM(3)-DetM(1))
			   ExfM(2)=ExfM(3)
               ExfM(3)=Exf
		   ENDIF
		   ! ¬“Œ–Œ… »Õ“≈–¬¿À
           IF((DetM(3)*DetM(2)).LT.0.D0) THEN
		       IIKK=2
               Exf=(DetM(2)*ExfM(3)-DetM(3)*ExfM(2))/(DetM(2)-DetM(3))
		       ExfM(1)=ExfM(3)
               ExfM(3)=Exf
		   ENDIF
      ENDIF		  		   
   

      ! œ–Œ¬≈–ﬂ≈Ã ¬€œŒÀÕ»ÀŒ—‹ À» ”—ÀŒ¬»≈
      ! œ–Œ¬≈–ﬂ≈Ã «Õ¿◊≈Õ»≈ Œœ–≈ƒ≈À»“≈Àﬂ ŒÕŒ ƒŒÀ∆ÕŒ ¡€“‹ Ã≈Õ‹ÿ≈ “Œ◊ÕŒ—“»
      ! Õ¿◊»Õ¿≈Ã œ–Œ¬≈–ﬂ“‹ ”—ÀŒ¬»≈ ¬ —À”◊¿≈ Œ¡Õ¿–”∆≈Õ»ﬂ »Õ“≈–¬¿À¿ √ƒ≈ Õ¿’Œƒ»“—ﬂ  Œ–≈Õ‹
      IF(INDEXDF.GT.1) THEN
         IF(DABS(DetM(3)).LT.EPS) THEN
            ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
   	        IparametrDeterEnergy=2 
			! «¿œ»—€¬¿≈Ã  Œ–≈Õ‹ Õ¿…ƒ≈ÕÕ€…
			EnergyZeroZ(NMO,IndexCorrect,2)=ExfM(3)  
         ENDIF
      ENDIF  
   ENDIF
    

  
   !WRITE(*,*) 'ITERASTION ZERO'
   !write(*,10685)  NEpsIter,IndexVilky,IndexCorrect,NNEL
   !write(*,19685)  DetM(1),DetM(3),DetM(2)
   !write(*,19685)  ExfM(1),ExfM(3),ExfM(2)
   !write(*,19685)  Exf
   !read(*,*)
   return
 end subroutine SearchSolution




 ! œŒƒœ–Œ√–¿ÃÃ¿ Œ—”Ÿ≈—“¬ÀﬂﬁŸ¿ﬂ œŒ»—  »Õ“≈–¬¿À¿ Õ”∆ÕŒ√Œ  Œ–Õﬂ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»» ’¿–“–»-‘Œ ¿ ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» ƒÀﬂ —À”◊¿ﬂ œ≈–¬Œ… »“≈–¿÷»»
 ! NMO-ÕŒÃ≈– ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
 ! NNEL- √À¿¬ÕŒ≈  ¬¿Õ“Œ¬Œ≈ ◊»—ÀŒ
 ! NEpsIter-ÕŒÃ≈– »“≈–¿÷»» ƒÀﬂ œŒÀ”◊≈Õ»ﬂ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»
 ! Kpoint-“Œ◊ ¿ —ÿ»¬ »
 ! IndexM-–¿«Ã≈– Ã¿——»¬¿
 ! Vout(IndexM,IndexM,Npoint)- Ã¿——»¬ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » "Õ¿–”∆”"
 ! Vin(IndexM,IndexM,Npoint)- Ã¿——»¬ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » "¬Õ”“–‹"
 ! DetM-Ã¿——»¬ «Õ¿◊≈Õ»… ƒ≈“≈–Ã»Õ¿Õ“¿
 ! ExfM-Ã¿——»¬ «Õ¿◊≈Õ»… ŒƒÕŒ›À≈ “–ŒÕÕŒ… ‘”Õ ÷»»
 ! DetMA-Ã¿——»¬ «Õ¿◊≈Õ»… ƒ≈“≈–Ã»Õ¿Õ“¿ ƒÀﬂ œŒ»— ¿  Œ–Õﬂ
 ! ExfMA-Ã¿——»¬ «Õ¿◊≈Õ»… ŒƒÕŒ›À≈ “–ŒÕÕŒ… ‘”Õ ÷»» ƒÀﬂ œŒ»— ¿  Œ–Õﬂ
 ! Exf-ŒƒÕŒ›À≈ “–ŒÕÕ¿ﬂ ›Õ≈–√»ﬂ
 ! DeltaEnergy-–¿«Õ»÷¿ Ã≈∆ƒ” ŒƒÕŒ›À≈ “–ŒÕÕ€Ã» ‘”Õ ÷»ﬂÃ»
 ! AZ,BZ,E-¬—œŒÃŒ√¿“≈À‹Õ€≈ Ã¿——»¬€
 ! Henergy-¯‡„ ÔÓ Ó‰ÌÓ˝ÎÂÍÚÓÌÌÓÈ ˝ÌÂ„ËË (œŒ—À≈ Œ ŒÕ◊¿Õ»ﬂ œ–Œ√–¿ÃÃ€ ƒ¿≈“ Õ”À»¬Œ≈ œ–»¡À»∆≈Õ»≈ ƒÀﬂ  Œ–Õﬂ)
 ! IparametrDeterEnergy-œ¿–¿Ã≈“– ¬€’Œƒ¿ »« ÷» À¿ œŒ ”“Œ◊Õ≈Õ»ﬁ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»
 ! EPS-“Œ◊ÕŒ—“‹
 ! IndexVilky-»Õƒ≈ — ” ¿«€¬¿ﬁŸ»… Õ¿ “Œ ◊“Œ Œœ–≈ƒ≈À≈Õ »Õ“≈–¬¿À ¬  Œ“Œ–ŒÃ Õ¿’Œƒ»“—ﬂ  Œ–≈Õ‹
 ! IndexVilky=0-»Õ“≈–¬¿À Õ≈ Œœ–≈ƒ≈À≈Õ
 ! IndexVilky=1-»Õ“≈–¬¿À Œœ–≈ƒ≈À≈Õ 
 ! IndexVilky=2-–≈∆»Ã œŒ»— ¿  Œ–Õﬂ 
 ! INDEXDF-»Õƒ≈ — ” ¿«€¬¿ﬁŸ»… ◊»—ÀŒ »“≈–¿÷»… —ƒ≈À¿ÕÕ€’ œŒ—À≈ œŒœ¿ƒ¿Õ»ﬂ ¬ ¬»À ”
 ! IndexCorrect-»Õƒ≈ — ” ¿«€¬¿ﬁŸ»… ◊»—ÀŒ  Œ–Õ≈… Õ¿…ƒ≈ÕÕ€’ Õ¿ ¬—≈Ã »Õ“≈–¬¿À≈  
 ! IndexSolutions-»Õƒ≈ — ◊»—À¿ –≈ÿ≈Õ»≈, Õ≈Œ¡’Œƒ»ÃŒ Õ¿…“» –≈ÿ≈Õ»ﬂ ƒÀﬂ NNEL-1, NNEL, NNEL+1, “Œ ≈—“‹ ƒÀﬂ ¬€’Œƒ¿ 
 ! Õ≈Œ¡’Œƒ»ÃŒ, ◊“Œ¡€ IndexSolutions=3 
 ! ExfSolutions(IndexSolutions)-›Õ≈–√»» Õ¿…ƒ≈ÕÕ€’  Œ–Õ≈…  NNEL-1, NNEL, NNEL+1
 ! ExfTemp-¬—œŒÃŒ√¿“≈À‹Õ¿ﬂ œ≈–≈Ã≈ÕÕ¿ﬂ
 ! IndexCorrectSET,IndexSolutionsSET,HenergySET,ExfSETT,ExfSET,DetSET-ƒ¿ÕÕ€≈ Õ≈Œ¡’Œƒ»Ã€ ƒÀﬂ –¿—◊≈“¿ ¬ —À”◊¿≈ Õ¿’Œ∆ƒ≈Õ»ﬂ  Œ–Õﬂ —À≈¬¿ ƒÀﬂ Õ≈ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€
 ! IKLKORX,IOPZ,IKLRXX-»Õƒ≈ —€  Œ––≈ “»–Œ¬ » ƒÀﬂ ”—“¿Õ¿¬À≈Õ»ﬂ  Œ–≈Õ‹ »À» –¿«–€¬
 ! EnergyZeroZ(NumbreMO,NNEL+1,2)-Ã¿——»¬  Œ–Õ≈… ŒƒÕŒ–ŒƒÕŒ√Œ ”–¿¬Õ≈Õ»ﬂ 
 ! INDEXAD-»Õƒ≈ — ” ¿«€¬¿ﬁŸ»… ◊»—ÀŒ »“≈–¿÷»… —ƒ≈À¿ÕÕ€’ ¬ —À”◊¿≈  Œ√ƒ¿ »Õ“≈–¬¿À Õ≈Œœ–≈ƒ≈À≈Õ 
 ! RcoffChengH- Œ›‘‘»÷»≈Õ“ »«Ã≈Õ≈Õ»ﬂ ÿ¿√¿
 ! ProDet(2)-Ã¿——»¬ œ–Œ»«¬ŒƒÕ€’
 ! INDEXRShag-–≈∆»Ã »«Ã≈Õ≈Õ»ﬂ ÿ¿√¿
 ! IIHD-»Õƒ≈ — ”Ã≈Õ‹ÿ≈Õ»ﬂ ÿ¿√¿
 ! IIOXDPZ- Àﬁ◊ ” ¿«€¬¿ﬁŸ»… ◊“Œ Ã€ œŒœ¿À» ¬ –≈∆»Ã ”Ã≈Õ‹ÿ≈Õ»ﬂ ÿ¿√¿ »  ŒÕ“–ŒÀ»–”≈Ã ¬Œ«ÃŒ∆ÕŒ—“‹ œ≈–≈— Œ ¿
 ! INDEXPeresc-»Õƒ≈ — ” ¿«€¬¿ﬁŸ»… ◊¿—“» »“≈–¿÷»… ¬ –≈∆»Ã≈ ¬Œ«ÃŒ∆ÕŒ√Œ œ≈–≈— Œ ¿
 ! DeltaEnerPers-»Õ“≈–¬¿À ›Õ≈–√»… ¬ Œ¡À¿—“» œ≈–≈— Œ ¿
 ! DeltaFunPers-»Õ“≈–¬¿À ‘”Õ ÷»… ¬ Œ¡À¿—“» œ≈–≈— Œ ¿ 
 subroutine SearchSolutionAccelerated(NMO,NNEL,NEpsIter,Kpoint,IndexM,Vout,Vin,DetM,ExfM,DetMA,ExfMA,Exf,AZ,BZ,E,Henergy,IparametrDeterEnergy,EPS,IndexVilky,INDEXDF,IIKK,IndexCorrect,IndexSolutions,ExfSolutions,ExfTemp,IndexCorrectSET,IndexSolutionsSET,HenergySET,ExfSETT,ExfSET,DetSET,IKLKORX,IOPZ,IKLRXX,EnergyZeroZ,INDEXAD,RcoffChengH,ProDet,INDEXRShag,IIHD,IIOXDPZ,INDEXPeresc,DeltaEnerPers,DeltaFunPers)
   implicit none
   integer::NMO,NNEL,NEpsIter,Kpoint,IndexM,IparametrDeterEnergy,IndexVilky,INDEXDF,IIKK,IndexCorrect,IndexSolutions,IndexCorrectSET,IndexSolutionsSET,IKLKORX,IOPZ,IKLRXX,INDEXAD,INDEXRShag,IIHD,IIOXDPZ,INDEXPeresc
   real(8)::Exf,Henergy,EPS,ExfTemp,ExfSETT,HenergySET,RcoffChengH,DeltaEnerPers,DeltaFunPers
   real(8),dimension(:)::DetM,ExfM,DetMA,ExfMA,ExfSolutions,ExfSET,DetSET,ProDet
   real(8),dimension(:,:)::AZ,BZ,E
   real(8),dimension(:,:,:)::Vout,Vin,EnergyZeroZ
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! 
   integer::IIDD,IBBB,IIII,klkl,IKLPERZnak,ISolution,IIIFKL,IKLCOMBEC
   real(8)::DeltaEnergy,DDD,Kcoff,RcoffGran,DMtemp,Rdet
   !real(8)::DeltaEnergy,RnormConstas,Kcoff,RcoffGran,ExfTemp,DMtemp,DDD
   ! Œœ–≈ƒ≈Àﬂ≈Ã ƒ≈“≈–Ã»Õ¿Õ“ —»—“≈Ã€
   call ReadWriteMassiv2(2,Kpoint,IndexM,Vout,AZ) 
   call ReadWriteMassiv2(2,Kpoint+1,IndexM,Vin,BZ) 
   10685 FORMAT(2X,100(I4,1X))
   19685 FORMAT(2X,100(F20.12,1X))

   ! ‘Œ–Ã»–”≈Ã ≈ƒ»Õ»◊Õ”ﬁ Ã¿“–»÷”
   E=0.D0
   DO IIDD=1,IndexM
      E(IIDD,IIDD)=1.D0
   ENDDO
   
   ! ‘Œ–Ã»–”≈Ã Ã¿“–»÷” —»—“≈Ã€
   !WRITE(100,*) 'E'
   !DO IIDD=1,IndexM
   !   WRITE(100,19345 ) (E(IIDD,IBBB),IBBB=1,IndexM)
   !ENDDO
   !WRITE(100,*) 'AZ'
   !DO IIDD=1,IndexM
   !   WRITE(100,19345 ) (AZ(IIDD,IBBB),IBBB=1,IndexM)
   !ENDDO 
   !WRITE(100,*) 'BZ'
   !DO IIDD=1,IndexM
   !   WRITE(100,19345 ) (BZ(IIDD,IBBB),IBBB=1,IndexM)
   !ENDDO
   E=E-MATMUL(AZ,BZ)
   !WRITE(100,*) 'E'
   !DO IIDD=1,IndexM
   !   WRITE(100,19345 ) (E(IIDD,IBBB),IBBB=1,IndexM)
   !ENDDO
   ! «¿œ»—€¬¿≈Ã –≈«”À‹“¿“ –¿—◊≈“¿
   ! Œœ–≈ƒ≈Àﬂ≈Ã ƒ≈“≈–Ã»Õ¿Õ“ —»—“≈Ã€
   Rdet=Determenant(E)

   WRITE(17,*) Exf,Rdet,RcoffChengH
   
  
  
   
   ! «¿œ»—€¬¿≈Ã –≈«”À‹“¿“ –¿—◊≈“¿
   IF(IndexVilky.EQ.0) THEN
        IF(NEpsIter.EQ.1) THEN
           DetM(4)=Rdet
		ENDIF
        IF(NEpsIter.EQ.2) THEN
           DetM(5)=Rdet
		ENDIF
        IF(NEpsIter.NE.1.AND.NEpsIter.NE.2) THEN
            DetM(1)=DetM(2)
			DetM(2)=DetM(3)
            DetM(3)=DetM(4)
            DetM(4)=DetM(5)
            DetM(5)=Rdet
        ENDIF
		
		! »Õƒ≈ — ‘» —»–”ﬁŸ»… ◊»—ÀŒ »“≈–¿÷»… ¬ —À”◊¿≈  Œ√ƒ¿ »Õ“≈–¬¿À Õ≈Œœ–≈ƒ≈À≈Õ
		INDEXAD=INDEXAD+1
		! ¬ Õ¿◊¿À≈ ¬Œ«¬–¿Ÿ¿≈Ã—ﬂ   œ–≈ƒ€ƒ”Ÿ≈Ã” ÿ¿√” ”¡»–¿≈Ã  Œ›‘‘»÷»≈Õ“ œŒÀ”◊≈ÕÕ€… ¬ œ–≈ƒ≈ƒ”Ÿ≈Ã »Õ“≈–¬¿À≈ 
		IF(INDEXAD.EQ.4) THEN
		   Henergy=Henergy*RcoffChengH
        ENDIF 
		! Õ¿◊»Õ¿≈Ã  Œ––≈ “»–Œ¬¿“‹ ÿ¿√ 
		IF(INDEXAD.EQ.5) THEN
		   ! ¬Œ«¬–¿Ÿ¿≈Ã  Œ›‘‘»÷»≈Õ“ ¬ »—’ŒƒÕŒ≈ —Œ—“ŒﬂÕ»≈
		   RcoffChengH=1.D0
           ProDet(1)=DABS(DetM(5)*(1.D0-DetM(4)/DetM(5))/(ExfM(5)*(1.D0-ExfM(4)/ExfM(5))))
		ENDIF
	    IF(INDEXAD.EQ.6) THEN
           ProDet(2)=DABS(DetM(5)*(1.D0-DetM(4)/DetM(5))/(ExfM(5)*(1.D0-ExfM(4)/ExfM(5))))
		ENDIF
		IF(INDEXAD.GT.6) THEN
           ProDet(1)=ProDet(2)
           ProDet(2)=DABS(DetM(5)*(1.D0-DetM(4)/DetM(5))/(ExfM(5)*(1.D0-ExfM(4)/ExfM(5))))
		   ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“  Œ›‘‘»÷»≈Õ“¿ » »«Ã≈Õ≈Õ»≈ ÿ¿√¿
		   call ChangeHR(INDEXRShag,IKLCOMBEC,IIHD,IIOXDPZ,IndexCorrect,Henergy,RcoffChengH,ExfM,ProDet,DetM,INDEXPeresc,DeltaEnerPers,DeltaFunPers)
		   ! œ–Œ¬≈–ﬂ≈Ã œ≈–≈’Œƒ ¬ –≈∆»Ã ”Ã≈Õ‹ÿ≈Õ»ﬂ ÿ¿√¿
		   IF(IKLCOMBEC.EQ.1) THEN
              ! ¬Œ«¬–¿Ÿ¿≈Ã—ﬂ Õ¿ ŒƒÕ” “Œ◊ ” Õ¿«¿ƒ
              Exf=ExfM(4)
			  ExfM(5)=ExfM(4)
              ExfM(4)=ExfM(3)
              ExfM(3)=ExfM(2)
              ExfM(2)=ExfM(1)
              DetM(5)=DetM(4)
              DetM(4)=DetM(3)
              DetM(3)=DetM(2)
              DetM(2)=DetM(1)   
		   ENDIF
		ENDIF
   ENDIF

   IF(IndexVilky.EQ.1) THEN	
      IF(INDEXDF.EQ.1) THEN 
         DetM(1)=DetM(2)
	     DetM(2)=DetM(3)
         DetM(3)=DetM(4)
         DetM(4)=DetM(5)
         DetM(5)=Rdet
      ENDIF 
	  IF(INDEXDF.EQ.2) THEN 
         ! œ–Œ¬≈–ﬂ≈Ã  ¿ Œ… »« –≈∆»ÃŒ¬ ¬ Àﬁ◊≈Õ
		 IF(IKLKORX.EQ.1) THEN
            !  Œ––≈ “»–Œ¬ ¿ —œ–¿¬¿
            ! œ–Œ¬≈–ﬂ≈Ã ◊“Œ¡€ «Õ¿◊≈Õ»≈ —œ–¿¬¿ ¡€ÀŒ “Œ√Œ ∆≈ «Õ¿ ¿
			IIIFKL=0
			IF(Rdet.GT.0.D0.AND.DetM(3).GT.0.D0) THEN
               DetM(1)=DetM(2)
	           DetM(2)=DetM(3)
			   DetM(3)=Rdet
               ExfM(1)=ExfM(2)
               ExfM(2)=ExfM(3)
			   ExfM(3)=Exf
			   IIIFKL=1
			   ! ”¬≈À»◊»¬¿≈Ã ◊»—ÀŒ “Œ◊≈  œŒÀ”◊≈ÕÕ€’ ¬ ¡À»«» “Œ◊ » »«Ã≈Õ≈Õ»ﬂ «Õ¿ ¿
			   IKLRXX=IKLRXX+1
			   ! “Œ◊ ¿ Œœ–≈ƒ≈À≈Õ¿ ¬Œ«¬–¿Ÿ¿≈Ã »—’ŒƒÕŒ≈ «Õ¿◊≈Õ»≈  Œ––≈ “–»–”ﬁŸ≈√Œ ÃÕŒ∆»“≈Àﬂ
			   IOPZ=4 
			ENDIF
            IF(Rdet.LT.0.D0.AND.DetM(3).LT.0.D0) THEN
               DetM(1)=DetM(2)
	           DetM(2)=DetM(3)
			   DetM(3)=Rdet
               ExfM(1)=ExfM(2)
               ExfM(2)=ExfM(3)
			   ExfM(3)=Exf
			   IIIFKL=1
			   ! ”¬≈À»◊»¬¿≈Ã ◊»—ÀŒ “Œ◊≈  œŒÀ”◊≈ÕÕ€’ ¬ ¡À»«» “Œ◊ » »«Ã≈Õ≈Õ»ﬂ «Õ¿ ¿
			   IKLRXX=IKLRXX+1
			   ! “Œ◊ ¿ Œœ–≈ƒ≈À≈Õ¿ ¬Œ«¬–¿Ÿ¿≈Ã »—’ŒƒÕŒ≈ «Õ¿◊≈Õ»≈  Œ––≈ “–»–”ﬁŸ≈√Œ ÃÕŒ∆»“≈Àﬂ
			   IOPZ=4 
			ENDIF
			IF(IIIFKL.EQ.0) THEN
               IOPZ=IOPZ*2
			ENDIF
			! ÕŒÃ≈– »“≈–¿÷»» ¬Œ«¬–¿Ÿ¿≈Ã Õ¿ 1 Õ¿«¿ƒ
			INDEXDF=INDEXDF-1
		 ENDIF
         IF(IKLKORX.EQ.2) THEN
            !  Œ––≈ “»–Œ¬ ¿ —À≈¬¿
            ! œ–Œ¬≈–ﬂ≈Ã ◊“Œ¡€ «Õ¿◊≈Õ»≈ —À≈¬¿ ¡€ÀŒ “Œ√Œ ∆≈ «Õ¿ ¿
			IIIFKL=0
			IF(Rdet.GT.0.D0.AND.DetM(4).GT.0.D0) THEN
               DetM(5)=DetM(4)
	           DetM(4)=Rdet
			   ExfM(5)=ExfM(4)
               ExfM(4)=Exf
			   IIIFKL=1
               ! ”¬≈À»◊»¬¿≈Ã ◊»—ÀŒ “Œ◊≈  œŒÀ”◊≈ÕÕ€’ ¬ ¡À»«» “Œ◊ » »«Ã≈Õ≈Õ»ﬂ «Õ¿ ¿
			   IKLRXX=IKLRXX+1
			   ! “Œ◊ ¿ Œœ–≈ƒ≈À≈Õ¿ ¬Œ«¬–¿Ÿ¿≈Ã »—’ŒƒÕŒ≈ «Õ¿◊≈Õ»≈  Œ––≈ “–»–”ﬁŸ≈√Œ ÃÕŒ∆»“≈Àﬂ
			   IOPZ=4  
			ENDIF
            IF(Rdet.LT.0.D0.AND.DetM(4).LT.0.D0) THEN
               DetM(5)=DetM(4)
	           DetM(4)=Rdet
			   ExfM(5)=ExfM(4)
               ExfM(4)=Exf
			   IIIFKL=1
			   ! ”¬≈À»◊»¬¿≈Ã ◊»—ÀŒ “Œ◊≈  œŒÀ”◊≈ÕÕ€’ ¬ ¡À»«» “Œ◊ » »«Ã≈Õ≈Õ»ﬂ «Õ¿ ¿
			   IKLRXX=IKLRXX+1
			   ! “Œ◊ ¿ Œœ–≈ƒ≈À≈Õ¿ ¬Œ«¬–¿Ÿ¿≈Ã »—’ŒƒÕŒ≈ «Õ¿◊≈Õ»≈  Œ––≈ “–»–”ﬁŸ≈√Œ ÃÕŒ∆»“≈Àﬂ
			   IOPZ=4 
			ENDIF
			IF(IIIFKL.EQ.0) THEN
               IOPZ=IOPZ*2
			ENDIF
			! ÕŒÃ≈– »“≈–¿÷»» ¬Œ«¬–¿Ÿ¿≈Ã Õ¿ 1 Õ¿«¿ƒ
			INDEXDF=INDEXDF-1
		 ENDIF
		
      ENDIF    
   ENDIF 

   
   IF(IndexVilky.EQ.2) THEN
      IF(INDEXDF.EQ.1) THEN
           DetMA(4)=DetMA(1)
           DetMA(1)=DetMA(2)
           DetMA(2)=DetMA(3)
           DetMA(3)=Rdet
	     ELSE
	       !  Œ–≈Õ‹ œŒœ¿À ¬ œ≈–¬€… »“≈–¬¿À
           IF(IIKK.EQ.1) THEN
              DetMA(2)=DetMA(3)
              DetMA(3)=Rdet
	       ENDIF
           !  Œ–≈Õ‹ œŒœ¿À ¬ ¬“Œ–Œ… »“≈–¬¿À
           IF(IIKK.EQ.2) THEN
              DetMA(1)=DetMA(3)
              DetMA(3)=Rdet
 	       ENDIF
      ENDIF
   ENDIF 
   		    
      
   ! œ–Œ¬Œƒ»Ã œŒ»—   Œ–Õ≈… Õ¿ ¬—≈Ã ›Õ≈–√»“»◊≈— ŒÃ »Õ“≈–¬¿À≈
   IF(IndexVilky.EQ.0) THEN
      ! œ–Œ¬Œƒ»Ã œ≈–≈¡Œ– «Õ¿◊≈Õ»… ›Õ≈–√»»
      IF(NEpsIter.EQ.1) THEN
	        ExfM(4)=Exf
            Exf=Exf*(1.D0-Henergy)
            ExfM(5)=Exf  
          ELSE
	       ! œ–Œ¬≈–ﬂ≈Ã œŒœ¿ƒ¿≈“ ŒƒÕŒ›À≈ “–ŒÕÕ¿ﬂ ›Õ≈–√»ﬂ ¬ ¬»À ” »À» Õ≈“ (Œœ–≈ƒ≈À≈Õ À» »Õ“≈–¬¿À ¬  Œ“Œ–ŒÃ Õ¿’Œƒ»“—ﬂ  Œ–≈Õ‹)
	       IF((DetM(4)*DetM(5)).LT.0.D0) THEN
	             IndexVilky=1 
				 ! œŒ— ŒÀ‹ ” »Õ“≈–¬¿À Œœ–≈ƒ≈À≈Õ «¿Õ”Àﬂ≈Ã ◊»—ÀŒ »“≈–¿÷»… ¬Õ≈ »Õ“≈–¬¿À¿ ƒÀﬂ ÕŒ¬Œ√Œ —À”◊¿ﬂ ¬Õ≈ »Õ“≈–¬¿À¿  
				 INDEXAD=0  
				 ! œŒ— ŒÀ‹ ” »Õ“≈–¬¿À Œœ–≈ƒ≈À≈Õ «¿Õ”Àﬂ≈Ã ◊»—ÀŒ »“≈–¿÷»… — ”Ã≈Õ‹ÿ≈ÕÕ€Ã ÿ¿√ŒÃ
				 INDEXRShag=0 
				 ! Œ“ Àﬁ◊¿≈Ã  ŒÕ“–ŒÀ‹ — ¿◊ ¿
				 IIOXDPZ=0                          
			   ELSE
			     Exf=Exf*(1.D0-Henergy)
                 ExfM(1)=ExfM(2)
                 ExfM(2)=ExfM(3)
				 ExfM(3)=ExfM(4)
                 ExfM(4)=ExfM(5)
				 ExfM(5)=Exf  
           ENDIF      
	  ENDIF
   ENDIF
   
   ! ”—“¿ÕŒ¬À≈Õ¿ Œ¡À¿—“‹ œ≈–≈Ã≈Õ€ «Õ¿ ¿ 
   IF(IndexVilky.EQ.1) THEN
        ! œ–Œ¬≈–ﬂ≈Ã œ≈–≈Ã≈Õ¿ «Õ¿ ¿ —¬ﬂ«¿Õ¿ — ¬Œ«Õ» ÕŒ¬≈Õ≈Ã –¿«–€¬¿ ¬ ƒ¿ÕÕŒ… Œ¡À¿—“» »À» — Õ¿À»◊»≈Ã  Œ–Õﬂ
        ! »Õƒ≈ — ” ¿«€¬¿≈“, ◊“Œ ¬ ƒ¿ÕÕŒÃ –≈∆»Ã≈  œ–Œ√–¿ÃÃ¿ –¿¡Œ“¿≈“ ƒÀﬂ ƒ¿ÕÕŒ√Œ »Õ“≈–¬¿À¿ ¬ œ≈–¬€… –¿«
		INDEXDF=INDEXDF+1
		!  Àﬁ◊ ” ¿«€¬¿≈“ Õ¿ œ≈–≈Ã≈Õ” «Õ¿ ¿
		IKLPERZnak=0
        IF(INDEXDF.EQ.1) THEN
             Exf=Exf*(1.D0-Henergy/FLOAT(IndexCorrect+2))
             ExfM(1)=ExfM(2)
             ExfM(2)=ExfM(3)
		     ExfM(3)=ExfM(4)
             ExfM(4)=ExfM(5)
		     ExfM(5)=Exf  
			 ExfTemp=Exf 
			 ! ‘» —»–”≈Ã IOPZ ƒÀﬂ  Œ––≈ “»–Œ¬ »  Œ–Õ≈…
			 IOPZ=4  
			 ! ‘» —»–”≈Ã ◊»—ÀŒ “Œ◊≈   Œ“Œ–€≈ ¡€À» ”◊“≈Õ€ œ–» —”∆≈Õ»» Œ¡À¿—“» 
			 IKLRXX=0 
           ELSE   
             IF(DABS(DetM(5)).GT.DABS(DetM(4)).AND.DABS(DetM(2)).GT.DABS(DetM(3))) THEN
                 ! ‘» —»–”≈Ã “Œ“ ‘¿ “, ◊“Œ Œ¡Õ¿–”∆≈Õ  Œ–≈Õ‹
				 IKLPERZnak=1 
				 ! Œ¡Õ¿–”∆≈Õ »Õ“≈–¬¿À  Œ–Õﬂ 
                 IndexCorrect=IndexCorrect+1
				 ! ‘» —»–”≈Ã ¬Œ«ÃŒ∆Õ€…  Œ–≈Õ‹ ¬ ƒ¿ÕÕŒ… Œ¡À¿—“»
                 EnergyZeroZ(NMO,IndexCorrect,1)=EnergyZeroZ(NMO,IndexCorrect,2)
				 EnergyZeroZ(NMO,IndexCorrect,2)=ExfM(3)  
                 ! »«Ã≈Õ≈Õ»≈ ÿ¿√¿ 
				 Henergy=Henergy/FLOAT(IndexCorrect+1)  
                 ! «¿œ»—€¬¿≈Ã ƒ¿ÕÕ€≈ ƒÀﬂ —À≈ƒ”ﬁŸ≈√Œ  Œ–Õﬂ ƒÀﬂ Õ¿’Œ∆ƒ≈Õ»ﬂ  Œ–Õﬂ Õ≈ŒƒÕŒ–ŒƒÕŒ√Œ ”–¿¬Õ≈Õ»ﬂ —À≈¬¿ 
                 ExfSET=ExfM
				 DetSET=DetM
				 HenergySET=Henergy
                 IndexCorrectSET=IndexCorrect
                 
				 ! ƒ¿ÕÕ¿ﬂ œ≈–≈Ã≈Õ¿ «Õ¿ Œ¬ —¬ﬂ«¿Õ¿ — Õ¿À»◊»≈Ã –¿«–€¬¿
			     ! À»¡Œ  Œ–≈Õ‹ Õ¿…ƒ≈Õ œ–» ›“ŒÃ ¬—≈ –¿¬ÕŒ Õ”∆ÕŒ œ≈–≈…“» ¬ –≈∆»Ã ƒ¿À‹Õ≈…ÿ≈√Œ œŒ»— ¿
			     ! œ≈–≈’Œƒ»Ã ¬ –≈∆»Ã ƒ¿À‹Õ≈…ÿ≈√Œ œŒ»— ¿  Œ–Õ≈…
			     IndexVilky=0 
                 INDEXDF=0
				 Exf=ExfM(5) 
				ELSE
				  ! ”—“¿Õ¿¬À»¬¿≈Ã œ–»◊»Õ¿ ¬ –¿«–€¬≈ »À» Õ≈“
				  ! ¬€ﬂ—Õﬂ≈Ã —”Ÿ≈—“¬”≈“  Œ–≈Õ‹ »À» »Ã≈≈“ Ã≈—“Œ –¿«–€¬
				  ! œ–» ›“ŒÃ, ”—“¿Õ¿¬À»¬¿≈Ã “¿ Œ≈ œŒ¬≈ƒ≈Õ»≈ —¬ﬂ«¿ÕŒ —  ŒÀ≈¡¿Õ»ﬂÃ» ¬ Œ¡À¿—“» œ≈–≈Ã≈Õ€ «Õ¿ ¿
				  ! Œ—”Ÿ≈—“¬Àﬂ≈Ã —”∆≈Õ»≈ Œ¡À¿—“» œ≈–≈Ã≈Õ€ «Õ¿ ¿ ƒÀﬂ ¬Õ≈—≈Õ»ﬂ ﬂ—ÕŒ—“» ¬ œŒ¬≈ƒ≈Õ»» Œœ–≈ƒ≈À»“≈Àﬂ ¬ Œ¡À¿—“» Õ”Àﬂ
                     
				  IIIFKL=0
				  ! ”—“¿Õ¿¬À»¬¿≈Ã œ–»◊»Õ” Œ“—”“—“¬»ﬂ  Œ–Õﬂ
				  ! œ–Œ¬≈–ﬂ≈Ã ¬€œŒÀÕ≈Õ»≈ œ≈–¬Œ√Œ ”—ÀŒ¬»ﬂ
			      IF(DABS(DetM(5)).GT.DABS(DetM(4))) THEN
				     ! ¬“Œ–Œ≈ ”—ÀŒ¬»≈ Õ≈ ¬€œŒÀÕﬂ≈“—ﬂ 
					 ! œ–»¡À»∆¿≈“ «Õ¿◊≈Õ»≈    Œ–Õﬂﬁ (—œ–¿¬¿)     
				     IKLKORX=1
					 Exf=ExfM(3)-DABS(ExfM(3)-ExfM(4))/DBLE(IOPZ)
				     IIIFKL=1
				  ENDIF 
				  ! œ–Œ¬≈–ﬂ≈Ã ¬€œŒÀÕ≈Õ»≈ ¬“Œ–Œ√Œ ”—ÀŒ¬»ﬂ
				  IF(DABS(DetM(2)).GT.DABS(DetM(3))) THEN
				     ! œ≈–¬Œ≈ ”—ÀŒ¬»≈ Õ≈ ¬€œŒÀÕﬂ≈“—ﬂ 
					 ! œ–»¡À»∆¿≈“ «Õ¿◊≈Õ»≈    Œ–Õﬂﬁ (—À≈¬¿)     
				     IKLKORX=2
                     Exf=ExfM(4)+DABS(ExfM(3)-ExfM(4))/DBLE(IOPZ)
				     IIIFKL=1
				  ENDIF 
                  
				  ! œ–Œ¬≈–ﬂ≈Ã — ŒÀ‹ Œ –¿« œŒÀ”◊≈Õ¿ ÕŒ¬¿ﬂ “Œ◊ ¿ “Œ ≈—“‹ — ŒÀ‹ Œ –¿« Ã€ ”Ã≈Õ‹ÿ¿À» Œ¡À¿—“‹ œ≈–≈Ã≈Õ€ «Õ¿ ¿  
                  IF(IKLRXX.EQ.3) THEN
				     ! ◊»—ÀŒ “Œ◊≈  –¿¬ÕŒ “–≈Ã, œ–» ›“ŒÃ Õ≈ œ–Œ»«ŒÿÀŒ »«Ã≈Õ≈Õ»… ¬ œŒ¬≈ƒ≈Õ»» Œœ–≈ƒ≈À»“≈Àﬂ ¬ ¡À»«» “Œ◊ » œ≈–≈Ã≈Õ€ «Õ¿ ¿ 
					 ! “¿ »Ã Œ¡–¿«ŒÃ »Ã≈≈“ Ã≈—“Œ –¿«–€¬ 
					 IIIFKL=0 
				  ENDIF 
  

				  ! œ–Œ¬≈–ﬂ≈Ã »Ã≈≈“ Ã≈—“Œ –¿«–€¬ »À» Õ≈“ 
				  IF(IIIFKL.EQ.0) THEN
			         ! ƒ¿ÕÕ¿ﬂ œ≈–≈Ã≈Õ¿ «Õ¿ Œ¬ —¬ﬂ«¿Õ¿ — Õ¿À»◊»≈Ã –¿«–€¬¿
			         ! À»¡Œ  Œ–≈Õ‹ Õ¿…ƒ≈Õ œ–» ›“ŒÃ ¬—≈ –¿¬ÕŒ Õ”∆ÕŒ œ≈–≈…“» ¬ –≈∆»Ã ƒ¿À‹Õ≈…ÿ≈√Œ œŒ»— ¿
			         ! œ≈–≈’Œƒ»Ã ¬ –≈∆»Ã ƒ¿À‹Õ≈…ÿ≈√Œ œŒ»— ¿  Œ–Õ≈…
			         IndexVilky=0 
                     INDEXDF=0 
					 Exf=ExfM(5) 
				  ENDIF

             ENDIF
			
		ENDIF 
        
        ! œ–Œ¬≈–ﬂ≈Ã ”—“¿ÕŒ¬À≈Õ ‘¿ “ Õ¿À»◊»ﬂ  Œ–Õﬂ »À» Õ≈“
		IF(IKLPERZnak.EQ.1) THEN
           ! œ–Œ¬≈–ﬂ≈Ã ¬€œŒÀÕ»ÀŒ—‹ À» ”—ÀŒ¬»≈
           ! ÕŒÃ≈– Õ¿…ƒ≈ÕŒ√Œ  Œ–Õﬂ œŒ œŒ–ﬂƒ ”(»Õ“≈–¬¿À¿ ¬  Œ“Œ–ŒÃ Õ¿’Œƒ»“—ﬂ  Œ–≈Õ‹) —ŒŒ“¬≈“—“¬”≈“ √À¿¬ÕŒÃ”  ¬¿Õ“Œ¬ŒÃ” ◊»—À”
           ISolution=0
           IF(IndexCorrect.EQ.(NNEL-1)) THEN
              ISolution=1
		   ENDIF
           IF(IndexCorrect.EQ.NNEL) THEN
              ISolution=1
		   ENDIF
          		   
		   
		   IF(ISolution.EQ.1) THEN
              ! ‘» —»–”≈Ã –≈∆»Ã œŒ»— ¿  Œ–Õﬂ ¬ »Õ“≈–¬¿À≈
		      IndexVilky=2 
		      !WRITE(*,*) 'ZERO',IndexVilky
		      !WRITE(*,*) DetM(5),DetM(4),DetM(2),DetM(3)
		      !WRITE(*,*) ExfM(5),ExfM(4),ExfM(2),ExfM(3)
		      !READ(*,*) 
		      ! «¿œ»—€¬¿≈Ã √–¿Õ»÷€ »Õ“≈–¬¿À¿ 
              ExfMA(2)=ExfM(4)
		      DetMA(2)=DetM(4)
		      ExfMA(3)=ExfM(3)
		      DetMA(3)=DetM(3)
		      !WRITE(*,*) DetM(2),DetM(3)
		      !WRITE(*,*) ExfM(2),ExfM(3)
		      !READ(*,*)   
		      ! «¿Õ”Àﬂ≈Ã œ≈–≈ƒ œŒ»— ŒÃ  Œ–Õﬂ
		      ExfMA(1)=0.D0
		      DetMA(1)=0.D0
		      ExfMA(4)=0.D0
              DetMA(4)=0.D0
		      ExfMA(5)=0.D0
		      DetMA(5)=0.D0
		      INDEXDF=0 
           ENDIF
        ENDIF 
	
		  		    
   ENDIF

   ! –≈∆»Ã œŒ»— ¿  Œ–Õﬂ ¬ »Õ“≈–¬¿À≈
   IF(IndexVilky.EQ.2) THEN 
      ! Œ—”Ÿ≈—“¬Àﬂ≈Ã œŒ»—   Œ–Õﬂ ¬ Õ¿…ƒ≈ÕŒÃ »Õ“≈–¬¿À≈
      INDEXDF=INDEXDF+1
      ! ƒÀﬂ œ≈–¬Œ√Œ –¿«¿ ” ¿«€¬¿≈Ã œ–»¡À»∆≈ÕÕ€…  Œ–≈Õ‹
	  IF(INDEXDF.EQ.1) THEN
           Exf=(DetMA(3)*ExfMA(2)-DetMA(2)*ExfMA(3))/(DetMA(3)-DetMA(2))
		   ExfMA(1)=ExfMA(2)
           ExfMA(2)=ExfMA(3)
		   ExfMA(3)=Exf
		 ELSE
           ! œ–Œ¬≈–ﬂ≈Ã ¬  ¿ ŒÃ »« ƒ¬”’ »Õ“≈–¬¿À¿’  Œ–≈Õ‹
		   ! œ≈–¬€… »Õ“≈–¬¿À
		   IF((DetMA(1)*DetMA(3)).LT.0.D0) THEN
               IIKK=1
		       Exf=(DetMA(3)*ExfMA(1)-DetMA(1)*ExfMA(3))/(DetMA(3)-DetMA(1))
			   ExfMA(2)=ExfMA(3)
               ExfMA(3)=Exf
		   ENDIF
		   ! ¬“Œ–Œ… »Õ“≈–¬¿À
           IF((DetMA(3)*DetMA(2)).LT.0.D0) THEN
		       IIKK=2
               Exf=(DetMA(2)*ExfMA(3)-DetMA(3)*ExfMA(2))/(DetMA(2)-DetMA(3))
		       ExfMA(1)=ExfMA(3)
               ExfMA(3)=Exf
		   ENDIF
      ENDIF		  		   
   

      ! œ–Œ¬≈–ﬂ≈Ã Õ¿…ƒ≈Õ  Œ–≈Õ‹ »À» Õ≈“
	  ! œ–Œ¬≈–ﬂ≈Ã ¬€œŒÀÕ»ÀŒ—‹ À» ”—ÀŒ¬»≈
      ! œ–Œ¬≈–ﬂ≈Ã «Õ¿◊≈Õ»≈ Œœ–≈ƒ≈À»“≈Àﬂ ŒÕŒ ƒŒÀ∆ÕŒ ¡€“‹ Ã≈Õ‹ÿ≈ “Œ◊ÕŒ—“»
      ! Õ¿◊»Õ¿≈Ã œ–Œ¬≈–ﬂ“‹ ”—ÀŒ¬»≈ ¬ —À”◊¿≈ Œ¡Õ¿–”∆≈Õ»ﬂ »Õ“≈–¬¿À¿ √ƒ≈ Õ¿’Œƒ»“—ﬂ  Œ–≈Õ‹
      IF(INDEXDF.GT.1) THEN
         IF(DABS(DetMA(3)).LT.EPS) THEN
            !  Œ–≈Õ‹ Õ¿…ƒ≈Õ 
			! ‘» —»–”≈Ã Õ¿…ƒ≈ÕÕ€…  Œ–≈Õ‹
			IndexSolutions=IndexSolutions+1
			IndexSolutionsSET=IndexSolutions
			! «¿œ»—€¬¿≈Ã Õ¿…ƒ≈ÕÕ€…  Œ–≈Õ‹
			ExfSolutions(IndexSolutions)=Exf
			! «¿œ»—€¬¿≈Ã  Œ–≈Õ‹ Õ¿…ƒ≈ÕÕ€…
			EnergyZeroZ(NMO,IndexCorrect,2)=ExfMA(3)  
			! œ≈–≈’Œƒ»Ã ¬ –≈∆»Ã ƒ¿À‹Õ≈…ÿ≈√Œ œŒ»— ¿  Œ–Õ≈…
			IndexVilky=0 
            INDEXDF=0 
			Exf=ExfTemp 
			ExfSETT=ExfTemp 
			!write(6,*) 'kor',NNEL,IndexSolutions,ExfSolutions(IndexSolutions)
         ENDIF
      ENDIF 
	  
	  ! ¬€’Œƒ »« ÷» À¿ œŒ œŒ»— ”  Œ–Õ≈… œ–Œ»«Œ…ƒ≈“ œ–» ”—ÀŒ¬»»
	  IF(IndexSolutions.EQ.2) THEN
	     ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
   	     IparametrDeterEnergy=2 
	  ENDIF 
	   
   ENDIF
    

  
   !WRITE(*,*) 'ITERASTION ZERO'
   !write(*,10685)  NEpsIter,IndexVilky,IndexCorrect,NNEL
   !write(*,19685)  DetM(1),DetM(3),DetM(2)
   !write(*,19685)  ExfM(1),ExfM(3),ExfM(2)
   !write(*,19685)  Exf
   !read(*,*)
   return
 end subroutine SearchSolutionAccelerated


 ! œŒƒœ–Œ√–¿ÃÃ¿ Œ—”Ÿ≈—“¬ÀﬂﬁŸ¿ﬂ œŒ»—  »Õ“≈–¬¿À¿ Õ”∆ÕŒ√Œ  Œ–Õﬂ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»» ’¿–“–»-‘Œ ¿ ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» ƒÀﬂ —À”◊¿ﬂ œ≈–¬Œ… »“≈–¿÷»»
 ! NMO-ÕŒÃ≈– ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»
 ! NNEL- √À¿¬ÕŒ≈  ¬¿Õ“Œ¬Œ≈ ◊»—ÀŒ
 ! NEpsIter-ÕŒÃ≈– »“≈–¿÷»» ƒÀﬂ œŒÀ”◊≈Õ»ﬂ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»
 ! Kpoint-“Œ◊ ¿ —ÿ»¬ »
 ! IndexM-–¿«Ã≈– Ã¿——»¬¿
 ! Vout(IndexM,IndexM,Npoint)- Ã¿——»¬ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » "Õ¿–”∆”"
 ! Vin(IndexM,IndexM,Npoint)- Ã¿——»¬ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » "¬Õ”“–‹"
 ! DetM-Ã¿——»¬ «Õ¿◊≈Õ»… ƒ≈“≈–Ã»Õ¿Õ“¿
 ! ExfM-Ã¿——»¬ «Õ¿◊≈Õ»… ŒƒÕŒ›À≈ “–ŒÕÕŒ… ‘”Õ ÷»»
 ! DetMA-Ã¿——»¬ «Õ¿◊≈Õ»… ƒ≈“≈–Ã»Õ¿Õ“¿ ƒÀﬂ œŒ»— ¿  Œ–Õﬂ
 ! ExfMA-Ã¿——»¬ «Õ¿◊≈Õ»… ŒƒÕŒ›À≈ “–ŒÕÕŒ… ‘”Õ ÷»» ƒÀﬂ œŒ»— ¿  Œ–Õﬂ
 ! Exf-ŒƒÕŒ›À≈ “–ŒÕÕ¿ﬂ ›Õ≈–√»ﬂ
 ! DeltaEnergy-–¿«Õ»÷¿ Ã≈∆ƒ” ŒƒÕŒ›À≈ “–ŒÕÕ€Ã» ‘”Õ ÷»ﬂÃ»
 ! AZ,BZ,E-¬—œŒÃŒ√¿“≈À‹Õ€≈ Ã¿——»¬€
 ! Henergy-¯‡„ ÔÓ Ó‰ÌÓ˝ÎÂÍÚÓÌÌÓÈ ˝ÌÂ„ËË (œŒ—À≈ Œ ŒÕ◊¿Õ»ﬂ œ–Œ√–¿ÃÃ€ ƒ¿≈“ Õ”À»¬Œ≈ œ–»¡À»∆≈Õ»≈ ƒÀﬂ  Œ–Õﬂ)
 ! IparametrDeterEnergy-œ¿–¿Ã≈“– ¬€’Œƒ¿ »« ÷» À¿ œŒ ”“Œ◊Õ≈Õ»ﬁ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»
 ! EPS-“Œ◊ÕŒ—“‹
 ! IndexVilky-»Õƒ≈ — ” ¿«€¬¿ﬁŸ»… Õ¿ “Œ ◊“Œ Œœ–≈ƒ≈À≈Õ »Õ“≈–¬¿À ¬  Œ“Œ–ŒÃ Õ¿’Œƒ»“—ﬂ  Œ–≈Õ‹
 ! IndexVilky=0-»Õ“≈–¬¿À Õ≈ Œœ–≈ƒ≈À≈Õ
 ! IndexVilky=1-»Õ“≈–¬¿À Œœ–≈ƒ≈À≈Õ 
 ! IndexVilky=2-–≈∆»Ã œŒ»— ¿  Œ–Õﬂ 
 ! INDEXDF-»Õƒ≈ — ” ¿«€¬¿ﬁŸ»… ◊»—ÀŒ »“≈–¿÷»… —ƒ≈À¿ÕÕ€’ œŒ—À≈ œŒœ¿ƒ¿Õ»ﬂ ¬ ¬»À ”
 ! IndexCorrect-»Õƒ≈ — ” ¿«€¬¿ﬁŸ»… ◊»—ÀŒ  Œ–Õ≈… Õ¿…ƒ≈ÕÕ€’ Õ¿ ¬—≈Ã »Õ“≈–¬¿À≈  
 ! IndexSolutions-»Õƒ≈ — ◊»—À¿ –≈ÿ≈Õ»≈, Õ≈Œ¡’Œƒ»ÃŒ Õ¿…“» –≈ÿ≈Õ»ﬂ ƒÀﬂ NNEL-1, NNEL, NNEL+1, “Œ ≈—“‹ ƒÀﬂ ¬€’Œƒ¿ 
 ! Õ≈Œ¡’Œƒ»ÃŒ, ◊“Œ¡€ IndexSolutions=3 
 ! ExfSolutions(IndexSolutions)-›Õ≈–√»» Õ¿…ƒ≈ÕÕ€’  Œ–Õ≈…  NNEL-1, NNEL, NNEL+1
 ! ExfTemp-¬—œŒÃŒ√¿“≈À‹Õ¿ﬂ œ≈–≈Ã≈ÕÕ¿ﬂ
 ! IndexCorrectSET,IndexSolutionsSET,HenergySET,ExfSETT,ExfSET,DetSET-ƒ¿ÕÕ€≈ Õ≈Œ¡’Œƒ»Ã€ ƒÀﬂ –¿—◊≈“¿ ¬ —À”◊¿≈ Õ¿’Œ∆ƒ≈Õ»ﬂ  Œ–Õﬂ —À≈¬¿ ƒÀﬂ Õ≈ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€
 ! IKLKORX,IOPZ,IKLRXX-»Õƒ≈ —€  Œ––≈ “»–Œ¬ » ƒÀﬂ ”—“¿Õ¿¬À≈Õ»ﬂ  Œ–≈Õ‹ »À» –¿«–€¬
 ! EnergyZeroZ(NumbreMO,NNEL+1,2)-Ã¿——»¬  Œ–Õ≈… ŒƒÕŒ–ŒƒÕŒ√Œ ”–¿¬Õ≈Õ»ﬂ 
 ! INDEXAD-»Õƒ≈ — ” ¿«€¬¿ﬁŸ»… ◊»—ÀŒ »“≈–¿÷»… —ƒ≈À¿ÕÕ€’ ¬ —À”◊¿≈  Œ√ƒ¿ »Õ“≈–¬¿À Õ≈Œœ–≈ƒ≈À≈Õ 
 ! RcoffChengH- Œ›‘‘»÷»≈Õ“ »«Ã≈Õ≈Õ»ﬂ ÿ¿√¿
 ! ProDet(2)-Ã¿——»¬ œ–Œ»«¬ŒƒÕ€’
 ! INDEXRShag-–≈∆»Ã »«Ã≈Õ≈Õ»ﬂ ÿ¿√¿
 ! IIHD-»Õƒ≈ — ”Ã≈Õ‹ÿ≈Õ»ﬂ ÿ¿√¿
 ! IIOXDPZ- Àﬁ◊ ” ¿«€¬¿ﬁŸ»… ◊“Œ Ã€ œŒœ¿À» ¬ –≈∆»Ã ”Ã≈Õ‹ÿ≈Õ»ﬂ ÿ¿√¿ »  ŒÕ“–ŒÀ»–”≈Ã ¬Œ«ÃŒ∆ÕŒ—“‹ œ≈–≈— Œ ¿
 ! INDEXPeresc-»Õƒ≈ — ” ¿«€¬¿ﬁŸ»… ◊¿—“» »“≈–¿÷»… ¬ –≈∆»Ã≈ ¬Œ«ÃŒ∆ÕŒ√Œ œ≈–≈— Œ ¿
 ! DeltaEnerPers-»Õ“≈–¬¿À ›Õ≈–√»… ¬ Œ¡À¿—“» œ≈–≈— Œ ¿
 ! DeltaFunPers-»Õ“≈–¬¿À ‘”Õ ÷»… ¬ Œ¡À¿—“» œ≈–≈— Œ ¿ 
 subroutine SearchSolutionAccelerated2(NMO,NNEL,NEpsIter,Kpoint,IndexM,Vout,Vin,DetM,ExfM,DetMA,ExfMA,Exf,AZ,BZ,E,Henergy,IparametrDeterEnergy,EPS,IndexVilky,INDEXDF,IIKK,IndexCorrect,IndexSolutions,ExfSolutions,ExfTemp,IndexCorrectSET,IndexSolutionsSET,HenergySET,ExfSETT,ExfSET,DetSET,IKLKORX,IOPZ,IKLRXX,EnergyZeroZ,INDEXAD,RcoffChengH,ProDet,INDEXRShag,IIHD,IIOXDPZ,INDEXPeresc,DeltaEnerPers,DeltaFunPers)
   implicit none
   integer::NMO,NNEL,NEpsIter,Kpoint,IndexM,IparametrDeterEnergy,IndexVilky,INDEXDF,IIKK,IndexCorrect,IndexSolutions,IndexCorrectSET,IndexSolutionsSET,IKLKORX,IOPZ,IKLRXX,INDEXAD,INDEXRShag,IIHD,IIOXDPZ,INDEXPeresc
   real(8)::Exf,Henergy,EPS,ExfTemp,ExfSETT,HenergySET,RcoffChengH,DeltaEnerPers,DeltaFunPers
   real(8),dimension(:)::DetM,ExfM,DetMA,ExfMA,ExfSolutions,ExfSET,DetSET,ProDet
   real(8),dimension(:,:)::AZ,BZ,E
   real(8),dimension(:,:,:)::Vout,Vin,EnergyZeroZ
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! 
   integer::IIDD,IBBB,IIII,klkl,IKLPERZnak,ISolution,IIIFKL,IKLCOMBEC
   real(8)::DeltaEnergy,DDD,Kcoff,RcoffGran,DMtemp,Rdet
   !real(8)::DeltaEnergy,RnormConstas,Kcoff,RcoffGran,ExfTemp,DMtemp,DDD
   ! Œœ–≈ƒ≈Àﬂ≈Ã ƒ≈“≈–Ã»Õ¿Õ“ —»—“≈Ã€
   call ReadWriteMassiv2(2,Kpoint,IndexM,Vout,AZ) 
   call ReadWriteMassiv2(2,Kpoint+1,IndexM,Vin,BZ) 
   10685 FORMAT(2X,100(I4,1X))
   19685 FORMAT(2X,100(F20.12,1X))

   ! ‘Œ–Ã»–”≈Ã ≈ƒ»Õ»◊Õ”ﬁ Ã¿“–»÷”
   E=0.D0
   DO IIDD=1,IndexM
      E(IIDD,IIDD)=1.D0
   ENDDO
   
   ! ‘Œ–Ã»–”≈Ã Ã¿“–»÷” —»—“≈Ã€
   !WRITE(100,*) 'E'
   !DO IIDD=1,IndexM
   !   WRITE(100,19345 ) (E(IIDD,IBBB),IBBB=1,IndexM)
   !ENDDO
   !WRITE(100,*) 'AZ'
   !DO IIDD=1,IndexM
   !   WRITE(100,19345 ) (AZ(IIDD,IBBB),IBBB=1,IndexM)
   !ENDDO 
   !WRITE(100,*) 'BZ'
   !DO IIDD=1,IndexM
   !   WRITE(100,19345 ) (BZ(IIDD,IBBB),IBBB=1,IndexM)
   !ENDDO
   E=E-MATMUL(AZ,BZ)
   !WRITE(100,*) 'E'
   !DO IIDD=1,IndexM
   !   WRITE(100,19345 ) (E(IIDD,IBBB),IBBB=1,IndexM)
   !ENDDO
   ! «¿œ»—€¬¿≈Ã –≈«”À‹“¿“ –¿—◊≈“¿
   ! Œœ–≈ƒ≈Àﬂ≈Ã ƒ≈“≈–Ã»Õ¿Õ“ —»—“≈Ã€
   Rdet=Determenant(E)

   WRITE(17,*) Exf,Rdet,RcoffChengH
   
  
  
   
   ! «¿œ»—€¬¿≈Ã –≈«”À‹“¿“ –¿—◊≈“¿
   IF(IndexVilky.EQ.0) THEN
        IF(NEpsIter.EQ.1) THEN
           DetM(4)=Rdet
		ENDIF
        IF(NEpsIter.EQ.2) THEN
           DetM(5)=Rdet
		ENDIF
        IF(NEpsIter.NE.1.AND.NEpsIter.NE.2) THEN
            DetM(1)=DetM(2)
			DetM(2)=DetM(3)
            DetM(3)=DetM(4)
            DetM(4)=DetM(5)
            DetM(5)=Rdet
        ENDIF
		
		! »Õƒ≈ — ‘» —»–”ﬁŸ»… ◊»—ÀŒ »“≈–¿÷»… ¬ —À”◊¿≈  Œ√ƒ¿ »Õ“≈–¬¿À Õ≈Œœ–≈ƒ≈À≈Õ
		INDEXAD=INDEXAD+1
		! ¬ Õ¿◊¿À≈ ¬Œ«¬–¿Ÿ¿≈Ã—ﬂ   œ–≈ƒ€ƒ”Ÿ≈Ã” ÿ¿√” ”¡»–¿≈Ã  Œ›‘‘»÷»≈Õ“ œŒÀ”◊≈ÕÕ€… ¬ œ–≈ƒ≈ƒ”Ÿ≈Ã »Õ“≈–¬¿À≈ 
		IF(INDEXAD.EQ.4) THEN
		   Henergy=Henergy*RcoffChengH
        ENDIF 
		! Õ¿◊»Õ¿≈Ã  Œ––≈ “»–Œ¬¿“‹ ÿ¿√ 
		IF(INDEXAD.EQ.5) THEN
		   ! ¬Œ«¬–¿Ÿ¿≈Ã  Œ›‘‘»÷»≈Õ“ ¬ »—’ŒƒÕŒ≈ —Œ—“ŒﬂÕ»≈
		   RcoffChengH=1.D0
           ProDet(1)=DABS(DetM(5)*(1.D0-DetM(4)/DetM(5))/(ExfM(5)*(1.D0-ExfM(4)/ExfM(5))))
		ENDIF
	    IF(INDEXAD.EQ.6) THEN
           ProDet(2)=DABS(DetM(5)*(1.D0-DetM(4)/DetM(5))/(ExfM(5)*(1.D0-ExfM(4)/ExfM(5))))
		ENDIF
		IF(INDEXAD.GT.6) THEN
           ProDet(1)=ProDet(2)
           ProDet(2)=DABS(DetM(5)*(1.D0-DetM(4)/DetM(5))/(ExfM(5)*(1.D0-ExfM(4)/ExfM(5))))
		   ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“  Œ›‘‘»÷»≈Õ“¿ » »«Ã≈Õ≈Õ»≈ ÿ¿√¿
		   call ChangeHR(INDEXRShag,IKLCOMBEC,IIHD,IIOXDPZ,IndexCorrect,Henergy,RcoffChengH,ExfM,ProDet,DetM,INDEXPeresc,DeltaEnerPers,DeltaFunPers)
		   ! œ–Œ¬≈–ﬂ≈Ã œ≈–≈’Œƒ ¬ –≈∆»Ã ”Ã≈Õ‹ÿ≈Õ»ﬂ ÿ¿√¿
		   IF(IKLCOMBEC.EQ.1) THEN
              ! ¬Œ«¬–¿Ÿ¿≈Ã—ﬂ Õ¿ ŒƒÕ” “Œ◊ ” Õ¿«¿ƒ
              Exf=ExfM(4)
			  ExfM(5)=ExfM(4)
              ExfM(4)=ExfM(3)
              ExfM(3)=ExfM(2)
              ExfM(2)=ExfM(1)
              DetM(5)=DetM(4)
              DetM(4)=DetM(3)
              DetM(3)=DetM(2)
              DetM(2)=DetM(1)   
		   ENDIF
		ENDIF
   ENDIF

   IF(IndexVilky.EQ.1) THEN	
      IF(INDEXDF.EQ.1) THEN 
         DetM(1)=DetM(2)
	     DetM(2)=DetM(3)
         DetM(3)=DetM(4)
         DetM(4)=DetM(5)
         DetM(5)=Rdet
      ENDIF 
	  IF(INDEXDF.EQ.2) THEN 
         ! œ–Œ¬≈–ﬂ≈Ã  ¿ Œ… »« –≈∆»ÃŒ¬ ¬ Àﬁ◊≈Õ
		 IF(IKLKORX.EQ.1) THEN
            !  Œ––≈ “»–Œ¬ ¿ —œ–¿¬¿
            ! œ–Œ¬≈–ﬂ≈Ã ◊“Œ¡€ «Õ¿◊≈Õ»≈ —œ–¿¬¿ ¡€ÀŒ “Œ√Œ ∆≈ «Õ¿ ¿
			IIIFKL=0
			IF(Rdet.GT.0.D0.AND.DetM(3).GT.0.D0) THEN
               DetM(1)=DetM(2)
	           DetM(2)=DetM(3)
			   DetM(3)=Rdet
               ExfM(1)=ExfM(2)
               ExfM(2)=ExfM(3)
			   ExfM(3)=Exf
			   IIIFKL=1
			   ! ”¬≈À»◊»¬¿≈Ã ◊»—ÀŒ “Œ◊≈  œŒÀ”◊≈ÕÕ€’ ¬ ¡À»«» “Œ◊ » »«Ã≈Õ≈Õ»ﬂ «Õ¿ ¿
			   IKLRXX=IKLRXX+1
			   ! “Œ◊ ¿ Œœ–≈ƒ≈À≈Õ¿ ¬Œ«¬–¿Ÿ¿≈Ã »—’ŒƒÕŒ≈ «Õ¿◊≈Õ»≈  Œ––≈ “–»–”ﬁŸ≈√Œ ÃÕŒ∆»“≈Àﬂ
			   IOPZ=4 
			ENDIF
            IF(Rdet.LT.0.D0.AND.DetM(3).LT.0.D0) THEN
               DetM(1)=DetM(2)
	           DetM(2)=DetM(3)
			   DetM(3)=Rdet
               ExfM(1)=ExfM(2)
               ExfM(2)=ExfM(3)
			   ExfM(3)=Exf
			   IIIFKL=1
			   ! ”¬≈À»◊»¬¿≈Ã ◊»—ÀŒ “Œ◊≈  œŒÀ”◊≈ÕÕ€’ ¬ ¡À»«» “Œ◊ » »«Ã≈Õ≈Õ»ﬂ «Õ¿ ¿
			   IKLRXX=IKLRXX+1
			   ! “Œ◊ ¿ Œœ–≈ƒ≈À≈Õ¿ ¬Œ«¬–¿Ÿ¿≈Ã »—’ŒƒÕŒ≈ «Õ¿◊≈Õ»≈  Œ––≈ “–»–”ﬁŸ≈√Œ ÃÕŒ∆»“≈Àﬂ
			   IOPZ=4 
			ENDIF
			IF(IIIFKL.EQ.0) THEN
               IOPZ=IOPZ*2
			ENDIF
			! ÕŒÃ≈– »“≈–¿÷»» ¬Œ«¬–¿Ÿ¿≈Ã Õ¿ 1 Õ¿«¿ƒ
			INDEXDF=INDEXDF-1
		 ENDIF
         IF(IKLKORX.EQ.2) THEN
            !  Œ––≈ “»–Œ¬ ¿ —À≈¬¿
            ! œ–Œ¬≈–ﬂ≈Ã ◊“Œ¡€ «Õ¿◊≈Õ»≈ —À≈¬¿ ¡€ÀŒ “Œ√Œ ∆≈ «Õ¿ ¿
			IIIFKL=0
			IF(Rdet.GT.0.D0.AND.DetM(4).GT.0.D0) THEN
               DetM(5)=DetM(4)
	           DetM(4)=Rdet
			   ExfM(5)=ExfM(4)
               ExfM(4)=Exf
			   IIIFKL=1
               ! ”¬≈À»◊»¬¿≈Ã ◊»—ÀŒ “Œ◊≈  œŒÀ”◊≈ÕÕ€’ ¬ ¡À»«» “Œ◊ » »«Ã≈Õ≈Õ»ﬂ «Õ¿ ¿
			   IKLRXX=IKLRXX+1
			   ! “Œ◊ ¿ Œœ–≈ƒ≈À≈Õ¿ ¬Œ«¬–¿Ÿ¿≈Ã »—’ŒƒÕŒ≈ «Õ¿◊≈Õ»≈  Œ––≈ “–»–”ﬁŸ≈√Œ ÃÕŒ∆»“≈Àﬂ
			   IOPZ=4  
			ENDIF
            IF(Rdet.LT.0.D0.AND.DetM(4).LT.0.D0) THEN
               DetM(5)=DetM(4)
	           DetM(4)=Rdet
			   ExfM(5)=ExfM(4)
               ExfM(4)=Exf
			   IIIFKL=1
			   ! ”¬≈À»◊»¬¿≈Ã ◊»—ÀŒ “Œ◊≈  œŒÀ”◊≈ÕÕ€’ ¬ ¡À»«» “Œ◊ » »«Ã≈Õ≈Õ»ﬂ «Õ¿ ¿
			   IKLRXX=IKLRXX+1
			   ! “Œ◊ ¿ Œœ–≈ƒ≈À≈Õ¿ ¬Œ«¬–¿Ÿ¿≈Ã »—’ŒƒÕŒ≈ «Õ¿◊≈Õ»≈  Œ––≈ “–»–”ﬁŸ≈√Œ ÃÕŒ∆»“≈Àﬂ
			   IOPZ=4 
			ENDIF
			IF(IIIFKL.EQ.0) THEN
               IOPZ=IOPZ*2
			ENDIF
			! ÕŒÃ≈– »“≈–¿÷»» ¬Œ«¬–¿Ÿ¿≈Ã Õ¿ 1 Õ¿«¿ƒ
			INDEXDF=INDEXDF-1
		 ENDIF
		
      ENDIF    
   ENDIF 

   
   IF(IndexVilky.EQ.2) THEN
      IF(INDEXDF.EQ.1) THEN
           DetMA(4)=DetMA(1)
           DetMA(1)=DetMA(2)
           DetMA(2)=DetMA(3)
           DetMA(3)=Rdet
	     ELSE
	       !  Œ–≈Õ‹ œŒœ¿À ¬ œ≈–¬€… »“≈–¬¿À
           IF(IIKK.EQ.1) THEN
              DetMA(2)=DetMA(3)
              DetMA(3)=Rdet
	       ENDIF
           !  Œ–≈Õ‹ œŒœ¿À ¬ ¬“Œ–Œ… »“≈–¬¿À
           IF(IIKK.EQ.2) THEN
              DetMA(1)=DetMA(3)
              DetMA(3)=Rdet
 	       ENDIF
      ENDIF
   ENDIF 
   		    
      
   ! œ–Œ¬Œƒ»Ã œŒ»—   Œ–Õ≈… Õ¿ ¬—≈Ã ›Õ≈–√»“»◊≈— ŒÃ »Õ“≈–¬¿À≈
   IF(IndexVilky.EQ.0) THEN
      ! œ–Œ¬Œƒ»Ã œ≈–≈¡Œ– «Õ¿◊≈Õ»… ›Õ≈–√»»
      IF(NEpsIter.EQ.1) THEN
	        ExfM(4)=Exf
            Exf=Exf*(1.D0-Henergy)
            ExfM(5)=Exf  
          ELSE
	       ! œ–Œ¬≈–ﬂ≈Ã œŒœ¿ƒ¿≈“ ŒƒÕŒ›À≈ “–ŒÕÕ¿ﬂ ›Õ≈–√»ﬂ ¬ ¬»À ” »À» Õ≈“ (Œœ–≈ƒ≈À≈Õ À» »Õ“≈–¬¿À ¬  Œ“Œ–ŒÃ Õ¿’Œƒ»“—ﬂ  Œ–≈Õ‹)
	       IF((DetM(4)*DetM(5)).LT.0.D0) THEN
	             IndexVilky=1 
				 ! œŒ— ŒÀ‹ ” »Õ“≈–¬¿À Œœ–≈ƒ≈À≈Õ «¿Õ”Àﬂ≈Ã ◊»—ÀŒ »“≈–¿÷»… ¬Õ≈ »Õ“≈–¬¿À¿ ƒÀﬂ ÕŒ¬Œ√Œ —À”◊¿ﬂ ¬Õ≈ »Õ“≈–¬¿À¿  
				 INDEXAD=0  
				 ! œŒ— ŒÀ‹ ” »Õ“≈–¬¿À Œœ–≈ƒ≈À≈Õ «¿Õ”Àﬂ≈Ã ◊»—ÀŒ »“≈–¿÷»… — ”Ã≈Õ‹ÿ≈ÕÕ€Ã ÿ¿√ŒÃ
				 INDEXRShag=0 
				 ! Œ“ Àﬁ◊¿≈Ã  ŒÕ“–ŒÀ‹ — ¿◊ ¿
				 IIOXDPZ=0                          
			   ELSE
			     Exf=Exf*(1.D0-Henergy)
                 ExfM(1)=ExfM(2)
                 ExfM(2)=ExfM(3)
				 ExfM(3)=ExfM(4)
                 ExfM(4)=ExfM(5)
				 ExfM(5)=Exf  
           ENDIF      
	  ENDIF
   ENDIF
   
   ! ”—“¿ÕŒ¬À≈Õ¿ Œ¡À¿—“‹ œ≈–≈Ã≈Õ€ «Õ¿ ¿ 
   IF(IndexVilky.EQ.1) THEN
        ! œ–Œ¬≈–ﬂ≈Ã œ≈–≈Ã≈Õ¿ «Õ¿ ¿ —¬ﬂ«¿Õ¿ — ¬Œ«Õ» ÕŒ¬≈Õ≈Ã –¿«–€¬¿ ¬ ƒ¿ÕÕŒ… Œ¡À¿—“» »À» — Õ¿À»◊»≈Ã  Œ–Õﬂ
        ! »Õƒ≈ — ” ¿«€¬¿≈“, ◊“Œ ¬ ƒ¿ÕÕŒÃ –≈∆»Ã≈  œ–Œ√–¿ÃÃ¿ –¿¡Œ“¿≈“ ƒÀﬂ ƒ¿ÕÕŒ√Œ »Õ“≈–¬¿À¿ ¬ œ≈–¬€… –¿«
		INDEXDF=INDEXDF+1
		!  Àﬁ◊ ” ¿«€¬¿≈“ Õ¿ œ≈–≈Ã≈Õ” «Õ¿ ¿
		IKLPERZnak=0
        IF(INDEXDF.EQ.1) THEN
             Exf=Exf*(1.D0-Henergy/FLOAT(IndexCorrect+2))
             ExfM(1)=ExfM(2)
             ExfM(2)=ExfM(3)
		     ExfM(3)=ExfM(4)
             ExfM(4)=ExfM(5)
		     ExfM(5)=Exf  
			 ExfTemp=Exf 
			 ! ‘» —»–”≈Ã IOPZ ƒÀﬂ  Œ––≈ “»–Œ¬ »  Œ–Õ≈…
			 IOPZ=4  
			 ! ‘» —»–”≈Ã ◊»—ÀŒ “Œ◊≈   Œ“Œ–€≈ ¡€À» ”◊“≈Õ€ œ–» —”∆≈Õ»» Œ¡À¿—“» 
			 IKLRXX=0 
           ELSE   
             IF(DABS(DetM(5)).GT.DABS(DetM(4)).AND.DABS(DetM(2)).GT.DABS(DetM(3))) THEN
                 ! ‘» —»–”≈Ã “Œ“ ‘¿ “, ◊“Œ Œ¡Õ¿–”∆≈Õ  Œ–≈Õ‹
				 IKLPERZnak=1 
				 ! Œ¡Õ¿–”∆≈Õ »Õ“≈–¬¿À  Œ–Õﬂ 
                 IndexCorrect=IndexCorrect+1
				 ! ‘» —»–”≈Ã ¬Œ«ÃŒ∆Õ€…  Œ–≈Õ‹ ¬ ƒ¿ÕÕŒ… Œ¡À¿—“»
                 EnergyZeroZ(NMO,IndexCorrect,1)=EnergyZeroZ(NMO,IndexCorrect,2)
				 EnergyZeroZ(NMO,IndexCorrect,2)=ExfM(3)  
                 ! »«Ã≈Õ≈Õ»≈ ÿ¿√¿ 
				 Henergy=Henergy/FLOAT(IndexCorrect+1)  
                 ! «¿œ»—€¬¿≈Ã ƒ¿ÕÕ€≈ ƒÀﬂ —À≈ƒ”ﬁŸ≈√Œ  Œ–Õﬂ ƒÀﬂ Õ¿’Œ∆ƒ≈Õ»ﬂ  Œ–Õﬂ Õ≈ŒƒÕŒ–ŒƒÕŒ√Œ ”–¿¬Õ≈Õ»ﬂ —À≈¬¿ 
                 ExfSET=ExfM
				 DetSET=DetM
				 HenergySET=Henergy
                 IndexCorrectSET=IndexCorrect
                 
				 ! ƒ¿ÕÕ¿ﬂ œ≈–≈Ã≈Õ¿ «Õ¿ Œ¬ —¬ﬂ«¿Õ¿ — Õ¿À»◊»≈Ã –¿«–€¬¿
			     ! À»¡Œ  Œ–≈Õ‹ Õ¿…ƒ≈Õ œ–» ›“ŒÃ ¬—≈ –¿¬ÕŒ Õ”∆ÕŒ œ≈–≈…“» ¬ –≈∆»Ã ƒ¿À‹Õ≈…ÿ≈√Œ œŒ»— ¿
			     ! œ≈–≈’Œƒ»Ã ¬ –≈∆»Ã ƒ¿À‹Õ≈…ÿ≈√Œ œŒ»— ¿  Œ–Õ≈…
			     IndexVilky=0 
                 INDEXDF=0
				 Exf=ExfM(5) 
				ELSE
				  ! ”—“¿Õ¿¬À»¬¿≈Ã œ–»◊»Õ¿ ¬ –¿«–€¬≈ »À» Õ≈“
				  ! ¬€ﬂ—Õﬂ≈Ã —”Ÿ≈—“¬”≈“  Œ–≈Õ‹ »À» »Ã≈≈“ Ã≈—“Œ –¿«–€¬
				  ! œ–» ›“ŒÃ, ”—“¿Õ¿¬À»¬¿≈Ã “¿ Œ≈ œŒ¬≈ƒ≈Õ»≈ —¬ﬂ«¿ÕŒ —  ŒÀ≈¡¿Õ»ﬂÃ» ¬ Œ¡À¿—“» œ≈–≈Ã≈Õ€ «Õ¿ ¿
				  ! Œ—”Ÿ≈—“¬Àﬂ≈Ã —”∆≈Õ»≈ Œ¡À¿—“» œ≈–≈Ã≈Õ€ «Õ¿ ¿ ƒÀﬂ ¬Õ≈—≈Õ»ﬂ ﬂ—ÕŒ—“» ¬ œŒ¬≈ƒ≈Õ»» Œœ–≈ƒ≈À»“≈Àﬂ ¬ Œ¡À¿—“» Õ”Àﬂ
                     
				  IIIFKL=0
				  ! ”—“¿Õ¿¬À»¬¿≈Ã œ–»◊»Õ” Œ“—”“—“¬»ﬂ  Œ–Õﬂ
				  ! œ–Œ¬≈–ﬂ≈Ã ¬€œŒÀÕ≈Õ»≈ œ≈–¬Œ√Œ ”—ÀŒ¬»ﬂ
			      IF(DABS(DetM(5)).GT.DABS(DetM(4))) THEN
				     ! ¬“Œ–Œ≈ ”—ÀŒ¬»≈ Õ≈ ¬€œŒÀÕﬂ≈“—ﬂ 
					 ! œ–»¡À»∆¿≈“ «Õ¿◊≈Õ»≈    Œ–Õﬂﬁ (—œ–¿¬¿)     
				     IKLKORX=1
					 Exf=ExfM(3)-DABS(ExfM(3)-ExfM(4))/DBLE(IOPZ)
				     IIIFKL=1
				  ENDIF 
				  ! œ–Œ¬≈–ﬂ≈Ã ¬€œŒÀÕ≈Õ»≈ ¬“Œ–Œ√Œ ”—ÀŒ¬»ﬂ
				  IF(DABS(DetM(2)).GT.DABS(DetM(3))) THEN
				     ! œ≈–¬Œ≈ ”—ÀŒ¬»≈ Õ≈ ¬€œŒÀÕﬂ≈“—ﬂ 
					 ! œ–»¡À»∆¿≈“ «Õ¿◊≈Õ»≈    Œ–Õﬂﬁ (—À≈¬¿)     
				     IKLKORX=2
                     Exf=ExfM(4)+DABS(ExfM(3)-ExfM(4))/DBLE(IOPZ)
				     IIIFKL=1
				  ENDIF 
                  
				  ! œ–Œ¬≈–ﬂ≈Ã — ŒÀ‹ Œ –¿« œŒÀ”◊≈Õ¿ ÕŒ¬¿ﬂ “Œ◊ ¿ “Œ ≈—“‹ — ŒÀ‹ Œ –¿« Ã€ ”Ã≈Õ‹ÿ¿À» Œ¡À¿—“‹ œ≈–≈Ã≈Õ€ «Õ¿ ¿  
                  IF(IKLRXX.EQ.3) THEN
				     ! ◊»—ÀŒ “Œ◊≈  –¿¬ÕŒ “–≈Ã, œ–» ›“ŒÃ Õ≈ œ–Œ»«ŒÿÀŒ »«Ã≈Õ≈Õ»… ¬ œŒ¬≈ƒ≈Õ»» Œœ–≈ƒ≈À»“≈Àﬂ ¬ ¡À»«» “Œ◊ » œ≈–≈Ã≈Õ€ «Õ¿ ¿ 
					 ! “¿ »Ã Œ¡–¿«ŒÃ »Ã≈≈“ Ã≈—“Œ –¿«–€¬ 
					 IIIFKL=0 
				  ENDIF 
  

				  ! œ–Œ¬≈–ﬂ≈Ã »Ã≈≈“ Ã≈—“Œ –¿«–€¬ »À» Õ≈“ 
				  IF(IIIFKL.EQ.0) THEN
			         ! ƒ¿ÕÕ¿ﬂ œ≈–≈Ã≈Õ¿ «Õ¿ Œ¬ —¬ﬂ«¿Õ¿ — Õ¿À»◊»≈Ã –¿«–€¬¿
			         ! À»¡Œ  Œ–≈Õ‹ Õ¿…ƒ≈Õ œ–» ›“ŒÃ ¬—≈ –¿¬ÕŒ Õ”∆ÕŒ œ≈–≈…“» ¬ –≈∆»Ã ƒ¿À‹Õ≈…ÿ≈√Œ œŒ»— ¿
			         ! œ≈–≈’Œƒ»Ã ¬ –≈∆»Ã ƒ¿À‹Õ≈…ÿ≈√Œ œŒ»— ¿  Œ–Õ≈…
			         IndexVilky=0 
                     INDEXDF=0 
					 Exf=ExfM(5) 
				  ENDIF

             ENDIF
			
		ENDIF 
        
        ! œ–Œ¬≈–ﬂ≈Ã ”—“¿ÕŒ¬À≈Õ ‘¿ “ Õ¿À»◊»ﬂ  Œ–Õﬂ »À» Õ≈“
		IF(IKLPERZnak.EQ.1) THEN
           ! œ–Œ¬≈–ﬂ≈Ã ¬€œŒÀÕ»ÀŒ—‹ À» ”—ÀŒ¬»≈
           ! ÕŒÃ≈– Õ¿…ƒ≈ÕŒ√Œ  Œ–Õﬂ œŒ œŒ–ﬂƒ ” (»Õ“≈–¬¿À¿ ¬  Œ“Œ–ŒÃ Õ¿’Œƒ»“—ﬂ  Œ–≈Õ‹) —ŒŒ“¬≈“—“¬”≈“ √À¿¬ÕŒÃ”  ¬¿Õ“Œ¬ŒÃ” ◊»—À”
           ISolution=0
           IF(IndexCorrect.EQ.NNEL) THEN
              ISolution=1
		   ENDIF
          		   
		   
		   IF(ISolution.EQ.1) THEN
              ! ‘» —»–”≈Ã –≈∆»Ã œŒ»— ¿  Œ–Õﬂ ¬ »Õ“≈–¬¿À≈
		      IndexVilky=2 
		      !WRITE(*,*) 'ZERO',IndexVilky
		      !WRITE(*,*) DetM(5),DetM(4),DetM(2),DetM(3)
		      !WRITE(*,*) ExfM(5),ExfM(4),ExfM(2),ExfM(3)
		      !READ(*,*) 
		      ! «¿œ»—€¬¿≈Ã √–¿Õ»÷€ »Õ“≈–¬¿À¿ 
              ExfMA(2)=ExfM(4)
		      DetMA(2)=DetM(4)
		      ExfMA(3)=ExfM(3)
		      DetMA(3)=DetM(3)
		      !WRITE(*,*) DetM(2),DetM(3)
		      !WRITE(*,*) ExfM(2),ExfM(3)
		      !READ(*,*)   
		      ! «¿Õ”Àﬂ≈Ã œ≈–≈ƒ œŒ»— ŒÃ  Œ–Õﬂ
		      ExfMA(1)=0.D0
		      DetMA(1)=0.D0
		      ExfMA(4)=0.D0
              DetMA(4)=0.D0
		      ExfMA(5)=0.D0
		      DetMA(5)=0.D0
		      INDEXDF=0 
           ENDIF
        ENDIF 
	
		  		    
   ENDIF

   ! –≈∆»Ã œŒ»— ¿  Œ–Õﬂ ¬ »Õ“≈–¬¿À≈
   IF(IndexVilky.EQ.2) THEN 
      ! Œ—”Ÿ≈—“¬Àﬂ≈Ã œŒ»—   Œ–Õﬂ ¬ Õ¿…ƒ≈ÕŒÃ »Õ“≈–¬¿À≈
      INDEXDF=INDEXDF+1
      ! ƒÀﬂ œ≈–¬Œ√Œ –¿«¿ ” ¿«€¬¿≈Ã œ–»¡À»∆≈ÕÕ€…  Œ–≈Õ‹
	  IF(INDEXDF.EQ.1) THEN
           Exf=(DetMA(3)*ExfMA(2)-DetMA(2)*ExfMA(3))/(DetMA(3)-DetMA(2))
		   ExfMA(1)=ExfMA(2)
           ExfMA(2)=ExfMA(3)
		   ExfMA(3)=Exf
		 ELSE
           ! œ–Œ¬≈–ﬂ≈Ã ¬  ¿ ŒÃ »« ƒ¬”’ »Õ“≈–¬¿À¿’  Œ–≈Õ‹
		   ! œ≈–¬€… »Õ“≈–¬¿À
		   IF((DetMA(1)*DetMA(3)).LT.0.D0) THEN
               IIKK=1
		       Exf=(DetMA(3)*ExfMA(1)-DetMA(1)*ExfMA(3))/(DetMA(3)-DetMA(1))
			   ExfMA(2)=ExfMA(3)
               ExfMA(3)=Exf
		   ENDIF
		   ! ¬“Œ–Œ… »Õ“≈–¬¿À
           IF((DetMA(3)*DetMA(2)).LT.0.D0) THEN
		       IIKK=2
               Exf=(DetMA(2)*ExfMA(3)-DetMA(3)*ExfMA(2))/(DetMA(2)-DetMA(3))
		       ExfMA(1)=ExfMA(3)
               ExfMA(3)=Exf
		   ENDIF
      ENDIF		  		   
   

      ! œ–Œ¬≈–ﬂ≈Ã Õ¿…ƒ≈Õ  Œ–≈Õ‹ »À» Õ≈“
	  ! œ–Œ¬≈–ﬂ≈Ã ¬€œŒÀÕ»ÀŒ—‹ À» ”—ÀŒ¬»≈
      ! œ–Œ¬≈–ﬂ≈Ã «Õ¿◊≈Õ»≈ Œœ–≈ƒ≈À»“≈Àﬂ ŒÕŒ ƒŒÀ∆ÕŒ ¡€“‹ Ã≈Õ‹ÿ≈ “Œ◊ÕŒ—“»
      ! Õ¿◊»Õ¿≈Ã œ–Œ¬≈–ﬂ“‹ ”—ÀŒ¬»≈ ¬ —À”◊¿≈ Œ¡Õ¿–”∆≈Õ»ﬂ »Õ“≈–¬¿À¿ √ƒ≈ Õ¿’Œƒ»“—ﬂ  Œ–≈Õ‹
      IF(INDEXDF.GT.1) THEN
         IF(DABS(DetMA(3)).LT.EPS) THEN
            !  Œ–≈Õ‹ Õ¿…ƒ≈Õ 
			! ‘» —»–”≈Ã Õ¿…ƒ≈ÕÕ€…  Œ–≈Õ‹
			IndexSolutions=IndexSolutions+1
			IndexSolutionsSET=IndexSolutions
			! «¿œ»—€¬¿≈Ã Õ¿…ƒ≈ÕÕ€…  Œ–≈Õ‹
			ExfSolutions(IndexSolutions)=Exf
			! «¿œ»—€¬¿≈Ã  Œ–≈Õ‹ Õ¿…ƒ≈ÕÕ€…
			EnergyZeroZ(NMO,IndexCorrect,2)=ExfMA(3)  
			! œ≈–≈’Œƒ»Ã ¬ –≈∆»Ã ƒ¿À‹Õ≈…ÿ≈√Œ œŒ»— ¿  Œ–Õ≈…
			IndexVilky=0 
            INDEXDF=0 
			Exf=ExfTemp 
			ExfSETT=ExfTemp 
			!write(6,*) 'kor',NNEL,IndexSolutions,ExfSolutions(IndexSolutions)
         ENDIF
      ENDIF 
	  
	  ! ¬€’Œƒ »« ÷» À¿ œŒ œŒ»— ”  Œ–Õ≈… œ–Œ»«Œ…ƒ≈“ œ–» ”—ÀŒ¬»»
	  IF(IndexSolutions.EQ.1) THEN
	     ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
   	     IparametrDeterEnergy=2 
	  ENDIF 
	   
   ENDIF
    

  
   !WRITE(*,*) 'ITERASTION ZERO'
   !write(*,10685)  NEpsIter,IndexVilky,IndexCorrect,NNEL
   !write(*,19685)  DetM(1),DetM(3),DetM(2)
   !write(*,19685)  ExfM(1),ExfM(3),ExfM(2)
   !write(*,19685)  Exf
   !read(*,*)
   return
 end subroutine SearchSolutionAccelerated2



 ! œŒƒœ–Œ√–¿ÃÃ¿ Œ—”Ÿ≈—“¬ÀﬂﬁŸ¿ﬂ œŒ»—  »Õ“≈–¬¿À¿ Õ”∆ÕŒ√Œ  Œ–Õﬂ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»» ’¿–“–»-‘Œ ¿ ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» ƒÀﬂ —À”◊¿ﬂ œŒ»— ¿  Œ–Õ≈… —À≈¬¿
 ! NNEL- √À¿¬ÕŒ≈  ¬¿Õ“Œ¬Œ≈ ◊»—ÀŒ
 ! NEpsIter-ÕŒÃ≈– »“≈–¿÷»» ƒÀﬂ œŒÀ”◊≈Õ»ﬂ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»
 ! Kpoint-“Œ◊ ¿ —ÿ»¬ »
 ! IndexM-–¿«Ã≈– Ã¿——»¬¿
 ! Vout(IndexM,IndexM,Npoint)- Ã¿——»¬ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » "Õ¿–”∆”"
 ! Vin(IndexM,IndexM,Npoint)- Ã¿——»¬ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » "¬Õ”“–‹"
 ! DetM-Ã¿——»¬ «Õ¿◊≈Õ»… ƒ≈“≈–Ã»Õ¿Õ“¿
 ! ExfM-Ã¿——»¬ «Õ¿◊≈Õ»… ŒƒÕŒ›À≈ “–ŒÕÕŒ… ‘”Õ ÷»»
 ! DetMA-Ã¿——»¬ «Õ¿◊≈Õ»… ƒ≈“≈–Ã»Õ¿Õ“¿ ƒÀﬂ œŒ»— ¿  Œ–Õﬂ
 ! ExfMA-Ã¿——»¬ «Õ¿◊≈Õ»… ŒƒÕŒ›À≈ “–ŒÕÕŒ… ‘”Õ ÷»» ƒÀﬂ œŒ»— ¿  Œ–Õﬂ
 ! Exf-ŒƒÕŒ›À≈ “–ŒÕÕ¿ﬂ ›Õ≈–√»ﬂ
 ! DeltaEnergy-–¿«Õ»÷¿ Ã≈∆ƒ” ŒƒÕŒ›À≈ “–ŒÕÕ€Ã» ‘”Õ ÷»ﬂÃ»
 ! AZ,BZ,E-¬—œŒÃŒ√¿“≈À‹Õ€≈ Ã¿——»¬€
 ! Henergy-¯‡„ ÔÓ Ó‰ÌÓ˝ÎÂÍÚÓÌÌÓÈ ˝ÌÂ„ËË (œŒ—À≈ Œ ŒÕ◊¿Õ»ﬂ œ–Œ√–¿ÃÃ€ ƒ¿≈“ Õ”À»¬Œ≈ œ–»¡À»∆≈Õ»≈ ƒÀﬂ  Œ–Õﬂ)
 ! IparametrDeterEnergy-œ¿–¿Ã≈“– ¬€’Œƒ¿ »« ÷» À¿ œŒ ”“Œ◊Õ≈Õ»ﬁ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»
 ! EPS-“Œ◊ÕŒ—“‹
 ! IndexVilky-»Õƒ≈ — ” ¿«€¬¿ﬁŸ»… Õ¿ “Œ ◊“Œ Œœ–≈ƒ≈À≈Õ »Õ“≈–¬¿À ¬  Œ“Œ–ŒÃ Õ¿’Œƒ»“—ﬂ  Œ–≈Õ‹
 ! IndexVilky=0-»Õ“≈–¬¿À Õ≈ Œœ–≈ƒ≈À≈Õ
 ! IndexVilky=1-»Õ“≈–¬¿À Œœ–≈ƒ≈À≈Õ 
 ! IndexVilky=2-–≈∆»Ã œŒ»— ¿  Œ–Õﬂ 
 ! INDEXDF-»Õƒ≈ — ” ¿«€¬¿ﬁŸ»… ◊»—ÀŒ »“≈–¿÷»… —ƒ≈À¿ÕÕ€’ œŒ—À≈ œŒœ¿ƒ¿Õ»ﬂ ¬ ¬»À ”
 ! IndexCorrect-»Õƒ≈ — ” ¿«€¬¿ﬁŸ»… ◊»—ÀŒ  Œ–Õ≈… Õ¿…ƒ≈ÕÕ€’ Õ¿ ¬—≈Ã »Õ“≈–¬¿À≈  
 ! IndexSolutions-»Õƒ≈ — ◊»—À¿ –≈ÿ≈Õ»≈, Õ≈Œ¡’Œƒ»ÃŒ Õ¿…“» –≈ÿ≈Õ»ﬂ ƒÀﬂ NNEL-1, NNEL, NNEL+1, “Œ ≈—“‹ ƒÀﬂ ¬€’Œƒ¿ 
 ! Õ≈Œ¡’Œƒ»ÃŒ, ◊“Œ¡€ IndexSolutions=3 
 ! ExfSolutions(IndexSolutions)-›Õ≈–√»» Õ¿…ƒ≈ÕÕ€’  Œ–Õ≈…  NNEL-1, NNEL, NNEL+1
 ! ExfTemp-¬—œŒÃŒ√¿“≈À‹Õ¿ﬂ œ≈–≈Ã≈ÕÕ¿ﬂ
 ! IKLKORX,IOPZ,IKLRXX-»Õƒ≈ —€  Œ––≈ “»–Œ¬ » ƒÀﬂ ”—“¿Õ¿¬À≈Õ»ﬂ  Œ–≈Õ‹ »À» –¿«–€¬
 ! INDEXAD-»Õƒ≈ — ” ¿«€¬¿ﬁŸ»… ◊»—ÀŒ »“≈–¿÷»… —ƒ≈À¿ÕÕ€’ ¬ —À”◊¿≈  Œ√ƒ¿ »Õ“≈–¬¿À Õ≈Œœ–≈ƒ≈À≈Õ 
 ! RcoffChengH- Œ›‘‘»÷»≈Õ“ »«Ã≈Õ≈Õ»ﬂ ÿ¿√¿
 ! ProDet(2)-Ã¿——»¬ œ–Œ»«¬ŒƒÕ€’
 ! INDEXRShag-–≈∆»Ã »«Ã≈Õ≈Õ»ﬂ ÿ¿√¿
 ! IIHD-»Õƒ≈ — ”Ã≈Õ‹ÿ≈Õ»ﬂ ÿ¿√¿
 ! IIOXDPZ- Àﬁ◊ ” ¿«€¬¿ﬁŸ»… ◊“Œ Ã€ œŒœ¿À» ¬ –≈∆»Ã ”Ã≈Õ‹ÿ≈Õ»ﬂ ÿ¿√¿ »  ŒÕ“–ŒÀ»–”≈Ã ¬Œ«ÃŒ∆ÕŒ—“‹ œ≈–≈— Œ ¿
 ! INDEXPeresc-»Õƒ≈ — ” ¿«€¬¿ﬁŸ»… ◊¿—“» »“≈–¿÷»… ¬ –≈∆»Ã≈ ¬Œ«ÃŒ∆ÕŒ√Œ œ≈–≈— Œ ¿
 ! DeltaEnerPers-»Õ“≈–¬¿À ›Õ≈–√»… ¬ Œ¡À¿—“» œ≈–≈— Œ ¿
 ! DeltaFunPers-»Õ“≈–¬¿À ‘”Õ ÷»… ¬ Œ¡À¿—“» œ≈–≈— Œ ¿ 
 subroutine SearchSolutionAcceleratedLeft(NNEL,NEpsIter,Kpoint,IndexM,Vout,Vin,DetM,ExfM,DetMA,ExfMA,Exf,AZ,BZ,E,Henergy,IparametrDeterEnergy,EPS,IndexVilky,INDEXDF,IIKK,IndexCorrect,IndexSolutions,ExfSolutions,ExfTemp,IKLKORX,IOPZ,IKLRXX,INDEXAD,RcoffChengH,ProDet,INDEXRShag,IIHD,IIOXDPZ,INDEXPeresc,DeltaEnerPers,DeltaFunPers)
   implicit none
   integer::NNEL,NEpsIter,Kpoint,IndexM,IparametrDeterEnergy,IndexVilky,INDEXDF,IIKK,IndexCorrect,IndexSolutions,IKLKORX,IOPZ,IKLRXX,INDEXAD,INDEXRShag,IIHD,IIOXDPZ,INDEXPeresc
   real(8)::Exf,Henergy,EPS,ExfTemp,RcoffChengH,DeltaEnerPers,DeltaFunPers
   real(8),dimension(:)::DetM,ExfM,DetMA,ExfMA,ExfSolutions,ProDet
   real(8),dimension(:,:)::AZ,BZ,E
   real(8),dimension(:,:,:)::Vout,Vin
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! 
   integer::IIDD,IBBB,IIII,klkl,IKLPERZnak,ISolution,IIIFKL,IKLCOMBEC
   real(8)::DeltaEnergy,DDD,Kcoff,RcoffGran,DMtemp,Rdet
   !real(8)::DeltaEnergy,RnormConstas,Kcoff,RcoffGran,ExfTemp,DMtemp,DDD
   ! Œœ–≈ƒ≈Àﬂ≈Ã ƒ≈“≈–Ã»Õ¿Õ“ —»—“≈Ã€
   call ReadWriteMassiv2(2,Kpoint,IndexM,Vout,AZ) 
   call ReadWriteMassiv2(2,Kpoint+1,IndexM,Vin,BZ) 
   10685 FORMAT(2X,100(I4,1X))
   19685 FORMAT(2X,100(F20.12,1X))

   ! ‘Œ–Ã»–”≈Ã ≈ƒ»Õ»◊Õ”ﬁ Ã¿“–»÷”
   E=0.D0
   DO IIDD=1,IndexM
      E(IIDD,IIDD)=1.D0
   ENDDO
   
   ! ‘Œ–Ã»–”≈Ã Ã¿“–»÷” —»—“≈Ã€
   !WRITE(100,*) 'E'
   !DO IIDD=1,IndexM
   !   WRITE(100,19345 ) (E(IIDD,IBBB),IBBB=1,IndexM)
   !ENDDO
   !WRITE(100,*) 'AZ'
   !DO IIDD=1,IndexM
   !   WRITE(100,19345 ) (AZ(IIDD,IBBB),IBBB=1,IndexM)
   !ENDDO 
   !WRITE(100,*) 'BZ'
   !DO IIDD=1,IndexM
   !   WRITE(100,19345 ) (BZ(IIDD,IBBB),IBBB=1,IndexM)
   !ENDDO
   E=E-MATMUL(AZ,BZ)
   !WRITE(100,*) 'E'
   !DO IIDD=1,IndexM
   !   WRITE(100,19345 ) (E(IIDD,IBBB),IBBB=1,IndexM)
   !ENDDO
   ! «¿œ»—€¬¿≈Ã –≈«”À‹“¿“ –¿—◊≈“¿
   ! Œœ–≈ƒ≈Àﬂ≈Ã ƒ≈“≈–Ã»Õ¿Õ“ —»—“≈Ã€
   Rdet=Determenant(E)

   WRITE(17,*) Exf,Rdet,RcoffChengH
   
  
  
   
   ! «¿œ»—€¬¿≈Ã –≈«”À‹“¿“ –¿—◊≈“¿
   IF(IndexVilky.EQ.0) THEN
        IF(NEpsIter.EQ.1) THEN
           DetM(4)=Rdet
		ENDIF
        IF(NEpsIter.EQ.2) THEN
           DetM(5)=Rdet
		ENDIF
        IF(NEpsIter.NE.1.AND.NEpsIter.NE.2) THEN
            DetM(1)=DetM(2)
			DetM(2)=DetM(3)
            DetM(3)=DetM(4)
            DetM(4)=DetM(5)
            DetM(5)=Rdet
        ENDIF

		! »Õƒ≈ — ‘» —»–”ﬁŸ»… ◊»—ÀŒ »“≈–¿÷»… ¬ —À”◊¿≈  Œ√ƒ¿ »Õ“≈–¬¿À Õ≈Œœ–≈ƒ≈À≈Õ
		INDEXAD=INDEXAD+1
		! ¬ Õ¿◊¿À≈ ¬Œ«¬–¿Ÿ¿≈Ã—ﬂ   œ–≈ƒ€ƒ”Ÿ≈Ã” ÿ¿√” ”¡»–¿≈Ã  Œ›‘‘»÷»≈Õ“ œŒÀ”◊≈ÕÕ€… ¬ œ–≈ƒ≈ƒ”Ÿ≈Ã »Õ“≈–¬¿À≈ 
		IF(INDEXAD.EQ.4) THEN
		   Henergy=Henergy*RcoffChengH
        ENDIF 
		! Õ¿◊»Õ¿≈Ã  Œ––≈ “»–Œ¬¿“‹ ÿ¿√ 
		IF(INDEXAD.EQ.5) THEN
		   ! ¬Œ«¬–¿Ÿ¿≈Ã  Œ›‘‘»÷»≈Õ“ ¬ »—’ŒƒÕŒ≈ —Œ—“ŒﬂÕ»≈
		   RcoffChengH=1.D0
           ProDet(1)=DABS(DetM(5)*(1.D0-DetM(4)/DetM(5))/(ExfM(5)*(1.D0-ExfM(4)/ExfM(5))))
		ENDIF
	    IF(INDEXAD.EQ.6) THEN
           ProDet(2)=DABS(DetM(5)*(1.D0-DetM(4)/DetM(5))/(ExfM(5)*(1.D0-ExfM(4)/ExfM(5))))
		ENDIF
		IF(INDEXAD.GT.6) THEN
           ProDet(1)=ProDet(2)
           ProDet(2)=DABS(DetM(5)*(1.D0-DetM(4)/DetM(5))/(ExfM(5)*(1.D0-ExfM(4)/ExfM(5))))
		   ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“  Œ›‘‘»÷»≈Õ“¿ » »«Ã≈Õ≈Õ»≈ ÿ¿√¿
		   call ChangeHR(INDEXRShag,IKLCOMBEC,IIHD,IIOXDPZ,IndexCorrect,Henergy,RcoffChengH,ExfM,ProDet,DetM,INDEXPeresc,DeltaEnerPers,DeltaFunPers)

		   ! œ–Œ¬≈–ﬂ≈Ã œ≈–≈’Œƒ ¬ –≈∆»Ã ”Ã≈Õ‹ÿ≈Õ»ﬂ ÿ¿√¿
		   IF(IKLCOMBEC.EQ.1) THEN
              ! ¬Œ«¬–¿Ÿ¿≈Ã—ﬂ Õ¿ ŒƒÕ” “Œ◊ ” Õ¿«¿ƒ
              Exf=ExfM(4)
			  ExfM(5)=ExfM(4)
              ExfM(4)=ExfM(3)
              ExfM(3)=ExfM(2)
              ExfM(2)=ExfM(1)
              DetM(5)=DetM(4)
              DetM(4)=DetM(3)
              DetM(3)=DetM(2)
              DetM(2)=DetM(1)   
		   ENDIF
		ENDIF
   ENDIF

   IF(IndexVilky.EQ.1) THEN	
      IF(INDEXDF.EQ.1) THEN 
         DetM(1)=DetM(2)
	     DetM(2)=DetM(3)
         DetM(3)=DetM(4)
         DetM(4)=DetM(5)
         DetM(5)=Rdet
      ENDIF  
	  IF(INDEXDF.EQ.2) THEN 
         ! œ–Œ¬≈–ﬂ≈Ã  ¿ Œ… »« –≈∆»ÃŒ¬ ¬ Àﬁ◊≈Õ
		 IF(IKLKORX.EQ.1) THEN
            !  Œ––≈ “»–Œ¬ ¿ —œ–¿¬¿
            ! œ–Œ¬≈–ﬂ≈Ã ◊“Œ¡€ «Õ¿◊≈Õ»≈ —œ–¿¬¿ ¡€ÀŒ “Œ√Œ ∆≈ «Õ¿ ¿
			IIIFKL=0
			IF(Rdet.GT.0.D0.AND.DetM(3).GT.0.D0) THEN
               DetM(1)=DetM(2)
	           DetM(2)=DetM(3)
			   DetM(3)=Rdet
               ExfM(1)=ExfM(2)
               ExfM(2)=ExfM(3)
			   ExfM(3)=Exf
			   IIIFKL=1
			   ! ”¬≈À»◊»¬¿≈Ã ◊»—ÀŒ “Œ◊≈  œŒÀ”◊≈ÕÕ€’ ¬ ¡À»«» “Œ◊ » »«Ã≈Õ≈Õ»ﬂ «Õ¿ ¿
			   IKLRXX=IKLRXX+1
			   ! “Œ◊ ¿ Œœ–≈ƒ≈À≈Õ¿ ¬Œ«¬–¿Ÿ¿≈Ã »—’ŒƒÕŒ≈ «Õ¿◊≈Õ»≈  Œ––≈ “–»–”ﬁŸ≈√Œ ÃÕŒ∆»“≈Àﬂ
			   IOPZ=4 
			ENDIF
            IF(Rdet.LT.0.D0.AND.DetM(3).LT.0.D0) THEN
               DetM(1)=DetM(2)
	           DetM(2)=DetM(3)
			   DetM(3)=Rdet
               ExfM(1)=ExfM(2)
               ExfM(2)=ExfM(3)
			   ExfM(3)=Exf
			   IIIFKL=1
			   ! ”¬≈À»◊»¬¿≈Ã ◊»—ÀŒ “Œ◊≈  œŒÀ”◊≈ÕÕ€’ ¬ ¡À»«» “Œ◊ » »«Ã≈Õ≈Õ»ﬂ «Õ¿ ¿
			   IKLRXX=IKLRXX+1
			   ! “Œ◊ ¿ Œœ–≈ƒ≈À≈Õ¿ ¬Œ«¬–¿Ÿ¿≈Ã »—’ŒƒÕŒ≈ «Õ¿◊≈Õ»≈  Œ––≈ “–»–”ﬁŸ≈√Œ ÃÕŒ∆»“≈Àﬂ
			   IOPZ=4 
			ENDIF
			IF(IIIFKL.EQ.0) THEN
               IOPZ=IOPZ*2
			ENDIF
			! ÕŒÃ≈– »“≈–¿÷»» ¬Œ«¬–¿Ÿ¿≈Ã Õ¿ 1 Õ¿«¿ƒ
			INDEXDF=INDEXDF-1
		 ENDIF
         IF(IKLKORX.EQ.2) THEN
            !  Œ––≈ “»–Œ¬ ¿ —À≈¬¿
            ! œ–Œ¬≈–ﬂ≈Ã ◊“Œ¡€ «Õ¿◊≈Õ»≈ —À≈¬¿ ¡€ÀŒ “Œ√Œ ∆≈ «Õ¿ ¿
			IIIFKL=0
			IF(Rdet.GT.0.D0.AND.DetM(4).GT.0.D0) THEN
               DetM(5)=DetM(4)
	           DetM(4)=Rdet
			   ExfM(5)=ExfM(4)
               ExfM(4)=Exf
			   IIIFKL=1
			   ! ”¬≈À»◊»¬¿≈Ã ◊»—ÀŒ “Œ◊≈  œŒÀ”◊≈ÕÕ€’ ¬ ¡À»«» “Œ◊ » »«Ã≈Õ≈Õ»ﬂ «Õ¿ ¿
			   IKLRXX=IKLRXX+1
			   ! “Œ◊ ¿ Œœ–≈ƒ≈À≈Õ¿ ¬Œ«¬–¿Ÿ¿≈Ã »—’ŒƒÕŒ≈ «Õ¿◊≈Õ»≈  Œ––≈ “–»–”ﬁŸ≈√Œ ÃÕŒ∆»“≈Àﬂ
			   IOPZ=4 
			ENDIF
            IF(Rdet.LT.0.D0.AND.DetM(4).LT.0.D0) THEN
               DetM(5)=DetM(4)
	           DetM(4)=Rdet
			   ExfM(5)=ExfM(4)
               ExfM(4)=Exf
			   IIIFKL=1
			   ! ”¬≈À»◊»¬¿≈Ã ◊»—ÀŒ “Œ◊≈  œŒÀ”◊≈ÕÕ€’ ¬ ¡À»«» “Œ◊ » »«Ã≈Õ≈Õ»ﬂ «Õ¿ ¿
			   IKLRXX=IKLRXX+1
			   ! “Œ◊ ¿ Œœ–≈ƒ≈À≈Õ¿ ¬Œ«¬–¿Ÿ¿≈Ã »—’ŒƒÕŒ≈ «Õ¿◊≈Õ»≈  Œ––≈ “–»–”ﬁŸ≈√Œ ÃÕŒ∆»“≈Àﬂ
			   IOPZ=4 
			ENDIF
			IF(IIIFKL.EQ.0) THEN
               IOPZ=IOPZ*2
			ENDIF
			! ÕŒÃ≈– »“≈–¿÷»» ¬Œ«¬–¿Ÿ¿≈Ã Õ¿ 1 Õ¿«¿ƒ
			INDEXDF=INDEXDF-1
		 ENDIF
		
      ENDIF    
   ENDIF 

   
   IF(IndexVilky.EQ.2) THEN
      IF(INDEXDF.EQ.1) THEN
           DetMA(4)=DetMA(1)
           DetMA(1)=DetMA(2)
           DetMA(2)=DetMA(3)
           DetMA(3)=Rdet
	     ELSE
	       !  Œ–≈Õ‹ œŒœ¿À ¬ œ≈–¬€… »“≈–¬¿À
           IF(IIKK.EQ.1) THEN
              DetMA(2)=DetMA(3)
              DetMA(3)=Rdet
	       ENDIF
           !  Œ–≈Õ‹ œŒœ¿À ¬ ¬“Œ–Œ… »“≈–¬¿À
           IF(IIKK.EQ.2) THEN
              DetMA(1)=DetMA(3)
              DetMA(3)=Rdet
 	       ENDIF
      ENDIF
   ENDIF 
   		    
      
   ! œ–Œ¬Œƒ»Ã œŒ»—   Œ–Õ≈… Õ¿ ¬—≈Ã ›Õ≈–√»“»◊≈— ŒÃ »Õ“≈–¬¿À≈
   IF(IndexVilky.EQ.0) THEN
      ! œ–Œ¬Œƒ»Ã œ≈–≈¡Œ– «Õ¿◊≈Õ»… ›Õ≈–√»»
      IF(NEpsIter.EQ.1) THEN
	        ExfM(4)=Exf
            Exf=Exf*(1.D0-Henergy)
            ExfM(5)=Exf  
          ELSE
	       ! œ–Œ¬≈–ﬂ≈Ã œŒœ¿ƒ¿≈“ ŒƒÕŒ›À≈ “–ŒÕÕ¿ﬂ ›Õ≈–√»ﬂ ¬ ¬»À ” »À» Õ≈“ (Œœ–≈ƒ≈À≈Õ À» »Õ“≈–¬¿À ¬  Œ“Œ–ŒÃ Õ¿’Œƒ»“—ﬂ  Œ–≈Õ‹)
	       IF((DetM(4)*DetM(5)).LT.0.D0) THEN
	             IndexVilky=1 
				 ! œŒ— ŒÀ‹ ” »Õ“≈–¬¿À Œœ–≈ƒ≈À≈Õ «¿Õ”Àﬂ≈Ã ◊»—ÀŒ »“≈–¿÷»… ¬Õ≈ »Õ“≈–¬¿À¿ ƒÀﬂ ÕŒ¬Œ√Œ —À”◊¿ﬂ ¬Õ≈ »Õ“≈–¬¿À¿  
				 INDEXAD=0 
				 ! œŒ— ŒÀ‹ ” »Õ“≈–¬¿À Œœ–≈ƒ≈À≈Õ «¿Õ”Àﬂ≈Ã ◊»—ÀŒ »“≈–¿÷»… — ”Ã≈Õ‹ÿ≈ÕÕ€Ã ÿ¿√ŒÃ
				 INDEXRShag=0
				 ! Œ“ Àﬁ◊¿≈Ã  ŒÕ“–ŒÀ‹ — ¿◊ ¿
				 IIOXDPZ=0                            
			   ELSE
			     Exf=Exf*(1.D0-Henergy)
                 ExfM(1)=ExfM(2)
                 ExfM(2)=ExfM(3)
				 ExfM(3)=ExfM(4)
                 ExfM(4)=ExfM(5)
				 ExfM(5)=Exf  
           ENDIF      
	  ENDIF
   ENDIF
   
   ! ”—“¿ÕŒ¬À≈Õ¿ Œ¡À¿—“‹ œ≈–≈Ã≈Õ€ «Õ¿ ¿ 
   IF(IndexVilky.EQ.1) THEN
        ! œ–Œ¬≈–ﬂ≈Ã œ≈–≈Ã≈Õ¿ «Õ¿ ¿ —¬ﬂ«¿Õ¿ — ¬Œ«Õ» ÕŒ¬≈Õ≈Ã –¿«–€¬¿ ¬ ƒ¿ÕÕŒ… Œ¡À¿—“» »À» — Õ¿À»◊»≈Ã  Œ–Õﬂ
        ! »Õƒ≈ — ” ¿«€¬¿≈“, ◊“Œ ¬ ƒ¿ÕÕŒÃ –≈∆»Ã≈  œ–Œ√–¿ÃÃ¿ –¿¡Œ“¿≈“ ƒÀﬂ ƒ¿ÕÕŒ√Œ »Õ“≈–¬¿À¿ ¬ œ≈–¬€… –¿«
		INDEXDF=INDEXDF+1
		!  Àﬁ◊ ” ¿«€¬¿≈“ Õ¿ œ≈–≈Ã≈Õ” «Õ¿ ¿
		IKLPERZnak=0
        IF(INDEXDF.EQ.1) THEN
             Exf=Exf*(1.D0-Henergy/FLOAT(IndexCorrect+2))
             ExfM(1)=ExfM(2)
             ExfM(2)=ExfM(3)
		     ExfM(3)=ExfM(4)
             ExfM(4)=ExfM(5)
		     ExfM(5)=Exf  
			 ExfTemp=Exf 
			 ! ‘» —»–”≈Ã IOPZ ƒÀﬂ  Œ––≈ “»–Œ¬ »  Œ–Õ≈…
			 IOPZ=4  
			 ! ‘» —»–”≈Ã ◊»—ÀŒ “Œ◊≈   Œ“Œ–€≈ ¡€À» ”◊“≈Õ€ œ–» —”∆≈Õ»» Œ¡À¿—“» 
			 IKLRXX=0 
           ELSE   
             IF(DABS(DetM(5)).GT.DABS(DetM(4)).AND.DABS(DetM(2)).GT.DABS(DetM(3))) THEN
                 ! ‘» —»–”≈Ã “Œ“ ‘¿ “, ◊“Œ Œ¡Õ¿–”∆≈Õ  Œ–≈Õ‹
				 IKLPERZnak=1 
				 ! Œ¡Õ¿–”∆≈Õ »Õ“≈–¬¿À  Œ–Õﬂ 
                 IndexCorrect=IndexCorrect+1
                 ! »«Ã≈Õ≈Õ»≈ ÿ¿√¿ 
				 Henergy=Henergy/FLOAT(IndexCorrect+1)  
                 ! ƒ¿ÕÕ¿ﬂ œ≈–≈Ã≈Õ¿ «Õ¿ Œ¬ —¬ﬂ«¿Õ¿ — Õ¿À»◊»≈Ã –¿«–€¬¿
			     ! À»¡Œ  Œ–≈Õ‹ Õ¿…ƒ≈Õ œ–» ›“ŒÃ ¬—≈ –¿¬ÕŒ Õ”∆ÕŒ œ≈–≈…“» ¬ –≈∆»Ã ƒ¿À‹Õ≈…ÿ≈√Œ œŒ»— ¿
			     ! œ≈–≈’Œƒ»Ã ¬ –≈∆»Ã ƒ¿À‹Õ≈…ÿ≈√Œ œŒ»— ¿  Œ–Õ≈…
			     IndexVilky=0 
                 INDEXDF=0
				 Exf=ExfM(5) 
				ELSE
                  ! ”—“¿Õ¿¬À»¬¿≈Ã œ–»◊»Õ¿ ¬ –¿«–€¬≈ »À» Õ≈“
				  ! ¬€ﬂ—Õﬂ≈Ã —”Ÿ≈—“¬”≈“  Œ–≈Õ‹ »À» »Ã≈≈“ Ã≈—“Œ –¿«–€¬
				  ! œ–» ›“ŒÃ, ”—“¿Õ¿¬À»¬¿≈Ã “¿ Œ≈ œŒ¬≈ƒ≈Õ»≈ —¬ﬂ«¿ÕŒ —  ŒÀ≈¡¿Õ»ﬂÃ» ¬ Œ¡À¿—“» œ≈–≈Ã≈Õ€ «Õ¿ ¿
				  ! Œ—”Ÿ≈—“¬Àﬂ≈Ã —”∆≈Õ»≈ Œ¡À¿—“» œ≈–≈Ã≈Õ€ «Õ¿ ¿ ƒÀﬂ ¬Õ≈—≈Õ»ﬂ ﬂ—ÕŒ—“» ¬ œŒ¬≈ƒ≈Õ»» Œœ–≈ƒ≈À»“≈Àﬂ ¬ Œ¡À¿—“» Õ”Àﬂ
                   
				  IIIFKL=0
				  ! ”—“¿Õ¿¬À»¬¿≈Ã œ–»◊»Õ” Œ“—”“—“¬»ﬂ  Œ–Õﬂ
				  ! œ–Œ¬≈–ﬂ≈Ã ¬€œŒÀÕ≈Õ»≈ œ≈–¬Œ√Œ ”—ÀŒ¬»ﬂ
			      IF(DABS(DetM(5)).GT.DABS(DetM(4))) THEN
				     ! ¬“Œ–Œ≈ ”—ÀŒ¬»≈ Õ≈ ¬€œŒÀÕﬂ≈“—ﬂ 
					 ! œ–»¡À»∆¿≈“ «Õ¿◊≈Õ»≈    Œ–Õﬂﬁ (—œ–¿¬¿)     
				     IKLKORX=1
                     Exf=ExfM(3)-DABS(ExfM(3)-ExfM(4))/DBLE(IOPZ)
				     IIIFKL=1
				  ENDIF 
				  ! œ–Œ¬≈–ﬂ≈Ã ¬€œŒÀÕ≈Õ»≈ ¬“Œ–Œ√Œ ”—ÀŒ¬»ﬂ
				  IF(DABS(DetM(2)).GT.DABS(DetM(3))) THEN
				     ! œ≈–¬Œ≈ ”—ÀŒ¬»≈ Õ≈ ¬€œŒÀÕﬂ≈“—ﬂ 
					 ! œ–»¡À»∆¿≈“ «Õ¿◊≈Õ»≈    Œ–Õﬂﬁ (—À≈¬¿)     
				     IKLKORX=2
                     Exf=ExfM(4)+DABS(ExfM(3)-ExfM(4))/DBLE(IOPZ)
				     IIIFKL=1
				  ENDIF 
                  
				  ! œ–Œ¬≈–ﬂ≈Ã — ŒÀ‹ Œ –¿« œŒÀ”◊≈Õ¿ ÕŒ¬¿ﬂ “Œ◊ ¿ “Œ ≈—“‹ — ŒÀ‹ Œ –¿« Ã€ ”Ã≈Õ‹ÿ¿À» Œ¡À¿—“‹ œ≈–≈Ã≈Õ€ «Õ¿ ¿  
                  IF(IKLRXX.EQ.3) THEN
				     ! ◊»—ÀŒ “Œ◊≈  –¿¬ÕŒ “–≈Ã, œ–» ›“ŒÃ Õ≈ œ–Œ»«ŒÿÀŒ »«Ã≈Õ≈Õ»… ¬ œŒ¬≈ƒ≈Õ»» Œœ–≈ƒ≈À»“≈Àﬂ ¬ ¡À»«» “Œ◊ » œ≈–≈Ã≈Õ€ «Õ¿ ¿ 
					 ! “¿ »Ã Œ¡–¿«ŒÃ »Ã≈≈“ Ã≈—“Œ –¿«–€¬ 
					 IIIFKL=0 
				  ENDIF 
			
				  ! œ–Œ¬≈–ﬂ≈Ã »Ã≈≈“ Ã≈—“Œ –¿«–€¬ »À» Õ≈“ 
				  IF(IIIFKL.EQ.0) THEN
			         ! ƒ¿ÕÕ¿ﬂ œ≈–≈Ã≈Õ¿ «Õ¿ Œ¬ —¬ﬂ«¿Õ¿ — Õ¿À»◊»≈Ã –¿«–€¬¿
			         ! À»¡Œ  Œ–≈Õ‹ Õ¿…ƒ≈Õ œ–» ›“ŒÃ ¬—≈ –¿¬ÕŒ Õ”∆ÕŒ œ≈–≈…“» ¬ –≈∆»Ã ƒ¿À‹Õ≈…ÿ≈√Œ œŒ»— ¿
			         ! œ≈–≈’Œƒ»Ã ¬ –≈∆»Ã ƒ¿À‹Õ≈…ÿ≈√Œ œŒ»— ¿  Œ–Õ≈…
			         IndexVilky=0 
                     INDEXDF=0 
					 Exf=ExfM(5) 
				  ENDIF
			 ENDIF
		
		ENDIF 
        
        ! œ–Œ¬≈–ﬂ≈Ã ”—“¿ÕŒ¬À≈Õ ‘¿ “ Õ¿À»◊»ﬂ  Œ–Õﬂ »À» Õ≈“
		IF(IKLPERZnak.EQ.1) THEN
           ! œ–Œ¬≈–ﬂ≈Ã ¬€œŒÀÕ»ÀŒ—‹ À» ”—ÀŒ¬»≈
           ! ÕŒÃ≈– Õ¿…ƒ≈ÕŒ√Œ  Œ–Õﬂ œŒ œŒ–ﬂƒ ”(»Õ“≈–¬¿À¿ ¬  Œ“Œ–ŒÃ Õ¿’Œƒ»“—ﬂ  Œ–≈Õ‹) —ŒŒ“¬≈“—“¬”≈“ √À¿¬ÕŒÃ”  ¬¿Õ“Œ¬ŒÃ” ◊»—À”
           ISolution=0
           IF(IndexCorrect.EQ.(NNEL+1)) THEN
              ISolution=1
		   ENDIF
		   
		   
		   IF(ISolution.EQ.1) THEN
              ! ‘» —»–”≈Ã –≈∆»Ã œŒ»— ¿  Œ–Õﬂ ¬ »Õ“≈–¬¿À≈
		      IndexVilky=2 
		      !WRITE(*,*) 'ZERO',IndexVilky
		      !WRITE(*,*) DetM(5),DetM(4),DetM(2),DetM(3)
		      !WRITE(*,*) ExfM(5),ExfM(4),ExfM(2),ExfM(3)
		      !READ(*,*) 
		      ! «¿œ»—€¬¿≈Ã √–¿Õ»÷€ »Õ“≈–¬¿À¿ 
              ExfMA(2)=ExfM(4)
		      DetMA(2)=DetM(4)
		      ExfMA(3)=ExfM(3)
		      DetMA(3)=DetM(3)
		      !WRITE(*,*) DetM(2),DetM(3)
		      !WRITE(*,*) ExfM(2),ExfM(3)
		      !READ(*,*)   
		      ! «¿Õ”Àﬂ≈Ã œ≈–≈ƒ œŒ»— ŒÃ  Œ–Õﬂ
		      ExfMA(1)=0.D0
		      DetMA(1)=0.D0
		      ExfMA(4)=0.D0
              DetMA(4)=0.D0
		      ExfMA(5)=0.D0
		      DetMA(5)=0.D0
		      INDEXDF=0 
           ENDIF
        ENDIF 
	
		  		    
   ENDIF

   ! –≈∆»Ã œŒ»— ¿  Œ–Õﬂ ¬ »Õ“≈–¬¿À≈
   IF(IndexVilky.EQ.2) THEN 
      ! Œ—”Ÿ≈—“¬Àﬂ≈Ã œŒ»—   Œ–Õﬂ ¬ Õ¿…ƒ≈ÕŒÃ »Õ“≈–¬¿À≈
      INDEXDF=INDEXDF+1
      ! ƒÀﬂ œ≈–¬Œ√Œ –¿«¿ ” ¿«€¬¿≈Ã œ–»¡À»∆≈ÕÕ€…  Œ–≈Õ‹
	  IF(INDEXDF.EQ.1) THEN
           Exf=(DetMA(3)*ExfMA(2)-DetMA(2)*ExfMA(3))/(DetMA(3)-DetMA(2))
		   ExfMA(1)=ExfMA(2)
           ExfMA(2)=ExfMA(3)
		   ExfMA(3)=Exf
		 ELSE
           ! œ–Œ¬≈–ﬂ≈Ã ¬  ¿ ŒÃ »« ƒ¬”’ »Õ“≈–¬¿À¿’  Œ–≈Õ‹
		   ! œ≈–¬€… »Õ“≈–¬¿À
		   IF((DetMA(1)*DetMA(3)).LT.0.D0) THEN
               IIKK=1
		       Exf=(DetMA(3)*ExfMA(1)-DetMA(1)*ExfMA(3))/(DetMA(3)-DetMA(1))
			   ExfMA(2)=ExfMA(3)
               ExfMA(3)=Exf
		   ENDIF
		   ! ¬“Œ–Œ… »Õ“≈–¬¿À
           IF((DetMA(3)*DetMA(2)).LT.0.D0) THEN
		       IIKK=2
               Exf=(DetMA(2)*ExfMA(3)-DetMA(3)*ExfMA(2))/(DetMA(2)-DetMA(3))
		       ExfMA(1)=ExfMA(3)
               ExfMA(3)=Exf
		   ENDIF
      ENDIF		  		   
   

      ! œ–Œ¬≈–ﬂ≈Ã Õ¿…ƒ≈Õ  Œ–≈Õ‹ »À» Õ≈“
	  ! œ–Œ¬≈–ﬂ≈Ã ¬€œŒÀÕ»ÀŒ—‹ À» ”—ÀŒ¬»≈
      ! œ–Œ¬≈–ﬂ≈Ã «Õ¿◊≈Õ»≈ Œœ–≈ƒ≈À»“≈Àﬂ ŒÕŒ ƒŒÀ∆ÕŒ ¡€“‹ Ã≈Õ‹ÿ≈ “Œ◊ÕŒ—“»
      ! Õ¿◊»Õ¿≈Ã œ–Œ¬≈–ﬂ“‹ ”—ÀŒ¬»≈ ¬ —À”◊¿≈ Œ¡Õ¿–”∆≈Õ»ﬂ »Õ“≈–¬¿À¿ √ƒ≈ Õ¿’Œƒ»“—ﬂ  Œ–≈Õ‹
      IF(INDEXDF.GT.1) THEN
         IF(DABS(DetMA(3)).LT.EPS) THEN
            !  Œ–≈Õ‹ Õ¿…ƒ≈Õ 
			! ‘» —»–”≈Ã Õ¿…ƒ≈ÕÕ€…  Œ–≈Õ‹
			IndexSolutions=IndexSolutions+1
			! «¿œ»—€¬¿≈Ã Õ¿…ƒ≈ÕÕ€…  Œ–≈Õ‹
			ExfSolutions(IndexSolutions)=Exf
			! œ≈–≈’Œƒ»Ã ¬ –≈∆»Ã ƒ¿À‹Õ≈…ÿ≈√Œ œŒ»— ¿  Œ–Õ≈…
			IndexVilky=0 
            INDEXDF=0 
			Exf=ExfTemp 
			!write(6,*) 'kor',NNEL,IndexSolutions,ExfSolutions(IndexSolutions)
         ENDIF
      ENDIF 
	  
	  ! ¬€’Œƒ »« ÷» À¿ œŒ œŒ»— ”  Œ–Õ≈… œ–Œ»«Œ…ƒ≈“ œ–» ”—ÀŒ¬»»
	  IF(IndexSolutions.EQ.3) THEN
	     ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
   	     IparametrDeterEnergy=2 
	  ENDIF 
	   
   ENDIF
    

  
   !WRITE(*,*) 'ITERASTION ZERO'
   !write(*,10685)  NEpsIter,IndexVilky,IndexCorrect,NNEL
   !write(*,19685)  DetM(1),DetM(3),DetM(2)
   !write(*,19685)  ExfM(1),ExfM(3),ExfM(2)
   !write(*,19685)  Exf
   !read(*,*)
   return
 end subroutine SearchSolutionAcceleratedLeft

 ! œŒƒœ–Œ√–¿ÃÃ¿ Œ—”Ÿ≈—“¬ÀﬂﬁŸ¿ﬂ œŒ»—  »Õ“≈–¬¿À¿ Õ”∆ÕŒ√Œ  Œ–Õﬂ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»» ’¿–“–»-‘Œ ¿ ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À» ƒÀﬂ —À”◊¿ﬂ œŒ»— ¿  Œ–Õ≈… —À≈¬¿
 ! NNEL- √À¿¬ÕŒ≈  ¬¿Õ“Œ¬Œ≈ ◊»—ÀŒ
 ! NEpsIter-ÕŒÃ≈– »“≈–¿÷»» ƒÀﬂ œŒÀ”◊≈Õ»ﬂ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»
 ! Kpoint-“Œ◊ ¿ —ÿ»¬ »
 ! IndexM-–¿«Ã≈– Ã¿——»¬¿
 ! Vout(IndexM,IndexM,Npoint)- Ã¿——»¬ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » "Õ¿–”∆”"
 ! Vin(IndexM,IndexM,Npoint)- Ã¿——»¬ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ » "¬Õ”“–‹"
 ! DetM-Ã¿——»¬ «Õ¿◊≈Õ»… ƒ≈“≈–Ã»Õ¿Õ“¿
 ! ExfM-Ã¿——»¬ «Õ¿◊≈Õ»… ŒƒÕŒ›À≈ “–ŒÕÕŒ… ‘”Õ ÷»»
 ! DetMA-Ã¿——»¬ «Õ¿◊≈Õ»… ƒ≈“≈–Ã»Õ¿Õ“¿ ƒÀﬂ œŒ»— ¿  Œ–Õﬂ
 ! ExfMA-Ã¿——»¬ «Õ¿◊≈Õ»… ŒƒÕŒ›À≈ “–ŒÕÕŒ… ‘”Õ ÷»» ƒÀﬂ œŒ»— ¿  Œ–Õﬂ
 ! Exf-ŒƒÕŒ›À≈ “–ŒÕÕ¿ﬂ ›Õ≈–√»ﬂ
 ! DeltaEnergy-–¿«Õ»÷¿ Ã≈∆ƒ” ŒƒÕŒ›À≈ “–ŒÕÕ€Ã» ‘”Õ ÷»ﬂÃ»
 ! AZ,BZ,E-¬—œŒÃŒ√¿“≈À‹Õ€≈ Ã¿——»¬€
 ! Henergy-¯‡„ ÔÓ Ó‰ÌÓ˝ÎÂÍÚÓÌÌÓÈ ˝ÌÂ„ËË (œŒ—À≈ Œ ŒÕ◊¿Õ»ﬂ œ–Œ√–¿ÃÃ€ ƒ¿≈“ Õ”À»¬Œ≈ œ–»¡À»∆≈Õ»≈ ƒÀﬂ  Œ–Õﬂ)
 ! IparametrDeterEnergy-œ¿–¿Ã≈“– ¬€’Œƒ¿ »« ÷» À¿ œŒ ”“Œ◊Õ≈Õ»ﬁ ŒƒÕŒ›À≈ “–ŒÕÕŒ… ›Õ≈–√»»
 ! EPS-“Œ◊ÕŒ—“‹
 ! IndexVilky-»Õƒ≈ — ” ¿«€¬¿ﬁŸ»… Õ¿ “Œ ◊“Œ Œœ–≈ƒ≈À≈Õ »Õ“≈–¬¿À ¬  Œ“Œ–ŒÃ Õ¿’Œƒ»“—ﬂ  Œ–≈Õ‹
 ! IndexVilky=0-»Õ“≈–¬¿À Õ≈ Œœ–≈ƒ≈À≈Õ
 ! IndexVilky=1-»Õ“≈–¬¿À Œœ–≈ƒ≈À≈Õ 
 ! IndexVilky=2-–≈∆»Ã œŒ»— ¿  Œ–Õﬂ 
 ! INDEXDF-»Õƒ≈ — ” ¿«€¬¿ﬁŸ»… ◊»—ÀŒ »“≈–¿÷»… —ƒ≈À¿ÕÕ€’ œŒ—À≈ œŒœ¿ƒ¿Õ»ﬂ ¬ ¬»À ”
 ! IndexCorrect-»Õƒ≈ — ” ¿«€¬¿ﬁŸ»… ◊»—ÀŒ  Œ–Õ≈… Õ¿…ƒ≈ÕÕ€’ Õ¿ ¬—≈Ã »Õ“≈–¬¿À≈  
 ! IndexSolutions-»Õƒ≈ — ◊»—À¿ –≈ÿ≈Õ»≈, Õ≈Œ¡’Œƒ»ÃŒ Õ¿…“» –≈ÿ≈Õ»ﬂ ƒÀﬂ NNEL-1, NNEL, NNEL+1, “Œ ≈—“‹ ƒÀﬂ ¬€’Œƒ¿ 
 ! Õ≈Œ¡’Œƒ»ÃŒ, ◊“Œ¡€ IndexSolutions=3 
 ! ExfSolutions(IndexSolutions)-›Õ≈–√»» Õ¿…ƒ≈ÕÕ€’  Œ–Õ≈…  NNEL-1, NNEL, NNEL+1
 ! ExfTemp-¬—œŒÃŒ√¿“≈À‹Õ¿ﬂ œ≈–≈Ã≈ÕÕ¿ﬂ
 ! IKLKORX,IOPZ,IKLRXX-»Õƒ≈ —€  Œ––≈ “»–Œ¬ » ƒÀﬂ ”—“¿Õ¿¬À≈Õ»ﬂ  Œ–≈Õ‹ »À» –¿«–€¬
 ! INDEXAD-»Õƒ≈ — ” ¿«€¬¿ﬁŸ»… ◊»—ÀŒ »“≈–¿÷»… —ƒ≈À¿ÕÕ€’ ¬ —À”◊¿≈  Œ√ƒ¿ »Õ“≈–¬¿À Õ≈Œœ–≈ƒ≈À≈Õ 
 ! RcoffChengH- Œ›‘‘»÷»≈Õ“ »«Ã≈Õ≈Õ»ﬂ ÿ¿√¿
 ! ProDet(2)-Ã¿——»¬ œ–Œ»«¬ŒƒÕ€’
 ! INDEXRShag-–≈∆»Ã »«Ã≈Õ≈Õ»ﬂ ÿ¿√¿
 ! INDEXGRNYT- Àﬁ◊ ¬€’Œƒ¿
 ! INDEXSHAA-” ¿«€¬¿≈“ Ã¿ —»Ã¿À‹ÕŒ≈ ◊»—ÀŒ ÿ¿√Œ¬ 
 ! IIHD-»Õƒ≈ — ”Ã≈Õ‹ÿ≈Õ»ﬂ ÿ¿√¿
 ! IIOXDPZ- Àﬁ◊ ” ¿«€¬¿ﬁŸ»… ◊“Œ Ã€ œŒœ¿À» ¬ –≈∆»Ã ”Ã≈Õ‹ÿ≈Õ»ﬂ ÿ¿√¿ »  ŒÕ“–ŒÀ»–”≈Ã ¬Œ«ÃŒ∆ÕŒ—“‹ œ≈–≈— Œ ¿
 ! INDEXPeresc-»Õƒ≈ — ” ¿«€¬¿ﬁŸ»… ◊¿—“» »“≈–¿÷»… ¬ –≈∆»Ã≈ ¬Œ«ÃŒ∆ÕŒ√Œ œ≈–≈— Œ ¿
 ! DeltaEnerPers-»Õ“≈–¬¿À ›Õ≈–√»… ¬ Œ¡À¿—“» œ≈–≈— Œ ¿
 ! DeltaFunPers-»Õ“≈–¬¿À ‘”Õ ÷»… ¬ Œ¡À¿—“» œ≈–≈— Œ ¿ 
 subroutine SearchSolutionAcceleratedLeft2(NNEL,NEpsIter,Kpoint,IndexM,Vout,Vin,DetM,ExfM,DetMA,ExfMA,Exf,AZ,BZ,E,Henergy,IparametrDeterEnergy,EPS,IndexVilky,INDEXDF,IIKK,IndexCorrect,IndexSolutions,ExfSolutions,ExfTemp,IKLKORX,IOPZ,IKLRXX,INDEXAD,RcoffChengH,ProDet,INDEXRShag,INDEXGRNYT,INDEXSHAA,IIHD,IIOXDPZ,INDEXPeresc,DeltaEnerPers,DeltaFunPers)
   implicit none
   integer::NNEL,NEpsIter,Kpoint,IndexM,IparametrDeterEnergy,IndexVilky,INDEXDF,IIKK,IndexCorrect,IndexSolutions,IKLKORX,IOPZ,IKLRXX,INDEXAD,INDEXRShag,INDEXGRNYT,INDEXSHAA,IIHD,IIOXDPZ,INDEXPeresc
   real(8)::Exf,Henergy,EPS,ExfTemp,RcoffChengH,DeltaEnerPers,DeltaFunPers
   real(8),dimension(:)::DetM,ExfM,DetMA,ExfMA,ExfSolutions,ProDet
   real(8),dimension(:,:)::AZ,BZ,E
   real(8),dimension(:,:,:)::Vout,Vin
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! 
   integer::IIDD,IBBB,IIII,klkl,IKLPERZnak,ISolution,IIIFKL,IKLCOMBEC
   real(8)::DeltaEnergy,DDD,Kcoff,RcoffGran,DMtemp,Rdet
   !real(8)::DeltaEnergy,RnormConstas,Kcoff,RcoffGran,ExfTemp,DMtemp,DDD
   ! Œœ–≈ƒ≈Àﬂ≈Ã ƒ≈“≈–Ã»Õ¿Õ“ —»—“≈Ã€
   call ReadWriteMassiv2(2,Kpoint,IndexM,Vout,AZ) 
   call ReadWriteMassiv2(2,Kpoint+1,IndexM,Vin,BZ) 
   10685 FORMAT(2X,100(I4,1X))
   19685 FORMAT(2X,100(F20.12,1X))

   ! ‘Œ–Ã»–”≈Ã ≈ƒ»Õ»◊Õ”ﬁ Ã¿“–»÷”
   E=0.D0
   DO IIDD=1,IndexM
      E(IIDD,IIDD)=1.D0
   ENDDO
   
   ! ‘Œ–Ã»–”≈Ã Ã¿“–»÷” —»—“≈Ã€
   !WRITE(100,*) 'E'
   !DO IIDD=1,IndexM
   !   WRITE(100,19345 ) (E(IIDD,IBBB),IBBB=1,IndexM)
   !ENDDO
   !WRITE(100,*) 'AZ'
   !DO IIDD=1,IndexM
   !   WRITE(100,19345 ) (AZ(IIDD,IBBB),IBBB=1,IndexM)
   !ENDDO 
   !WRITE(100,*) 'BZ'
   !DO IIDD=1,IndexM
   !   WRITE(100,19345 ) (BZ(IIDD,IBBB),IBBB=1,IndexM)
   !ENDDO
   E=E-MATMUL(AZ,BZ)
   !WRITE(100,*) 'E'
   !DO IIDD=1,IndexM
   !   WRITE(100,19345 ) (E(IIDD,IBBB),IBBB=1,IndexM)
   !ENDDO
   ! «¿œ»—€¬¿≈Ã –≈«”À‹“¿“ –¿—◊≈“¿
   ! Œœ–≈ƒ≈Àﬂ≈Ã ƒ≈“≈–Ã»Õ¿Õ“ —»—“≈Ã€
   Rdet=Determenant(E)

   WRITE(17,*) Exf,Rdet,RcoffChengH
   
  
  
   
   ! «¿œ»—€¬¿≈Ã –≈«”À‹“¿“ –¿—◊≈“¿
   IF(IndexVilky.EQ.0) THEN
        IF(NEpsIter.EQ.1) THEN
           DetM(4)=Rdet
		ENDIF
        IF(NEpsIter.EQ.2) THEN
           DetM(5)=Rdet
		ENDIF
        IF(NEpsIter.NE.1.AND.NEpsIter.NE.2) THEN
            DetM(1)=DetM(2)
			DetM(2)=DetM(3)
            DetM(3)=DetM(4)
            DetM(4)=DetM(5)
            DetM(5)=Rdet
        ENDIF

		! »Õƒ≈ — ‘» —»–”ﬁŸ»… ◊»—ÀŒ »“≈–¿÷»… ¬ —À”◊¿≈  Œ√ƒ¿ »Õ“≈–¬¿À Õ≈Œœ–≈ƒ≈À≈Õ
		INDEXAD=INDEXAD+1
		! ¬ Õ¿◊¿À≈ ¬Œ«¬–¿Ÿ¿≈Ã—ﬂ   œ–≈ƒ€ƒ”Ÿ≈Ã” ÿ¿√” ”¡»–¿≈Ã  Œ›‘‘»÷»≈Õ“ œŒÀ”◊≈ÕÕ€… ¬ œ–≈ƒ≈ƒ”Ÿ≈Ã »Õ“≈–¬¿À≈ 
		IF(INDEXAD.EQ.4) THEN
		   Henergy=Henergy*RcoffChengH
        ENDIF 
		! Õ¿◊»Õ¿≈Ã  Œ––≈ “»–Œ¬¿“‹ ÿ¿√ 
		IF(INDEXAD.EQ.5) THEN
		   ! ¬Œ«¬–¿Ÿ¿≈Ã  Œ›‘‘»÷»≈Õ“ ¬ »—’ŒƒÕŒ≈ —Œ—“ŒﬂÕ»≈
		   RcoffChengH=1.D0
           ProDet(1)=DABS(DetM(5)*(1.D0-DetM(4)/DetM(5))/(ExfM(5)*(1.D0-ExfM(4)/ExfM(5))))
		ENDIF
	    IF(INDEXAD.EQ.6) THEN
           ProDet(2)=DABS(DetM(5)*(1.D0-DetM(4)/DetM(5))/(ExfM(5)*(1.D0-ExfM(4)/ExfM(5))))
		ENDIF
		IF(INDEXAD.GT.6) THEN
           ProDet(1)=ProDet(2)
           ProDet(2)=DABS(DetM(5)*(1.D0-DetM(4)/DetM(5))/(ExfM(5)*(1.D0-ExfM(4)/ExfM(5))))
		   ! Œ—”Ÿ≈—“¬Àﬂ≈Ã –¿—◊≈“  Œ›‘‘»÷»≈Õ“¿ » »«Ã≈Õ≈Õ»≈ ÿ¿√¿
		   call ChangeHR(INDEXRShag,IKLCOMBEC,IIHD,IIOXDPZ,IndexCorrect,Henergy,RcoffChengH,ExfM,ProDet,DetM,INDEXPeresc,DeltaEnerPers,DeltaFunPers)
		   ! œ–Œ¬≈–ﬂ≈Ã œ≈–≈’Œƒ ¬ –≈∆»Ã ”Ã≈Õ‹ÿ≈Õ»ﬂ ÿ¿√¿
		   IF(IKLCOMBEC.EQ.1) THEN
              ! ¬Œ«¬–¿Ÿ¿≈Ã—ﬂ Õ¿ ŒƒÕ” “Œ◊ ” Õ¿«¿ƒ
              Exf=ExfM(4)
			  ExfM(5)=ExfM(4)
              ExfM(4)=ExfM(3)
              ExfM(3)=ExfM(2)
              ExfM(2)=ExfM(1)
              DetM(5)=DetM(4)
              DetM(4)=DetM(3)
              DetM(3)=DetM(2)
              DetM(2)=DetM(1)   
		   ENDIF
		ENDIF

		! ¬€’Œƒ ¡”ƒ≈“ œŒ—À≈ 150 ÿ¿√Œ¬ ¬ ƒ¿ÕÕŒÃ –≈∆»Ã≈
		INDEXSHAA=INDEXSHAA+1
		IF(INDEXSHAA.GT.150) THEN
		   ! Œ—”Ÿ≈—“¬»“‹ ¬€’Œƒ
		   INDEXGRNYT=1
		   ! ‘» —»–”≈Ã Õ¿…ƒ≈ÕÕ€…  Œ–≈Õ‹
		   IndexSolutions=IndexSolutions+1
		   ! «¿œ»—€¬¿≈Ã Õ¿…ƒ≈ÕÕ€…  Œ–≈Õ‹
		   ExfSolutions(IndexSolutions)=Exf  
		   ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
   	       IparametrDeterEnergy=2 
		ENDIF 
   ENDIF

   IF(IndexVilky.EQ.1) THEN	
      IF(INDEXDF.EQ.1) THEN 
         DetM(1)=DetM(2)
	     DetM(2)=DetM(3)
         DetM(3)=DetM(4)
         DetM(4)=DetM(5)
         DetM(5)=Rdet
      ENDIF  
	  IF(INDEXDF.EQ.2) THEN 
         ! œ–Œ¬≈–ﬂ≈Ã  ¿ Œ… »« –≈∆»ÃŒ¬ ¬ Àﬁ◊≈Õ
		 IF(IKLKORX.EQ.1) THEN
            !  Œ––≈ “»–Œ¬ ¿ —œ–¿¬¿
            ! œ–Œ¬≈–ﬂ≈Ã ◊“Œ¡€ «Õ¿◊≈Õ»≈ —œ–¿¬¿ ¡€ÀŒ “Œ√Œ ∆≈ «Õ¿ ¿
			IIIFKL=0
			IF(Rdet.GT.0.D0.AND.DetM(3).GT.0.D0) THEN
               DetM(1)=DetM(2)
	           DetM(2)=DetM(3)
			   DetM(3)=Rdet
               ExfM(1)=ExfM(2)
               ExfM(2)=ExfM(3)
			   ExfM(3)=Exf
			   IIIFKL=1
			   ! ”¬≈À»◊»¬¿≈Ã ◊»—ÀŒ “Œ◊≈  œŒÀ”◊≈ÕÕ€’ ¬ ¡À»«» “Œ◊ » »«Ã≈Õ≈Õ»ﬂ «Õ¿ ¿
			   IKLRXX=IKLRXX+1
			   ! “Œ◊ ¿ Œœ–≈ƒ≈À≈Õ¿ ¬Œ«¬–¿Ÿ¿≈Ã »—’ŒƒÕŒ≈ «Õ¿◊≈Õ»≈  Œ––≈ “–»–”ﬁŸ≈√Œ ÃÕŒ∆»“≈Àﬂ
			   IOPZ=4 
			ENDIF
            IF(Rdet.LT.0.D0.AND.DetM(3).LT.0.D0) THEN
               DetM(1)=DetM(2)
	           DetM(2)=DetM(3)
			   DetM(3)=Rdet
               ExfM(1)=ExfM(2)
               ExfM(2)=ExfM(3)
			   ExfM(3)=Exf
			   IIIFKL=1
			   ! ”¬≈À»◊»¬¿≈Ã ◊»—ÀŒ “Œ◊≈  œŒÀ”◊≈ÕÕ€’ ¬ ¡À»«» “Œ◊ » »«Ã≈Õ≈Õ»ﬂ «Õ¿ ¿
			   IKLRXX=IKLRXX+1
			   ! “Œ◊ ¿ Œœ–≈ƒ≈À≈Õ¿ ¬Œ«¬–¿Ÿ¿≈Ã »—’ŒƒÕŒ≈ «Õ¿◊≈Õ»≈  Œ––≈ “–»–”ﬁŸ≈√Œ ÃÕŒ∆»“≈Àﬂ
			   IOPZ=4 
			ENDIF
			IF(IIIFKL.EQ.0) THEN
               IOPZ=IOPZ*2
			ENDIF
			! ÕŒÃ≈– »“≈–¿÷»» ¬Œ«¬–¿Ÿ¿≈Ã Õ¿ 1 Õ¿«¿ƒ
			INDEXDF=INDEXDF-1
		 ENDIF
         IF(IKLKORX.EQ.2) THEN
            !  Œ––≈ “»–Œ¬ ¿ —À≈¬¿
            ! œ–Œ¬≈–ﬂ≈Ã ◊“Œ¡€ «Õ¿◊≈Õ»≈ —À≈¬¿ ¡€ÀŒ “Œ√Œ ∆≈ «Õ¿ ¿
			IIIFKL=0
			IF(Rdet.GT.0.D0.AND.DetM(4).GT.0.D0) THEN
               DetM(5)=DetM(4)
	           DetM(4)=Rdet
			   ExfM(5)=ExfM(4)
               ExfM(4)=Exf
			   IIIFKL=1
			   ! ”¬≈À»◊»¬¿≈Ã ◊»—ÀŒ “Œ◊≈  œŒÀ”◊≈ÕÕ€’ ¬ ¡À»«» “Œ◊ » »«Ã≈Õ≈Õ»ﬂ «Õ¿ ¿
			   IKLRXX=IKLRXX+1
			   ! “Œ◊ ¿ Œœ–≈ƒ≈À≈Õ¿ ¬Œ«¬–¿Ÿ¿≈Ã »—’ŒƒÕŒ≈ «Õ¿◊≈Õ»≈  Œ––≈ “–»–”ﬁŸ≈√Œ ÃÕŒ∆»“≈Àﬂ
			   IOPZ=4 
			ENDIF
            IF(Rdet.LT.0.D0.AND.DetM(4).LT.0.D0) THEN
               DetM(5)=DetM(4)
	           DetM(4)=Rdet
			   ExfM(5)=ExfM(4)
               ExfM(4)=Exf
			   IIIFKL=1
			   ! ”¬≈À»◊»¬¿≈Ã ◊»—ÀŒ “Œ◊≈  œŒÀ”◊≈ÕÕ€’ ¬ ¡À»«» “Œ◊ » »«Ã≈Õ≈Õ»ﬂ «Õ¿ ¿
			   IKLRXX=IKLRXX+1
			   ! “Œ◊ ¿ Œœ–≈ƒ≈À≈Õ¿ ¬Œ«¬–¿Ÿ¿≈Ã »—’ŒƒÕŒ≈ «Õ¿◊≈Õ»≈  Œ––≈ “–»–”ﬁŸ≈√Œ ÃÕŒ∆»“≈Àﬂ
			   IOPZ=4 
			ENDIF
			IF(IIIFKL.EQ.0) THEN
               IOPZ=IOPZ*2
			ENDIF
			! ÕŒÃ≈– »“≈–¿÷»» ¬Œ«¬–¿Ÿ¿≈Ã Õ¿ 1 Õ¿«¿ƒ
			INDEXDF=INDEXDF-1
		 ENDIF
		
      ENDIF    
   ENDIF 

   
   IF(IndexVilky.EQ.2) THEN
      IF(INDEXDF.EQ.1) THEN
           DetMA(4)=DetMA(1)
           DetMA(1)=DetMA(2)
           DetMA(2)=DetMA(3)
           DetMA(3)=Rdet
	     ELSE
	       !  Œ–≈Õ‹ œŒœ¿À ¬ œ≈–¬€… »“≈–¬¿À
           IF(IIKK.EQ.1) THEN
              DetMA(2)=DetMA(3)
              DetMA(3)=Rdet
	       ENDIF
           !  Œ–≈Õ‹ œŒœ¿À ¬ ¬“Œ–Œ… »“≈–¬¿À
           IF(IIKK.EQ.2) THEN
              DetMA(1)=DetMA(3)
              DetMA(3)=Rdet
 	       ENDIF
      ENDIF
   ENDIF 
   		    
      
   ! œ–Œ¬Œƒ»Ã œŒ»—   Œ–Õ≈… Õ¿ ¬—≈Ã ›Õ≈–√»“»◊≈— ŒÃ »Õ“≈–¬¿À≈
   IF(IndexVilky.EQ.0) THEN
      ! œ–Œ¬Œƒ»Ã œ≈–≈¡Œ– «Õ¿◊≈Õ»… ›Õ≈–√»»
      IF(NEpsIter.EQ.1) THEN
	        ExfM(4)=Exf
            Exf=Exf*(1.D0-Henergy)
            ExfM(5)=Exf  
          ELSE
	       ! œ–Œ¬≈–ﬂ≈Ã œŒœ¿ƒ¿≈“ ŒƒÕŒ›À≈ “–ŒÕÕ¿ﬂ ›Õ≈–√»ﬂ ¬ ¬»À ” »À» Õ≈“ (Œœ–≈ƒ≈À≈Õ À» »Õ“≈–¬¿À ¬  Œ“Œ–ŒÃ Õ¿’Œƒ»“—ﬂ  Œ–≈Õ‹)
	       IF((DetM(4)*DetM(5)).LT.0.D0) THEN
	             IndexVilky=1 
				 ! œŒ— ŒÀ‹ ” »Õ“≈–¬¿À Œœ–≈ƒ≈À≈Õ «¿Õ”Àﬂ≈Ã ◊»—ÀŒ »“≈–¿÷»… ¬Õ≈ »Õ“≈–¬¿À¿ ƒÀﬂ ÕŒ¬Œ√Œ —À”◊¿ﬂ ¬Õ≈ »Õ“≈–¬¿À¿  
				 INDEXAD=0 
				 ! œŒ— ŒÀ‹ ” »Õ“≈–¬¿À Œœ–≈ƒ≈À≈Õ «¿Õ”Àﬂ≈Ã ◊»—ÀŒ »“≈–¿÷»… — ”Ã≈Õ‹ÿ≈ÕÕ€Ã ÿ¿√ŒÃ
				 INDEXRShag=0  
				 ! Œ“ Àﬁ◊¿≈Ã  ŒÕ“–ŒÀ‹ — ¿◊ ¿
				 IIOXDPZ=0                          
			   ELSE
			     Exf=Exf*(1.D0-Henergy)
                 ExfM(1)=ExfM(2)
                 ExfM(2)=ExfM(3)
				 ExfM(3)=ExfM(4)
                 ExfM(4)=ExfM(5)
				 ExfM(5)=Exf  
           ENDIF      
	  ENDIF
   ENDIF
   
   ! ”—“¿ÕŒ¬À≈Õ¿ Œ¡À¿—“‹ œ≈–≈Ã≈Õ€ «Õ¿ ¿ 
   IF(IndexVilky.EQ.1) THEN
        ! œ–Œ¬≈–ﬂ≈Ã œ≈–≈Ã≈Õ¿ «Õ¿ ¿ —¬ﬂ«¿Õ¿ — ¬Œ«Õ» ÕŒ¬≈Õ≈Ã –¿«–€¬¿ ¬ ƒ¿ÕÕŒ… Œ¡À¿—“» »À» — Õ¿À»◊»≈Ã  Œ–Õﬂ
        ! »Õƒ≈ — ” ¿«€¬¿≈“, ◊“Œ ¬ ƒ¿ÕÕŒÃ –≈∆»Ã≈  œ–Œ√–¿ÃÃ¿ –¿¡Œ“¿≈“ ƒÀﬂ ƒ¿ÕÕŒ√Œ »Õ“≈–¬¿À¿ ¬ œ≈–¬€… –¿«
		INDEXDF=INDEXDF+1
		!  Àﬁ◊ ” ¿«€¬¿≈“ Õ¿ œ≈–≈Ã≈Õ” «Õ¿ ¿
		IKLPERZnak=0
        IF(INDEXDF.EQ.1) THEN
             Exf=Exf*(1.D0-Henergy/FLOAT(IndexCorrect+2))
             ExfM(1)=ExfM(2)
             ExfM(2)=ExfM(3)
		     ExfM(3)=ExfM(4)
             ExfM(4)=ExfM(5)
		     ExfM(5)=Exf  
			 ExfTemp=Exf 
			 ! ‘» —»–”≈Ã IOPZ ƒÀﬂ  Œ––≈ “»–Œ¬ »  Œ–Õ≈…
			 IOPZ=4  
			 ! ‘» —»–”≈Ã ◊»—ÀŒ “Œ◊≈   Œ“Œ–€≈ ¡€À» ”◊“≈Õ€ œ–» —”∆≈Õ»» Œ¡À¿—“» 
			 IKLRXX=0 
           ELSE   
             IF(DABS(DetM(5)).GT.DABS(DetM(4)).AND.DABS(DetM(2)).GT.DABS(DetM(3))) THEN
                 ! ‘» —»–”≈Ã “Œ“ ‘¿ “, ◊“Œ Œ¡Õ¿–”∆≈Õ  Œ–≈Õ‹
				 IKLPERZnak=1 
				 ! Œ¡Õ¿–”∆≈Õ »Õ“≈–¬¿À  Œ–Õﬂ 
                 IndexCorrect=IndexCorrect+1
                 ! »«Ã≈Õ≈Õ»≈ ÿ¿√¿ 
				 Henergy=Henergy/FLOAT(IndexCorrect+1)  
                 ! ƒ¿ÕÕ¿ﬂ œ≈–≈Ã≈Õ¿ «Õ¿ Œ¬ —¬ﬂ«¿Õ¿ — Õ¿À»◊»≈Ã –¿«–€¬¿
			     ! À»¡Œ  Œ–≈Õ‹ Õ¿…ƒ≈Õ œ–» ›“ŒÃ ¬—≈ –¿¬ÕŒ Õ”∆ÕŒ œ≈–≈…“» ¬ –≈∆»Ã ƒ¿À‹Õ≈…ÿ≈√Œ œŒ»— ¿
			     ! œ≈–≈’Œƒ»Ã ¬ –≈∆»Ã ƒ¿À‹Õ≈…ÿ≈√Œ œŒ»— ¿  Œ–Õ≈…
			     IndexVilky=0 
                 INDEXDF=0
				 Exf=ExfM(5) 
				ELSE
                  ! ”—“¿Õ¿¬À»¬¿≈Ã œ–»◊»Õ¿ ¬ –¿«–€¬≈ »À» Õ≈“
				  ! ¬€ﬂ—Õﬂ≈Ã —”Ÿ≈—“¬”≈“  Œ–≈Õ‹ »À» »Ã≈≈“ Ã≈—“Œ –¿«–€¬
				  ! œ–» ›“ŒÃ, ”—“¿Õ¿¬À»¬¿≈Ã “¿ Œ≈ œŒ¬≈ƒ≈Õ»≈ —¬ﬂ«¿ÕŒ —  ŒÀ≈¡¿Õ»ﬂÃ» ¬ Œ¡À¿—“» œ≈–≈Ã≈Õ€ «Õ¿ ¿
				  ! Œ—”Ÿ≈—“¬Àﬂ≈Ã —”∆≈Õ»≈ Œ¡À¿—“» œ≈–≈Ã≈Õ€ «Õ¿ ¿ ƒÀﬂ ¬Õ≈—≈Õ»ﬂ ﬂ—ÕŒ—“» ¬ œŒ¬≈ƒ≈Õ»» Œœ–≈ƒ≈À»“≈Àﬂ ¬ Œ¡À¿—“» Õ”Àﬂ
                   
				  IIIFKL=0
				  ! ”—“¿Õ¿¬À»¬¿≈Ã œ–»◊»Õ” Œ“—”“—“¬»ﬂ  Œ–Õﬂ
				  ! œ–Œ¬≈–ﬂ≈Ã ¬€œŒÀÕ≈Õ»≈ œ≈–¬Œ√Œ ”—ÀŒ¬»ﬂ
			      IF(DABS(DetM(5)).GT.DABS(DetM(4))) THEN
				     ! ¬“Œ–Œ≈ ”—ÀŒ¬»≈ Õ≈ ¬€œŒÀÕﬂ≈“—ﬂ 
					 ! œ–»¡À»∆¿≈“ «Õ¿◊≈Õ»≈    Œ–Õﬂﬁ (—œ–¿¬¿)     
				     IKLKORX=1
                     Exf=ExfM(3)-DABS(ExfM(3)-ExfM(4))/DBLE(IOPZ)
				     IIIFKL=1
				  ENDIF 
				  ! œ–Œ¬≈–ﬂ≈Ã ¬€œŒÀÕ≈Õ»≈ ¬“Œ–Œ√Œ ”—ÀŒ¬»ﬂ
				  IF(DABS(DetM(2)).GT.DABS(DetM(3))) THEN
				     ! œ≈–¬Œ≈ ”—ÀŒ¬»≈ Õ≈ ¬€œŒÀÕﬂ≈“—ﬂ 
					 ! œ–»¡À»∆¿≈“ «Õ¿◊≈Õ»≈    Œ–Õﬂﬁ (—À≈¬¿)     
				     IKLKORX=2
                     Exf=ExfM(4)+DABS(ExfM(3)-ExfM(4))/DBLE(IOPZ)
				     IIIFKL=1
				  ENDIF 
                  
				  ! œ–Œ¬≈–ﬂ≈Ã — ŒÀ‹ Œ –¿« œŒÀ”◊≈Õ¿ ÕŒ¬¿ﬂ “Œ◊ ¿ “Œ ≈—“‹ — ŒÀ‹ Œ –¿« Ã€ ”Ã≈Õ‹ÿ¿À» Œ¡À¿—“‹ œ≈–≈Ã≈Õ€ «Õ¿ ¿  
                  IF(IKLRXX.EQ.3) THEN
				     ! ◊»—ÀŒ “Œ◊≈  –¿¬ÕŒ “–≈Ã, œ–» ›“ŒÃ Õ≈ œ–Œ»«ŒÿÀŒ »«Ã≈Õ≈Õ»… ¬ œŒ¬≈ƒ≈Õ»» Œœ–≈ƒ≈À»“≈Àﬂ ¬ ¡À»«» “Œ◊ » œ≈–≈Ã≈Õ€ «Õ¿ ¿ 
					 ! “¿ »Ã Œ¡–¿«ŒÃ »Ã≈≈“ Ã≈—“Œ –¿«–€¬ 
					 IIIFKL=0 
				  ENDIF 
			
				  ! œ–Œ¬≈–ﬂ≈Ã »Ã≈≈“ Ã≈—“Œ –¿«–€¬ »À» Õ≈“ 
				  IF(IIIFKL.EQ.0) THEN
			         ! ƒ¿ÕÕ¿ﬂ œ≈–≈Ã≈Õ¿ «Õ¿ Œ¬ —¬ﬂ«¿Õ¿ — Õ¿À»◊»≈Ã –¿«–€¬¿
			         ! À»¡Œ  Œ–≈Õ‹ Õ¿…ƒ≈Õ œ–» ›“ŒÃ ¬—≈ –¿¬ÕŒ Õ”∆ÕŒ œ≈–≈…“» ¬ –≈∆»Ã ƒ¿À‹Õ≈…ÿ≈√Œ œŒ»— ¿
			         ! œ≈–≈’Œƒ»Ã ¬ –≈∆»Ã ƒ¿À‹Õ≈…ÿ≈√Œ œŒ»— ¿  Œ–Õ≈…
			         IndexVilky=0 
                     INDEXDF=0 
					 Exf=ExfM(5) 
				  ENDIF
			 ENDIF
		
		ENDIF 
        
        ! œ–Œ¬≈–ﬂ≈Ã ”—“¿ÕŒ¬À≈Õ ‘¿ “ Õ¿À»◊»ﬂ  Œ–Õﬂ »À» Õ≈“
		IF(IKLPERZnak.EQ.1) THEN
           ! œ–Œ¬≈–ﬂ≈Ã ¬€œŒÀÕ»ÀŒ—‹ À» ”—ÀŒ¬»≈
           ! ÕŒÃ≈– Õ¿…ƒ≈ÕŒ√Œ  Œ–Õﬂ œŒ œŒ–ﬂƒ ”(»Õ“≈–¬¿À¿ ¬  Œ“Œ–ŒÃ Õ¿’Œƒ»“—ﬂ  Œ–≈Õ‹) —ŒŒ“¬≈“—“¬”≈“ √À¿¬ÕŒÃ”  ¬¿Õ“Œ¬ŒÃ” ◊»—À”
           ISolution=0
           IF(IndexCorrect.EQ.(NNEL+1)) THEN
              ISolution=1
		   ENDIF
		   
		   
		   IF(ISolution.EQ.1) THEN
              ! ‘» —»–”≈Ã –≈∆»Ã œŒ»— ¿  Œ–Õﬂ ¬ »Õ“≈–¬¿À≈
		      IndexVilky=2 
		      !WRITE(*,*) 'ZERO',IndexVilky
		      !WRITE(*,*) DetM(5),DetM(4),DetM(2),DetM(3)
		      !WRITE(*,*) ExfM(5),ExfM(4),ExfM(2),ExfM(3)
		      !READ(*,*) 
		      ! «¿œ»—€¬¿≈Ã √–¿Õ»÷€ »Õ“≈–¬¿À¿ 
              ExfMA(2)=ExfM(4)
		      DetMA(2)=DetM(4)
		      ExfMA(3)=ExfM(3)
		      DetMA(3)=DetM(3)
		      !WRITE(*,*) DetM(2),DetM(3)
		      !WRITE(*,*) ExfM(2),ExfM(3)
		      !READ(*,*)   
		      ! «¿Õ”Àﬂ≈Ã œ≈–≈ƒ œŒ»— ŒÃ  Œ–Õﬂ
		      ExfMA(1)=0.D0
		      DetMA(1)=0.D0
		      ExfMA(4)=0.D0
              DetMA(4)=0.D0
		      ExfMA(5)=0.D0
		      DetMA(5)=0.D0
		      INDEXDF=0 
           ENDIF
        ENDIF 
	
		  		    
   ENDIF

   ! –≈∆»Ã œŒ»— ¿  Œ–Õﬂ ¬ »Õ“≈–¬¿À≈
   IF(IndexVilky.EQ.2) THEN 
      ! Œ—”Ÿ≈—“¬Àﬂ≈Ã œŒ»—   Œ–Õﬂ ¬ Õ¿…ƒ≈ÕŒÃ »Õ“≈–¬¿À≈
      INDEXDF=INDEXDF+1
      ! ƒÀﬂ œ≈–¬Œ√Œ –¿«¿ ” ¿«€¬¿≈Ã œ–»¡À»∆≈ÕÕ€…  Œ–≈Õ‹
	  IF(INDEXDF.EQ.1) THEN
           Exf=(DetMA(3)*ExfMA(2)-DetMA(2)*ExfMA(3))/(DetMA(3)-DetMA(2))
		   ExfMA(1)=ExfMA(2)
           ExfMA(2)=ExfMA(3)
		   ExfMA(3)=Exf
		 ELSE
           ! œ–Œ¬≈–ﬂ≈Ã ¬  ¿ ŒÃ »« ƒ¬”’ »Õ“≈–¬¿À¿’  Œ–≈Õ‹
		   ! œ≈–¬€… »Õ“≈–¬¿À
		   IF((DetMA(1)*DetMA(3)).LT.0.D0) THEN
               IIKK=1
		       Exf=(DetMA(3)*ExfMA(1)-DetMA(1)*ExfMA(3))/(DetMA(3)-DetMA(1))
			   ExfMA(2)=ExfMA(3)
               ExfMA(3)=Exf
		   ENDIF
		   ! ¬“Œ–Œ… »Õ“≈–¬¿À
           IF((DetMA(3)*DetMA(2)).LT.0.D0) THEN
		       IIKK=2
               Exf=(DetMA(2)*ExfMA(3)-DetMA(3)*ExfMA(2))/(DetMA(2)-DetMA(3))
		       ExfMA(1)=ExfMA(3)
               ExfMA(3)=Exf
		   ENDIF
      ENDIF		  		   
   

      ! œ–Œ¬≈–ﬂ≈Ã Õ¿…ƒ≈Õ  Œ–≈Õ‹ »À» Õ≈“
	  ! œ–Œ¬≈–ﬂ≈Ã ¬€œŒÀÕ»ÀŒ—‹ À» ”—ÀŒ¬»≈
      ! œ–Œ¬≈–ﬂ≈Ã «Õ¿◊≈Õ»≈ Œœ–≈ƒ≈À»“≈Àﬂ ŒÕŒ ƒŒÀ∆ÕŒ ¡€“‹ Ã≈Õ‹ÿ≈ “Œ◊ÕŒ—“»
      ! Õ¿◊»Õ¿≈Ã œ–Œ¬≈–ﬂ“‹ ”—ÀŒ¬»≈ ¬ —À”◊¿≈ Œ¡Õ¿–”∆≈Õ»ﬂ »Õ“≈–¬¿À¿ √ƒ≈ Õ¿’Œƒ»“—ﬂ  Œ–≈Õ‹
      IF(INDEXDF.GT.1) THEN
         IF(DABS(DetMA(3)).LT.EPS) THEN
            !  Œ–≈Õ‹ Õ¿…ƒ≈Õ 
			! ‘» —»–”≈Ã Õ¿…ƒ≈ÕÕ€…  Œ–≈Õ‹
			IndexSolutions=IndexSolutions+1
			! «¿œ»—€¬¿≈Ã Õ¿…ƒ≈ÕÕ€…  Œ–≈Õ‹
			ExfSolutions(IndexSolutions)=Exf
			! œ≈–≈’Œƒ»Ã ¬ –≈∆»Ã ƒ¿À‹Õ≈…ÿ≈√Œ œŒ»— ¿  Œ–Õ≈…
			IndexVilky=0 
            INDEXDF=0 
			Exf=ExfTemp 
			!write(6,*) 'kor',NNEL,IndexSolutions,ExfSolutions(IndexSolutions)
         ENDIF
      ENDIF 
	  
	  ! ¬€’Œƒ »« ÷» À¿ œŒ œŒ»— ”  Œ–Õ≈… œ–Œ»«Œ…ƒ≈“ œ–» ”—ÀŒ¬»»
	  IF(IndexSolutions.EQ.3) THEN
	     ! ”—ÀŒ¬»≈ ¬€’Œƒ¿ ¬€œŒÀÕ≈ÕŒ
   	     IparametrDeterEnergy=2
		 ! —“¿Õƒ¿–“Õ€… ¬€’Œƒ 
		 INDEXGRNYT=0 
	  ENDIF 
	   
   ENDIF
    

  
   !WRITE(*,*) 'ITERASTION ZERO'
   !write(*,10685)  NEpsIter,IndexVilky,IndexCorrect,NNEL
   !write(*,19685)  DetM(1),DetM(3),DetM(2)
   !write(*,19685)  ExfM(1),ExfM(3),ExfM(2)
   !write(*,19685)  Exf
   !read(*,*)
   return
 end subroutine SearchSolutionAcceleratedLeft2




 ! œŒƒœ–Œ√–¿ÃÃ¿ »«Ã≈Õ≈Õ»ﬂ ÿ¿√¿
 subroutine ChangeHR(INDEXRShag,IKLCOMBEC,IIHD,IIOXDPZ,IndexCorrect,Henergy,RcoffChengH,ExfM,ProDet,DetM,INDEXPeresc,DeltaEnerPers,DeltaFunPers)
   implicit none
   integer::INDEXRShag,IKLCOMBEC,IIHD,IIOXDPZ,IndexCorrect,INDEXPeresc
   real(8)::Henergy,RcoffChengH,DeltaEnerPers,DeltaFunPers
   real(8),dimension(:)::ExfM,ProDet,DetM
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   integer::IndexZZ1,IndexZZ2
   real(8)::RcoffChengHOld,RDS,DeltaEnerPersOld,DeltaFunPersOld

   !  Àﬁ◊ ” ¿«€¬¿ﬁŸ»… Õ≈Œ¡’Œƒ»ÃŒ—“‹ ¬Œ«¬–¿Ÿ≈Õ»ﬂ Õ¿ ŒƒÕ” “Œ◊ ” Õ¿«¿ƒ
   IKLCOMBEC=0 
   
   ! ¬Œ«¬–¿Ÿ¿≈Ã ¬ »—’ŒƒÕŒ≈ —Œ—“ŒﬂÕ»≈ ÿ¿√
   Henergy=Henergy*RcoffChengH 
   ! «¿œ»—€¬¿≈Ã —“¿–Œ≈ «Õ¿◊≈Õ»≈ 
   RcoffChengHOld=RcoffChengH
   
   ! –¿—◊»“€¬¿≈Ã ÕŒ¬€…  Œ›‘‘»÷»≈Õ“
   RcoffChengH=ProDet(2)/ProDet(1)
   ! œ–Œ¬≈–ﬂ≈Ã  –»“≈–»…
   IF(RcoffChengH.GT.2.1D0) THEN
      RcoffChengH=RcoffChengH*2.D0
   ENDIF 
   ! Œ√–¿Õ»◊≈Õ»≈ œŒ ¬≈À»◊»Õ≈ ”Ã≈Õ‹ÿ≈Õ»ﬂ ÿ¿√¿
   ! Õ≈“ –≈∆»Ã¿ ”Ã≈Õ‹ÿ≈Õ»ﬂ ÿ¿√¿ ¬ 10 –¿«
   IF(RcoffChengH.GT.12.D0.AND.INDEXRShag.EQ.0) THEN
      RcoffChengH=12.D0
   ENDIF 
   ! ≈—“‹ –≈∆»Ã ”Ã≈Õ‹ÿ≈Õ»ﬂ ÿ¿√¿ ¬ 10 –¿« 
   IF(RcoffChengH.GT.20.D0.AND.INDEXRShag.NE.0) THEN
      RcoffChengH=20.D0
   ENDIF 

   IF(RcoffChengH.LT.1.D0) THEN
      RcoffChengH=1.D0
   ENDIF

   ! ¬Œ«ÃŒ∆Õ€≈  Œ––≈ “»–Œ¬ » ¬ –≈∆»Ã≈ ”Ã≈Õ‹ÿ≈Õ»ﬂ ÿ¿√¿ ¬ 10*IIHD –¿«
   
   IF(INDEXRShag.NE.0) THEN
      INDEXRShag=INDEXRShag+1
   ENDIF 

   RDS=RcoffChengH/RcoffChengHOld
   IF(RDS.GT.2.D0.AND.INDEXRShag.EQ.0) THEN
      ! œ≈–≈’Œƒ»Ã   –≈∆»Ã” ”Ã≈Õ‹ÿ≈Õ»ﬂ ÿ¿√¿
	  INDEXRShag=1 
	  ! Œ—”Ÿ≈—“¬Àﬂ≈Ã —Ã≈Ÿ≈Õ»≈ Õ¿ ŒƒÕ” “Œ◊ ” Õ¿«¿ƒ
	  IKLCOMBEC=1
	  ! ” ¿«€¬¿≈Ã  Œ›‘‘»÷»≈Õ“ ”Ã≈Õ‹ÿ≈Õ»ﬂ ÿ¿√¿
	  IIHD=1
   ENDIF

   ! œ–Œ¬≈–ﬂ≈Ã œ–Œ»—’Œƒ»“ œ–»¡À»∆≈Õ»≈   Õ”Àﬁ »À» Õ≈“
   IF(INDEXRShag.NE.0) THEN
      ! œ–Œ¬≈–ﬂ≈Ã ÕŒÃ≈–  Œ–Õﬂ 
	  ! — ¿◊≈  ¬Œ«Õ» ¿≈“ ƒÀﬂ ¬“Œ–Œ√Œ  Œ–Õﬂ » ¬€ÿ≈   
      IF(IndexCorrect.NE.0) THEN
         ! œ–Œ¬≈–ﬂ≈Ã œ–ŒÿÀ» ¬ –≈∆»Ã ”Ã≈Õ‹ÿ≈Õﬂ ÿ¿√¿ 
	     IF(IIOXDPZ.EQ.1) THEN
	        ! œ–Œ¬≈–ﬂ≈Ã ◊“Œ¡€ ‘”Õ ÷»» ¡€À» ¬ ŒƒÕŒ… Œ¡À¿—“»
	        IndexZZ1=0 
	        IF(DetM(5).GT.0.D0) THEN
               IndexZZ1=IndexZZ1+1 
	        ENDIF
            IF(DetM(4).GT.0.D0) THEN
               IndexZZ1=IndexZZ1+1 
	        ENDIF
	        IF(DetM(3).GT.0.D0) THEN
               IndexZZ1=IndexZZ1+1 
	        ENDIF
		    IF(DetM(2).GT.0.D0) THEN
               IndexZZ1=IndexZZ1+1 
	        ENDIF
            IndexZZ2=0 
            IF(DetM(5).LT.0.D0) THEN
               IndexZZ2=IndexZZ2+1 
	        ENDIF
            IF(DetM(4).LT.0.D0) THEN
               IndexZZ2=IndexZZ2+1 
	        ENDIF
	        IF(DetM(3).LT.0.D0) THEN
               IndexZZ2=IndexZZ2+1 
	        ENDIF
            IF(DetM(2).LT.0.D0) THEN
               IndexZZ2=IndexZZ2+1 
	        ENDIF
	        ! œ–Œ¬≈–ﬂ≈Ã ‘”Õ ÷»ﬂ Õ¿’Œƒ»“—ﬂ ¬ ŒƒÕŒ… Œ¡À¿—“»
            IF(IndexZZ1.EQ.4.OR.IndexZZ2.EQ.4) THEN
               ! œ–Œ¬≈–ﬂ≈Ã Õ≈ ¬Œ«Õ» À¿ —»“”¿÷»ﬂ œ≈–≈— Œ ¿ Œ“ œ–¿¬Œ… ◊¿—“» –¿«–€¬¿ ¬ À≈¬”ﬁ ◊¿—“‹ 
	           IF(DABS(DetM(3)).LT.DABS(DetM(2))) THEN
			      IF(DABS(DetM(5)).GT.DABS(DetM(4)).AND.DABS(DetM(4)).LT.DABS(DetM(3))) THEN
				     ! œŒœ¿À» ¬ –≈∆»Ã œ≈–≈— Œ ¿
					 INDEXPeresc=INDEXPeresc+1
                     ! –¿«Õ»÷¿ ›Õ≈–√»… œ–≈ƒ€ƒ”Ÿ≈≈ «Õ¿◊≈Õ»≈
                     DeltaEnerPersOld=DeltaEnerPers
					 ! –¿«Õ»÷¿ ‘”Õ ÷»… œ–≈ƒ€ƒ”Ÿ≈≈ «Õ¿◊≈Õ»≈ 
					 DeltaFunPersOld=DeltaFunPers
					 ! –¿«Õ»÷¿ ›Õ≈–√»… ƒ¿ÕÕ€… –¿—◊≈“
                     DeltaEnerPers=DABS(ExfM(5)*(1.D0-ExfM(4)/ExfM(5)))
					 ! –¿«Õ»÷¿ ‘”Õ ÷»… ƒ¿ÕÕ€… –¿—◊≈“
                     DeltaFunPers=DABS(DetM(5)*(1.D0-DetM(4)/DetM(5)))
					 IF(INDEXPeresc.EQ.1) THEN
	                    ! Œ—”Ÿ≈—“¬Àﬂ≈Ã —Ã≈Ÿ≈Õ»≈ Õ¿ ŒƒÕ” “Œ◊ ” Õ¿«¿ƒ
	                    IKLCOMBEC=1
                        ! ” ¿«€¬¿≈Ã  Œ›‘‘»÷»≈Õ“ ”Ã≈Õ‹ÿ≈Õ»ﬂ ÿ¿√¿
	                    IIHD=IIHD+2
		                ! œ–Œ¬≈–ﬂ≈Ã ¬€’Œƒ »« –≈∆»Ã¿ ”∆≈ ÃŒ∆≈“ ¡€“‹ Œ—”Ÿ≈—“¬À≈Õ »À» Õ≈“
                        IF(INDEXRShag.GT.25) THEN
                           ! ”Ã≈Õ‹ÿ¿≈Ã ◊»—ÀŒ »“≈–¿÷»… ¬ –≈∆»Ã≈ ”Ã≈Õ‹ÿ≈ÕÕŒ√Œ ÿ¿√¿, ◊“Œ¡€
		                   ! ŒÕ Õ≈ «¿ ŒÕ◊»À—ﬂ –¿Õ‹ÿ≈ “Œ√Œ  ¿  Œœ–≈ƒ≈À»“—ﬂ  Œ–≈Õ‹
			               INDEXRShag=INDEXRShag-1 
		                ENDIF
					 ENDIF
					 IF(INDEXPeresc.GT.1) THEN
                        ! –¿——Ã¿“–»¬¿≈Ã ¬€œŒÀÕ≈Õ»ﬂ  –»“≈–»ﬂ 
						! »Õ“≈–¬¿À Ã≈∆ƒ” “Œ◊¿Ã» — ¿◊ ¿ ”Ã≈Õ‹ÿ¿≈“—ﬂ » ”¬≈À»◊»¬¿≈“—ﬂ –¿«Õ»÷¿ Ã≈∆ƒ” «Õ¿◊≈Õ»ﬂÃ» ‘”Õ ÷»» — ¿◊ ¿
                        IF(DeltaEnerPers.LT.DeltaEnerPersOld.AND.(DeltaFunPers/DeltaEnerPersOld).GT.1.5D0) THEN
                             ! –¿«Õ»÷¿ Ã≈∆ƒ” «Õ¿◊≈Õ»ﬂÃ» ‘”Õ ÷»… — ”Ã≈Õ‹ÿ≈Õ»≈Ã »Õ“≈–¬¿À¿ ¬Œ«–¿—“¿≈“ —À≈ƒŒ¬¿“≈À‹ÕŒ ›“Œ –¿«–€¬
						     ! ≈—À» ›“Œ√Œ Õ≈ œ–Œ»—’Œƒ»“ ›“Œ — ¿◊≈  »  Œ–Õﬂ ¬ ¡À»«» — ¿◊ ¿ » ¬Œ«Õ» Õ≈“
						     ! Œ—”Ÿ≈—“¬Àﬂ≈Ã —Ã≈Ÿ≈Õ»≈ Õ¿ ŒƒÕ” “Œ◊ ” Õ¿«¿ƒ
	                         IKLCOMBEC=1
                             ! ” ¿«€¬¿≈Ã  Œ›‘‘»÷»≈Õ“ ”Ã≈Õ‹ÿ≈Õ»ﬂ ÿ¿√¿
	                         IIHD=IIHD+2
		                     ! œ–Œ¬≈–ﬂ≈Ã ¬€’Œƒ »« –≈∆»Ã¿ ”∆≈ ÃŒ∆≈“ ¡€“‹ Œ—”Ÿ≈—“¬À≈Õ »À» Õ≈“
                             IF(INDEXRShag.GT.25) THEN
                                ! ”Ã≈Õ‹ÿ¿≈Ã ◊»—ÀŒ »“≈–¿÷»… ¬ –≈∆»Ã≈ ”Ã≈Õ‹ÿ≈ÕÕŒ√Œ ÿ¿√¿, ◊“Œ¡€
		                        ! ŒÕ Õ≈ «¿ ŒÕ◊»À—ﬂ –¿Õ‹ÿ≈ “Œ√Œ  ¿  Œœ–≈ƒ≈À»“—ﬂ  Œ–≈Õ‹
			                    INDEXRShag=INDEXRShag-1 
		                     ENDIF
						   ELSE
						     ! –¿«–€¬¿ Õ≈“ ¬Œ«¬–¿Ÿ¿≈Ã—ﬂ ¬ –≈∆»Ã Œ“—”“—“¬»ﬂ œ≈–≈— Œ ¿ 
							 INDEXPeresc=0
						ENDIF
					 ENDIF
	              ENDIF
			   ENDIF    
            ENDIF
         ENDIF
      ENDIF
	    
	  ! –¿——◊»“€¬¿≈Ã  Œ›‘‘»÷»≈Õ“
      RcoffChengH=RcoffChengH*10.D0*DBLE(IIHD)
	  
	  ! œ–Œ¬≈–ﬂ≈Ã œ–Œ»—’Œƒ»“ œ–»¡À»∆≈Õ»≈   Õ”Àﬁ »À» Õ≈“
	  RDS=RcoffChengH/RcoffChengHOld
	  IF(RDS.GT.1.D0.AND.DABS(DetM(5)).LT.DABS(DetM(4))) THEN
	     ! ‘» —»–”≈Ã, ◊“Œ Ã€ œŒœ¿À» ¬ –≈∆»Ã ”Ã≈Õ‹ÿ≈Õ»ﬂ ÿ¿√¿
		 IIOXDPZ=1
	     ! ”Ã≈Õ‹ÿ¿≈Ã ◊»—ÀŒ »“≈–¿÷»… ¬ –≈∆»Ã≈ ”Ã≈Õ‹ÿ≈ÕÕŒ√Œ ÿ¿√¿, ◊“Œ¡€
		 ! ŒÕ Õ≈ «¿ ŒÕ◊»À—ﬂ –¿Õ‹ÿ≈ “Œ√Œ  ¿  Œœ–≈ƒ≈À»“—ﬂ  Œ–≈Õ‹ 
		 IF(INDEXRShag.NE.1) THEN
            INDEXRShag=INDEXRShag-1
		 ENDIF
	  ENDIF

   ENDIF
 
   
   IF(INDEXRShag.GT.25) THEN
      ! œŒ—À≈ 25-“» »“≈–¿÷»…
	  ! ¬Œ«¬–¿Ÿ¿≈Ã—ﬂ Œ¡–¿“ÕŒ
	  RcoffChengH=RcoffChengH/(10.D0*DBLE(IIHD)) 
   ENDIF
   
   Henergy=Henergy/RcoffChengH
   
   return
 end subroutine ChangeHR


 ! œŒƒœ–Œ√–¿ÃÃ¿ Œ—”Ÿ≈—“¬Àﬂ≈“ –¿—◊≈“ œ¿–¿Ã≈“–Œ¬ œ–Œ√ŒÕ »
 ! NKLZ- Àﬁ◊ ” ¿«¬¿ﬁŸ»… “»œ –¿—◊≈“¿
 ! NKLZ=1-–¿—◊≈“ œ¿–¿Ã≈“–Œ¬ ƒÀﬂ —À”◊¿ﬂ ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€ ”–¿¬Õ≈Õ»…
 ! NKLZ=2-–¿—◊≈“ œ¿–¿Ã≈“–Œ¬ ƒÀﬂ —À”◊¿ﬂ Õ≈ŒƒÕŒ–ŒƒÕŒ… —»—“≈Ã€ ”–¿¬Õ≈Õ»…
 ! IndexM-–¿«Ã≈– Ã¿——»¬¿
 ! Kpoint-ÕŒÃ≈– “Œ◊ » —ÿ»¬ »
 ! Npoint-◊»—ÀŒ “Œ◊≈ 
 ! AA(IndexM,IndexM,Npoint)-Ã¿——»¬ A 
 ! BB(IndexM,IndexM,Npoint)-Ã¿——»¬ B
 ! FX(IndexM,Npoint)-Ã¿——»¬ F
 ! Vout(IndexM,IndexM,Npoint)-Ã¿——»¬ œ–Œ√ŒÕ » œŒ Õ¿œ–¿¬À≈Õ»ﬁ "Õ¿–”∆”"
 ! Uout(IndexM,Npoint)-Ã¿——»¬ œ–Œ√ŒÕ » œŒ Õ¿œ–¿¬À≈Õ»ﬁ "Õ¿–”∆”"
 ! Vin(IndexM,IndexM,Npoint)-Ã¿——»¬ œ–Œ√ŒÕ » œŒ Õ¿œ–¿¬À≈Õ»ﬁ "¬Õ”“–‹"
 ! Uin(IndexM,Npoint)-Ã¿——»¬ œ–Œ√ŒÕ » œŒ Õ¿œ–¿¬À≈Õ»ﬁ "¬Õ”“–‹"
 ! VNout,UNout,VNin,UNin,AZ,BZ,FZ,DZ,E,AX,BX-¬—œŒÃŒ√¿“≈À‹Õ€≈ Ã¿——»¬€ ƒÀﬂ –¿—◊≈“¿
 subroutine CalculationParameterProgonky(NKLZ,IndexM,Kpoint,Npoint,AA,BB,FX,Vout,Uout,Vin,Uin,VNout,UNout,VNin,UNin,AZ,BZ,FZ,DZ,E,AX,BX)
   implicit none
   integer::NKLZ,IndexM,NumeroMin,NumeroMax,Kpoint,Npoint
   real(8),dimension(:)::UNout,UNin,AX,BX
   real(8),dimension(:,:)::FX,Uout,Uin,VNout,VNin,AZ,BZ,FZ,DZ,E
   real(8),dimension(:,:,:)::AA,BB,Vout,Vin
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   integer::IIDF,IIXX,IIYY
   45352 FORMAT(2X,100(F15.10,1X))
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   !!Œ—”Ÿ≈—“¬Àﬂ≈Ã œ–Œ√ŒÕ ” Õ¿–”∆” "OUT"!!
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   call ReadWriteMassiv2(2,1,IndexM,AA,AZ)
   call ReadWriteMassiv2(2,3,IndexM,AA,FZ)
   call ReadWriteMassiv2(2,2,IndexM,BB,BZ) 
   ! –≈ÿ¿≈Ã ”–¿¬Õ≈Õ»ﬂ »“≈–¿÷»ŒÕÕ€Ã Ã≈“ŒƒŒÃ œŒÀ”◊¿≈Ã œ¿–¿Ã≈“–€ œ–Œ√ŒÕ » ¬ œ≈–¬Œ… “Œ◊ »
   call IterationSolutionEquations(AZ,FZ,BZ,VNout) 
   ! ÙÓÏËÛÂÏ Ï‡ÒÒË‚˚ ‚ Ì‡˜‡Î¸ÌÓÈ ÚÓ˜ÍË 1,2
   call ReadWriteMassiv2(1,1,IndexM,Vout,VNout)
   call ReadWriteMassiv2(1,2,IndexM,Vout,VNout)
   !WRITE(6,*) 'POINT',1
   !DO IIXX=1,IndexM
   !   WRITE(6,45352) (VNout(IIXX,IIYY),IIYY=1,IndexM)
   !ENDDO

   IF(NKLZ.EQ.2) THEN 
      AX=0.D0
      call ReadWriteMassiv1(1,1,IndexM,Uout,AX) 
      call ReadWriteMassiv1(1,2,IndexM,Uout,AX) 
   ENDIF
    
   DO IIDF=3,Kpoint+1
      ! —◊»“€¬¿≈Ã Ã¿——»¬€
	  call ReadWriteMassiv2(2,IIDF-1,IndexM,AA,AZ)
      call ReadWriteMassiv2(2,IIDF+1,IndexM,AA,FZ)
      call ReadWriteMassiv2(2,IIDF,IndexM,BB,BZ) 
      call ReadWriteMassiv2(2,IIDF-1,IndexM,Vout,E)
      DZ=BZ-MATMUL(AZ,E)
      ! Õ¿’Œƒ»Ã Œ¡–¿“Õ”ﬁ Ã¿“–»÷”
	  call InverseMatrix(DZ,DZ)
      VNout=MATMUL(DZ,FZ)
      ! «¿œ»—€¬¿≈Ã –≈«”À‹“¿“ –¿—◊≈“¿ ƒÀﬂ ƒ¿ÕÕŒ… “Œ◊ » ¬ Ã¿——»¬ Vout
	  call ReadWriteMassiv2(1,IIDF,IndexM,Vout,VNout)
      
      !WRITE(6,*) 'POINT',IIDF
      !DO IIXX=1,IndexM
      !   WRITE(6,45352) (VNout(IIXX,IIYY),IIYY=1,IndexM)
      !ENDDO


	  ! ”—“¿Õ¿¬À»¬¿≈Ã “»œ –¿—◊≈“¿ 
	  IF(NKLZ.EQ.2) THEN 
         call ReadWriteMassiv1(2,IIDF,IndexM,FX,AX)
		 call ReadWriteMassiv1(2,IIDF-1,IndexM,Uout,BX)
		 UNout=MATMUL(DZ,MATMUL(AZ,BX)-AX)  
		 ! «¿œ»—€¬¿≈Ã –≈«”À‹“¿“ –¿—◊≈“¿
         call ReadWriteMassiv1(1,IIDF,IndexM,Uout,UNout) 
	  ENDIF 
   ENDDO

   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   ! Œ—”Ÿ—“¬Àﬂ≈Ã œ–Œ√ŒÕ ” ¬Õ”“–‹ "IN"!!!!!!!!!!!!!!!!!!
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   call ReadWriteMassiv2(2,Npoint,IndexM,AA,AZ)
   call ReadWriteMassiv2(2,Npoint-2,IndexM,AA,FZ)
   call ReadWriteMassiv2(2,Npoint-1,IndexM,BB,BZ) 
   ! –≈ÿ¿≈Ã ”–¿¬Õ≈Õ»ﬂ »“≈–¿÷»ŒÕÕ€Ã Ã≈“ŒƒŒÃ œŒÀ”◊¿≈Ã œ¿–¿Ã≈“–€ œ–Œ√ŒÕ » ¬ œŒ—À≈ƒÕ≈… “Œ◊ »
   call IterationSolutionEquations(AZ,FZ,BZ,VNin) 
   
   ! ÙÓÏËÛÂÏ Ï‡ÒÒË‚˚ ‚ ÍÓÌÂ˜ÌÓÈ ÚÓ˜ÍË Npoint,Npoint-1
   call ReadWriteMassiv2(1,Npoint,IndexM,Vin,VNin)
   call ReadWriteMassiv2(1,Npoint-1,IndexM,Vin,VNin)
   
   IF(NKLZ.EQ.2) THEN 
      AX=0.D0
      call ReadWriteMassiv1(1,Npoint,IndexM,Uin,AX) 
      call ReadWriteMassiv1(1,Npoint-1,IndexM,Uin,AX) 
   ENDIF
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   !!Œ—”Ÿ≈—“¬Àﬂ≈Ã œ–Œ√ŒÕ ” ¬Õ”“–‹ "IN"!!
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   DO IIDF=Npoint-2,Kpoint+1,-1
      ! —◊»“€¬¿≈Ã Ã¿——»¬€
	  call ReadWriteMassiv2(2,IIDF-1,IndexM,AA,AZ)
      call ReadWriteMassiv2(2,IIDF+1,IndexM,AA,FZ)
      call ReadWriteMassiv2(2,IIDF,IndexM,BB,BZ) 
      call ReadWriteMassiv2(2,IIDF+1,IndexM,Vin,E)
      DZ=BZ-MATMUL(FZ,E)
      ! Õ¿’Œƒ»Ã Œ¡–¿“Õ”ﬁ Ã¿“–»÷”
      call InverseMatrix(DZ,DZ)
      VNin=MATMUL(DZ,AZ)
      ! «¿œ»—€¬¿≈Ã –≈«”À‹“¿“ –¿—◊≈“¿ ƒÀﬂ ƒ¿ÕÕŒ… “Œ◊ » ¬ Ã¿——»¬ Vin
	  call ReadWriteMassiv2(1,IIDF,IndexM,Vin,VNin)
      
	  ! ”—“¿Õ¿¬À»¬¿≈Ã “»œ –¿—◊≈“¿ 
	  IF(NKLZ.EQ.2) THEN 
         call ReadWriteMassiv1(2,IIDF,IndexM,FX,AX)
		 call ReadWriteMassiv1(2,IIDF+1,IndexM,Uin,BX)
		 UNin=MATMUL(DZ,MATMUL(FZ,BX)-AX)  
		 ! «¿œ»—€¬¿≈Ã –≈«”À‹“¿“ –¿—◊≈“¿
         call ReadWriteMassiv1(1,IIDF,IndexM,Uin,UNin) 
	  ENDIF 
   ENDDO


   return
 end subroutine CalculationParameterProgonky


 ! œŒƒœ–Œ√–¿ÃÃ¿ –≈ÿ≈Õ»ﬂ Ã¿“–»◊ÕŒ√Œ ”–¿¬Õ≈Õ»ﬂ »“≈–¿÷»ŒÕÕ€Ã Ã≈“ŒƒŒÃ 
 subroutine IterationSolutionEquations(A1,A3,B2,V)
   implicit none
   real(8),dimension(:,:)::A1,A3,B2,V
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   integer::n,ierr,IIKL,IOUP,IASS,IKLP
   real(8)::delta
   real(8),parameter::epsd=1.d-40
   real(8),allocatable,dimension(:,:)::V1,V2,DeltaV,C
   
   n=size(V,dim=1)

   ! ¬€ƒ≈Àﬂ≈Ã œﬂÃﬂ“‹ œŒƒ Ã¿——»¬€
   allocate(C(n,n),stat=ierr)
   if(ierr/=0) then
      write(*,*) 'IterationSolutionEquations'
      write(*,*) 'MEMORY ON THE FILE "C" IS NOT SELECTED'
  	  read(*,*)
	  stop 
   endif  
   allocate(V1(n,n),stat=ierr)
   if(ierr/=0) then
      write(*,*) 'IterationSolutionEquations'
      write(*,*) 'MEMORY ON THE FILE "V1" IS NOT SELECTED'
  	  read(*,*)
	  stop 
   endif   
   allocate(V2(n,n),stat=ierr)
   if(ierr/=0) then
      write(*,*) 'IterationSolutionEquations'
      write(*,*) 'MEMORY ON THE FILE "V2" IS NOT SELECTED'
	  read(*,*)
	  stop 
   endif   
   allocate(DeltaV(n,n),stat=ierr)
   if(ierr/=0) then
      write(*,*) 'IterationSolutionEquations'
      write(*,*) 'MEMORY ON THE FILE "DeltaV" IS NOT SELECTED'
	  read(*,*)
	  stop 
   endif

   59412 FORMAT(2X,100(F15.10,1X))
   !write(6,*) 'B2'
   !DO IASS=1,n
   !   WRITE(6,59412) (B2(IASS,IKLP),IKLP=1,n)
   !ENDDO
 
   !write(6,*) 'A1'
   !DO IASS=1,n
   !   WRITE(6,59412) (A1(IASS,IKLP),IKLP=1,n)
   !ENDDO
  
   !write(6,*) 'A3'
   !DO IASS=1,n
   !   WRITE(6,59412) (A3(IASS,IKLP),IKLP=1,n)
   !ENDDO
   !STOP
   ! Õ¿◊¿À‹ÕŒ≈ œ–»¡À»∆≈Õ»≈
   C=B2
   ! Õ¿’Œƒ»Ã Œ–¡¿“Õ”ﬁ Ã¿“–»÷”
   call InverseMatrix(C,C)
   V1=MATMUL(C,A3)   
   V2=V1
   delta=1.D0
   DO WHILE(delta.GT.epsd) 
      C=B2-MATMUL(A1,V1)
	  ! Õ¿’Œƒ»Ã Œ–¡¿“Õ”ﬁ Ã¿“–»÷”
      call InverseMatrix(C,C)
	  V1=MATMUL(C,A3)
      DeltaV=V1-V2
      ! «¿œ»—€¬¿≈Ã –≈«”À‹“¿“ –¿—◊≈“¿ ƒÀﬂ ÕŒ¬Œ… »“≈–¿÷»»
	  V2=V1
      ! Œœ–≈ƒ≈Àﬂ≈Ã ƒ≈“≈–Ã»Õ¿Õ“ Ã¿“–»÷€
	  delta=DABS(Determenant(DeltaV))
   ENDDO
   
   ! «¿œ»—€¬¿≈Ã –≈«”À‹“¿“ –¿—◊≈“¿ œŒÀ”◊≈ÕÕŒ√Œ »“≈–¿÷»ŒÕÕ€Ã Ã≈“ŒƒŒÃ 
   V=V2 
 

   ! ”ƒ¿À≈Õ»≈ Ã¿——»¬Œ¬ »« œﬂÃﬂ“»
   deallocate(C,stat=ierr)
   if(ierr/=0) then
      write(*,*) 'IterationSolutionEquations'
      write(*,*) 'THE FILE "C" IS NOT REMOVED FROM MEMORY'
	  read(*,*) 
	  stop 
   endif
   deallocate(V1,stat=ierr)
   if(ierr/=0) then
      write(*,*) 'IterationSolutionEquations'
      write(*,*) 'THE FILE "V1" IS NOT REMOVED FROM MEMORY'
	  read(*,*) 
	  stop 
   endif
   deallocate(V2,stat=ierr)
   if(ierr/=0) then
      write(*,*) 'IterationSolutionEquations'
      write(*,*) 'THE FILE "V2" IS NOT REMOVED FROM MEMORY'
	  read(*,*)
	  stop 
   endif
   deallocate(DeltaV,stat=ierr)
   if(ierr/=0) then
      write(*,*) 'IterationSolutionEquations'
      write(*,*) 'THE FILE "DeltaV" IS NOT REMOVED FROM MEMORY'
	  read(*,*)
	  stop 
   endif

   return
 end subroutine IterationSolutionEquations


 ! œŒƒœ–Œ√–¿ÃÃ¿ –¿—◊≈“¿ Œœ–≈ƒ≈À»“≈Àﬂ Ã¿“–»÷€ 
 ! n-‡ÁÏÂ Ï‡ÚËˆ˚
 ! a(n,n)-Ï‡ÚËˆ‡	
 real(8) function Determenant(a)
   use msimsl,nouse=>fac
   implicit none
   real(8),dimension(:,:)::a
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   integer::n,ierr
   real(8)::det1,det2
   integer,allocatable,dimension(:)::ipvt   
   real(8),allocatable,dimension(:,:)::fac
 
   n=size(a,dim=1)	
   ! ¬€ƒ≈Àﬂ≈Ã œﬂÃﬂ“‹ œŒƒ Ã¿——»¬€
   allocate(fac(n,n),stat=ierr)
   if(ierr/=0) then
      write(*,*) 'Determenant'
      write(*,*) 'MEMORY ON THE FILE "fac" IS NOT SELECTED'
  	  read(*,*)
	  stop 
   endif   
   allocate(ipvt(n),stat=ierr)
   if(ierr/=0) then
      write(*,*) 'Determenant'
      write(*,*) 'MEMORY ON THE FILE "ipvt" IS NOT SELECTED'
	  read(*,*)
	  stop 
   endif   



   !LU-–¿«ÀŒ∆≈Õ»≈
   call DLftrg(n,a,n,fac,n,ipvt)
   call DLfdrg(n,fac,n,ipvt,det1,det2)
   
   Determenant=det1*(10.D0)**det2 

   ! ”ƒ¿À≈Õ»≈ Ã¿——»¬Œ¬ »« œﬂÃﬂ“» 
   deallocate(fac,stat=ierr)
   if(ierr/=0) then
      write(*,*) 'Determenant'
      write(*,*) 'THE FILE "fac" IS NOT REMOVED FROM MEMORY'
	  read(*,*) 
	  stop 
	endif
      deallocate(ipvt,stat=ierr)
	if(ierr/=0) then
	  write(*,*) 'Determenant'
      write(*,*) 'THE FILE "ipvt" IS NOT REMOVED FROM MEMORY'
	  read(*,*)
	  stop 
	endif

	return    
  end function  Determenant

 ! œŒƒœ–Œ√–¿ÃÃ¿ Œœ–≈ƒ≈ÀﬂﬁŸ¿ﬂ “Œ◊ ” —ÿ»¬ » –≈ÿ≈Õ»… OUT AND IN
 ! Npoint-◊»—ÀŒ “Œ◊≈ 
 ! NumeroMin-Ã»Õ»Ã¿À‹Õ€… ÕŒÃ≈– √¿–ÃŒÕ» »
 ! Exf-ŒƒÕŒ›À≈ “–ŒÕÕ¿ﬂ ›Õ≈–√»ﬂ ’¿–“–»-‘Œ ¿ (ÃŒÀ≈ ”Àﬂ–ÕŒ… Œ–¡»“¿À»)
 ! Pz(NumbreGarmMO(NMO),NumbreGarmMO(NMO),Npoint) - Ã¿——»¬ «Õ¿◊≈Õ»… P(ro)-˜‡ÒÚË ÎÓ„‡Î¸ÌÓÈ ÙÛÌÍˆËË P ‚ıÓ‰ˇ˘ÂÈ ‚ Û‡‚ÌÂÌËÂ Y''=P*Y+Q-ÀŒ ¿À‹Õ¿ﬂ ◊¿—“‹ œŒ“≈Õ÷»¿À¿
 ! RO1X(Npoint)- Ã¿——»¬ «Õ¿◊≈Õ»… œ≈–¬Œ… œ–Œ»«¬ŒƒÕŒ… œŒ ÕŒ¬Œ… œ≈–≈Ã≈ÕÕŒ…
 ! Kpoint-ÕŒÃ≈– “Œ◊ » —ÿ»¬ » –≈ÿ≈Õ»…
 subroutine PointIntersection(Npoint,NumeroMin,Exf,Pz,RO1X,Kpoint)
   implicit none
   integer::Npoint,NumeroMin,Kpoint
   real(8)::Exf
   real(8),dimension(:)::RO1X
   real(8),dimension(:,:,:)::Pz
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   integer::IIDXK,IKLW,NumeroKoren,Isumk
   real(8)::F1,F2
   
   ! ÕŒÃ≈–  Œ–Õﬂ œ–»Õ»Ã¿≈√Œ «¿ “Œ◊ ” —ÿ»¬ »
   NumeroKoren=1
    
   IKLW=1
   Isumk=0
   DO WHILE(IKLW.EQ.1) 
	  F1=Pz(NumeroMin,NumeroMin,1)+Exf/RO1X(1)**2 
      DO IIDXK=2,Npoint
         F2=Pz(NumeroMin,NumeroMin,IIDXK)+Exf/RO1X(IIDXK)**2
		 IF(F1*F2.LT.0.D0) THEN
		    Isumk=Isumk+1
			! Õ¿…ƒ≈Õ  Œ–≈Õ‹
            IF(Isumk.EQ.NumeroKoren) THEN 
	           Kpoint=IIDXK-1
	 	       IKLW=2
	           EXIT
		    ENDIF
		 ENDIF 
	     F1=F2
      ENDDO
      !  Œ––≈ “»–”≈Ã «Õ¿◊≈Õ»≈ ›Õ≈–√»»
	  IF(IKLW.EQ.1) THEN
         Exf=Exf*0.8D0 
      ENDIF
   ENDDO 
   return
 end subroutine PointIntersection


 ! œŒƒœ–Œ√–¿ÃÃ¿ ◊“≈Õ»ﬂ »« Ã¿——»¬¿ ¬ Ã¿——»¬
 ! NN-ÕŒÃ≈– “Œ◊ »  Œ“Œ–Œ… —ŒŒ“¬≈“—“¬”≈“ Ã¿“–»÷€
 ! NumeroMin,NumeroMax-Ã»Õ»Ã¿À‹ÕŒ≈ » Ã¿ —»Ã¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ »Õƒ≈ —¿
 ! D(N1,N2,N3)-“–≈’Ã≈–Õ€… Ã¿——»¬
 ! A(N1,N2)-ƒ¬”’Ã≈–Õ€… Ã¿——»¬ 
 subroutine ReadWriteMassiv2X(NN,NumeroMin,NumeroMax,D,A) 
   implicit none
   integer::KL,NN,NumeroMin,NumeroMax
   real(8),dimension(:,:)::A
   real(8),dimension(:,:,:)::D
   !!!!!!!!!!!!!!!!!!!!!!!!!!!
   integer::IIDX,IIDY,IXXK,YXXK

   ! ◊“≈Õ»≈ »« Ã¿——»¬¿
   !IXXK=0
   !DO IIDX=NumeroMin,NumeroMax
   !   IXXK=IXXK+1
   !   YXXK=0
   !   DO IIDY=NumeroMin,NumeroMax
   !      YXXK=YXXK+1
   !	  A(IXXK,YXXK)=D(IIDY,IIDX,NN)
   !   ENDDO
   ! ENDDO


   FORALL (IIDX=NumeroMin:NumeroMax)
     FORALL (IIDY=NumeroMin:NumeroMax)
       A(IIDX-NumeroMin+1,IIDY-NumeroMin+1)=D(IIDY,IIDX,NN) 
	 END FORALL
   END FORALL

   return
 end subroutine ReadWriteMassiv2X

 ! œŒƒœ–Œ√–¿ÃÃ¿ ◊“≈Õ»ﬂ » «¿œ»—»  Ã¿——»¬¿ ¬ Ã¿——»¬
 ! KL=1- Àﬁ◊ ◊“≈Õ»ﬂ
 ! KL=2- Àﬁ◊ «¿œ»—»
 ! NN-ÕŒÃ≈– “Œ◊ »  Œ“Œ–Œ… —ŒŒ“¬≈“—“¬”≈“ Ã¿“–»÷€
 ! NumeroMin,NumeroMax-Ã»Õ»Ã¿À‹ÕŒ≈ » Ã¿ —»Ã¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ »Õƒ≈ —¿
 ! D(N1,N2)-ƒ¬”’Ã≈–Õ€… Ã¿——»¬
 ! A(N1)-ŒƒÕŒÃ≈–Õ€… Ã¿——»¬ 
 subroutine ReadWriteMassiv1X(KL,NN,NumeroMin,NumeroMax,D,A) 
   implicit none
   integer::KL,NN,NumeroMin,NumeroMax
   real(8),dimension(:)::A
   real(8),dimension(:,:)::D
   !!!!!!!!!!!!!!!!!!!!!!!!!!!
   integer::IIDX,IXXD

   ! «¿œ»—» ¬ Ã¿——»¬
   IF(KL.EQ.1) THEN  
      !IXXD=0
      !DO IIDX=NumeroMin,NumeroMax
      !   IXXD=IXXD+1
	  !   D(IIDX,NN)=A(IXXD)
      !ENDDO
	  FORALL (IIDX=NumeroMin:NumeroMax)
        D(IIDX,NN)=A(IIDX-NumeroMin+1)
	  END FORALL
   ENDIF
   
   ! ◊“≈Õ»≈ »« Ã¿——»¬¿
   IF(KL.EQ.2) THEN  
	  !IXXD=0
      !DO IIDX=NumeroMin,NumeroMax
      !   IXXD=IXXD+1
	  !   A(IXXD)=D(IIDX,NN)
      !ENDDO
	  FORALL (IIDX=NumeroMin:NumeroMax) 
        A(IIDX-NumeroMin+1)=D(IIDX,NN) 
	  END FORALL
   ENDIF
   
   return
 end subroutine ReadWriteMassiv1X








 ! œŒƒœ–Œ√–¿ÃÃ¿ ◊“≈Õ»ﬂ » «¿œ»—» Ã¿——»¬¿ ¬ Ã¿——»¬
 ! KL=1- Àﬁ◊ ◊“≈Õ»ﬂ
 ! KL=2- Àﬁ◊ «¿œ»—»
 ! NN-ÕŒÃ≈– Œ◊ »  Œ“Œ–Œ… —ŒŒ“¬≈“—“¬”≈“ Ã¿“–»÷€
 ! IndexM-Ã¿ —»Ã¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ »Õƒ≈ —¿
 ! D(N1,N2,N3)-“–≈’Ã≈–Õ€… Ã¿——»¬
 ! A(N1,N2)-ƒ¬”’Ã≈–Õ€… Ã¿——»¬ 
 subroutine ReadWriteMassiv2(KL,NN,IndexM,D,A) 
   implicit none
   integer::KL,NN,IndexM
   real(8),dimension(:,:)::A
   real(8),dimension(:,:,:)::D
   !!!!!!!!!!!!!!!!!!!!!!!!!!!
   integer::IIDX,IIDY

   ! «¿œ»—‹ ¬ Ã¿——»¬
   IF(KL.EQ.1) THEN
      !DO IIDX=1,IndexM
      !   DO IIDY=1,IndexM
      !      D(IIDY,IIDX,NN)=A(IIDY,IIDX)
	  !	 ENDDO
	  !ENDDO
      FORALL (IIDX=1:IndexM)
        FORALL (IIDY=1:IndexM)
          D(IIDY,IIDX,NN)=A(IIDY,IIDX)
		END FORALL
	  END FORALL
   ENDIF 
   
   ! ◊“≈Õ»≈ »« Ã¿——»¬¿
   IF(KL.EQ.2) THEN
      !DO IIDX=1,IndexM
      !   DO IIDY=1,IndexM
      !      A(IIDY,IIDX)=D(IIDY,IIDX,NN)
	  !	 ENDDO
	  !ENDDO
      FORALL (IIDX=1:IndexM)
	    FORALL (IIDY=1:IndexM)
          A(IIDY,IIDX)=D(IIDY,IIDX,NN)
		END FORALL
	  END FORALL 
   ENDIF 


   return
 end subroutine ReadWriteMassiv2

 ! œŒƒœ–Œ√–¿ÃÃ¿ ◊“≈Õ»ﬂ » «¿œ»—» Ã¿——»¬¿ ¬ Ã¿——»¬
 ! KL=1- Àﬁ◊ ◊“≈Õ»ﬂ
 ! KL=2- Àﬁ◊ «¿œ»—»
 ! NN-ÕŒÃ≈– Œ◊ »  Œ“Œ–Œ… —ŒŒ“¬≈“—“¬”≈“ Ã¿“–»÷€
 ! IndexM-Ã¿ —»Ã¿À‹ÕŒ≈ «Õ¿◊≈Õ»≈ »Õƒ≈ —¿
 ! D(N1,N2)-ƒ¬”’Ã≈–Õ€… Ã¿——»¬
 ! A(N1)-ŒƒÕŒÃ≈–Õ€… Ã¿——»¬ 
 subroutine ReadWriteMassiv1(KL,NN,IndexM,D,A) 
   implicit none
   integer::KL,NN,IndexM
   real(8),dimension(:)::A
   real(8),dimension(:,:)::D
   !!!!!!!!!!!!!!!!!!!!!!!!!!!
   integer::IIDX

   ! «¿œ»—‹ ¬ Ã¿——»¬
   IF(KL.EQ.1) THEN
      !DO IIDX=1,IndexM
      !   D(IIDX,NN)=A(IIDX)
	  !ENDDO
	  FORALL (IIDX=1:IndexM) D(IIDX,NN)=A(IIDX)
   ENDIF 
   
   ! ◊“≈Õ»≈ »« Ã¿——»¬¿
   IF(KL.EQ.2) THEN
      !DO IIDX=1,IndexM
      !   A(IIDX)=D(IIDX,NN)
	  !ENDDO
	  FORALL (IIDX=1:IndexM) A(IIDX)=D(IIDX,NN)
   ENDIF 


   return
 end subroutine ReadWriteMassiv1

 ! œŒƒœ–Œ√–¿ÃÃ¿ –¿—◊≈“¿ Œ¡–¿“ÕŒ… Ã¿“–»÷€
 ! N-–¿«Ã≈–  ¬¿ƒ–¿“ÕŒ… Ã¿“–»÷€
 ! A(N,N)- ¬¿ƒ–¿“Õ¿ﬂ Ã¿“–»÷¿
 ! B(N,N)-Œ¡–¿“Õ¿ﬂ  ¬¿ƒ–¿“Õ¿ﬂ Ã¿“–»÷¿
 subroutine InverseMatrix(A,B)
   use msimsl
   implicit none
   real(8),dimension(:,:)::A,B
   !!!!!!!!!!!!!!!!!!!!!!!!!!!
   integer::N
   
   N=size(A,dim=1)

   call DLINRG(N,A,N,B,N)

   return
 end subroutine InverseMatrix

end module msde
